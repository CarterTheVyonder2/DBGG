!function(){"use strict";String.prototype.format=function(t){if(!t)return this;var e=this;if(t instanceof Array)for(var i=0;i<t.length;i++)null!=t[i]&&(e=e.replace(new RegExp("({)"+i+"(})","g"),t[i]));else if(Object.is(t))for(var s in t)null!=t[s]&&(e=e.replace(new RegExp("({"+s+"})","g"),t[s]));return e},String.is=function(t){return"string"==typeof t},Function.is=function(t){return"function"==typeof t},Object.is=function(t){return"object"==typeof t},Object.empty=function(t){if(!Object.is(t))return!0;for(const e in t)return!1;return!0},Object.has1=function(t){if(!Object.is(t))return!1;for(const e in t)if(t[e])return!0;return!1},Map.has1=function(t){if(!(t&&t instanceof Map))return!1;let e=t.values();if(!e)return!1;for(const t of e)if(t)return!0;return!1},Map.prototype.has1=function(){return Map.has1(this)};var s={};class a{registerView(t,e,i){i||(i={}),i.mgr=this,s.uiViewMgr.registerView(t,e,i)}bindDataKey(t,e,i){s.d.bindKey(this,t,e,i)}}s.Module=a;class r{constructor(){this.modules=[],this.moduleTbl=new Map}preInit(){s.gMsgCet.on("CMEVT_ON_SHOW",this,t=>{this.doModulesFun("onGameShow",t)}),s.gMsgCet.on("CMEVT_ON_HIDE",this,t=>{this.doModulesFun("onGameHide",t)})}addModule(t){let e=new t;return t.i=e,this.addModuleObj(t,e)}addModuleObj(t,e){return this.modules.push(e),this.addModuleToTbl(t,e),e}addModuleToTbl(t,e){this.moduleTbl.set(t,e)}getModule(t){return this.getModleFromTbl(t)}getModleFromTbl(t){return this.moduleTbl.get(t)}doModulesFun(t,e){for(let i=0;i<this.modules.length;i++){let s=this.modules[i];s&&s[t]&&s[t](e)}}onGameStart(){this.doModulesFun("onGameStart")}onGameReady(){this.doModulesFun("onGameReady")}doModulesPreInit(){this.doModulesFun("preInit")}doModulesInit(){this.doModulesFun("init")}doModulesLateInit(){this.doModulesFun("lateInit")}}s.ModuleMgr=r;class o extends a{bindPros(t,e){if(!t||!e)return t;for(let i in e)t[i]=e[i];return t}getQueryObj(t){let e={};return(t||window.location.href).substring(t.lastIndexOf("?")+1).replace(/([^?&=]+)=([^?&=]*)/g,function(t,i,s){return e[i]=String(s),t}),e}getQueryVal(t,e){let i=e&&(t||window.location.href).substring(t.lastIndexOf("?")+1).match(new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"));return i&&i[2]}checkListVal(t,e){return e&&e[(t-1)%e.length]}}s.Util=o;class h extends a{constructor(){super(),this._dataDic=new Map,this._evtCtrl=new l,this._fetchCtrl=new d}lateInit(){this.checkClearOnTimer()}onGameShow(){this.checkClearOnTimer()}onGameHide(){}get(t,e){let i=this.getKeyPro(t);return i&&(i.local&&(void 0===i.value||null===i.value)&&(i.value=this.getLocal(t))||i.clear&&this.checkGetClear(t,i)||i.fetch&&this.fetch(t,e)||Function.is(i.value)&&i.value(e,t)||i.value||i.dv)}set(t,e){let i=this.getKeyPro(t);return(i&&i.value)!=e&&(!i&&this.setKeyPros(t,i={}),i.value=e,i.local&&this.setLocal(t,e),i.clear&&this.checkSetClear(t,i),i.setFunc&&i.setFunc(t,i),this.event(t),!0)}getKeyPro(t){return this._dataDic.get(t)}setKeyPros(t,e){return t&&this._dataDic.set(t,e),this}addKeyPros(t,e){return this.setKeyPros(t,s.util.bindPros(this.getKeyPro(t),e)||e)}bindKey(t,e,i,s){return t&&Object.is(t)&&e&&i&&Object.defineProperty(t,e,{get:()=>this.get(i),set:t=>{this.set(i,t)}}),t&&s&&this.addKeyPros(i,s),this}checkGetClear(t,e){return!e.setTime&&(e.setTime=this.getLocal(t+"_setTime"),e.value=this.getLocal(t)),s.timerMgr.inSameDay(e.setTime)?e.value:(this.set(t,null)||this.checkSetClear(t,e),s.gMsgCet.event(t+".clear"),e.value)}checkSetClear(t,e){this.setLocal(t+"_setTime",e.setTime=s.timerMgr.now),this.setLocal(t,e.value)}checkClearOnTimer(){for(let t of this._dataDic.keys()){let e=this._dataDic.get(t);e&&e.clearTimer&&(s.timerMgr.once(s.timerMgr.getSpanLeftTime("number"==typeof e.clear&&e.clear,e.clearTimeSpan),e,e._clearTimerFunc||(e._clearTimerFunc=(()=>{s.timerMgr.once(s.timerMgr.getSpanLeftTime("number"==typeof e.clear&&e.clear,e.clearTimeSpan),e,e._clearTimerFunc),this.checkGetClear(t,e)}))),this.checkGetClear(t,e))}}getLocal(t){return Laya.LocalStorage.getJSON(t)}setLocal(t,e){Laya.LocalStorage.setJSON(t,e)}clearLocal(){Laya.LocalStorage.clear()}hasListener(t){return this._evtCtrl.hasListener(t)}event(t,e){return this._evtCtrl.event(t,e),this}on(t,e,i,s){return this._evtCtrl.on(t,e,i,s),this}once(t,e,i,s){return this._evtCtrl.once(t,e,i,s),this}off(t,e,i,s){return this._evtCtrl.off(t,e,i,s),this}onFetch(t,e,i){return this._fetchCtrl.onFetch(t,e,i),this}offFetch(t,e,i){return this._fetchCtrl.offFetch(t,e,i),this}fetch(t,e){return this._fetchCtrl.fetch(t,e)}}s.DataCtrl=h;class l extends Laya.EventDispatcher{on(t,e,i,s){if(t&&t instanceof Array)for(const a of t)this.on(a,e,i,s);else super.on(t,e,i,s)}}s.EvtCtrl=l;class d{constructor(){this._fetchData=new Map}onFetch(t,e,i){return t&&e&&!i?this._fetchData.set(t,{caller:e,listener:i}):s.error("onFatch error"),this}offFetch(t,e,i){let a=t&&this._fetchData.get(t);return a&&a.caller==e&&a.listener==i?this._fetchData.delete(t):s.error("offFatch error"),this}fetch(t,e){let i=t&&this._fetchData.get(t);return i&&i.listener.call(i.caller,e)}}s.FetchCtrl=d;s.QueueCtrl=class{constructor(){this._q=[],this._i=-1,this._o=null}add(t,e){if(!t)return this;!e&&(e=0);let i=this._q.length;for(let t=0;t<this._q.length;t++)if(this._q[t].p>e){i=t;break}return this._q.splice(i,0,{f:t,p:e}),this}remove(t){if(!t)return this;for(let e=this._q.length-1;e>=0;e--)this._q[e].f==t&&this._q.splice(e,1);return this}start(t){return this._i=0,this.data=t,this.run(),this}next(){return this._i++,this.run(),this}run(){if(this._i>=this._q.length)return this.stop();let t=this.clearCurObj()._q[this._i];return this._o=t&&t.f&&t.f(this),this._o&&Object.is(this._o)&&(this._o._qc=this),!this._o&&this.next(),this}stop(){return this.clearCurObj()._i=-1,this}clearCurObj(){return this._o&&Object.is(this._o)&&(this._o._qc=null),this._o=null,this}};class g extends Laya.EventDispatcher{constructor(){super(),this.fatchData=new Map}on(t,e,i,s){if(t&&t instanceof Array)for(const a of t)super.on(a,e,i,s);else super.on(t,e,i,s)}onFatch(t,e,i){t&&e&&i?this.fatchData.set(t,{caller:e,listener:i}):s.error("onFatch error")}offFatch(t,e,i){t?this.fatchData.delete(t):s.error("offFatch error")}fetch(t,e){if(!t)return null;let i=this.fatchData.get(t);if(!i)return null;let s=i.caller;return i.listener.call(s,e)}}s.GMsgCenter=g;class c extends Laya.HttpRequest{setEndFunc(t){this._endHandler=t}send(t,e,i,s,a){this._endHandler&&(this.once(Laya.Event.COMPLETE,this,this.completeHandler),this.once(Laya.Event.ERROR,this,this.errorHandler),this.on(Laya.Event.PROGRESS,this,this.processHandler)),super.send(t,e,i||"get",s||"text",a)}processHandler(t){}errorHandler(t){this.onReqEnd()}completeHandler(t){this.onReqEnd()}onReqEnd(){this._endHandler&&this._endHandler.runWith(this)}get resText(){return this.http?this.http.responseText:null}}s.HttpReq=c;class u extends a{constructor(){super(),this.MethodEnum={get:"get",post:"post",put:"put",delete:"delete"},this.ResponseTypeEnum={text:"text",document:"document",json:"json",blob:"blob",arrayBuffer:"arrayBuffer"}}getTxt(t,e,i,s){return this.doHttpReq(t,e,i,this.MethodEnum.get,this.ResponseTypeEnum.text,s)}getJson(t,e,i,s){return this.doHttpReq(t,e,i,this.MethodEnum.get,this.ResponseTypeEnum.json,s)}postTxt(t,e,i,s){return this.doHttpReq(t,e,i,this.MethodEnum.post,this.ResponseTypeEnum.text,s)}postJson(t,e,i,s){return this.doHttpReq(t,e,i,this.MethodEnum.post,this.ResponseTypeEnum.json,s)}doHttpReq(t,e,i,a,r,o){s.log("http请求,类型:"+a+",url:"+t);let n=new c;return n.setEndFunc(e),n.send(t,i,a||"get",r||"text",o),n}}s.NetMgr=u;class p extends a{parseCfgData(t,e){if(!t)return null;String.is(t)&&(t=s.resMgr.getRes(t));let i=e&&e.ctrl||new m;return i.setData(t),i}}s.CfgMgr=p;class m{constructor(){this._keyName="id",this._cfgList=null,this._cfgTbl=null}get cfgCount(){return this._cfgList?this._cfgList.length:0}get cfgList(){return this._cfgList}get cfgTbl(){return this._cfgTbl}addCfgToList(t){t&&(t.cfgIndex=this._cfgList.length,this._cfgList.push(t),this._cfgTbl[t[this._keyName]]=t)}setData(t){t instanceof Array?this.setCfgList(t):this.setCfgTbl(t)}setCfgList(t){if(this._cfgList=t,this._cfgTbl={},this._cfgList)for(let t=0;t<this.cfgCount;t++){let e=this.getCfgByIndex(t);e&&(e.cfgIndex=t,this._cfgTbl[e[this._keyName]]=e,e.ctrl=this)}}setCfgTbl(t){if(this._cfgTbl=t,this._cfgList=[],this._cfgTbl)for(const t in this._cfgTbl){const e=this._cfgTbl[t];e&&(e.cfgIndex=this._cfgList.length,this._cfgList.push(e),e.ctrl=this)}}getCfgByIndex(t){return this._cfgList[t]}getCfg(t){return this._cfgTbl[t]}getIndexByID(t){let e=this.getCfg(t);return e&&e.cfgIndex>=0?e.cfgIndex:-1}every(t,e){if(t)for(let i=0;i<this.cfgCount;i++){let s=this.getCfgByIndex(i);s&&(String.is(t)?s[t]&&s[t](s,i,e):t(s,i,e))}}}s.CfgCtrl=m;class f extends a{constructor(){super(),this.gInfoViewID="HintView"}doShowInfo(t,e){t&&t.content&&s.uiViewMgr.showView(this.gInfoViewID,{infoCfg:t,args:e,info:t.content.format(e)})}showInfo(t,e){this.doShowInfo(s.gCfg.hintConfig.cfgs[t],e)}showInfoCont(t,e,i){t&&e&&this.doShowInfo({infoType:t,content:e},i)}}s.GInfoMgr=f;class I{static parseCfgs(){}static addData(t,e){let i=new I;i.vpID=t,i.parentVpID=e,I.addCfgToList(i)}static addCfgToList(t){t&&(I.cfgs.push(t),I.cfgTbl[t.vpID]=t)}static getCfgByIndex(t){return I.cfgs[t]}static getCfg(t){return I.cfgTbl[t]}static getAddData(t){if(!t)return null;let e=I.getCfg(t);return e||((e=new I).vpID=t,I.addCfgToList(e)),e}addSubVpData(t){if(!I)return;!this._subVpDatas&&(this._subVpDatas=[]);let e=!1;for(let i of this._subVpDatas)if(i&&i.vpID==t.vpID){e=!0;break}!e&&this._subVpDatas.push(t)}}I.cfgs=[],I.cfgTbl={},I.cfgCount=0,s.VPData=I;class y{constructor(t){this._vpData=t,this._vpData&&(this._vpData.vp=this,this._vpData.pros&&(this.mgr=this._vpData.pros.mgr)),this.tryCreateView()}get vpData(){return this._vpData}get viewID(){return this._vpData?this._vpData.vpID:null}get visible(){return!!this._vpData&&this._vpData.visible}set visible(t){this._vpData&&(this._vpData.visible=t)}tryCreateView(){this.preCreateView(),this.createView(),this.afterCreateView()}preCreateView(){}createView(){this.tryCreatePanel()}afterCreateView(){this.updatePanelLayer(),this.resetPos(),this.removeFromDisplay()}tryCreatePanel(){this.preCreatePanel(),this.createPanel(),this.afterCreatePanel()}preCreatePanel(){}createPanel(){}afterCreatePanel(){this.bindEvt()}updatePanelLayer(){}bringToTop(){this.panel&&this.panel.parent&&this.panel.parent.setChildIndex(this.panel,this.panel.parent.numChildren-1)}bringToBottom(){this.panel&&this.panel.parent&&this.panel.parent.setChildIndex(this.panel,0)}resetPos(){}globalToLocal(t,e){return(e||this.panel).displayObject.globalToLocal(t)}show(t,e){this.visible&&null==e||(this.checkVShowDataOnShow(e),this.visible||(this.visible=!0,this.addBaseNotify(),this.addNotify()),this.noticeMgrViewBfShow(),this.beforShow(e),this.showPanel(e),this.updateEvtFuncs(),this.doShow(e),this.afterShow(e),this.noticeMgrViewShow(),this.evtViewShow(e),this.checkGuide())}get vShowData(){return this._vShowData}set vShowData(t){let e=this._vShowData;this._vShowData=t,this.onVShowDataSet(e,this._vShowData)}onVShowDataSet(t,e){}checkVShowDataOnShow(t){(!t||!t.onGameShow)&&(this.vShowData=t)}checkVShowDataOnHide(t){!this.visible&&(!t||!t.onGameHide)&&(this.vShowData=null)}noticeMgrViewBfShow(){}beforShow(t){}doShow(t){}afterShow(t){}noticeMgrViewShow(){}evtViewShow(t){this.visible&&(s.gMsgCet.event("cm.view.show."+this.viewID,{vpData:this.vpData}),s.gMsgCet.event("cm.view."+this.viewID,{vpData:this.vpData,val:!0}),s.gMsgCet.event("cm.view.show",{vpData:this.vpData}))}isShow(t){return this.visible&&(!t||this.viewID==t)}getCurShowViewID(){return this.visible?this.viewID:null}hide(t,e){this.visible&&(this.visible&&(this.visible=!1,this.removeBaseNotify(),this.removeNotify()),this.checkStopGuide(),this.beforHide(e),this.hidePanel(e),this.doHide(e),this.afterHide(e),this.checkVShowDataOnHide(e),this.noticeMgrViewHide(),this.evtViewHide(e))}beforHide(t){}doHide(t){}afterHide(t){}noticeMgrViewHide(){}evtViewHide(t){this.visible||(s.gMsgCet.event("cm.view.hide."+this.viewID,{vpData:this.vpData}),s.gMsgCet.event("cm.view."+this.viewID,{vpData:this.vpData,val:!1}),s.gMsgCet.event("cm.view.hide",{vpData:this.vpData}))}hideSelf(){s.uiViewMgr.hideView(this.viewID)}get panel(){return this._panel}setPanel(t){this._panel=t}createPanelUI(t){if(null==t||""==t)return null;let e=s.uiViewMgr.createUiObj(t).asCom;return this.setPanel(e),e}showPanel(t){this.doShowPanelDirectly()}addToDisplay(){this.panel.visible=!0,this.autoUpdatePanelDepth()}autoUpdatePanelDepth(){this.bringToTop()}startShowPanel(){this.stopShowHideTween(),this.addToDisplay()}afterShowPanel(){this.showHideTween=null}hidePanel(t){this.doHidePanelDirectly()}removeFromDisplay(){this.panel.visible=!1}startHidePanel(){this.stopShowHideTween()}afterHidePanel(){this.showHideTween=null,this.removeFromDisplay()}doShowPanelDirectly(){this.startShowPanel(),this.afterShowPanel()}doHidePanelDirectly(){this.startHidePanel(),this.afterHidePanel()}stopShowHideTween(){null!=this.showHideTween&&(this.showHideTween.clear(),this.showHideTween=null)}bindEvt(){this.bindGetUIEvt(),this.bindGuideCheck(),this.doBindEvt()}doBindEvt(){}unBind(){this._bEvtDatas=null}addBEvtData(t){t&&(this._bEvtDatas||(this._bEvtDatas=[]),this._bEvtDatas.push(t))}updateEvtFuncs(){if(this._bEvtDatas&&this.visible)for(const t of this._bEvtDatas)t.args&&t.func()}doBEvtDataExeFunc(t){if(!this._bEvtDatas)return;let e=this._bEvtDatas.length,i=null;for(let s=0;s<e;s++){let e=this._bEvtDatas[s];e.exeOnce&&(i||(i=[])).push(s),e.exeFunc&&e.exeFunc(e,t)}if(i)for(e=i.length-1;e>=0;e--)this._bEvtDatas.slice(i[e])}addBaseNotify(){this.doBEvtDataExeFunc("on")}addNotify(){}removeBaseNotify(){this.doBEvtDataExeFunc("off")}removeNotify(){}bindGEvt(t,e,i){if(t&&e)if(t instanceof Array)for(const s of t)this.bindGEvt(s,e,i);else this.addBEvtData({evt:t,func:e.bind(this),args:i,exeFunc:this.doGEvts.bind(this)})}doGEvts(t,e){s.gMsgCet[e](t.evt,this,t.func)}bindGFetch(t,e){if(t&&e)if(t instanceof Array)for(const i of t)this.bindGFetch(i,e);else this.addBEvtData({evt:t,func:e.bind(this),exeFunc:this.doGFetch.bind(this)})}doGFetch(t,e){s.gMsgCet[e+"Fatch"](t.evt,this,t.func)}bindUiEvt(t,e,i){if(t&&e&&i)if(t instanceof Array)for(const s of t)this.bindUiEvt(s,e,i);else String.is(t)&&(t=this.u(t)),this.addBEvtData({u:t,evt:e,func:i.bind(this),exeFunc:this.doUiEvts.bind(this)})}bindUiClick(t,e){this.bindUiEvt(t,Laya.Event.CLICK,e)}bindClickHide(t){this.bindUiClick(t,()=>{this.hideSelf()})}bindBtnScale(t,e=null){this.bindUiEvt(t,Laya.Event.MOUSE_DOWN,()=>{this.setBtnScale(e||t,.9)}),this.bindUiEvt(t,Laya.Event.MOUSE_UP,()=>{this.setBtnScale(e||t,1)})}setBtnScale(t,e){if(t)if(t instanceof Array)for(const i of t)this.setBtnScale(i,e);else t.setScale(e,e)}doUiEvts(t,e){t.u[e](t.evt,this,t.func)}tmOnce(t,e,i,s){this.doTimer("once",t,e,i,s)}tmLoop(t,e,i,s){this.doTimer("loop",t,e,i,s)}tmFrameLoop(t,e,i,s){this.doTimer("frameLoop",t,e,i,s)}doTimer(t,e,i,a,r){s.timerMgr[t](e,this,i,a,r),this.addBEvtData({func:i,exeFunc:this.doTimerEvts.bind(this),exeOnce:!0})}doTimerEvts(t,e){s.timerMgr.clear(this,t.func)}bindGetUIEvt(){this.bindGFetch("GET_VIEW_UI_BY_NAME"+this.viewID,this.u)}u(t,e){return t?(e||this.panel).getChild(t):null}bindGuideCheck(){this.bindGEvt("CMEVT_GUIDE_STEP_STAET"+this.viewID,this.checkGuide)}checkGuide(){s.guideMgr&&s.guideMgr.onViewCheckEnd(this)}startGuide(t,e){t&&s.guideMgr.start(t)}checkStopGuide(){s.guideMgr&&s.guideMgr.checkGuideOnVPHide(this)}qcNext(){this._qc&&this._qc.next()}}s.UIVPBase=y;var w,C,b=s.UiLayerEnum={};s.UIViewBase=class extends y{constructor(t){super(t)}preCreateView(){super.preCreateView(),this._layer=s.uiViewMgr.defaultLayer,this.autoHideOnGHide=!0,this.autoShowOnGShow=!0}get layer(){return this._layer}set layer(t){this._layer=t,this.updatePanelLayer()}updatePanelLayer(){let t=s.uiViewMgr.getLayerContainer(this.layer);t!=this.panel.parent&&t.addChild(this.panel)}makeFullScreen(){this.onGResize(),s.gMsgCet.on("onGResize",this,this.onGResize)}onGResize(){this.panel.setSize(s.uiViewMgr.uw,s.uiViewMgr.uh)}noticeMgrViewBfShow(){this.visible&&s.uiViewMgr.onViewBfShow(this)}noticeMgrViewShow(){this.visible&&s.uiViewMgr.onViewShow(this)}noticeMgrViewHide(){!this.visible&&s.uiViewMgr.onViewHide(this)}onMaskClick(){this.hideSelf()}doShowPanelZoom(){this.startShowPanel(),this.showHideTween=s.Tween.fromTo(this.panel,{alpha:.5,scaleX:.5,scaleY:.5},{alpha:1,scaleX:1,scaleY:1},.3,s.Ease.elasticInOut,s.handle(this,this.afterShowPanel))}doHidePanelZoom(){this.startHidePanel(),this.showHideTween=s.Tween.to(this.panel,{alpha:.5,scaleX:.5,scaleY:.5},.3,s.Ease.elasticInOut,s.handle(this,this.afterHidePanel))}};class G{constructor(){this._curUiPosYOnLH=0,this._defaultLayer=2,this._sceneuiLayer=0,this._sceneui=null,this._layerCons=[],this._uiOffY=0,this._uCenterX=0,this._uCenterY=0,this._uw=0,this._uh=0,this._gScale=1,this._viewOpens=[],this._maskViewIDs={},this._maskViewLayer={},this.autoHideViewsOnGameHide=!0,this.viewOnGameShowEnd=!0,this.calcGScale()}get defaultLayer(){return this._defaultLayer}get sceneuiLayer(){return this._sceneuiLayer}get sceneui(){return this._sceneui}initFGUI(t,e,i,a){function checkFGUI(){fgui.UIPackage.getByName("GameUI")&&fgui.UIPackage.getByName("GameUI2")&&a&&a.run()}t&&t.forEach((t,e)=>{b[t]=e,b[e]=t}),b.num=t&&t.length,this._defaultLayer=String.is(e)?b[e]:e,this._sceneuiLayer=String.is(i)?b[i]:i,fgui.UIPackage.loadPackage("res/UI/GameUI",s.handle(this,checkFGUI)),fgui.UIPackage.loadPackage("res/UI/GameUI2",s.handle(this,checkFGUI))}createUiObj(t){return fgui.UIPackage.createObject("GameUI",t)||fgui.UIPackage.createObject("GameUI2",t)}getItemURL(t){return fgui.UIPackage.getItemURL("GameUI",t)||fgui.UIPackage.getItemURL("GameUI2",t)}get curUiPosYOnLH(){return this._curUiPosYOnLH}get uiOffY(){return this._uiOffY}get uw(){return this._uw}get uh(){return this._uh}get gScale(){return this._gScale}calcGScale(){this._gScale=Math.min(Laya.Browser.clientWidth/Laya.stage.width,Laya.Browser.clientHeight/Laya.stage.height)}preInit(){s.stage.addChild(fgui.GRoot.inst.displayObject);for(let t=0;t<b.num;t++){let e=this.createUiObj("BasePanel").asCom;e.name=b[t].toString(),e.opaque=!1,fgui.GRoot.inst.addChild(e),this._layerCons[t]=e,this._maskViewIDs[t]="maskView-"+b[t].toString(),this._maskViewLayer[this._maskViewIDs[t]]=t}this._sceneui=this.getLayerContainer(this.sceneuiLayer),this._sceneui.setPivot(0,0),this._sceneui.setXY(0,0),Laya.stage.on(Laya.Event.RESIZE,this,this.onResize),this.onResize()}onResize(){this.calcGScale(),this._uiOffY=s.gh()/s.gw()>17/9?100:0,this._uw=s.gw(),this._uh=s.gh()-this._uiOffY,this._uCenterX=this._uw/2,this._uCenterY=this._uiOffY+this._uh/2;for(const t of this._layerCons)t.x=this._uCenterX,t.y=this._uCenterY;s.gMsgCet.event("onGResize")}getLayerContainer(t){return this._layerCons[t]}getUIX(t){return t}getUIY(t){return t-this._uiOffY}getAddVpData(t){return I.getAddData(t)}getVpData(t){return I.getCfg(t)}registerView(t,e,i){if(!t)return s.error("UIViewMgr.registerView_error:empty_viewID"),null;if(!e)return s.error("UIViewMgr.registerView_error:empty_cls"),null;let a=this.getAddVpData(t);return a.cls=e,a.pros=i,a}registerSubPanel(t,e,i){let a=this.getVpData(i);if(!a)return s.error("UIViewMgr.registerSubPanel_error:empty_parentVpData"),null;let r=this.registerView(t,e);return!r||r.parentVpID?(s.error("UIViewMgr.registerSubPanel_error:parentVpID_not_empty"),null):(r.parentVpID=i,a.addSubVpData(r),r)}getView(t,e){return t&&this.getViewByVpData(this.getVpData(t),e)}getViewByVpData(t,e){if(!t)return s.error("UIViewMgr.getView_error:empty_vpData"),null;if(e&&!t.vp){if(!t.cls)return s.error("UIViewMgr.getView_error:empty_cls"),null;new t.cls(t)}return t.vp}showView(t,e){return this.doShowView(this.getView(t,!0),t,e)}showViewByVpData(t,e){return this.doShowView(this.getViewByVpData(t,!0),t.vpID,e)}isViewNameShow(t){return this.isViewVpDataShow(this.getVpData(t))}isViewVpDataShow(t){return this.isViewShow(this.getViewByVpData(t,!1))}isViewShow(t){return!(!t||!t.visible)}hideView(t,e){return this.doHideView(this.getView(t,!1),t,e)}hideViewByVpData(t,e){return this.doHideView(this.getViewByVpData(t,!1),t.vpID,e)}triggerView(t,e){let i=this.getView(t,!1);return null==i?this.showView(t,e):i.isShow(t)?this.doHideView(i,t,e):this.doShowView(i,t,e)}doShowView(t,e,i){if(this._viewIDsOnGShow&&t.autoShowOnGShow){let t=this._viewIDsOnGShow.indexOf(e);t<0&&this._viewIDsOnGShow.splice(t,0,e)}else s.pf.isGameShow&&t&&t.show(e,i);return t}doHideView(t,e,i){if(this._viewIDsOnGShow){let t=this._viewIDsOnGShow.indexOf(e);t>=0&&this._viewIDsOnGShow.splice(t,1)}return t&&t.hide(e,i),t}onViewBfShow(t){if(null==t||!t.visible)return;this._viewOpens.indexOf(t)>=0||this._viewOpens.push(t)}onViewShow(t){this.checkMaskView()}onViewHide(t){if(null==t||t.visible)return;let e=this._viewOpens.indexOf(t);e<0||(this._viewOpens.splice(e,1),this.checkMaskView())}getViewUi(t){if(!t)return null;let e,i;if(Object.is(t))e=t.viewID,i=t.uiName;else if(String.is(t)){let s=t.split("|");e=s[0],i=s[1]}return e&&s.gMsgCet.fetch("GET_VIEW_UI_BY_NAME"+e,i)}get maskViewIDs(){return this._maskViewIDs}getMaskViewLayer(t){return this._maskViewLayer[t]}checkMaskView(){let t=null;for(let e=this._viewOpens.length-1;e>=0;e--){let i=this._viewOpens[e];if(i&&i.needMask){t=i;break}}this._curMaskView!=t&&(this._curMaskView&&this.hideMaskView(this._curMaskView.layer),this._curMaskView=t,this._curMaskView&&this.showMaskView(this._curMaskView.layer))}showMaskView(t){this.showView(this._maskViewIDs[t],!0)}hideMaskView(t){this.hideView(this._maskViewIDs[t])}onMaskClick(){this._curMaskView&&this._curMaskView.onMaskClick()}get curMaskview(){return this._curMaskView}onGameShow(){let t=this._viewIDsOnGShow;if(this._viewIDsOnGShow=null,t)for(let e of t)this.showView(e,{onGameShow:!0});this.viewOnGameShowEnd=!0,s.gMsgCet.event("CMEVT_VIEW_ON_SHOW_END")}onGameHide(){if(this.viewOnGameShowEnd=!1,!this.autoHideViewsOnGameHide)return;let t=this._viewIDsOnGShow||[];this._viewIDsOnGShow=null;let e,i=[];for(let s of this._viewOpens)s&&(e=s.getCurShowViewID())&&(s.autoHideOnGHide&&i.push(e),s.autoShowOnGShow&&t.indexOf(e)<0&&t.push(e));for(e of i)this.hideView(e,{onGameHide:!0});this._viewIDsOnGShow=t}}s.UIViewMgr=G;s.Tween=class extends Laya.Tween{static fromTo(t,e,i,a,r,o,n,h,l){return s.util.bindPros(t,e),Laya.Tween.to(t,i,a,r,o,n,h,l)}static yoyo(t,e,i,s,a,r,o,n,h,l){return v.getTwYoyo().yoyo(t,e,i,s,a,r,o,n,h,l)}};class v{static getTwYoyo(){return new v}yoyo(t,e,i,s,a,r,o,n,h,l){return this.target=t,this.num=e,this.props0=i,this.props=s,this.duration=a,this.ease=r,this.complete=o,this.delay=n,this.coverBefore=h,this.autoRecover=l,this.start(),this}start(){this.clearTw(),s.Tween.bind(this.target,this.props0),this.m_index=0,this.doTw()}doTw(){this.m_curTw=null,this.m_index>=this.num?this.onComplete():this.m_curTw=s.Tween.to(this.target,this.m_index%2==0?this.props:this.props0,this.duration,this.ease,s.handle(this,this.onTwComplete),this.delay,this.coverBefore,this.autoRecover)}clearTw(){this.m_curTw&&(this.m_curTw.clear(),this.m_curTw=null)}onTwComplete(){this.m_index++,this.doTw()}onComplete(){let t=this.complete;this.clear(),t&&t.run()}clear(){this.clearTw(),this.target=null,this.num=0,this.props0=null,this.props=null,this.duration=0,this.ease=null,this.complete=null,this.delay=0,this.coverBefore=!1,this.autoRecover=!1}}s.TwYoyo=v;class S{constructor(){this._guidePt=Laya.Point.EMPTY,this._guideRect=Laya.Rectangle.create()}initData(t,e){this._guideViewVpData=t,this._cfgCtrl=e}onGameShow(){this._curGuideCfg&&s.timerMgr.once(30,this,this.checkGuideCfg)}onGameHide(){s.timerMgr.clear(this,this.checkGuideCfg)}get isGuiding(){return!!this.curGuideCfg}get curGuideCfg(){return this._curGuideCfg}get guidePt(){return this._guidePt}get guideRect(){return this._guideRect}get guideUis(){return this._guideUis}start(t){this.doGuide(t)}stop(t){t&&this._curGuideCfg&&this._curGuideCfg.id==t&&this.stopCurGuide()}stopCurGuide(){this._curGuideCfg=null,s.timerMgr.clear(this,this.onGuideDelayEnd),this.hideGuide()}showGuideView(){s.uiViewMgr.showViewByVpData(this._guideViewVpData,{msg:"updateGuide"})}hideGuide(){this._guideUis=null,s.uiViewMgr.hideViewByVpData(this._guideViewVpData)}doGuide(t){this.hideGuide(),this._curGuideCfg=this._cfgCtrl.getCfg(t),this.checkGuideCfg()}checkGuideCfg(){(!this._curGuideCfg||!this.doGuideCfg())&&this.stopCurGuide()}doGuideCfg(){if(this._curGuideCfg.actCtrl&&s.gMsgCet.event(this._curGuideCfg.actCtrl),2==this._curGuideCfg.actType)return this._guidePt.reset(),this._guideRect.reset(),this.showGuideView(),s.timerMgr.once(Number(this._curGuideCfg.actTypeParam),this,this.onGuideDelayEnd),!0;if(3==this._curGuideCfg.actType)return s.gMsgCet.event(s.enum.evtEnum.CHECK_VIEW_GUIDE+this._curGuideCfg.viewID),!0;let t=this.tryGetCurGuideUi(this._curGuideCfg.uiName),e=this.tryGetCurGuideUi(this._curGuideCfg.pointName)||t,i=this.tryGetCurGuideUi(this._curGuideCfg.uiRect)||t;if(!e)return!1;this._guidePt=i.localToGlobal(),i?this._guideRect.setTo(this._guidePt.x-i.width*i.pivotX,this._guidePt.y-i.height*i.pivotY,i.width,i.height):this._guideRect.reset(),this._guidePt=e.localToGlobal(),this.addUis(t);for(let t=0;this._curGuideCfg.uis&&t<this._curGuideCfg.uis.length;t++)this.addUis(this.tryGetCurGuideUi(this._curGuideCfg.uis[t]));if(this.showGuideView(),t&&0==this._curGuideCfg.actType)this._clickTarget=t,this._clickTarget.on(this._curGuideCfg.actTypeParam||Laya.Event.CLICK,this,this.onGuideTargetClick,this.getEvtArgs());else{if(1!=this._curGuideCfg.actType||!this._curGuideCfg.actTypeParam)return s.error("GuideMgr-doGuideCfg-Error:No-Evt!");s.gMsgCet.once(this.getActTypeParam(),this,this.onGuideStepEnd,this.getEvtArgs()),this._curGuideCfg._actTypeParam2&&s.gMsgCet.event(this._curGuideCfg._actTypeParam2)}return!0}addUis(t){if(!t||!t.parent)return;this._guideUis||(this._guideUis=[]);let e=t.parent.getChildIndex(t),i=this._guideUis.length;for(let t=0;t<this._guideUis.length;t++){if(this._guideUis[t].i>e){i=t;break}}this._guideUis.splice(i,0,{u:t,i:e,p:t.parent,x:t.x,y:t.y})}getEvtArgs(){return[{guideCfg:this._curGuideCfg}]}checkEvtArgs(t){return t&&this._curGuideCfg&&this._curGuideCfg==t.guideCfg}tryGetCurGuideUi(t){return s.uiViewMgr.getViewUi({viewID:this._curGuideCfg.viewID,uiName:t})}getActTypeParam(){if(this._curGuideCfg){if(!this._curGuideCfg._actTypeParam){let t=this._curGuideCfg.actTypeParam.split("|");this._curGuideCfg._actTypeParam=t[0],t[1]&&(this._curGuideCfg._actTypeParam2=t[1])}return this._curGuideCfg._actTypeParam}}checkGuideOnVPHide(t){if(t&&this._curGuideCfg&&this._curGuideCfg.viewID==t.viewID)if(s.pf.isGameShow)s.timerMgr.frameOnce(1,this,this.checkGuideVPHide);else{let t=this._curGuideCfg;this.stopCurGuide(),this._curGuideCfg=t}}checkGuideVPHide(){this._curGuideCfg&&this._curGuideCfg.viewID&&!s.uiViewMgr.isViewNameShow(this._curGuideCfg.viewID)&&(1==this._curGuideCfg.vpHide?this.tryGoNextGuide():this.stopCurGuide())}onGuideTargetClick(t){this.checkEvtArgs(t)&&(this._clickTarget.off(this._curGuideCfg.actTypeParam||Laya.Event.CLICK,this,this.onGuideTargetClick),this._clickTarget=null,this.tryGoNextGuide())}onGuideStepEnd(t){this.checkEvtArgs(t)&&this.tryGoNextGuide()}onGuideDelayEnd(){this.tryGoNextGuide()}onViewCheckEnd(t){t&&this._curGuideCfg&&3==this._curGuideCfg.actType&&this._curGuideCfg.viewID==t.viewID&&this.tryGoNextGuide()}tryGoNextGuide(){this.doGuide(this._curGuideCfg?this._curGuideCfg.nextId:-1)}onEsc(){return!0}}s.GuideMgr=S;class R extends a{preInit(){this._soundMuteSrc=new Map,Laya.SoundManager.useAudioMusic=!1,Laya.SoundManager.autoReleaseSound=!1,this.initSound()}initSound(){this.needPlayMusic=!0,this.setSoundMuted("sysSetMuted",s.localDataMgr.getBool("Sound.muted"))}get muted(){return this._soundMuteSrc.get("sysSetMuted")}set muted(t){this._soundMuteSrc.get("sysSetMuted")!=t&&(s.localDataMgr.setBool("Sound.muted",t),this.setSoundMuted("sysSetMuted",t),s.gMsgCet.event("sound.muted"))}setSoundMuted(t,e){t&&(this._soundMuteSrc.set(t,e),this.checkSound())}checkSound(){let t=!s.pf.isGameShow;!t&&this._soundMuteSrc.forEach(e=>{e&&(t=!0)}),Laya.SoundManager.muted!=t&&(Laya.SoundManager.muted=t,!t&&this.musicUrl&&this.needPlayMusic&&this.doPlayMusic(this.musicUrl))}triggerMuted(){this.muted=!this.muted}playMusic(t,e,i,s){return this.musicUrl!=t?this.doPlayMusic(t,e,i,s):null}doPlayMusic(t,e,i,s){return this.musicUrl=t,this.needPlayMusic=Laya.SoundManager.muted,this.needPlayMusic?null:Laya.SoundManager.playMusic(this.musicUrl,e,i,s)}playSound(t,e,i,s,a){return Laya.SoundManager.playSound(t,e,i,s,a)}}s.SoundManager=R;s.localDataMgr=class extends Laya.LocalStorage{static setNum(t,e){this.setItem(t,e.toString())}static getNum(t){return Number.parseFloat(this.getItem(t))||0}static setInt(t,e){this.setItem(t,e.toString())}static getInt(t){return Number.parseInt(this.getItem(t))||0}static setBool(t,e){this.setItem(t,e?"1":null)}static getBool(t){return"1"==this.getItem(t)}static setJSON(t,e){this.setItem(t,JSON.stringify(e))}static getJSON(t){let e=this.getItem(t);if(e){if(String.is(e))return JSON.parse(e);if(Object.is(e))return e}return null}};class _ extends a{get prg(){return this._prg}initData(t){this._prgViewVpData=t}addPre(t){if(t)return!this._pres&&(this._pres=[]),this._pres.push(t),this}doPre(t,e,i,a,r,o,n,h){return this._pres?this.load(this._pres,s.handle(this,()=>{this._pres=null,t&&t.run()}),e,i,a,r,o,n,h):t&&t.run(),this}start(){this._prg=0,s.uiViewMgr.showViewByVpData(this._prgViewVpData)}onProgress(t){this._prg=t,s.gMsgCet.event("PrgMgr.progress",{progress:this._prg})}onEnd(){this._prg=1,s.uiViewMgr.hideViewByVpData(this._prgViewVpData)}load(t,e,i,a,r,o,n,h,l){this.start(),s.resMgr.load(t,s.handle(this,()=>{this.onEnd(),e&&e.run()}),s.handle(this,t=>{this.onProgress(t),i&&i.run()},null,!1),a,r,o,n,h,l)}openScene(t,e,i){this.start(),s.sceneMgr.openScene(t,()=>{this.onEnd(),e&&e()},t=>{this.onProgress(t),i&&i(t)})}}s.PrgMgr=_;class L{get scene(){return this._scene}setScene(t){this._scene=t,this._scene&&this._scene.parent&&this._scene.parent.parent&&this._scene.parent.parent.setChildIndex(this._scene.parent,0)}get scenePath(){return this._scenePath}get worldRoot(){return Laya.Physics.I.worldRoot}set worldRoot(t){Laya.Physics.I.worldRoot=t}get mapX(){return this.worldRoot.x}set mapX(t){this.worldRoot.x=s.uiViewMgr.sceneui.x=t}get mapY(){return this.worldRoot.y}set mapY(t){this.worldRoot.y=s.uiViewMgr.sceneui.y=t}setMapXY(t,e){this.mapX=t,this.mapY=e}get mapScale(){return this.worldRoot.scaleX}set mapScale(t){this.worldRoot.scale(t,t),s.uiViewMgr.sceneui.setScale(t,t)}init(){}openScene(t,e,i){this._scenePath=t,Laya.Scene.open(this._scenePath,!0,null,s.handle(this,this.onSceneOpen,[{funcOnEnd:e}]),i?s.handle(null,i):null)}onSceneOpen(t,e){this.setScene(e),t.funcOnEnd&&t.funcOnEnd()}}s.SceneMgr=L;s.ScCompBase=class extends Laya.Script{onEnable(){s.sceneMgr.setScene(this.owner.scene)}};class M extends a{constructor(){super()}get(t,e=null,i=null){let s=t&&(String.is(t)?e?e.prototype?Laya.Pool.getItemByClass(t,e):Laya.Pool.getItemByCreateFun(t,e,i):Laya.Pool.getItem(t):Laya.Pool.createByClass(t));return s&&s.onPoolGet&&s.onPoolGet(),s}getByCls(t,e){return Laya.Pool.getItemByClass(t,e)}recover(t,e){t&&(t.onRecover&&t.onRecover(),e&&String.is(e)?Laya.Pool.recover(e,t):Laya.Pool.recoverByClass(t))}clear(t){Laya.Pool.clearBySign(t)}}s.Ease=Laya.Ease,s.isDebug="file:"==Laya.Browser.window.location.protocol,!s.moduleMgr&&(s.moduleMgr=new r),!s.util&&(s.util=s.moduleMgr.addModule(o)),s.instMgrs=function(){s.stage=Laya.stage,!s.timerMgr&&(s.timerMgr=s.moduleMgr.addModuleObj("TimerMgr",Object.defineProperties(Laya.timer,{_gPreInitTime:{value:0,writable:!0},preInit:{value:function(){this._gPreInitTime=this.currTimer,this._msPerDay=864e5,this._timezoneOffset=6e4*(new Date).getTimezoneOffset()}},gameRunTime:{get:function(){return this.currTimer-this._gPreInitTime}},autoResumeOnGameHide:{value:!1,writable:!0},timezoneOffset:{get:function(){return this._timezoneOffset}},onGameShow:{value:function(){this.autoResumeOnGameHide&&this.resume()}},onGameHide:{value:function(){this.autoResumeOnGameHide&&this.pause()}},msPerDay:{value:864e5},today:{get:function(){return this.getDay(this.now)}},getDay:{value:function(t){return Math.floor((t?t-this.timezoneOffset:0)/this.msPerDay)}},inDay:{value:function(t,e){return this.getDay(t)==e}},inSameDay:{value:function(t,e){return this.inDay(t,this.getDay(e||this.now))}},getSpanLeftTime:{value:function(t,e,i){return(e||(e=this._msPerDay))-((i||this.now)-(t||0)-this.timezoneOffset)%e}},now:{get:function(){return Date.now()}}}))),!s.resMgr&&(s.resMgr=s.moduleMgr.addModuleObj("Loader",Laya.loader)),!s.netMgr&&(s.netMgr=s.moduleMgr.addModule(u)),!s.soundMgr&&(s.soundMgr=s.moduleMgr.addModule(R)),!s.cfgMgr&&(s.cfgMgr=s.moduleMgr.addModule(p)),!s.gMsgCet&&(s.gMsgCet=s.moduleMgr.addModule(g)),!s.d&&(s.d=s.moduleMgr.addModule(h)),!s.uiViewMgr&&(s.uiViewMgr=s.moduleMgr.addModule(G)),!s.gInfoMgr&&(s.gInfoMgr=s.moduleMgr.addModule(f)),!s.guideMgr&&(s.guideMgr=s.moduleMgr.addModule(S)),!s.prgMgr&&(s.prgMgr=s.moduleMgr.addModule(_)),!s.sceneMgr&&(s.sceneMgr=s.moduleMgr.addModule(L)),s.pool||(s.pool=s.moduleMgr.addModule(M))},s.M=function(t){return s.moduleMgr.getModule(t)},s.handle=function(t,e,i,s){return Laya.Handler.create(t,e,i,s)},s.log=function(t,...e){e&&e.length>0?console.log(t,e):console.log(t)},s.error=function(t){console.error(t)},s.gw=function(){return Laya.stage.width},s.gh=function(){return Laya.stage.height},s.gScale=function(){return s.uiViewMgr.gScale},window.GI=s;class P{constructor(){}static regComp(t,e){null==P.items[t]?P.items[t]=e:GI.log(t+"名字对应的组件已存在")}static getComp(t){if(null!=t&&""!=t){if(null!=P.items[t])return P.items[t];GI.log(t+"名字对应的组件没有找到")}else GI.log("CompRegister Comp value is unvalue")}}P.items=[];class x extends Laya.Script{constructor(){super(...arguments),this.texName="",this.MaxHP=100,this.HP=100,this.propIdx=1,this.restitution=.1,this.linearDamping=.5,this.friction=.3,this.density=20,this.propId=0,this.propMaxNum=4,this.specificId=0,this.idx=""}AwakeItem(){this.sp=this.owner}initInfo(t){this.idx=t}initData(t){this.from=t.from,this.to=t.to,this.delay=t.delay,this.isH=t.isH,this.duration=t.duration,this.isChange=t.isChange,this.texName=t.texName,this.typeParam=t.typeParam,this.forceX=t.forceX,this.forceY=t.forceY,this.px=t.pivotX,this.py=t.pivotY,this.density=t.density,this.ratote=t.ratote,this.MaxHP=t.maxHp,this.HP=t.hp,this.restitution=t.restitution,this.linearDamp=t.linearDamping,this.friction=t.friction,this.propId=t.propId,this.propMaxNum=t.propMaxNum,this.specificId=t.specificId,0==this.duration&&(this.duration=2e3),0==this.delay&&(this.delay=10)}}class k extends x{constructor(){super(...arguments),this.MaxHP=100,this.HP=100,this.propIdx=1,this.restitution=0,this.linearDamping=.5,this.friction=.3,this.density=20,this.propId=0,this.propMaxNum=4,this.rigidId=0,this.grage=0,this.boomerang=1,this.floor=1}onAwake(){GI.gMsgCet.on("balloon.ropeJoint",this,this.addRopeJoint),GI.gMsgCet.on("balloon.ropeJoint.des",this,this.removeRopeJoint)}onAwakeCus(){this.lab="QiQiu".concat(this.typeParam.toString())}AwakeItem(){super.AwakeItem();let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic"),this.rigid=t,this.col=this.sp.getComponent(Laya.ColliderBase),null!=this.col&&(this.col.restitution=this.restitution||0,this.col.friction=this.friction),this.rigid.allowSleep=!0,this.propCfg=$t.i.data.ModuleCfgs.datas[this.propId],this.feebles=this.propCfg.feebles,this.scales=this.propCfg.scales,this.grage=this.propCfg.grage}initData(t){super.initData(t),this.textureName=this.texName.split(","),null==this.sp&&(this.AwakeItem(),this.col.density=this.density||3),this.propMaxNum=this.textureName.length}getScale(t){if(null!=this.scales)for(let e=0;e<this.scales.length;++e)if(this.scales[e].id==t)return this.scales[e];return{id:1,scaleX:1,scaleY:1}}loadPropImage(t){if(this.textureName.length-1<t-1)return void GI.error(this.textureName.length+"  数据有问题   破碎层 与数据不对   par  "+t);if(""==this.textureName[t-1])return void GI.error(this.textureName.length+"  数据为空   par  "+t+this.sp);let e,i=$t.i.mapCtrl.itemJson[this.idx][0].pa.split("/");e="sceneObj/".concat(i[1]).concat("/").concat(this.textureName[t-1].trim()).concat(".png"),this.propIdx=t,this.sp.loadImage(e)}UpdateShow(){if(this.HP<=0)return void GI.timerMgr.frameOnce(1,this,()=>{this.RemoveItem()});let t=this.HP/this.MaxHP;if(4==this.propMaxNum)t>=.76?this.propIdx=1:t>=.51?this.propIdx=2:t>=.26?this.propIdx=3:t>.1&&(this.propIdx=4);else if(3==this.propMaxNum)t>=.61?this.propIdx=1:t>=.31?this.propIdx=2:t>=.1&&(this.propIdx=3);else if(0==this.propMaxNum)return;this.loadPropImage(this.propIdx)}RemoveItem(){if($t.i.data.AddGrade(this.grage),null!=this.sp){let t=Laya.Point.create();t.setTo(this.sp.width/2,this.sp.height/2),t=this.sp.localToGlobal(t,!1,GI.sceneMgr.worldRoot),GI.gMsgCet.event("AddGameGrade",{grage:this.grage,isBird:!1,id:this.propCfg.id,point:t,score_type:"destroy"});let e=this.getScale(this.specificId);GI.gMsgCet.event("ab.PlayEffect",[this.propCfg.hit_eff,t.x,t.y,this.sp.rotation,e.scaleX,e.scaleY]),te.RemoveNodes(this.sp),this.rigid=null,this.sp.destroy(),this.sp=null}}addRopeJoint(t){this.onAwakeCus(),t.label==this.lab&&(this.ropeJonintContract(t),$t.i.data.setBallonPar(this.typeParam))}ropeJonintContract(t){this.sp=this.owner,this.ropJoint=new Laya.RopeJoint,this.ropJoint.otherBody=t,this.ropJoint.otherAnchor=[30,41],this.sp&&(this.ropJoint.selfAnchor=[this.sp.width/2,0]),0==this.delay&&(this.delay=200),this.ropJoint.maxLength=this.delay||200,this.sp&&this.sp.addComponentIntance(this.ropJoint)}removeRopeJoint(t){t==this.typeParam&&null!=this.ropJoint&&this.ropJoint.destroy()}onDestroy(){this.ropJoint&&this.ropJoint&&this.ropJoint.destroy()}}!function(t){t[t.RedBird=0]="RedBird",t[t.FastBird=1]="FastBird",t[t.AvatarBird=2]="AvatarBird",t[t.BombBird=3]="BombBird",t[t.EggBird=4]="EggBird",t[t.BigRedBird=5]="BigRedBird",t[t.BoomerangBird=6]="BoomerangBird",t[t.ShockWaveBird=7]="ShockWaveBird"}(w||(w={})),function(t){t[t.MuTou=0]="MuTou",t[t.ShiTou=1]="ShiTou",t[t.BoLi=2]="BoLi",t[t.WuPing=3]="WuPing",t[t.Zhu=4]="Zhu",t[t.RedBird=5]="RedBird",t[t.HuangBird=6]="HuangBird",t[t.LanBird=7]="LanBird",t[t.ZaDanBird=8]="ZaDanBird",t[t.TouDanBird=9]="TouDanBird",t[t.DaRedBird=10]="DaRedBird",t[t.HuiLiBird=11]="HuiLiBird",t[t.TNT=12]="TNT",t[t.CJBBird=13]="CJBBird"}(C||(C={}));class D extends k{constructor(){super(),this.SoundForce=10,this.IsTriggerSelf=!1,this.LeaveLists=new Map,this.point=Laya.Point.create(),this.isRemove=!1,this.triggerList=[]}AwakeItem(){super.AwakeItem(),this.rigidId=D.RigidIdx++,null!=this.rigid&&(this.sp.on("Rigid.PostSolve",this,this.OnTriggerEnter),this.sp.on("Rigid.LeaveContact",this,this.OnLeaveContactContact),$t.i.GameMgr.AddRigidItem(this)),this.rigid.linearDamping=this.linearDamping,this.col.density=this.density,this.col.friction=1,$t.i.data.MaxGameGrade=$t.i.data.MaxGameGrade+this.grage,this.UpdateShow(),D.startGameTime=!1}UpdateShow(){super.UpdateShow(),this.HP<0&&(this.sp.off("Rigid.PostSolve",this,this.OnTriggerEnter),this.sp.off("Rigid.LeaveContact",this,this.OnLeaveContactContact))}IsSelfTrigger(t,e){return null!=e&&null!=e.m_manifold&&(1==e.m_manifold.type&&null!=e.m_fixtureA&&e.m_fixtureA.collider==t||2==e.m_manifold.type&&null!=e.m_fixtureB&&e.m_fixtureB.collider==t)}OnTriggerEnter(t,e,i,s){if(null!=t&&null!=t.owner&&0==this.isRemove){if(this.HP<=0)return;let a=t.owner,r=a.getComponent(D),o=D.flooe,n=!1,h=null;if(null!=r?o=r.rigidId:a.name.indexOf("bird")>=0&&null!=(h=$t.i.roleCtrl.GetBirdById(t.label))&&(n=!0,o=-2-h.BirdId),0==this.LeaveLists.has(o)){if(this.IsTriggerSelf=this.IsSelfTrigger(e,i),this.AddLeaveId(o),0==D.startGameTime)return;this.point.setTo(s.normalImpulses[0],s.normalImpulses[1]);let t=this.point.distance(0,0);null!=h?this.onTriggerEnterBird(h,t,a):null!=r?this.onTriggerEnterRigid(r,t):this.onTriggerEnterFloor(t),this.UpdateShow()}}}AddLeaveId(t){0==this.LeaveLists.has(t)&&this.LeaveLists.set(t,t)}OnLeaveContactContact(t,e,i){if(null!=t&&null!=t.owner&&0==this.isRemove){let e=t.owner.getComponent(D),i=-1;null!=e&&(i=e.rigidId),null!=this.LeaveLists.get(i)&&this.LeaveLists.delete(i)}}GetFeebles(t){if(null!=this.feebles)for(let e=0;e<this.feebles.length;++e)if(this.feebles[e].id==t)return this.feebles[e].addition;return 1}onTriggerEnterBird(t,e,i){let s=this.GetFeebles(t.grageId);t.birdType==w.FastBird&&t.isCanMouse&&(s*=2);let a=Math.floor(e*s);this.IsTriggerSelf&&a>this.SoundForce&&(t.IsTriggerFirst?this.OnFirstBirdTriggerSound(t):(t.PlayTriggerSound(),this.OnTriggerSound())),this.HP-=a,$t.i.data.AddGrade(Math.floor(e));let r=$t.i.data.BirdCfgs.birds[t.birdType],o=Laya.Point.create();o.setTo(this.sp.width/2,this.sp.height/2),o=i.localToGlobal(o,!1,GI.sceneMgr.worldRoot),GI.gMsgCet.event("AddGameGrade",{grage:a,isBird:!1,id:this.propCfg.id,point:{x:o.x,y:o.y},score_type:"hit"}),GI.gMsgCet.event("ab.PlayEffect",[r.hit_eff.url,o.x,o.y,i.rotation,r.hit_eff.scaleX,r.hit_eff.scaleY]),this.HP<0&&(this.HP=0)}onTriggerEnterRigid(t,e){var i=e*this.GetFeebles(t.propId);this.IsTriggerSelf&&i>this.SoundForce&&this.OnTriggerSound(),this.HP-=i,this.HP<0&&(this.HP=0)}onTriggerEnterFloor(t){var e=t*this.propCfg.floor;this.HP-=e,this.IsTriggerSelf&&e>this.SoundForce&&this.OnTriggerSound(),this.HP<0&&(this.HP=0)}OnBoomerang(t){if(this.HP<=0)return;let e=this.propCfg.boomerang;this.HP-=t*e,this.HP<0&&(this.HP=0),this.UpdateShow()}MustDie(){this.HP=0,this.UpdateShow()}RemoveItem(){this.sp.off("Rigid.PostSolve",this,this.OnTriggerEnter),super.RemoveItem(),$t.i.GameMgr.RemoveRigidItem(this),this.OnRemoveSound()}OnFirstBirdTriggerSound(t){GI.gMsgCet.event("AB.RigidItem",[this.propId,2])}OnTriggerSound(){GI.gMsgCet.event("AB.RigidItem",[this.propId,1])}OnRemoveSound(){GI.gMsgCet.event("AB.RigidItem",[this.propId,3])}onDestroy(){this.isRemove=!0,this.sp.off("Rigid.LeaveContact",this,this.OnLeaveContactContact),this.sp.off("Rigid.PostSolve",this,this.OnTriggerEnter),super.onDestroy()}}D.flooe=-1,D.startGameTime=!1,D.RigidIdx=0;class B extends D{constructor(){super(...arguments),this.propIdx=1,this.density=10,this.force=40}onAwake(){super.onAwake()}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.density=9,this.col.density=this.density}onStart(){$t.i.GameMgr.AddPig(this)}RemoveItem(){super.RemoveItem(),$t.i.GameMgr.RemovePigItem(this);let t=0;$t.i.isEventScene?($t.i.lastEventSceneScore<GI.gCfg.timelimitEvent.prgMax&&$t.i.lastEventSceneScore++,t=$t.i.lastEventSceneScore):$t.i.data.isDailyChallengeScene&&($t.i.data.dailyChallengeData.curScore++,t=++$t.i.data.dailyChallengeData.score),GI.gMsgCet.event("ab.pigRemove",{score:t})}loadPropImage(t){if(null==this.textureName)return;if(null==this.texName)return;let e;e="sceneObj/birds/".concat(this.textureName[t-1]).concat(".png"),this.propIdx=t,this.sp.loadImage(e)}randomNum(){let t=Math.floor(Math.random()*this.textureName.length);this.loadPropImage(t)}}class T extends x{onAwake(){super.onAwake(),this.sp=this.owner,this.sp.scaleX=-1;let t=this.sp.getComponent(Laya.ColliderBase);null!=t&&(t.restitution=0)}}class A extends D{constructor(){super(...arguments),this.BombForce=12,this.isBomb=!1}AwakeItem(){super.AwakeItem()}BombSkill(){let t=this.sp.localToGlobal(Laya.Point.create(),!1,GI.sceneMgr.worldRoot),e=this.propCfg.hit_eff;GI.gMsgCet.event("ab.PlayEffect",[e,t.x,t.y,this.sp.rotation,1,1])}OnBoomerang(t){this.DetonatedBomb()}MustDie(){this.DetonatedBomb()}RemoveItem(){this.BombSkill(),0==this.isBomb&&this.DetonatedBomb(),super.RemoveItem()}DetonatedBomb(){if(this.isBomb)return;this.isBomb=!0;for(var t=this.sp.getComponent(Laya.RigidBody).body.GetWorldCenter(),e=new Laya.Physics.I.box2d.b2Vec2,i=new Laya.Physics.I.box2d.b2Vec2,s=0;s<=100;s++){var a=3.6*s,r=new Laya.Physics.I.box2d.b2RayCastInput;r.p1=t,r.p2.Set(t.x+5*Math.cos(a),t.y+5*Math.sin(a)),r.maxFraction=1;for(var o=new Laya.Physics.I.box2d.b2RayCastOutput,n=Laya.Physics.I.world.GetBodyList();n;n=n.GetNext()){var h=n.GetFixtureList();if(h)if(h.RayCast(o,r)){e.Copy(r.p1),i.Copy(r.p2),i.SelfSub(e),i.SelfMul(o.fraction),e.SelfAdd(i);var l=new Laya.Physics.I.box2d.b2Vec2;l.Copy(e),l.SelfSub(t);let s=new Laya.Physics.I.box2d.b2Vec2(l.x*(1-o.fraction)*this.BombForce,l.y*(1-o.fraction)*this.BombForce);if(null!=h.collider&&null!=h.collider.owner){let t=h.collider.owner.getComponent(D);null!=t&&t.OnBoomerang(s.x+s.y)}n.ApplyLinearImpulseToCenter(s)}}}}}class V extends Laya.Script{onAwake(){super.onAwake(),this.sp=this.owner;let t=new Laya.Point(this.sp.x,this.sp.y);$t.i.data.tagPos=t}}class E extends x{AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.texture=null;this.sp.getComponent(Laya.BoxCollider),this.sp.getComponent(Laya.RigidBody)}}class U extends x{onAwake(){super.onAwake(),this.sp=this.owner,this.boxType()}boxType(){let t=this.sp.getComponents(Laya.ColliderBase);for(let e=0;e<t.length;e++)t[e].restitution=0}}class O extends k{onAwake(){super.onAwake(),this.sp=this.owner,this.onAwakeCus()}onAwakeCus(){this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid&&(this.rigid.label="QiQiu".concat(this.typeParam.toString())),this.box=this.sp.getComponent(Laya.BoxCollider),null!=this.box&&(this.box.isSensor=!0)}onStart(){super.onStart(),GI.gMsgCet.event("balloon.ropeJoint",this.rigid)}onTriggerEnter(t,e){null!=t&&null!=t.owner&&(GI.gMsgCet.event("balloon.ropeJoint.des",this.typeParam),this.onDestroy(),this.HP)}initData(t){this.sp=this.owner,super.initData(t)}onDestroy(){this.box&&this.box.destroy(),this.rigid&&this.rigid.destroy(),this.sp.texture=null,this.blowUp()}blowUp(){var t=new Laya.Skeleton;this.sp.addChild(t),t.load("res/Effect/blue_bird_hit.sk",GI.handle(this,()=>{GI.timerMgr.once(1e3,this,()=>{t.destroy()})}))}}class N extends x{onAwake(){super.onAwake(),this.sp=this.owner,this.boxType()}boxType(){let t=this.sp.getComponents(Laya.ColliderBase);for(let e=0;e<t.length;e++)t[e].restitution=this.restitution}initData(t){super.initData(t),this.restitution=this.restitution||.3}}class F extends x{itemInfo(){let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic"),this.col=this.sp.getComponent(Laya.ColliderBase),null!=this.col&&(this.col.restitution=0)}initData(t){super.initData(t),this.sp=this.owner,this.itemInfo(),this.col.density=this.density||3}}class H extends D{onAwake(){super.onAwake()}AwakeItem(){super.AwakeItem(),this.sp=this.owner}RemoveItem(){let t=Laya.Point.create();t.setTo(this.sp.width/2,this.sp.height/2),t=this.sp.localToGlobal(t,!1,GI.sceneMgr.worldRoot),$t.i.onChestCollect({point:t}),super.RemoveItem()}onStart(){}loadPropImage(t){}}class q{registerComp(){P.regComp("NotVisiableItem",E),P.regComp("PigItem",B),P.regComp("NoRestitutionItem",U),P.regComp("BalloonItem",O),P.regComp("PropItem",D),P.regComp("FIipxItem",T),P.regComp("TntBombItem",A),P.regComp("TagPosItem",V),P.regComp("RestitutionItem",N),P.regComp("DynamicItem",F),P.regComp("ChestItem",H)}}class J extends Laya.Script{initParam(t,e,i,s,a){}}let j={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class W extends J{initParam(t,e,i,s,a){super.initParam(t,e,i,s,a);let r=t;this.addMapComp(r,e,i)}addMapComp(t,e,i){if(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t.skin="sceneObj".concat(i.pa.concat(".png")),t.sizeGrid=i.sizeGrid,1==i.rigiBody){t.addComponent(Laya.RigidBody).type="static"}if(null!=e.box){let i=t.addComponent(Laya.BoxCollider);null!=i&&(i.width=e.box.width,i.height=e.box.height,i.label=e.collisionType.toString()),e.boxCentereChange&&e.layer==j.visionBg&&(i.y=e.height-25),e.colArea&&e.layer==j.visionBg&&(i.label="Ground")}}}let Y={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class X extends J{initParam(t,e,i,s,a){super.initParam(t,e,i,s,a),this.addMapComp(t,e,i,!1,!0)}addMapComp(t,e,i,s,a){if(a){let t=new Laya.Skeleton;if($t.i.mapCtrl.sceneItem.addChild(t),t.pos(e.x,e.y),t.load("sceneObj".concat(i.pa.concat(".sk"))),1==i.rigiBody){t.addComponent(Laya.RigidBody),t.getComponent(Laya.RigidBody).type="static"}if(null!=e.box){t.addComponent(Laya.BoxCollider);let i=t.getComponent(Laya.BoxCollider);i.width=e.box.width,i.height=e.box.height,i.label=e.collisionType.toString(),(e.colArea&&e.layer==Y.sceneItem||e.layer==Y.frontLayer)&&(i.isSensor=!0,i.restitution=1),e.hurt&&(i.label="Hurt")}if(null!=e&&null!=e.comName){let i=t.addComponent(P.getComp(e.comName));i instanceof x&&(GI.log("------------getComp0000  "),null!=e.data&&i.initData(e.data))}$t.i.mapCtrl.AddObjectToLayer(t,e.layer,!1,!0)}}}class z extends J{initParam(t,e,i,s,a,r=null){super.initParam(t,e,i,s,a),this.addMapComp(t,e,i,r)}addMapComp(t,e,i,s){if(i.seqAni){let a="sceneObj".concat(i.pa.concat(".json")),r=s;GI.resMgr.load(a,Laya.Handler.create(this,function(i){let s=new Laya.Prefab;s.json=i;let a=Laya.Pool.getItemByCreateFun(this.itemJson[e.idx][r].idx,s.create,s);if(a.pos(this.itemJson[e.idx][r].x,this.itemJson[e.idx][r].y),a.wrapMode=2,a.play(),""!=this.itemJson[e.idx][r].cname){let t=a.addComponent(P.getComp(this.itemJson[e.idx][r].cname));if(t instanceof x){let i=this.getCustomData(e.sItem,this.itemJson[e.idx][r].idx);null!=i&&t.initData(i)}}t.addChild(a)}))}}}class K{constructor(t,e){this.x=t,this.y=e}}let Q={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class Z extends J{initParam(t,e,i,s,a){super.initParam(t,e,i,s,a),this.addMapComp(t,e,i,s,a)}addMapComp(t,e,i,s,a){let r=new Laya.Sprite;if(r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height,r.pivot(0,0),null!=i.pa&&r.loadImage("sceneObj".concat(i.pa.concat(".png"))),0!=i.vaRotate&&(r.rotation=360-i.vaRotate),i.colArea&&i.born){let e=i.x+t.x,s=Math.abs(i.y)+t.y-20,a=new K(e,s);$t.i.mapCtrl.setCurStepPos(a)}else if(i.born){let t=new K(e.x+i.x,e.y+600);$t.i.mapCtrl.setCurStepPos(t)}if(1==i.rigiBody&&$t.i.mapCtrl.addRigiBody(r,i,e,!0,!1,!1),null!=i.box){let t=r.addComponent(Laya.BoxCollider);t.width=i.box.width,t.height=i.box.height,i.boxCentereChange&&i.layer==Q.backGround?t.y=i.height-25:i.boxCentereChange&&i.layer==Q.frontLayer?t.y=-i.box.height+i.height:i.boxCentereChange&&i.layer==Q.sceneItem&&(t.y=-i.box.height+i.height),t.label=i.collisionType.toString(),i.colArea&&i.layer==Q.visionBg?t.label="Ground":(i.colArea&&i.layer==Q.sceneItem||i.layer==Q.frontLayer)&&(t.isSensor=!0,t.restitution=1),i.hurt&&(t.label="Hurt")}if(0!=i.radius){let t=r.addComponent(Laya.CircleCollider);if(null!=t&&(t.radius=i.height/2,1==i.rigiBody)){let t=r.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic")}}if(null!=i&&""!=i.cname){let t=r.addComponent(P.getComp(i.cname));if(t instanceof x){let s=$t.i.mapCtrl.getCustomData(e.sItem,i.idx);null!=s&&t.initData(s)}}for(let t=0;t<i.poly.length;t++){let e=r.addComponent(Laya.PolygonCollider),s="",a=i.poly[t].Element.length;if(a<8){let r=0;for(r=0;r<a;r++)s=s.concat(i.poly[t].Element[r].px.toString(),","),s=r==a-1?s.concat(i.poly[t].Element[r].py.toString()):s.concat(i.poly[t].Element[r].py.toString(),",");e.points=s,e.restitution=1}else{let a=0;for(a=0;a<8;a++)s=s.concat(i.poly[t].Element[a].px.toString(),","),s=7==a?s.concat(i.poly[t].Element[a].py.toString()):s.concat(i.poly[t].Element[a].py.toString(),",");e.x=i.width/2,e.points=s,e.restitution=1;let o=r.addComponent(Laya.PolygonCollider),n="",h=-1,l=i.poly[t].Element.length,d=l-1;if(l>8){for(h=8;h<l;h++)n=n.concat(i.poly[t].Element[h].px.toString(),","),n=h==d?n.concat(i.poly[t].Element[h].py.toString()):n.concat(i.poly[t].Element[h].py.toString(),",");o.x=i.width/2,o.y=i.height/2,o.points=n}o.restitution=1}}t.addChild(r)}}let $={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class tt extends J{initParam(t,e,i,s,a){super.initParam(t,e,i,s,a),this.addMapComp(t,e,i,s,a)}addMapComp(t,e,i,s,a){a&&(t=t);let r=t.getComponent(Laya.BoxCollider);null!=r||(r=t.addComponent(Laya.BoxCollider)),null!=e&&null!=e.box&&(r.width=e.box.width,r.height=e.box.height,r.y=e.box.centerY-e.box.height/2),a&&(r.width=i.box.width,r.height=i.box.height,r.y=-i.box.height,r.x=-i.box.width/2),r.label=i.collisionType.toString(),i.colArea&&i.layer==$.visionBg?r.label="Ground":(i.colArea&&i.layer==$.sceneItem||i.layer==$.frontLayer)&&(r.isSensor=!0,r.restitution=1),null!=e&&e.hurt&&(r.label="Hurt")}}class et extends Laya.Script{getCls(t){if("itemJson.sudoku"==t){return new W}if("itemJson.spine"==t){return new X}if("itemJson.seqAni"==t){return new z}if("sprite"==t){return new Z}if("itemJson.box"==t){return new tt}}}class it{constructor(){this._kParent=null,this._arrURLs=[],this._templetMap=new Map,this._effArray=[]}Init(t){this._kParent=t,GI.gMsgCet.on("ab.PlayEffect",this,this.onPlayEffect),GI.timerMgr.frameLoop(10,this,this.onUpdate)}preloadEffect(){let t=[];for(let e of $t.i.data.ModuleCfgs.datas)e.hit_eff&&t.push(e.hit_eff);for(let e of $t.i.data.BirdCfgs.birds)e.hit_eff&&t.push(e.hit_eff);GI.log("预加载特效1111：",t),GI.resMgr.load(t,GI.handle(this,t=>{GI.log("预加载特效222：",t)}))}onUpdate(){for(let t=0;t<this._effArray.length;++t){let e=Laya.Pool.getItem(this._effArray[t].url);null==e?(e=new Laya.Skeleton).load(this._effArray[t].url,Laya.Handler.create(this,this.activeEffect,[this._effArray[t].url,e,this._effArray[t].posX,this._effArray[t].posY,this._effArray[t].rotation,this._effArray[t].scaleX,this._effArray[t].scaleY])):this.activeEffect(this._effArray[t].url,e,this._effArray[t].posX,this._effArray[t].posY,this._effArray[t].rotation,this._effArray[t].scaleX,this._effArray[t].scaleY),this._effArray.splice(t,1)}}onPlayEffect(t,e,i,s,a=1,r=1){if(null==t)return;-1==this._arrURLs.indexOf(t)&&this._arrURLs.push(t);let o={url:t,posX:e,posY:i,rotation:s,scaleX:a,scaleY:r};this._effArray.push(o)}activeEffect(t,e,i,s,a,r,o){e&&(this._kParent.addChild(e),e.x=i,e.y=s,e.rotation=a,e.scaleX=r,e.scaleY=o,e.play(0,!1),e.on(Laya.Event.STOPPED,this,this.recoverEffect,[t,e]))}recoverEffect(t,e){e&&(this._kParent.removeChild(e),Laya.Pool.recover(t,e))}clear(){for(let t=0;t<this._arrURLs.length;++t)Laya.Pool.clearBySign(this._arrURLs[t]);this._arrURLs=[],this._templetMap.forEach(t=>{t.destroy()}),this._templetMap.clear(),this._effArray=[],GI.timerMgr.clear(this,this.onUpdate)}}class st{constructor(){this._isDebug=!1,this._arrURLs=[],this._needPlayBg=0,this._needPlayMusicUrl="",this._playMusicTime=0,this._playMusicCD=100}Init(){this.preloadSound(),this.preloadBgMusic(),GI.gMsgCet.on("AB.BirdSound",this,this.onPlaySound),GI.gMsgCet.on("AB.RigidItem",this,this.onPlaySound),GI.gMsgCet.on("AB.SoundEvent",this,this.onPlaySoundEvent),GI.gMsgCet.on("AB.PlayMusic",this,this.onPlayMusic),this._isDebug&&Laya.stage.on(Laya.Event.KEY_DOWN,this,this.onKeyDown),GI.timerMgr.frameLoop(30,this,this.updatePlayerMusic),GI.gMsgCet.on("CMEVT_VIEW_ON_SHOW_END",this,this.onGameShowEnd)}preloadSound(){if(GI.gCfg.soundpreload){var t=Laya.SoundManager._soundClass;for(let e of $t.i.data.soundsCfg.modules)for(let i of e.sounds)i.url&&"null"!=i.url&&(new t).load(i.url);for(let e of $t.i.data.soundsCfg.events)for(let i of e.sounds)i.url&&"null"!=i.url&&(new t).load(i.url)}}preloadBgMusic(){if(GI.gCfg.bgMusicPreload){var t=Laya.SoundManager._soundClass;for(let e of $t.i.data.soundsCfg.bgmusic)for(let i of e.sounds)i.url&&"null"!=i.url&&(new t).load(i.url)}}updatePlayerMusic(){this._needPlayBg>0&&GI.timerMgr.currTimer>this._playMusicTime&&(this._playMusicTime=GI.timerMgr.currTimer+this._playMusicCD,this._needPlayMusicUrl&&GI.soundMgr.playMusic(this._needPlayMusicUrl,0),this._needPlayBg=0)}onPlayMusic(t=1,e=1){this._needPlayMusicUrl=this.getURL($t.i.data.soundsCfg.bgmusic,t,e),this._needPlayMusicUrl&&this._needPlayBg++}onGameShowEnd(){GI.log("-----游戏切入---------"),GI.gCfg.gameShowEnd&&(GI.log("-------游戏静音--------"),Laya.SoundManager.muted=!Laya.SoundManager.muted,Laya.SoundManager.muted=!Laya.SoundManager.muted)}onPlaySound(t,e){let i=this.getURL($t.i.data.soundsCfg.modules,t,e);i&&"null"!=i&&(-1==this._arrURLs.indexOf(i)&&this._arrURLs.push(i),GI.soundMgr.playSound(i)),this._isDebug&&GI.log("onPlaySound播放"+this._soundInfo+" type: "+t.toString()+",id: "+e.toString()+",url: "+i)}onPlaySoundEvent(t,e=1){if(t&&t.eventType){let i=this.getURL($t.i.data.soundsCfg.events,t.eventType,e);i&&"null"!=i&&(-1==this._arrURLs.indexOf(i)&&this._arrURLs.push(i),GI.soundMgr.playSound(i)),this._isDebug&&GI.log("onPlaySoundEvent播放"+this._soundInfo+" type: "+t.eventType.toString()+",id: "+e.toString()+",url: "+i)}}getURL(t,e,i){let s=null;for(let a=0;a<t.length;++a)if(t[a].id==e)for(let e=0;e<t[a].sounds.length;++e)if(t[a].sounds[e].id==i){s=t[a].sounds[e].url,this._soundInfo=t[a].name+t[a].sounds[e].use;break}return s}clear(){this._isDebug&&GI.log(this._arrURLs);for(let t=0;t<this._arrURLs.length;++t)Laya.SoundManager.destroySound(this._arrURLs[t]);this._arrURLs=[]}destory(){this.clear(),GI.timerMgr.clear(this,this.updatePlayerMusic)}onKeyDown(t){t.keyCode==Laya.Keyboard.Q&&GI.gMsgCet.event("AB.PlayMusic"),t.keyCode==Laya.Keyboard.W&&GI.gMsgCet.event("AB.PlayMusic",[2,1])}}class at{constructor(t,e){this.x=t,this.y=e}}var rt={};let ot={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class nt{constructor(){this._effectControl=new it,this._soundControl=new st,this._mapAddMgr=new et,this._initComp=new q,this.stepPos=new Array,this.launcherPos=new at(230,625),this.bornSpr=new Array,this.visionBgx=0,this._cheerRoles=[]}get mapAddMgr(){return this._mapAddMgr}get initComp(){return this._initComp}initSceneItem(t){this.itemInitEndCall=t,this.initMap()}initMap(){GI.resMgr.load("res/map/mapCfg.json",GI.handle(this,t=>{this.mapConfig=t;for(const t in this.mapConfig.mapCfg){let e,i=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Bg,s=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Si,a=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Fr,r=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Ci,o=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Po,n=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Re,h=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Mp;e=null!=this.mapConfig.mapCfg[t].dataPath?this.mapConfig.mapCfg[t].dataPath:"res/map/level".concat(t.toString()).concat(".json"),rt[t]={dataPath:e,backGround:i,sceneItem:s,frontLayer:a,circle:r,polygon:o,rectangle:n,map:h,minX:this.mapConfig.mapCfg[t].minX,maxX:this.mapConfig.mapCfg[t].maxX,minY:this.mapConfig.mapCfg[t].minY,maxY:this.mapConfig.mapCfg[t].maxY,initScale:this.mapConfig.mapCfg[t].initScale,minScale:this.mapConfig.mapCfg[t].minScale}}this.onSceneItemLoad()}))}onSceneItemLoad(){null!=this.itemInitEndCall&&(this.itemInitEndCall.run(),this.itemInitEndCall.recover(),this.itemInitEndCall=null)}initlizeComp(){this.initComp.registerComp()}onInitLevelMap(){let t=$t.i.data.getCurMapLvl();D.RigidIdx=0,GI.prgMgr.load([{url:rt[t].dataPath,type:Laya.Loader.JSON},{url:rt[t].backGround,type:Laya.Loader.ATLAS},{url:rt[t].sceneItem,type:Laya.Loader.ATLAS},{url:rt[t].frontLayer,type:Laya.Loader.ATLAS},{url:rt[t].circle,type:Laya.Loader.ATLAS},{url:rt[t].polygon,type:Laya.Loader.ATLAS},{url:rt[t].rectangle,type:Laya.Loader.ATLAS},{url:rt[t].map,type:Laya.Loader.ATLAS}],Laya.Handler.create(this,this.onSpriteLoaded)),this._effectControl.Init(GI.sceneMgr.worldRoot),this.initDarkCover()}changeMap(t){this.mapInitEndCall=t,this.clearScene(),this.onInitLevelMap(),GI.gMsgCet.on("wmCtrl.ROLE_DEATH",this,this.onFailMsg);let e=$t.i.data.curChapter;($t.i.data.isGuideScene||$t.i.isEventScene||$t.i.data.isDailyChallengeScene)&&(e=1e3),GI.gMsgCet.event("AB.PlayMusic",[2,e]),GI.gMsgCet.event("AB.SoundEvent",{eventType:1})}clearScene(){this.clearCheerRoles(),this.ClearMapObj(),this.clearStepPos(),this.clearBornSpr(),this._effectControl.clear(),this._soundControl.clear(),$t.i.data.clearBirdPos(),$t.i.data.clearOffsetPos(),$t.i.data.clearBalloonPar()}onRoleLoaded(){null!=this.mapInitEndCall&&(this.mapInitEndCall.run(),this.mapInitEndCall.recover(),this.mapInitEndCall=null)}onParseMap(t,e){if(t.isObj){let i=new Laya.Sprite;i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,i.pivot(0,0),this.AddObjectToLayer(i,t.layer,!1,!1),this.onParseMapItem(t,i,e),this.addCompFunc(i,null,t,!0,!1)}else if(this.itemJson[t.idx][0].sudoku){let e=new Laya.Image;this.mapAddMgr.getCls("itemJson.sudoku").initParam(e,t,this.itemJson[t.idx][0],!1,!1),this.AddObjectToLayer(e,t.layer,!0,!1)}else if(this.itemJson[t.idx][0].spine){this.mapAddMgr.getCls("itemJson.spine").initParam(null,t,this.itemJson[t.idx][0],!1,!0)}else this.itemJson[t.idx][0].seqAni?this.seqAniGenerate(t):this.spriteGenerate(t,null,null)}onParseMapJsonItem(t,e,i,s){if(t.sudoku){let e=new Laya.Image;if(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e.pivot(0,0),null!=t.pa&&(e.skin="sceneObj".concat(t.pa.concat(".png"))),e.sizeGrid=t.sizeGrid,this.addRigiBody(e,t,null,!1,!1,!0),null!=t.box){e.addComponent(Laya.BoxCollider);let i=e.getComponent(Laya.BoxCollider);null!=i&&(i.width=t.box.width,i.height=t.box.height,i.label=t.collisionType.toString()),t.boxCentereChange&&t.layer==ot.visionBg&&(i.y=t.height-25),t.colArea&&t.layer==ot.visionBg&&(i.label="Ground")}i.addChild(e)}else if(t.spine)this.addSkeleton(i,e,t);else if(t.seqAni)this.addSeqAni(i,e,t,s);else{this.mapAddMgr.getCls("sprite").initParam(i,e,t,!1,!1)}this.addRigiBody(i,null,e,!0,!1,!1),e.poly.length>0&&null==i.getComponent(Laya.PolygonCollider)&&this.addPolyCollider(i,e),null!=e.box&&this.addBox(i,e,t,!0,!1)}onParseMapItem(t,e,i){let s;for(s=0;s<this.itemJson[t.idx].length;s++)this.onParseMapJsonItem(this.itemJson[t.idx][s],t,e,s)}addSkeleton(t,e,i){if(i.spine){let s=new Laya.Skeleton,a=i.x,r=i.y;s.pos(a,r),s.load("sceneObj".concat(i.pa.concat(".sk"))),this.addRigiBody(s,i,null,!1,!0,!1),null!=i.box&&this.addBox(s,e,i,!1,!0),this.addCompFunc(s,i,e,!1,!0),t.addChild(s)}}addSeqAni(t,e,i,s){if(i.seqAni){let a="sceneObj".concat(i.pa.concat(".json")),r=s;GI.resMgr.load(a,Laya.Handler.create(this,function(i){let s=new Laya.Prefab;s.json=i;let a=Laya.Pool.getItemByCreateFun(this.itemJson[e.idx][r].idx,s.create,s);if(a.pos(this.itemJson[e.idx][r].x,this.itemJson[e.idx][r].y),a.wrapMode=2,a.play(),""!=this.itemJson[e.idx][r].cname){let t=a.addComponent(P.getComp(this.itemJson[e.idx][r].cname));if(t instanceof x){let i=this.getCustomData(e.sItem,this.itemJson[e.idx][r].idx);null!=i&&t.initData(i)}}t.addChild(a)}))}}addBox(t,e,i,s,a){a&&(t=t);let r=t.getComponent(Laya.BoxCollider);null!=r||(r=t.addComponent(Laya.BoxCollider)),null!=e&&null!=e.box&&(r.width=e.box.width,r.height=e.box.height,r.y=e.box.centerY-e.box.height/2),a&&(r.width=i.box.width,r.height=i.box.height,r.y=-i.box.height,r.x=-i.box.width/2),r.label=i.collisionType.toString(),i.colArea&&i.layer==ot.visionBg?r.label="Ground":(i.colArea&&i.layer==ot.sceneItem||i.layer==ot.frontLayer)&&(r.isSensor=!0,r.restitution=1),null!=e&&e.hurt&&(r.label="Hurt"),null!=i&&i.hurt&&(r.label="Hurt")}addCompFunc(t,e,i,s,a){if(a&&(t=t),null!=i&&null!=i.comName){let e=t.addComponent(P.getComp(i.comName));e instanceof x&&null!=i.data&&e.initData(i.data)}if(null!=e&&""!=e.cname){let s=t.addComponent(P.getComp(e.cname));if(s instanceof x){let t=this.getCustomData(i.sItem,e.idx);null!=t&&s.initData(t)}}}onSpriteLoaded(){var t=GI.resMgr.getRes(rt[$t.i.data.getCurMapLvl()].dataPath);this.itemJson=GI.resMgr.getRes("res/map/item.json");for(let e in t)this.onParseMap(t[e],null);this.onRoleLoaded()}getCustomData(t,e){let i;for(i=0;i<t.length;i++)if(t[i].idx==e)return t[i].data;return null}addPolyCollider(t,e){if(null!=t){let i=0;for(i=0;i<e.poly.length;i++){let s=t.addComponent(Laya.PolygonCollider),a="",r=e.poly[i].Element.length;if(r<8){let t=0;for(t=0;t<r;t++)a=a.concat(e.poly[i].Element[t].px.toString(),","),a=t==r-1?a.concat(e.poly[i].Element[t].py.toString()):a.concat(e.poly[i].Element[t].py.toString(),",");s.points=a,s.restitution=1}else{let r=0;for(r=0;r<8;r++)a=a.concat(e.poly[i].Element[r].px.toString(),","),a=7==r?a.concat(e.poly[i].Element[r].py.toString()):a.concat(e.poly[i].Element[r].py.toString(),",");s.x=e.width/2,s.points=a,s.restitution=1;let o=t.addComponent(Laya.PolygonCollider),n="",h=-1,l=e.poly[i].Element.length,d=l-1;if(l>8){for(h=8;h<l;h++)n=n.concat(e.poly[i].Element[h].px.toString(),","),n=h==d?n.concat(e.poly[i].Element[h].py.toString()):n.concat(e.poly[i].Element[h].py.toString(),",");o.x=e.width/2,o.y=e.height/2,o.points=n}o.restitution=1}}}}addRigiBody(t,e,i,s,a,r){if(a&&(t=t),r&&(t=t),null!=e&&1==e.rigiBody){t.addComponent(Laya.RigidBody).type="static"}if(null!=i&&1==i.rigiBody&&null==t.getComponent(Laya.RigidBody)){t.addComponent(Laya.RigidBody).type="static"}}seqAniGenerate(t){let e="sceneObj".concat(this.itemJson[t.idx][0].pa.concat(".json"));GI.resMgr.load(e,Laya.Handler.create(this,function(e){let i=new Laya.Prefab;i.json=e;let s=Laya.Pool.getItemByCreateFun(t.idx,i.create,i);if(s.pos(t.x,t.y),s.wrapMode=2,s.play(),this.addAnimationToLayer(s,t.layer),""!=t.cname){s.addComponent(P.getComp(t.cname))}}))}spriteGenerate(t,e,i){if(t.offset&&$t.i.data.setOffsetPos(t.x,t.y),t.backUpBirds)return void $t.i.data.setCurBirdPos(t.x,t.y,t.birdType);let s=new Laya.Sprite;if($t.i.data.maxRightX=t.x,s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height,s.loadImage("sceneObj".concat(this.itemJson[t.idx][0].pa.concat(".png"))),t.colArea&&t.born){let e=new at(t.x,t.y);this.setCurStepPos(e)}if(t.born){let e=new at(t.x,t.y-50);this.setCurStepPos(e)}if(t.born&&($t.i.data.groundY=t.y),1==this.itemJson[t.idx][0].rigiBody){s.addComponent(Laya.RigidBody).type="static"}if(null!=t.box){s.addComponent(Laya.BoxCollider);let e=s.getComponent(Laya.BoxCollider);e.width=t.box.width,e.height=t.box.height,t.boxCentereChange&&t.layer==ot.backGround?e.y=t.height-25:t.boxCentereChange&&t.layer==ot.frontLayer?e.y=-t.box.height+t.height:t.boxCentereChange&&(t.layer,ot.sceneItem),e.label=t.collisionType.toString(),t.colArea&&t.layer==ot.visionBg?(e.label="Ground",e.isSensor=!0):(t.colArea&&t.layer==ot.sceneItem||t.layer==ot.frontLayer)&&(e.isSensor=!0,e.restitution=1),t.hurt&&(e.label="Hurt")}let a=0;for(a=0;a<t.poly.length;a++){let e=s.addComponent(Laya.PolygonCollider),i="",r=t.poly[a].Element.length;if(r<8){let s=0;for(s=0;s<r;s++)i=i.concat(t.poly[a].Element[s].px.toString(),","),i=s==r-1?i.concat(t.poly[a].Element[s].py.toString()):i.concat(t.poly[a].Element[s].py.toString(),",");e.points=i,e.restitution=1}else{let r=0;for(r=0;r<8;r++)i=i.concat(t.poly[a].Element[r].px.toString(),","),i=7==r?i.concat(t.poly[a].Element[r].py.toString()):i.concat(t.poly[a].Element[r].py.toString(),",");e.x=t.width/2,e.points=i,e.restitution=1;let o=s.addComponent(Laya.PolygonCollider),n="",h=-1,l=t.poly[a].Element.length,d=l-1;if(l>8){for(h=8;h<l;h++)n=n.concat(t.poly[a].Element[h].px.toString(),","),n=h==d?n.concat(t.poly[a].Element[h].py.toString()):n.concat(t.poly[a].Element[h].py.toString(),",");o.x=t.width/2,o.y=t.height/2,o.points=n}o.restitution=1}}if(t.radius){let e=s.addComponent(Laya.CircleCollider);if(null!=e&&(e.radius=t.height/2,1==this.itemJson[t.idx][0].rigiBody)){let t=s.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic")}}if(""!=t.rotation&&(s.rotation=t.rotation-360),""!=t.cname){let e=s.addComponent(P.getComp(t.cname));e instanceof x&&null!=t.data&&(e.initInfo(t.idx),e.initData(t.data))}null==e&&null==i?this.AddObjectToLayer(s,t.layer,!1,!1):e.addChild(s)}AddObjectToLayer(t,e,i,s){i&&(t=t),s&&(t=t),e==ot.visionBg?this.visionBg.addChild(t):e==ot.backGround?this.backGround.addChild(t):e==ot.sceneItem?this.sceneItem.addChild(t):e==ot.frontLayer?this.front.addChild(t):e==ot.topLayer&&this.topMoreRole.addChild(t)}onFailMsg(){$t.i.onFail()}ClearMapObj(){this.recursiveClearLayer(this.backGround),this.recursiveClearLayer(this.sceneItem),this.recursiveClearLayer(this.front),this.recursiveClearLayer(this.visionBg),this.recursiveClearLayer(this.topMoreRole),this.clearDarkCover(),GI.gMsgCet.off("wmCtrl.ROLE_DEATH",this,this.onFailMsg)}clearLayer(t){if(null!=t){let e=0;for(e=t.numChildren-1;e>=0;e--){let i=t.getChildAt(e);if(null!=i){let t=i.getComponents(Laya.ColliderBase);if(null!=t)for(let e=0;e<t.length;++e)null!=t[e]&&t[e].destroy();i.destroy()}}}}recursiveClearLayer(t){if(null!=t){let e=0;for(e=t.numChildren-1;e>=0;e--){let i=t.getChildAt(e);if(this.recursiveClearLayer(i),null!=i){let t=i.getComponent(D);null!=t&&t.onDestroy();let e=i.getComponents(Laya.ColliderBase);if(null!=e)for(let t=0;t<e.length;++t)null!=e[t]&&(e[t].destroy(),e[t]=null);let s=i.getComponent(Laya.RigidBody);null!=s&&s.destroy();let a=i.getComponent(Laya.RevoluteJoint);null!=a&&(a.destroy(),a=null),i.rotation=0,i.destroy()}}}}setCurBornSpr(t){this.bornSpr.push(t)}clearBornSpr(){for(;this.bornSpr.pop(););}setCurStepPos(t){this.stepPos.push(t)}clearStepPos(){for(;this.stepPos.pop(););}init(t){this.initlizeComp(),this.visionBg=new Laya.Sprite,this.backGround=new Laya.Sprite,this.sceneItem=new Laya.Sprite,null!=this.roleLayer&&(GI.sceneMgr.worldRoot.removeChild(this.roleLayer),this.roleLayer.destroy()),this.roleLayer=new Laya.Sprite,this.roleLayer.pos(0,0),this.front=new Laya.Sprite,this.topMoreRole=new Laya.Sprite,GI.sceneMgr.worldRoot.addChild(this.visionBg),GI.sceneMgr.worldRoot.addChild(this.backGround),GI.sceneMgr.worldRoot.addChild(this.sceneItem),GI.sceneMgr.worldRoot.addChild(this.front),GI.sceneMgr.worldRoot.addChild(this.roleLayer),GI.sceneMgr.worldRoot.addChild(this.topMoreRole),this.topMoreRole.pos(0,0),this.initSceneItem(t),this._soundControl.Init(),GI.gMsgCet.event("AB.PlayMusic")}moveVisionBg(t){this.visionBgx!=t&&(this.visionBgx=t,this.visionBg.x=.3*-t)}getCurBornSpr(){return this.bornSpr[$t.i.curStep]}getCurStepPos(){return this.stepPos[$t.i.curStep]}getLaunchePos(){return this.launcherPos}getLastStepPos(){return this.stepPos[this.stepPos.length-1]}getStepByPos(t,e){let i=0;for(i=0;i<this.stepPos.length;i++)if(this.stepPos[i].x==t&&this.stepPos[i].y==e)return i;return-1}addAnimationToLayer(t,e){e==ot.visionBg?this.visionBg.addChild(t):e==ot.backGround?this.backGround.addChild(t):e==ot.sceneItem?this.sceneItem.addChild(t):e==ot.frontLayer&&this.front.addChild(t)}checkCheerRoles(){if($t.i.curStep<$t.i.totalStep-1)this.clearCheerRoles();else if(this._cheerRoles.length>0)return}addCheerRole(t,e){if(!t||e[t.id])return;e[t.id]=!0;let i=new Laya.Skeleton;this.sceneItem.addChild(i);let s=this.getLastStepPos();i.pos(s.x+160+90*this._cheerRoles.length,s.y+75),i.load(t.roleAni),i.scaleX=-1,this._cheerRoles.push(i)}clearCheerRoles(){for(;this._cheerRoles.length>0;)this._cheerRoles.pop().destroy(!0)}playDarkEffect(t){if(t&&t.shadkeDuration&&this.darkCover){let e=t.shadkeDuration-1500;e<0&&(e=0),this.darkCover.visible=!0,this.darkTweenPre=GI.Tween.to(this.darkCover,{alpha:.7},1e3,GI.Ease.linearNone,GI.handle(this,()=>{this.darkTweenAfter=GI.Tween.to(this.darkCover,{alpha:0},500,Laya.Ease.linearNone,GI.handle(this,()=>{this.darkCover&&(this.darkCover.visible=!1)}),e)}))}}initDarkCover(){this.darkCover=new Laya.Sprite,this.darkCover.visible=!1,this.darkCover.pivot(0,0),this.darkCover.alpha=.7,this.AddObjectToLayer(this.darkCover,ot.topLayer,!0,!1);let t=$t.i.data.getCurMapLvl(),e=this.mapConfig.mapCfg[t].minX,i=this.mapConfig.mapCfg[t].maxX,s=this.mapConfig.mapCfg[t].minY-1e3,a=this.mapConfig.mapCfg[t].maxY;this.darkCover.graphics.drawRect(-1e3,s,i-e+4e3,a-s,"#000000")}clearDarkCover(){this.darkTweenPre&&this.darkTweenPre.clear(),this.darkTweenAfter&&this.darkTweenAfter.clear()}}class ht{constructor(){this.rodUrl="rod/2scRod/Soft.png",this.animNum=6,this.SizeNum=2,this.alphaNum=.058,this.rodShowMaxSize=[30,30],this.rodShowMaxAngle=1,this.rodShowMinSize=[18,18],this.rodShowMinAngle=.652}onEnable(t){this.roleCtrl=t;let e=this.roleCtrl.rodSize;this.rodSize=e;e.x;this.leftShow=this.CreateRodShow(e,1),this.rightShow=this.CreateRodShow(e,2)}onDisable(){te.RemoveNodes(this.leftShow),te.RemoveNodes(this.rightShow),te.RemoveNodes(this.leftRodColl),te.RemoveNodes(this.rightRodColl),this.leftRodColl=null,this.rightRodColl=null,this.leftShow=null,this.rightShow=null}CreateRodShow(t,e){let i=te.CreateSprite(this.rodUrl,this.rodShowMinSize[0],this.rodShowMinSize[1],this.rodShowMinSize[0]/2,this.rodShowMinSize[1]/2,0,0);return 1==e?this.roleCtrl.leftLeg.addChild(i):this.roleCtrl.rightLeg.addChild(i),i.pos(t.x/2,t.y),i.alpha=this.rodShowMaxAngle,i}CloseShowRod(){GI.timerMgr.clear(this,this.UpdateShowAnim),this.rightShow.alpha=0,this.leftShow.alpha=0}get isLeftRodShow(){return this.leftShow.alpha>0}set isLeftRodShow(t){t?(this.leftShow.alpha=this.rodShowMinAngle,this.rightShow.alpha=0,this.leftShow.width=this.rodShowMaxSize[0],this.leftShow.height=this.rodShowMaxSize[1]):(this.leftShow.alpha=0,this.rightShow.alpha=this.rodShowMinAngle,this.rightShow.width=this.rodShowMaxSize[0],this.rightShow.height=this.rodShowMaxSize[1]),this.rightShow.pivotX=this.rightShow.width/2,this.rightShow.pivotY=this.rightShow.height/2,this.rightShow.pos(this.rodSize.x/2,this.rodSize.y),this.leftShow.pivotX=this.leftShow.width/2,this.leftShow.pivotY=this.leftShow.height/2,this.leftShow.pos(this.rodSize.x/2,this.rodSize.y)}get isRightRodShow(){return this.rightShow.alpha>0}set isRightRodShow(t){t?(this.leftShow.alpha=0,this.rightShow.alpha=this.rodShowMinAngle,this.rightShow.width=this.rodShowMaxSize[0],this.rightShow.height=this.rodShowMaxSize[1]):(this.leftShow.alpha=this.rodShowMinAngle,this.rightShow.alpha=0,this.leftShow.width=this.rodShowMaxSize[0],this.leftShow.height=this.rodShowMaxSize[1]),this.rightShow.pivotX=this.rightShow.width/2,this.rightShow.pivotY=this.rightShow.height/2,this.rightShow.pos(this.rodSize.x/2,this.rodSize.y),this.leftShow.pivotX=this.leftShow.width/2,this.leftShow.pivotY=this.leftShow.height/2,this.leftShow.pos(this.rodSize.x/2,this.rodSize.y)}ShowUpdateAnim(t,e){GI.timerMgr.clear(this,this.UpdateShowAnim),this.showAnimIdx=t,1==t?this.isLeftRodShow&&GI.timerMgr.frameLoop(1,this,this.UpdateShowAnim,[e]):2==t&&this.isRightRodShow&&GI.timerMgr.frameLoop(1,this,this.UpdateShowAnim,[e])}SetRodShowSize(t,e=!0){e?(t.width+=this.SizeNum,t.height+=this.SizeNum,t.width>this.rodShowMaxSize[0]&&(t.width=this.rodShowMaxSize[0]),t.height>this.rodShowMaxSize[1]&&(t.height=this.rodShowMaxSize[1]),t.alpha-=this.alphaNum):(t.width-=this.SizeNum,t.height-=this.SizeNum,t.width<this.rodShowMinSize[0]&&(t.width=this.rodShowMinSize[0]),t.height<this.rodShowMinSize[1]&&(t.height=this.rodShowMinSize[1]),t.alpha+=this.alphaNum),t.pivotX=t.width/2,t.pivotY=t.height/2,t.pos(this.rodSize.x/2,this.rodSize.y)}UpdateShowAnim(t){let e;if(null==(e=1==this.showAnimIdx?this.leftShow:this.rightShow))return GI.timerMgr.clear(this,this.UpdateShowAnim),null;this.SetRodShowSize(e,t),(t&&e.alpha<=this.rodShowMinAngle||0==t&&e.alpha>=this.rodShowMaxAngle)&&GI.timerMgr.clear(this,this.UpdateShowAnim)}}class lt extends Laya.RevoluteJoint{constructor(){super()}}class dt{constructor(t,e){this._part1H=0,this._part2H=0,this._partLen=20,this._part1Pos=new Laya.Point,this._part2Pos=new Laya.Point,this._part3Pos=new Laya.Point,this.roleCtrl=t,this._index=e}initRole(t,e){this._limb=t,this._part1=this._limb.getChildByName("part1"),this._part1Pt=this._limb.getChildByName("part1Pt"),this._part2=this._part1.getChildByName("part2"),this._part3Con=this._part2.getChildByName("part3Con"),this._part3=this._part3Con.getChildByName("part3"),this._part3Pt=this._part3.getChildByName("part3Pt");let i=e.getChildByName("hand");for(;i.numChildren>0;){let t=i.getChildAt(0);null!=t&&(i.removeChildAt(0),t.destroy())}i.addChild(this._part3),this._part3.rotation=-90,this._part1H=this._part1.height,this._part2H=this._part2.height,this._partLen=Math.floor((this._part1H+this._part2H)/2)}onUpdate(){if(!this._limb||this.roleCtrl.isRoleDeath)return;this.updateScPos(this._part1Pt,this._part1Pos),this.updateScPos(this._part3Pt,this._part3Pos);let t=this._part1Pos.distance(this._part3Pos.x,this._part3Pos.y);if(t>2*this._partLen)this._part1.height=this._part1.pivotY+t/2,this._part1.rotation=this.getRotat(this._part1Pos,this._part3Pos)-this.roleCtrl.roleShow.rotation,this._part2.y=this._part1.height,this._part2.height=this._part2.pivotY+t/2,this._part2.rotation=0;else{let e=this._partLen*Math.cos(Math.PI*t/(4*this._partLen));this._part2Pos.setTo((this._part3Pos.x+this._part1Pos.x)/2-e*(this._part3Pos.y-this._part1Pos.y)/t,(this._part3Pos.y+this._part1Pos.y)/2+e*(this._part3Pos.x-this._part1Pos.x)/t),t=this._part2Pos.distance(this._part1Pos.x,this._part1Pos.y),this._part1.height=this._part1.pivotY+t,this._part1.rotation=this.getRotat(this._part1Pos,this._part2Pos)-this.roleCtrl.roleShow.rotation,this._part2.y=this._part1.height,this._part2.height=this._part2.pivotY+t,this._part2.rotation=this.getRotat(this._part2Pos,this._part3Pos)-this._part1.rotation-this.roleCtrl.roleShow.rotation}}updateScPos(t,e){return t.localToGlobal(e.reset(),null,GI.sceneMgr.worldRoot)}getRotat(t,e){return t&&e?180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI:0}onRoleDie(){this._part1.height=this._part1H,this._part2.height=this._part2H,this._part3Con.addChild(this._part3),this._part3.rotation=0,this._part3.pos(0,0)}}class gt{constructor(t,e){this._let1H=0,this._offY=0,this._leg1Pos=new Laya.Point,this._rodFeetPos=new Laya.Point,this.roleCtrl=t,this._index=e}initRole(t,e){this._limb=t,this._leg1=this._limb.getChildByName("leg1"),this._leg1Pt=this._limb.getChildByName("leg1Pt"),this._feet=this._leg1.getChildByName("feet"),this._rodFeetPt=e.getChildByName("feet"),this._let1H=this._leg1.height,this._offY=this._feet.y-this._let1H}onUpdate(){this._limb&&!this.roleCtrl.isRoleDeath&&(this.updateScPos(this._leg1Pt,this._leg1Pos),this.updateScPos(this._rodFeetPt,this._rodFeetPos),this._leg1.height=this._leg1Pos.distance(this._rodFeetPos.x,this._rodFeetPos.y),this._leg1.rotation=this.getRotat(this._leg1Pos,this._rodFeetPos)-this.roleCtrl.roleShow.rotation,this._feet.y=this._leg1.height+this._offY)}updateScPos(t,e){return t.localToGlobal(e.reset(),null,GI.sceneMgr.worldRoot)}getRotat(t,e){return t&&e?180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI:0}onRoleDie(){this._leg1.height=this._let1H}}class ct{constructor(){this.imgUrl="rod/2scRod/RoleDeath.png",this.size={x:57,y:49,pivotX:29,pivotY:25}}static StartAnim(t,e=1){let i=new ct;return i.Init(t,e),i}Init(t,e=1){this.sprite=new Laya.Sprite,this.sprite.loadImage(this.imgUrl),this.sprite.width=this.size.x,this.sprite.height=this.size.y,this.sprite.pivot(this.size.pivotX,this.size.pivotY),GI.sceneMgr.worldRoot.addChild(this.sprite),this.sprite.pos(t.x,t.y),this.sprite.scaleX=e,this.sprite.scaleY=e,this.sprite.alpha=1,this.sprite.rotation=0;GI.Tween.to(this.sprite,{rotation:-130},900,null,Laya.Handler.create(this,this.AnimEnd)),GI.Tween.to(this.sprite,{alpha:0},850)}AnimEnd(){this.sprite.destroy()}}var ut,pt,mt,ft,It,yt;!function(t){t[t.None=0]="None",t[t.LeftRod=1]="LeftRod",t[t.RightRod=2]="RightRod"}(ut||(ut={})),function(t){t[t.None=0]="None",t[t.GameNode=1]="GameNode",t[t.AllDeath=2]="AllDeath",t[t.Hurt=3]="Hurt"}(pt||(pt={})),function(t){t[t.normal=0]="normal",t[t.danger=1]="danger",t[t.win=2]="win",t[t.fail=3]="fail"}(mt||(mt={}));class wt{constructor(){this.rolePrefabData=null,this.rodPrefabData=null,this.soundKey={1:"res/sound/Walk.mp3",2:"res/sound/Walk.mp3",3:"res/sound/Walk.mp3",4:"res/sound/Walk.mp3",5:"res/sound/SavePoint.mp3"},this.CollisionKey={1:"",2:"",3:"",4:""},this.GameNode="4",this.AllDeath="Ground",this.Hurt="Hurt",this.isNewbie=!1,this.isDangling=!1,this.isStartUpForce=!1,this.balloonNum=2,this.flY=300,this.buoyancy=500,this.MaxAngle=65,this.buoyancyNum=80,this.leftCollideTime=0,this.leftAway=!1,this.rightCollideTime=0,this.rightAway=!1,this.zoomIn=!1,this.posetionH=593,this.cameraX=230,this.cameraY=740,this.mousex=0,this.minAngleData=-60,this.maxAngleData=60,this.isInit=!1,this.RoleX=0,this.addX=0,this.isSlideFoot=!1,this.isMouseDown=!1,this.userLorR=ut.None,this.leftTween=null,this.RightTween=null,this.rodSize=new Laya.Point(12,198),this.pivotLorR=[6,20],this.runPivotLorR=[6,65],this.boxSize=new Laya.Point(6,198),this.boxPoth=new Laya.Point(3,0),this.roleBoxSize=[0,0,38,38],this.roleTexeSize=[55,37,40,21],this.rolefaceSize=[52,47,22,40],this.RodRunYAddNum=5,this.RoleForce=420,this.rodTweenTime=300,this.StartAngle=28,this.isRoleDeath=!1,this.isInWall=!0,this.isFollowRole=!1,this.followRole=new Laya.Point(0,0),this.leftRodRupture=[],this.rightRodRupture=[],this.leftRodAnimPlay=!0,this.rightRodAnimPlay=!0,this.isRemove=!1,this.onTriggerExitNUm=0,this.isPlayGameNodeSound=!1,this.firstRun=!1,this.isjump=!1,this.MinForce=1850,this.jcRodPoth=null,this.isInRodQuan=!1,this.leftAngle=0,this.rightAngle=0,this.DEGTORAD=50,this.mouseMaxNum=130,this.AngularVelocity=this.DEGTORAD/this.mouseMaxNum,this.IsDetectRod=!1,this.rodUrl="",this.faceUrls={[mt.normal]:"/face.png",[mt.danger]:"/faceDanger.png",[mt.win]:"/faceWin.png",[mt.fail]:"/faceFail.png"}}preInit(){this._leftArm=new dt(this,1),this._rightArm=new dt(this,2),this._leftLeg=new gt(this,1),this._rightLeg=new gt(this,2),GI.gMsgCet.on("Wm.onFinishLvl",this,this.RoleVictory),GI.gMsgCet.on("ReachMidStep",this,this.OnReachMidStep),GI.gMsgCet.on("ReachLine",this,this.OnReachMidStep),GI.gMsgCet.on("wmCtrl.MOUSE_UP",this,this.onMouseUp11),GI.gMsgCet.on("wmCtrl.MOUSE_DOWN",this,this.onMouseDown11),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_Start",this,()=>{this.setDangerFace(!0)}),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_End",this,()=>{this.setDangerFace(!1)}),GI.gMsgCet.on("wm.waterForce",this,this.OrganForce)}ReachMidStepPhiz(){this.setNormalFace()}ShowWinFacePhiz(){this.setWinFace(),GI.timerMgr.clear(this,this.ReachMidStepPhiz),GI.timerMgr.once(1200,this,this.ReachMidStepPhiz)}OnReachMidStep(){this.ShowWinFacePhiz(),this.isNewbie&&(2==this.balloonNum?(this.buoyancy=400,this.leftRigid.angularDamping=20,this.rightRigid.angularDamping=20,this.SetRoleTutorial(6)):1==this.balloonNum&&(this.leftRigid.angularDamping=0,this.rightRigid.angularDamping=0,this.SetRoleTutorial(7)))}SetInertiaScale(t,e=1,i=1){var s=new Laya.Physics.I.box2d.b2MassData;t.body.GetMassData(s),s.I=e,s.mass=i,t.body.SetMassData(s)}SetMassData(t,e,i){var s=new Laya.Physics.I.box2d.b2MassData;t.body.GetMassData(s),s.center.Set(e,i),t.body.SetMassData(s)}initGuideStepRole(){if(this.isNewbie=$t.i.data.isGuideScene,this.isDangling=!1,this.isNewbie){let t=$t.i.data.guideStep;null==t&&(t=1),this.isDangling=t<=4,t>3&&(this.balloonNum=t<=5?2:6==t?1:0),this.flY=540,this.buoyancy=450}}initRole(t=230,e=710){if(this.initGuideStepRole(),null==this.rolePrefabData){let i=[{url:$t.i.data.bodyData.curUseData.scRes,type:Laya.Loader.JSON},{url:"res/rod/Rod.json",type:Laya.Loader.JSON},{url:$t.i.data.rodData.curUseData.scResBase,type:Laya.Loader.JSON}];this.AddRoleSkinUrls(i),GI.resMgr.load(i,Laya.Handler.create(this,i=>{this.rolePrefabData=GI.resMgr.getRes($t.i.data.bodyData.curUseData.scRes),this.rodPrefabData=GI.resMgr.getRes("res/rod/Rod.json"),this.CreateRoles(t,e)}))}else this.CreateRoles(t,e);ie.physicsDebug&&Laya.PhysicsDebugDraw.enable()}CreateRoles(t,e){Laya.Physics.I.box2d.DEBUG=!1,e-=100,this.isInWall=!0,this.isSlideFoot=!1,this.isInit=!1,this.isMouseDown=!1,this.isRoleDeath=!1,this.MinForce=1100,this.rightAway=!1,this.leftAway=!1,this.isjump=!1,this.SetAllObjectIsNull(),this.CreateRole(t,e),this.CreateRoleShow(t,e),this.ShowRod(),this.isInit=!0,this.isRoleDeath=!1,this.RoleX=this.role.x,GI.gMsgCet.on("Wm.part.curUseID.body",this,this.UpdateRoleSkin),GI.gMsgCet.on("Wm.part.curUseID.rod",this,this.UpdateRodSkin),GI.gMsgCet.on("Wm.part.curUseID.hat",this,this.UpdateRoleHatSkin),GI.gMsgCet.on("Wm.part.curUseID.jewelry",this,this.UpdateRoleJewelrySkin)}set leftAllowRotation(t){this.leftRigid.allowRotation=t}set rightAllowRotation(t){this.rightRigid.allowRotation=t}AddRoleSkinUrls(t){null!=$t.i.data.hatData.curUseData&&t.push({url:$t.i.data.hatData.curUseData.scRes,type:Laya.Loader.JSON}),null!=$t.i.data.jewelryData.curUseData&&t.push({url:$t.i.data.jewelryData.curUseData.scRes,type:Laya.Loader.JSON})}UpdateRoleHatSkin(){if(null!=$t.i.data.hatData.curUseData){let t=[{url:$t.i.data.hatData.curUseData.scRes,type:Laya.Loader.JSON}];GI.resMgr.load(t,Laya.Handler.create(this,t=>{null!=this.role&&this.CreateRoleGarnishHat()}))}else this.CreateRoleGarnishHat()}UpdateRoleJewelrySkin(){if(null!=$t.i.data.jewelryData.curUseData){let t=[{url:$t.i.data.jewelryData.curUseData.scRes,type:Laya.Loader.JSON}];GI.resMgr.load(t,Laya.Handler.create(this,t=>{null!=this.role&&this.CreateRoleGarnishJewelry()}))}else this.CreateRoleGarnishJewelry()}UpdateRoleSkin(){let t=[{url:$t.i.data.bodyData.curUseData.scRes,type:Laya.Loader.JSON}];this.AddRoleSkinUrls(t),GI.resMgr.load(t,Laya.Handler.create(this,t=>{this.rolePrefabData=GI.resMgr.getRes($t.i.data.bodyData.curUseData.scRes),null!=this.role&&this.CreateRoleShow(this.role.x,this.role.y)}))}UpdateRodSkin(){GI.resMgr.load([{url:$t.i.data.rodData.curUseData.scResBase,type:Laya.Loader.JSON}],Laya.Handler.create(this,t=>{this.ShowRod()}))}RemoveRole(){if(null!=this.role){if(this.isRemove=!0,this.roleRodCollCtrl.onDisable(),this.roleRodCollCtrl=null,this.roleShow.off(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision),this.roleFace.off(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision),this.isNewbie){let t=this.balloons.length;for(let e=0;e<t;++e){let t=this.balloons.pop();te.RemoveNodes(t)}}this.RemoveRodRuptureObject(this.rightRodRupture),this.RemoveRodRuptureObject(this.leftRodRupture),this.leftRodAnimPlay=!0,this.rightRodAnimPlay=!0,te.RemoveNodes(this.jcRodPoth),te.RemoveNodes(this.leftLeg),te.RemoveNodes(this.rightLeg),te.RemoveNodes(this.leftCenter),te.RemoveNodes(this.rightCenter),te.RemoveNodes(this.role),te.RemoveNodes(this.roleShow),te.RemoveNodes(this.roleFace),te.RemoveNodes(this.spinCenter),te.RemoveNodes(this.driveNode),GI.gMsgCet.off("Wm.part.curUseID.body",this,this.UpdateRoleSkin),GI.gMsgCet.off("Wm.part.curUseID.rod",this,this.UpdateRodSkin),GI.gMsgCet.off("Wm.part.curUseID.hat",this,this.UpdateRoleHatSkin),GI.gMsgCet.off("Wm.part.curUseID.jewelry",this,this.UpdateRoleJewelrySkin),this.SetAllObjectIsNull()}}SetAllObjectIsNull(){this.spinCenter=null,this.driveNode=null,this.startFoot=null,this.endFoot=null,this.role=null,this.roleShow=null,this.roleFace=null,this.leftLeg=null,this.rightLeg=null,this.roleRigid=null,this.leftRigid=null,this.rightRigid=null,this.roleBox=null,this.leftBox=null,this.rightBox=null,this.leftWeldJoint=null,this.rightWeldJoint=null,this.leftRvltJoint=null,this.rightRvltJoint=null,this.leftBindJoint=null,this.rigthBindJoint=null,this.leftBindBox=null,this.rightBindBox=null,this.leftMeshData=null,this.rightMeshData=null}OrganForce(t){this.removeWheelJoint(ut.None),this.leftBox.density=.05,this.rightBox.density=.05,this.roleBox.density=5;let e=t.x,i=t.y;this.rightAllowRotation=!1,this.leftAllowRotation=!1,this.roleRigid.applyForceToCenter({x:e,y:-i})}RoleVictory(){this.isMouseDown=!1,this.isRoleDeath=!0,this._leftArm.onRoleDie(),this._rightArm.onRoleDie(),this._leftLeg.onRoleDie(),this._rightLeg.onRoleDie(),this.setWinFace()}RoleDeath(){if(this.isRoleDeath)return;GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"),this.setFailFace(),this.RemoveRodTween(ut.LeftRod),this.RemoveRodTween(ut.RightRod),this.roleRodCollCtrl.CloseShowRod(),this.rightRvltJoint.enabled=!1,this.leftRvltJoint.enabled=!1,this.leftAllowRotation=!0,this.rightAllowRotation=!0,this.leftWeldJoint.destroy(),this.rightWeldJoint.destroy(),this.roleShow.getComponent(Laya.JointBase).destroy();let t=this.roleShow.getComponent(Laya.ColliderBase);t.density=10,t.friction=5e4;this.roleShow.getComponent(Laya.RigidBody);this.leftAway=!1,this.rightAway=!1,this.roleRigid.mask=1,this.leftRigid.gravityScale=1,this.rightRigid.gravityScale=1,this.leftBox.density=10,this.rightBox.density=10,this.roleBox.density=10,this.leftLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_EXIT),this.leftLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_ENTER),this.rightLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_EXIT),this.rightLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_ENTER),GI.timerMgr.clear(this,this.ReachMidStepPhiz),GI.timerMgr.clear(this,this.RodInPointTime),this.leftLeg.offAll(Laya.Event.TRIGGER_ENTER),this.rightLeg.offAll(Laya.Event.TRIGGER_ENTER),this.leftLeg.offAll(Laya.Event.TRIGGER_EXIT),this.rightLeg.offAll(Laya.Event.TRIGGER_EXIT),this.removeWheelJoint(ut.None),GI.soundMgr.playSound("res/sound/Hit.mp3"),this.isRoleDeath=!0,this._leftArm.onRoleDie(),this._rightArm.onRoleDie(),this._leftLeg.onRoleDie(),this._rightLeg.onRoleDie(),GI.gMsgCet.event("wmCtrl.ROLE_DEATH")}OnRoleCollision(t){null!=t&&t.label!=this.GameNode&&"0"!=t.label&&(this.AddRoldDeathEffects(t,this.roleShow.getComponent(Laya.ColliderBase)),this.RoleDeath())}get roleX(){return this.isRoleDeath?this.roleShow?this.roleShow.x:-1:this.role?this.role.x:-1}get roleY(){return this.isRoleDeath?this.roleShow?this.roleShow.y:-1:this.role?this.role.y:-1}get roleHeight(){return 76}getAngle(){let t=this.rightLeg.rotation,e=this.leftLeg.rotation;return t<0&&e<0||t>0&&e>0?Math.abs(t-e):Math.abs(t+e)}onTriggerExit(){this.onTriggerExitNUm++,Laya.timer.clear(this,this.onTriggerExit)}removeWheelJoint(t,e=!0){let i=!1;return t!=ut.RightRod&&t!=ut.None||(null!=this.rigthBindJoint&&(0==e&&(this.rightBindBox=this.rigthBindJoint.otherBody.owner.getComponent(Laya.ColliderBase)),this.rigthBindJoint.destroy(),this.rigthBindJoint=null,i=!0),e&&(this.rightBindBox=null)),t!=ut.LeftRod&&t!=ut.None||(null!=this.leftBindJoint&&(0==e&&(this.leftBindBox=this.leftBindJoint.otherBody.owner.getComponent(Laya.ColliderBase)),this.leftBindJoint.destroy(),this.leftBindJoint=null,i=!0),e&&(this.leftBindBox=null)),i}IsRemoveUpForce(){this.isNewbie&&0==this.IsRodSameSide()&&(this.isStartUpForce=!1)}GetRodColliderPoint(t){let e=t==ut.LeftRod?this.leftLeg:this.rightLeg;return this.LocalToGlobal(e,e.rotation>0?6:-6,200)}RodInCollider(t,e){if(null!=t.owner){let i=this.GetRodColliderPoint(e),s=t.owner;if(null!=s.getComponent(Laya.BoxCollider)){i=this.GlobalToLocal(s,i.x,i.y);let e=t,a=6,r=e.x-a,o=e.y-a,n=e.width+a,h=e.height+a;return i.x>=r&&i.x<=n&&i.y<=h&&i.y>=o}if(null!=s.getComponent(Laya.CircleCollider)){let e=t,a=(e.radius+3)*(e.radius+3);return(i=this.GlobalToLocal(s,i.x,i.y)).x*i.y<=a}return!0}return!1}AddLeftJoint(t,e=!1,i=!0,s=!0){if(null!=t&&null!=t.owner&&0==this.leftAway){if(null==this.leftBindJoint){if(0==this.RodInCollider(t,ut.LeftRod)){this.GetContactEdge(this.leftCfqRigid).length}this.leftBox.density=5;let e=new lt;e.otherBody=t.owner.getComponent(Laya.RigidBody),i&&(e.collideConnected=!0),e.anchor=[this.rodSize.x/2,this.rodSize.y],this.leftLeg.addComponentIntance(e),this.leftBindJoint=e,this.leftWeldJoint.enabled=!1,this.leftAllowRotation=!0}this.leftAllowRotation=!0,this.IsRemoveUpForce()}}AddRightJoint(t,e=!1,i=!0,s=!1){if(null!=t&&null!=t.owner&&0==this.rightAway){if(null==this.rigthBindJoint){if(0==this.RodInCollider(t,ut.RightRod)){this.GetContactEdge(this.rightCfqRigid).length}this.rightBox.density=5;let e=new lt;e.otherBody=t.owner.getComponent(Laya.RigidBody),i&&(e.collideConnected=!0),e.anchor=[this.rodSize.x/2,this.rodSize.y],this.rightLeg.addComponentIntance(e),this.rigthBindJoint=e,this.rightWeldJoint.enabled=!1,this.rightRigid.allowRotation=!0}this.rightAllowRotation=!0,this.IsRemoveUpForce()}}BindJoint(t=!0,e=!1){this.IsRodSameSide()?this.removeWheelJoint(ut.None):this.userLorR==ut.RightRod?(t&&this.IsInRodUP(ut.RightRod)&&this.AddRightJoint(this.rightBindBox,!0,!0,e),null!=this.leftBindBox&&this.IsInRodUP(ut.LeftRod)&&this.AddLeftJoint(this.leftBindBox,!1,!0,e)):(t&&this.IsInRodUP(ut.LeftRod)&&this.AddLeftJoint(this.leftBindBox,!0,!0,e),null!=this.rightBindBox&&this.IsInRodUP(ut.RightRod)&&this.AddRightJoint(this.rightBindBox,!1,!0,e))}onLeftRigidClick(t){t.isSensor||("2"==t.label?(this.leftBindBox=t,this.AddLeftJoint(t,!0,!0,!0),this.PlayRodAnim(ut.LeftRod)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClick))}onRightRigidClick(t){t.isSensor||("2"==t.label?(this.AddRightJoint(t,!0,!0,!0),this.PlayRodAnim(ut.RightRod),this.rightBindBox=t):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClick))}onRightRigidClickEnd(t){t.isSensor||this.userLorR==ut.LeftRod&&(this.isInWall=!1)}onRightRigidClickEnter(t){t.isSensor||(this.userLorR==ut.RightRod?(this.isjump?this.onRigidJumpBodyClick(t):this.onRigidBodyClick(t),this.rightCollideTime=Laya.timer.currFrame):this.isjump&&this.onRigidJumpFixedClick(t))}onLeftRigidClickEnd(t){t.isSensor||this.userLorR==ut.RightRod&&(this.isInWall=!1)}onLeftRigidClickEnter(t){t.isSensor||(this.userLorR==ut.LeftRod?(this.isjump?this.onRigidJumpBodyClick(t):this.onRigidBodyClick(t),this.leftCollideTime=Laya.timer.currFrame):this.isjump&&this.onRigidJumpFixedClick(t))}LocalToGlobal(t,e,i){let s=Laya.Point.create();return s.setTo(e,i),t.localToGlobal(s,!1,$t.i.mapCtrl.roleLayer)}GlobalToLocal(t,e,i){let s=Laya.Point.create();return s.setTo(e,i),t.globalToLocal(s,!1,$t.i.mapCtrl.roleLayer)}IsRodInGroundUp(t,e){if(null!=e&&null!=e.owner){let i=e.owner;if(null!=i){let s=this.LocalToGlobal(t,0,this.rodSize.y),a=e;return(s=null!=a?this.GlobalToLocal(i,s.x,s.y-a.y):this.GlobalToLocal(i,s.x,s.y)).x>=1&&s.y<1&&s.y,!0}}return!1}IsRodSameSide(){return this.leftLeg.rotation<=0&&this.rightLeg.rotation<=0||this.leftLeg.rotation>=0&&this.rightLeg.rotation>=0}IsRodOverspill(t){return t<this.minAngleData||t>this.maxAngleData}GetRodAllAngle(){return Math.abs(this.leftLeg.rotation)+Math.abs(this.rightLeg.rotation)}ClearForces(t){if(null==t)return;let e=t.body;e.m_force.SetZero(),e.m_invI=0,this.ClearTorque(t)}ClearTorque(t){if(null==t)return;let e=t.body;e.m_torque=0,e.m_angularVelocity=0,e.m_I=0}GetRigidPoints(t){let e=new Array;if(null!=t){let i=t.body.GetContactList();for(;null!=i;){let t=new Laya.Point;t.x=-1,t.y=-1;let s=i.contact.m_manifold;s.pointCount>0&&(t.x=50*s.points[0].localPoint.x,t.y=50*s.points[0].localPoint.y),e.push(t),i=i.next}}return e}GetRigidNormals(t){let e=new Array;if(null!=t){let i=t.body.GetContactList();for(;null!=i;){let t=Laya.Point.create();t.x=-1,t.y=-1;let s=i.contact.m_manifold;t.x=s.localNormal.x,t.y=s.localNormal.y,e.push(t),i=i.next}}return e}GetContactEdge(t){let e=new Array;if(null!=t){let i=t.body.GetContactList();for(;null!=i;)e.push(i),i=i.next}return e}IsFixtureAIsRod(t){return"Rod"==t.GetBody().GetUserData()}localNormalToWorld(t,e,i){let s=Laya.Point.create();return s.x=t*i.q.c-e*i.q.s,s.y=t*i.q.s+e*i.q.c,s}GetimpactPointByManifold(t,e){let i={x:-1,y:-1};if(null!=t){let s=this.GetContactEdge(t),a=this.GetContactEdge(e);if(a.length>0)for(let t=0;t<a.length;++t)s.push(a[t]);for(let t=0;t<s.length;++t){let a=s[t].contact;if(a.m_fixtureA.GetBody()==e.body||a.m_fixtureB.GetBody()==e.body){let r=new Laya.Physics.I.box2d.b2WorldManifold;s[t].contact.GetWorldManifold(r);let o=r.points[0].x>r.points[1].x?r.points[0]:r.points[1];if(0==o.x){let i=e.owner,r=s[t].contact.m_manifold.localPoint,o=!1;return o&&2==a.m_manifold.type||!o&&1==a.m_manifold.type?((r=this.localNormalToWorld(r.x,r.y,o?a.m_fixtureA.m_body.m_xf:a.m_fixtureB.m_body.m_xf)).x=(i.x+50*r.x)/50,r.y=(i.y+50*r.y)/50,r):(r=s[t].contact.m_manifold.points[0].localPoint,(r=this.localNormalToWorld(r.x,r.y,o?a.m_fixtureA.m_body.m_xf:a.m_fixtureB.m_body.m_xf)).x=(i.x+50*r.x)/50,r.y=(i.y+50*r.y)/50,r)}i.x<o.x&&(i.x=o.x,i.y=o.y)}}}return i}GetImpactPoint(t,e){let i=this.GetimpactPointByManifold(t,e);return i.x>0?(i.x=50*i.x,i.y=50*i.y,i):{x:-1,y:-1}}IsInRodUP(t){let e=null,i=null;t==ut.LeftRod?(i=this.leftRigid,e=this.leftCfqRigid):(i=this.rightRigid,e=this.rightCfqRigid);let s=this.GetContactEdge(i);if(s.length>0)for(let t=0;t<s.length;++t){let e=s[t].contact,i=this.IsFixtureAIsRod(e.m_fixtureA),a=e.m_manifold;if(1==a.type&&i||2==a.type&&0==i){a.localPoint.x;if(50*a.localPoint.y>=.98*this.rodSize.y){this.localNormalToWorld(a.localNormal.x,a.localNormal.y,i?e.m_fixtureA.m_body.m_xf:e.m_fixtureB.m_body.m_xf);if(-a.localNormal.y<0)return!0}}else if(a.pointCount>0){a.points[0].localPoint.x;if(50*a.points[0].localPoint.y>=.98*this.rodSize.y){if(this.localNormalToWorld(a.localNormal.x,a.localNormal.y,i?e.m_fixtureB.m_body.m_xf:e.m_fixtureA.m_body.m_xf).y<0)return!0}}}return!1}AddRodFriction(t){let e=this.GetContactEdge(t);if(null!=e&&e.length>0)for(let t=0;t<e.length;++t){let i=e[t];null!=i&&null!=i.contact&&i.contact.SetFriction(5e5)}}onRigidJumpBodyClick(t){this.userLorR==ut.LeftRod?(this.leftBindBox=t,this.AddRodFriction(this.leftRigid),this.IsInRodUP(ut.LeftRod)?(this.AddRodFriction(this.leftRigid),this.AddLeftJoint(t,!1,!0,!0),this.PlayRodAnim(ut.LeftRod),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.IsInCollider(ut.RightRod)?(this.BindJoint(!0,!0),this.PlayRodAnim(ut.LeftRod),this.PlayRodAnim(ut.RightRod)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter)):(this.rightBindBox=t,this.AddRodFriction(this.rightRigid),this.IsInRodUP(ut.RightRod)?(this.AddRightJoint(t,!1,!0,!0),this.PlayRodAnim(ut.RightRod),this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter)):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter),this.IsInCollider(ut.LeftRod)?(this.BindJoint(!0,!0),this.PlayRodAnim(ut.LeftRod),this.PlayRodAnim(ut.RightRod)):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))}onRigidJumpFixedClick(t){this.userLorR==ut.LeftRod?(this.rightBindBox=t,this.IsInRodUP(ut.RightRod)?(this.isjump=!1,this.AddRightJoint(t,!1,!0,!0),this.PlayRodAnim(ut.RightRod)):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter)):(this.leftBindBox=t,this.IsInRodUP(ut.LeftRod)?(this.isjump=!1,this.AddLeftJoint(t,!1,!0,!0),this.PlayRodAnim(ut.LeftRod)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter))}AddRoldDeathEffects(t,e){if(!this.isRoleDeath&&null!=t&&null!=t.rigidBody){let i=t.rigidBody,s=this.GetImpactPoint(i,e.rigidBody);s.x>=0&&ct.StartAnim(s)}}onRigidBodyClick(t){if(null!=t){if(t.label==this.AllDeath||t.label==this.Hurt)return this.AddRoldDeathEffects(t,this.userLorR==ut.LeftRod?this.leftBox:this.rightBox),void this.RoleDeath();if(t.label==this.GameNode&&0==this.isPlayGameNodeSound&&(this.isPlayGameNodeSound=!0),this.IsInRodUP(this.userLorR)){if(this.PlayRodAnim(this.userLorR),(this.userLorR==ut.RightRod&&this.rightBindBox==t||this.userLorR==ut.LeftRod&&this.leftBindBox==t)&&(this.isPlayGameNodeSound=!0),"2"!=t.label&&"3"!=t.label&&"1"!=t.label||(0==this.isPlayGameNodeSound&&GI.soundMgr.playSound("res/sound/Walk.mp3"),this.isPlayGameNodeSound=!1),this.isInWall=!0,this.userLorR==ut.RightRod?this.rightBindBox=t:this.leftBindBox=t,0==this.isMouseDown){this.startFoot=null,this.endFoot=null,this.BindJoint(!0,!0),this.GetUserRodLOrR()==ut.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.isNewbie&&0==this.isDangling&&4==$t.i.data.guideStep&&this.firstRun&&this.SetRoleTutorial(5)}else this.PlayRodAnim(this.userLorR),this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter);this.leftBox.density=(this.userLorR,ut.LeftRod,5),this.rightBox.density=(this.userLorR,ut.RightRod,5),this.roleBox.density=5,Laya.timer.frameOnce(10,this,this.onTriggerExit,[])}else null!=this.startFoot&&(this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))}else null!=this.startFoot&&(this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))}SetRodData(){this.userLorR==ut.LeftRod?(this.startFoot=this.leftLeg,this.endFoot=this.rightLeg):this.userLorR==ut.RightRod&&(this.startFoot=this.rightLeg,this.endFoot=this.leftLeg)}SetRodRotate(){this.roleRodCollCtrl.ShowUpdateAnim(this.userLorR,!1)}GetUserRodLOrR(){return this.isDangling?ut.LeftRod:this.rightLeg.rotation<this.leftLeg.rotation?ut.LeftRod:ut.RightRod}GetRoleAllMass(){return this.roleRigid.body.GetMass()+this.rightRigid.body.GetMass()+this.leftRigid.body.GetMass()}OnRunJiaoCheng(){this.isNewbie&&0==this.isDangling&&4==$t.i.data.guideStep&&(this.firstRun=!0)}OnRun(){this.mousex=Laya.stage.mouseX,null!=this.leftBindJoint&&null!=this.rigthBindJoint?this.isInWall=!0:this.IsInRodUP(ut.LeftRod)&&this.IsInRodUP(ut.RightRod)?this.isInWall=!0:this.isInWall=!1,this.roleRigid.linearDamping=0,this.OnRunJiaoCheng(),this.onTriggerExit(),this.userLorR=this.GetUserRodLOrR(),this.leftAngle=this.leftLeg.rotation,this.rightAngle=this.rightLeg.rotation;let t=this.GetRoleAllMass();if(0==this.isInWall){if(this.SetRodData(),(this.userLorR==ut.LeftRod?null!=this.leftBindJoint:null!=this.rigthBindJoint)||this.IsInRodUP(this.userLorR)){this.removeWheelJoint(ut.None),this.ShowWinFacePhiz(),this.leftBox.density=.5,this.rightBox.density=.5,this.roleBox.density=3,t=this.GetRoleAllMass();let e=75,i=370;Math.trunc(this.startFoot.rotation/10);this.startFoot.rotation<0&&(e=-75),this.roleRigid.body.m_linearVelocity.y=0,this.leftRigid.body.m_linearVelocity.y=0,this.rightRigid.body.m_linearVelocity.y=0;let s=this.roleRigid.body.m_linearVelocity;(s.x>6&&e>0||s.x<-5&&e<0)&&(e=0),this.isjump=!0,this.userLorR==ut.LeftRod?this.leftRodAnimPlay=!0:this.rightRodAnimPlay=!0,this.PlayRodAnim(this.userLorR),this.roleRigid.applyForceToCenter({x:e*t,y:-i*t}),this.leftRodAnimPlay=!0,this.rightRodAnimPlay=!0}this.isInWall=!1,this.SetRodRotate(),this.PackUpRodAnim()}else this.SetRodData(),this.SetRodRotate(),this.PackUpRodAnim();if(this.isInWall){let t=0,e=.0174532924*(t=this.endFoot.rotation<this.startFoot.rotation?Math.abs(this.endFoot.rotation):Math.abs(this.startFoot.rotation)),i=t/10*this.RoleForce;i<3*this.RoleForce&&(i=3*this.RoleForce);let s=i*Math.sin(e),a=i*Math.cos(e);this.removeWheelJoint(ut.None,!1),this.BindJoint(!0,!1),this.removeWheelJoint(this.userLorR),this.userLorR==ut.RightRod?null!=this.leftBindJoint&&(this.leftAllowRotation=!0):null!=this.rigthBindJoint&&(this.rightAllowRotation=!0),this.leftBox.density=this.userLorR==ut.LeftRod?.5:5,this.rightBox.density=this.userLorR==ut.RightRod?.5:5,this.roleBox.density=5;let r=this.MinForce;a<s?(s=s<r?r:s,a=a<r?r:a,this.roleRigid.applyForceToCenter({x:s,y:-a})):(a=a<r?r:a,s=s<r?r:s,this.roleRigid.applyForceToCenter({x:a,y:-s})),this.MinForce=1100}this.userLorR==ut.LeftRod?this.leftBindBox=null:this.rightBindBox=null,this.userLorR==ut.LeftRod?this.leftRodAnimPlay=!0:this.rightRodAnimPlay=!0;this.GetUserRodLOrR();this.userLorR==ut.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.isInWall=!1}RemoveQiQiu(t,e){this.balloons[t].getComponent(Laya.RevoluteJoint).destroy(),this.isDangling=!1,this.leftRigid.angularDamping=e,this.rightRigid.angularDamping=e}SetRoleTutorial(t){switch(t){case 1:break;case 2:this.CreateRodPoint(90,90);break;case 3:this.isInRodQuan=!1,this.CreateRodPoint(-15,120);break;case 4:this.isInRodQuan=!1,this.isMouseDown=!1,this.leftLeg.rotation=20,this.GetUserRodLOrR()==ut.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.RodFloorAnim(this.pivotLorR[1]/50),null!=this.jcRodPoth&&(this.jcRodPoth.offAll(Laya.Event.TRIGGER_ENTER),te.RemoveNodes(this.jcRodPoth),this.jcRodPoth=null),this.role.getComponent(Laya.RevoluteJoint).destroy(),this.RemoveQiQiu(3,13),this.isDangling=!1,this.balloonNum=2;break;case 6:this.RemoveQiQiu(2,8),this.balloonNum=1;break;case 7:this.RemoveQiQiu(1,0),this.balloonNum=0}$t.i.data.guideStep=t}RodInPointTime(){this.SetRoleTutorial($t.i.data.guideStep+1),GI.timerMgr.clear(this,this.RodInPointTime)}CreateRodPoint(t,e){if(null==this.jcRodPoth){let t=new Laya.Sprite;$t.i.mapCtrl.roleLayer.addChild(t),t.width=50,t.height=50,t.pivot(25,25);let e=t.addComponent(Laya.CircleCollider);e.radius=25,e.isSensor=!0,e.refresh();let i=t.addComponent(Laya.RigidBody);i.type="static",i.allowSleep=!1,i.category=4,i.mask=4,this.jcRodPoth=t,t.on(Laya.Event.TRIGGER_ENTER,this,()=>{0==this.isInRodQuan&&$t.i.data.guideStep<4&&(GI.timerMgr.once(600,this,this.RodInPointTime),GI.gMsgCet.event("wmCtrl.RodInPointStart")),this.isInRodQuan=!0}),t.on(Laya.Event.TRIGGER_EXIT,this,()=>{this.GetContactEdge(this.jcRodPoth.getComponent(Laya.RigidBody)).length>1||(this.isInRodQuan=!1,GI.timerMgr.clear(this,this.RodInPointTime),GI.gMsgCet.event("wmCtrl.RodInPointOut"))})}this.LocalToGlobal(this.role,t,e);this.jcRodPoth.x=this.role.x+t,this.jcRodPoth.y=this.role.y+e}RodRunPoint(){let t=Laya.Point.create();return null==this.jcRodPoth?t:(t.x=this.jcRodPoth.x,t.y=this.jcRodPoth.y,t)}onMouseDown11(t){this.isMouseDown=!0,0==this.isRoleDeath&&(this.OnRun(),this.isFollowRole=!1)}onMouseUpJC(){if(this.isNewbie&&(this.isDangling&&$t.i.data.guideStep<=1&&this.SetRoleTutorial(2),7==$t.i.data.guideStep)){$t.i.mapCtrl.getLastStepPos().x-this.role.x<600&&this.SetRoleTutorial(8)}}onMouseUp11(t){if(this.onMouseUpJC(),0==this.isRoleDeath&&null!=this.leftLeg&&this.isMouseDown){if(this.isMouseDown=!1,this.IsInRodUP(ut.LeftRod)&&this.IsInRodUP(ut.RightRod))this.leftBox.density=3.5,this.rightBox.density=3.5,this.isjump=!1,this.BindJoint(!0,!0),this.isFollowRole=!0,this.followRole.x=this.role.x,this.followRole.y=this.role.y,this.leftAllowRotation=!0,this.rightAllowRotation=!0,this.isNewbie&&0==this.isDangling&&4==$t.i.data.guideStep&&this.firstRun&&this.SetRoleTutorial(5);else if(this.isjump)if(this.roleBox.density=10,this.userLorR==ut.RightRod){this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter);this.GetUserRodLOrR();this.leftBox.density=3.5,this.rightAllowRotation=!0,this.rightBox.density=3.5,this.IsInCollider(ut.RightRod)&&this.IsInRodUP(ut.RightRod)&&null!=this.rightBindBox?(this.AddRightJoint(this.rightBindBox,!1,!0,!1),this.userLorR=ut.LeftRod):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter)}else this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter),0==this.rightAway&&(this.leftBox.density=3.5,this.rightBox.density=3.5),this.leftBox.density=3.5,this.rightBox.density=3.5,this.leftAllowRotation=!0,this.IsInCollider(ut.LeftRod)&&this.IsInRodUP(ut.LeftRod)&&null!=this.leftBindBox?this.AddLeftJoint(this.leftBindBox,!1,!0,!1):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter);else this.userLorR==ut.RightRod?(this.leftBox.density=3.5,this.IsInRodUP(ut.RightRod)||0==this.rightAway&&null!=this.rightBindBox?(this.AddRightJoint(this.rightBindBox,!1,!0,!1),this.rightBox.density=3.5,this.rightAllowRotation=!0):(this.rightBox.density=3.5,this.rightAllowRotation=!1)):(this.rightBox.density=3.5,this.IsInRodUP(ut.LeftRod)||0==this.leftAway&&null!=this.leftBindBox?(this.AddRightJoint(this.leftBindBox,!1,!0,!1),this.leftBox.density=3.5,this.leftAllowRotation=!0):(this.leftBox.density=3.5,this.leftAllowRotation=!1)),this.roleBox.density=5;this.GetUserRodLOrR()==ut.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.RodFloorAnim(this.pivotLorR[1]/50)}}GetRodAngleInRange(t){return t>this.maxAngleData?t=this.maxAngleData:t<this.minAngleData&&(t=this.minAngleData),t}MouseRigodBodySpin(t){t<=-this.mouseMaxNum?t=-this.mouseMaxNum:t>=this.mouseMaxNum&&(t=this.mouseMaxNum);let e=-this.AngularVelocity*t,i=this.userLorR==ut.LeftRod?this.leftRigid:this.rightRigid,s=this.userLorR==ut.LeftRod?this.leftLeg.rotation:this.rightLeg.rotation,a=0,r=this.userLorR==ut.LeftRod?this.leftBox:this.rightBox;if(this.userLorR==ut.LeftRod?(this.leftAngle+=e,this.leftAngle=this.GetRodAngleInRange(this.leftAngle),a=this.leftLeg.rotation-this.leftAngle,this.leftWeldJoint.enabled=!1):(this.rightAngle+=e,this.rightAngle=this.GetRodAngleInRange(this.rightAngle),a=this.rightLeg.rotation-this.leftAngle,this.rightWeldJoint.enabled=!1),(s<=this.minAngleData&&e<0||s>=this.maxAngleData&&e>0)&&(e=0),0==e)0==this.IsDetectRod&&this.ClearForces(i);else{r.density,r.density=.5;let a=e+s;a>this.maxAngleData?e=this.maxAngleData-s:a<this.minAngleData&&(e=this.minAngleData-s),i.body.SetAngularVelocity(e),Math.abs(t)>10&&(this.userLorR==ut.LeftRod?null!=this.leftTween&&(this.RemoveRodTween(this.userLorR),this.leftRvltJoint.joint.m_localAnchorB.y=this.runPivotLorR[1]/50):this.userLorR==ut.RightRod&&null!=this.RightTween&&(this.RemoveRodTween(this.userLorR),this.rightRvltJoint.joint.m_localAnchorB.y=this.runPivotLorR[1]/50))}}OnClearTorque(){if(this.isMouseDown){this.addX,this.role.x,this.RoleX;this.RoleX=this.role.x;let t=Laya.stage.mouseX-this.mousex;this.mousex=Laya.stage.mouseX,this.MouseRigodBodySpin(t)}}Removess(t){let e=t.body;e.m_angularVelocity>0?(e.m_angularVelocity-=.05,e.m_angularVelocity<0&&(e.m_angularVelocity=0)):e.m_angularVelocity<0&&(e.m_angularVelocity+=.05,e.m_angularVelocity>0&&(e.m_angularVelocity=0))}RoleBuoyancy(t){0==t&&(this.isStartUpForce=!0),this.isNewbie&&(this.balloons.length>0&&(this.balloons[0].x=this.role.x,this.balloons[0].y=this.role.y),this.isStartUpForce&&(this.leftLeg.rotation,this.OnSetRoleBuoyancy(),null!=this.leftBindJoint&&null!=this.rigthBindJoint&&(this.isStartUpForce=!1)))}OnSetRoleBuoyancy(){if(null!=this.role&&this.role.y>this.flY&&this.balloonNum>=1&&$t.i.data.guideStep<8){this.leftBox.density=5,this.rightBox.density=5;let t=this.role.y-this.flY,e=(t=t>this.buoyancyNum?this.buoyancyNum:t)/this.buoyancyNum*this.buoyancy;this.roleRigid.applyForceToCenter({x:0,y:-e})}}RodInAiryAngle(t){t==ut.RightRod?null==this.rightBindBox&&0==this.GetContactEdge(this.rightRigid).length&&this.ClearTorque(this.rightRigid):t==ut.LeftRod&&null==this.leftBindJoint&&0==this.GetContactEdge(this.leftRigid).length&&this.ClearTorque(this.leftRigid)}UpdateRodInAiry(t){this.isMouseDown?this.userLorR==ut.LeftRod?this.RodInAiryAngle(ut.RightRod):this.userLorR==ut.RightRod&&this.RodInAiryAngle(ut.LeftRod):0==t&&0==this.IsRodSameSide()&&(this.RodInAiryAngle(ut.RightRod),this.RodInAiryAngle(ut.LeftRod)),null!=this.leftBindJoint&&null!=this.rigthBindJoint||!this.IsRoleMaxAngle()||0!=t?(this.leftWeldJoint.enabled=!1,this.rightWeldJoint.enabled=!1):(null==this.rigthBindJoint&&(this.rightWeldJoint.enabled=!0),null==this.leftBindJoint&&(this.leftWeldJoint.enabled=!0))}onUpdate(){if(null!=this.role&&(null!=this.roleShow&&(this.roleShow.rotation=(this.leftLeg.rotation+this.rightLeg.rotation)/2),this._leftArm.onUpdate(),this._rightArm.onUpdate(),this._leftLeg.onUpdate(),this._rightLeg.onUpdate()),this.isRoleDeath||null==this.role)return;this.AddRodFriction(this.leftRigid),this.AddRodFriction(this.rightRigid);let t=this.DetectRodUntie();this.RoleBuoyancy(t),this.UpdateRodInAiry(this.IsDetectRod),this.OnClearTorque(),$t.i.mapCtrl.moveVisionBg(-(this.role.x-this.cameraX)),ie.physicsDebug&&null!=Laya.PhysicsDebugDraw.I&&(Laya.PhysicsDebugDraw.I.x=GI.sceneMgr.worldRoot.x,Laya.PhysicsDebugDraw.I.y=GI.sceneMgr.worldRoot.y),null!=this.rigthBindJoint&&null!=this.leftBindJoint||0!=this.isMouseDown||(this.userLorR==ut.LeftRod?0==this.IsInCollider(ut.LeftRod)&&0==this.IsInCollider(ut.RightRod)&&this.ClearTorque(this.leftRigid):0==this.IsInCollider(ut.RightRod)&&0==this.IsInCollider(ut.LeftRod)&&this.ClearTorque(this.rightRigid)),null!=this.rigthBindJoint&&null!=this.leftBindJoint&&(this.ClearTorque(this.leftRigid),this.ClearTorque(this.rightRigid)),this.IsDetectRod&&(this.leftRigid.allowRotation=!0,this.rightRigid.allowRotation=!0)}IsRoleFallDown(){return this.IsRodSameSide()&&this.IsInCollider(ut.LeftRod)&&this.IsInCollider(ut.RightRod)}IsRoleMaxAngle(){return Math.abs(this.leftLeg.rotation)+Math.abs(this.rightLeg.rotation)>2*this.maxAngleData}IsUntieRod(t){return t>=89||t<=-89}DetectRodUntie(){if(null==this.leftLeg)return!1;if(0==this.isNewbie&&this.IsDetectRod&&this.IsRodSameSide()){let t=this.leftLeg.rotation;if((t=t<0?this.rightLeg.rotation>t?this.rightLeg.rotation:t:this.rightLeg.rotation<t?this.rightLeg.rotation:t)>0&&t>=45||t<0&&t<=-45){let t={x:this.role.x-70,y:this.role.y-40};return this.leftLeg.rotation<0&&(t.x=this.role.x+70),ct.StartAnim(t),this.RoleDeath(),!0}}if(this.IsUntieRod(this.leftLeg.rotation)&&this.removeWheelJoint(ut.LeftRod),this.IsUntieRod(this.rightLeg.rotation)&&this.removeWheelJoint(ut.RightRod),this.IsRoleFallDown())return GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_Start"),this.removeWheelJoint(ut.None),this.rightAllowRotation=!0,this.leftAllowRotation=!0,null!=this.role&&0==this.isNewbie&&(this.roleBox.density=5,this.leftBox.density=5,this.rightBox.density=5),this.IsDetectRod=!0,!1;if(0==this.IsRodSameSide()){let t=this.GetRodAllAngle();if(t>2*this.maxAngleData+15&&this.IsInCollider(ut.LeftRod)&&this.IsInCollider(ut.RightRod)){if(t<2*this.maxAngleData+30)GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_Start"),this.IsDetectRod=!0;else{let t={x:this.role.x-70,y:this.role.y-40};ct.StartAnim(t),this.RoleDeath()}return!1}this.IsDetectRod&&0==this.IsRodSameSide()&&(this.IsDetectRod=!1,GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"))}else this.IsDetectRod&&0==this.IsRodSameSide()&&(this.IsDetectRod=!1,GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"));return!0}DetectRodSpinUntieJoint(){let t=this.GetSupportRigid();null!=t&&this.IsCollisionManyWall(t)&&this.removeWheelJoint(this.GetSupportRoleRodType())}DetectionRodAngle(){if(0==this.isMouseDown){let t=Math.abs(this.leftLeg.rotation)+Math.abs(this.rightLeg.rotation);if(2*this.MaxAngle+15<t){let t={x:this.role.x-70,y:this.role.y-40};ct.StartAnim(t),this.RoleDeath()}}}IsInCollider(t){let e,i,s=!1;if(t==ut.LeftRod?(e=this.leftRigid,i=this.leftBindJoint,s=0==this.leftAway&&Laya.timer.currFrame-this.leftCollideTime<3):(e=this.rightRigid,i=this.rigthBindJoint,s=0==this.rightAway&&Laya.timer.currFrame-this.rightCollideTime<3),s)return!0;if(null!=i)return!0;let a=this.GetContactEdge(e);if(null!=a)for(let t=0;t<a.length;++t)if(null!=a[t]&&a[t].contact.m_manifold.pointCount>0)return!0;return!1}IsCollisionManyWall(t){let e=t.body.GetContactList();return null!=e&&null!=e.next}IsOperateRodBindWall(){return this.userLorR==ut.LeftRod?null!=this.leftBindJoint&&this.leftBindJoint.enabled:this.userLorR==ut.RightRod&&(null!=this.rigthBindJoint&&this.rigthBindJoint.enabled)}IsSupportRodBindWall(){return this.userLorR==ut.RightRod?null!=this.leftBindJoint&&this.leftBindJoint.enabled:this.userLorR==ut.LeftRod&&(null!=this.rigthBindJoint&&this.rigthBindJoint.enabled)}GetOperateSprite(){return this.userLorR==ut.LeftRod?this.leftLeg:this.userLorR==ut.RightRod?this.rightLeg:null}GetSupportSprite(){return this.userLorR==ut.LeftRod?this.rightLeg:this.userLorR==ut.RightRod?this.leftLeg:null}GetOperateRigid(){return this.userLorR==ut.LeftRod?this.leftRigid:this.userLorR==ut.RightRod?this.rightRigid:null}GetSupportRigid(){return this.userLorR==ut.LeftRod?this.rightRigid:this.userLorR==ut.RightRod?this.leftRigid:null}GetSupportRoleRodType(){return this.userLorR==ut.LeftRod?ut.RightRod:this.userLorR==ut.RightRod?ut.LeftRod:ut.None}LeftPackRodRunAnimEnd(){null!=this.leftTween&&(this.leftTween=null)}RightPackRodRunAnimEnd(){null!=this.RightTween&&(this.RightTween=null)}PackUpRodAnim(){this.RodFloorAnim(this.runPivotLorR[1]/50),this.leftLeg.off(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.off(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter),GI.timerMgr.once(50,this,()=>{null!=this.leftLeg&&(this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))})}RemoveRodTween(t){t==ut.LeftRod?null!=this.leftTween&&(this.leftTween.clear(),this.leftTween.recover(),this.leftTween=null):t==ut.RightRod&&null!=this.RightTween&&(this.RightTween.clear(),this.RightTween.recover(),this.RightTween=null)}RodFloorAnim(t){let e;this.userLorR==ut.LeftRod?(e=this.leftRvltJoint.joint,this.leftWeldJoint.enabled=!1,this.ClearTorque(this.leftRigid),this.RemoveRodTween(this.userLorR),this.leftTween=GI.Tween.to(e.m_localAnchorB,{y:t},this.rodTweenTime,null,Laya.Handler.create(this,this.LeftPackRodRunAnimEnd),0,!1,!1)):this.userLorR==ut.RightRod&&(e=this.rightRvltJoint.joint,this.rightWeldJoint.enabled=!1,this.ClearTorque(this.rightRigid),this.RemoveRodTween(this.userLorR),this.RightTween=GI.Tween.to(e.m_localAnchorB,{y:t},this.rodTweenTime,null,Laya.Handler.create(this,this.RightPackRodRunAnimEnd),0,!1,!1))}onRoleDeathDetect(t,e){if("Hurt"==t.label||"HurtRodRupture"==t.label){{let t=e==ut.LeftRod?this.leftLeg:this.rightLeg,i=t.getChildByName("rod");if(i.numChildren>0){let t=i.removeChildAt(0);t&&t.destroy()}let s=e==ut.LeftRod?this.leftRodRupture:this.rightRodRupture;t.addChild(s[0]),s[0].x=6,s[0].y=20;let a=e==ut.LeftRod?this.leftBox:this.rightBox;a.width=s[0].width,a.height=s[0].height;let r={x:6,y:150},o=ct.StartAnim(r,.7);t.addChild(o.sprite),o.sprite.x=6,o.sprite.y=150,r=this.LocalToGlobal(t,6,150),s[1].addComponent(Laya.RigidBody),$t.i.mapCtrl.roleLayer.addChild(s[1]),s[1].x=r.x,s[1].y=r.y;let n=s[1].addComponent(Laya.BoxCollider);n.width=s[1].width,n.height=s[1].height,n.density=a.density}this.RoleDeath()}}PlayRodAnim(t){this.isRoleDeath||(t==ut.LeftRod?this.leftRodAnimPlay&&(this.leftRodAnimPlay=!1,this.leftAnim.play(0,!1)):this.rightRodAnimPlay&&(this.rightRodAnimPlay=!1,this.rightAnim.play(0,!1)))}CreateRole(t=230,e=600){this.CreateRoleSprites(t,e),this.followRole.x=t,this.followRole.y=e,this.roleRodCollCtrl=new ht,this.roleRodCollCtrl.onEnable(this),this.roleRodCollCtrl.isLeftRodShow=!0,this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClick),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClick),this.leftLeg.on(Laya.Event.TRIGGER_ENTER,this,t=>{if(this.onRoleDeathDetect(t,ut.LeftRod),!t.isSensor){if(this.userLorR==ut.LeftRod&&Laya.timer.currFrame-this.leftCollideTime>2&&(this.leftCollideTime=Laya.timer.currFrame),this.leftAway){this.GetContactEdge(this.leftCfqRigid).length>0&&(this.leftAway=!1)}this.IsInRodUP(ut.LeftRod)&&0==this.isjump&&0==this.IsRodSameSide()&&0==this.isMouseDown&&this.AddLeftJoint(t,!1,!0,!0),this.userLorR!=ut.LeftRod&&(this.leftRigid.allowRotation=!0),null!=t.rigidBody&&"HammerItem"==t.rigidBody.label&&this.removeWheelJoint(ut.None)}}),this.rightLeg.on(Laya.Event.TRIGGER_ENTER,this,t=>{if(this.onRoleDeathDetect(t,ut.RightRod),!t.isSensor){if(this.userLorR==ut.RightRod&&Laya.timer.currFrame-this.rightCollideTime>2&&(this.rightCollideTime=Laya.timer.currFrame),this.rightAway){this.GetContactEdge(this.rightCfqRigid).length>0&&(this.rightAway=!1)}this.IsInRodUP(ut.RightRod)&&0==this.isjump&&0==this.IsRodSameSide()&&0==this.isMouseDown&&this.AddRightJoint(t,!1,!0,!0),this.userLorR!=ut.RightRod&&(this.rightRigid.allowRotation=!0),null!=t.rigidBody&&"HammerItem"==t.rigidBody.label&&this.removeWheelJoint(ut.None)}}),this.leftLeg.on(Laya.Event.TRIGGER_EXIT,this,t=>{t.isSensor||(this.userLorR==ut.LeftRod?this.leftCollideTime=Laya.timer.currFrame:this.GetContactEdge(this.leftCfqRigid).length<=0&&null==this.leftBindJoint&&(this.leftRigid.allowRotation=!1))}),this.rightLeg.on(Laya.Event.TRIGGER_EXIT,this,t=>{t.isSensor||(this.userLorR==ut.RightRod?this.rightCollideTime=Laya.timer.currFrame:this.GetContactEdge(this.rightCfqRigid).length<=0&&null==this.rigthBindJoint&&(this.rightRigid.allowRotation=!1))})}RemoveRodRuptureObject(t){if(t.length>0)for(let e=0;e<t.length;++e)te.RemoveNodes(t[e])}GetrodRuptureObjs(t,e){let i="",s=[];e==ut.RightRod?(this.RemoveRodRuptureObject(this.rightRodRupture),this.rightRodRupture=[],i="right"):(this.RemoveRodRuptureObject(this.leftRodRupture),this.leftRodRupture=[],i="left");for(let e=1;e<3;++e){let a=t.getChildByName(i+e);$t.i.mapCtrl.roleLayer.addChild(a),a.x=-1e3,a.y=-1e3,s.push(a)}e==ut.RightRod?this.rightRodRupture=s:this.leftRodRupture=s}GetRodAnim(t){for(;t.numChildren>0;)if("anim"==(t=t.getChildAt(0)).name)return t;return null}StopRodAnim(t){t==ut.LeftRod?null!=this.leftAnim.player?this.leftAnim.player.stop():GI.timerMgr.once(5,this,t=>{this.StopRodAnim(t)},[ut.LeftRod]):null!=this.rightAnim.player?this.rightAnim.player.stop():GI.timerMgr.once(5,this,t=>{this.StopRodAnim(t)},[ut.RightRod])}ShowRod(){if(null==this.leftLeg||this.isRoleDeath)return;let t=new Laya.Prefab;t.json=GI.resMgr.getRes($t.i.data.rodData.curUseData.scResBase);let e=t.create(),i=this.leftLeg.getChildByName("rod"),s=i.getChildByName("left");null!=s&&(i.removeChildAt(0),s.destroy());let a=e.getChildByName("left"),r=a.y;i.addChild(a),a.x=a.pivotX,a.y=r;let o=this.rightLeg.getChildByName("rod"),n=e.getChildByName("right"),h=n.y,l=o.getChildByName("right");null!=l&&(o.removeChildAt(0),l.destroy()),o.addChild(n),n.x=n.pivotX,n.y=h,this.leftAnim=this.GetRodAnim(a);let d=$t.i.data.rodData.curUseData.id;this.rodUrl;this.leftAnim.load("res/rod/rod"+d+"/rod"+d+"_left.sk",Laya.Handler.create(this,this.StopRodAnim,[ut.LeftRod])),this.rightAnim=this.GetRodAnim(n),this.rightAnim.load("res/rod/rod"+d+"/rod"+d+"_right.sk",Laya.Handler.create(this,this.StopRodAnim,[ut.RightRod])),this.GetrodRuptureObjs(e,ut.LeftRod),this.GetrodRuptureObjs(e,ut.RightRod)}createRoleGarnish(t){if(!t)return;let e=this.roleShow.getChildByName(t.data.bindPtName);if(e.numChildren>0){let t=e.removeChildAt(0);t&&t.destroy()}if(null!=t.curUseData){GI.util.bindPros(e,t.data.scPtPros);let i=new Laya.Prefab;i.json=GI.resMgr.getRes(t.curUseData.scRes);let s=e.addChild(i.create());t.curUseData.showPros&&t.curUseData.showPros[$t.i.data.bodyData.curUseID]&&GI.util.bindPros(s,t.curUseData.showPros[$t.i.data.bodyData.curUseID].sc)}}CreateRoleGarnishHat(){this.createRoleGarnish($t.i.data.hatData)}CreateRoleGarnishJewelry(){this.createRoleGarnish($t.i.data.jewelryData)}CreateRoleShow(t=230,e=600){null!=this.roleShow&&te.RemoveNodes(this.roleShow);let i=new Laya.Prefab;i.json=this.rolePrefabData,this.roleShow=i.create();let s=this.roleShow.getComponent(Laya.ColliderBase);s.density=.05,s.friction=1;let a=this.roleShow.getComponent(Laya.RigidBody);a.category=16,a.mask=1,a.linearDamping=.5,$t.i.mapCtrl.roleLayer.addChildAt(this.roleShow,this.LeftRodLayer),this.roleShow.pos(t,e),this.roleFace=this.roleShow.getChildByName("Face"),this.CreateRoleGarnishHat(),this.CreateRoleGarnishJewelry(),this._leftArm.initRole(this.roleShow.getChildByName("leftArm"),this.leftLeg),this._rightArm.initRole(this.roleShow.getChildByName("rightArm"),this.rightLeg),this._leftLeg.initRole(this.roleShow.getChildByName("leftLeg"),this.leftLeg),this._rightLeg.initRole(this.roleShow.getChildByName("rightLeg"),this.rightLeg),this.AddRoleShowJoint()}AddRoleShowJoint(){let t=this.roleShow.getComponent(Laya.RigidBody);t.gravityScale=1,t.allowRotation=!1;let e=this.roleShow.getComponent(Laya.ColliderBase);e.density=.001,e.label="role",this.roleShow.on(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision),this.role.on(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision);let i=new Laya.MotorJoint;i.otherBody=this.roleRigid,i.linearOffset=[this.roleBoxSize[2]/2,this.roleBoxSize[2]/2],i.correctionFactor=.5,i.maxTorque=0,i.maxForce=1e5,this.roleShow.addComponentIntance(i)}onTTTa(t,e){e.isSensor||(t==ut.LeftRod?this.leftAway=!1:this.rightAway=!1)}ontttb(t,e){e.isSensor||(t==ut.LeftRod?(0==this.isRemove&&(this.leftAway=!0),this.isRemove=!1):(0==this.isRemove&&(this.rightAway=!0),this.isRemove=!1))}CreateBalloon(t,e,i){this.balloons=new Array;let s=40;if(this.isNewbie){let a=4;0==this.isDangling&&(2==this.balloonNum?(a=3,s=30):1==this.balloonNum?(a=2,s=10):(a=0,s=0));for(let s=0;s<a;++s){let a=t.getChildByName("balloon"+s);a.x=e,a.y=i,this.balloons.push(a),$t.i.mapCtrl.roleLayer.addChild(a)}return s}return 0}CreateRoleSprites(t=230,e=600){let i=new Laya.Prefab;i.json=this.rodPrefabData;let s=i.create();this.role=s.getChildByName("role"),this.roleBoxSize[2]=this.role.width,this.roleBoxSize[3]=this.role.height,$t.i.mapCtrl.roleLayer.addChild(this.role),this.roleBox=this.role.getComponent(Laya.BoxCollider),this.roleRigid=this.role.getComponent(Laya.RigidBody);let a=this.CreateBalloon(s,t,e);this.leftLeg=s.getChildByName("left"),$t.i.mapCtrl.roleLayer.addChild(this.leftLeg),this.LeftRodLayer=$t.i.mapCtrl.roleLayer.numChildren,this.leftCfqRigid=this.leftLeg.getChildByName("cfq").getComponent(Laya.RigidBody),this.leftBox=this.leftLeg.getComponent(Laya.BoxCollider),this.leftRigid=this.leftLeg.getComponent(Laya.RigidBody),this.leftRigid.body.SetUserData("Rod"),this.leftDistanceJoint=this.leftLeg.getComponent(Laya.DistanceJoint),this.leftDistanceJoint.destroy(),this.role.x=t,this.role.y=e,this.leftLeg.x=t,this.leftLeg.y=e,this.leftRvltJoint=this.leftLeg.addComponentIntance(this.CreateRevoluteJoint(this.roleRigid,this.pivotLorR)),this.leftWeldJoint=this.leftLeg.addComponentIntance(this.CreateWeldJoint(this.roleRigid,this.pivotLorR)),this.leftWeldJoint.enabled=!1,this.rightLeg=s.getChildByName("right"),$t.i.mapCtrl.roleLayer.addChild(this.rightLeg),this.rightCfqRigid=this.rightLeg.getChildByName("cfq").getComponent(Laya.RigidBody),this.rightBox=this.rightLeg.getComponent(Laya.BoxCollider),this.rightRigid=this.rightLeg.getComponent(Laya.RigidBody),this.rightRigid.body.SetUserData("Rod"),this.rightDistanceJoint=this.rightLeg.getComponent(Laya.DistanceJoint),this.rightDistanceJoint.destroy(),this.rightLeg.x=t,this.rightLeg.y=e,this.rightRvltJoint=this.rightLeg.addComponentIntance(this.CreateRevoluteJoint(this.roleRigid,this.pivotLorR)),this.rightWeldJoint=this.rightLeg.addComponentIntance(this.CreateWeldJoint(this.roleRigid,this.pivotLorR)),this.rightWeldJoint.enabled=!1;this.rightRigid.linearDamping=.1,this.rightRigid.angularDamping=.1,this.leftRigid.linearDamping=.1,this.leftRigid.angularDamping=.1,this.roleRigid.linearDamping=.1,this.roleRigid.angularDamping=.1,this.isNewbie&&(this.leftRigid.angularDamping=a,this.rightRigid.angularDamping=a),this.isDangling&&this.role.addComponent(Laya.RevoluteJoint),this.leftAllowRotation=!1,this.rightAllowRotation=!1;let r=this.leftLeg.getChildByName("cfq");r.on(Laya.Event.TRIGGER_ENTER,this,this.onTTTa,[ut.LeftRod]),r.on(Laya.Event.TRIGGER_EXIT,this,this.ontttb,[ut.LeftRod]);let o=this.rightLeg.getChildByName("cfq");o.on(Laya.Event.TRIGGER_ENTER,this,this.onTTTa,[ut.RightRod]),o.on(Laya.Event.TRIGGER_EXIT,this,this.ontttb,[ut.RightRod])}AddBoxCollider(t,e,i,s,a){let r=new Laya.BoxCollider;return r.x=e,r.y=i,r.width=s,r.height=a,r.restitution=0,r.friction=5e3,t.addComponentIntance(r),r}AddPolygonCollider(t){let e=new Laya.PolygonCollider;return e.friction=5e3,e.points="0,0,8,0,8,190,6,196,4,198,2,196,0,190",t.addComponentIntance(e),e}AddRigidBody(t,e,i=1,s=!1){let a=new Laya.RigidBody;return a.category=e,a.mask=i,a.allowSleep=!1,a.bullet=!0,t.addComponentIntance(a),s&&this.SetMassData(a,this.pivotLorR[0]/50,this.pivotLorR[1]/50),a}CreateRevoluteJoint(t,e=null){let i=new Laya.RevoluteJoint;return i.otherBody=t,i.anchor=null==e?this.pivotLorR:e,i}CreateWeldJoint(t,e=null){let i=new Laya.WeldJoint;return i.otherBody=t,i.frequency=0,i.anchor=null==e?this.pivotLorR:e,i}CreateDistanceJoint(t,e,i=[20,20],s=[3,3]){let a=new Laya.DistanceJoint;return a.enabled=!1,a.otherAnchor=i,a.selfAnchor=s,a.otherBody=e,a.selfBody=t,a.length=.001,a.enabled=!0,a}CreatePrismaticJoint(t,e){let i=new Laya.PrismaticJoint;return i.otherBody=t,i.anchor=e,i.axis=[0,1],i}CreateSprite(t,e,i,s,a,r,o,n){return null==t&&(t=new Laya.Sprite,$t.i.mapCtrl.roleLayer.addChild(t)),t.loadImage(e),t.width=i,t.height=s,t.pivot(a,r),t.x=o,t.y=n,t}setNormalFace(){this.setFace(mt.normal)}setDangerFace(t){t?this._curRoleFace==mt.normal&&this.setFace(mt.danger):0==this.isRoleDeath&&this.setNormalFace()}setWinFace(){this.setFace(mt.win)}setFailFace(){this.setFace(mt.fail)}setFace(t){this._curRoleFace=t,this.roleFace.loadImage($t.i.data.bodyData.curUseData.faceImgBase+this.faceUrls[this._curRoleFace])}}class Ct extends GI.UIViewBase{constructor(){super(...arguments),this.currentScore=0,this.targetScore=0,this.rankCount=0,this.get_rank=0,this.totalRank=3,this.isNewRecord=!1,this.isSkLoaded=!1}createPanel(){this.needMask=!0,this.createPanelUI("WmSucView"),this.makeFullScreen(),this.txtScore=this.u("txtScore").asTextField,this.panel.getController("shareRecordCtrl").selectedPage=GI.gCfg.shareRecordCfgs&&GI.gCfg.shareRecordCfgs.length?"show":"hide",this.panel.getController("shareGameCtrl").selectedPage=GI.gCfg.shareGameBtn}doBindEvt(){this.bindUiClick("btnLevel",()=>{this.hideSelf(),GI.gMsgCet.event("AB.PlayMusic"),GI.uiViewMgr.showView("ChallengeView",{chapterId:$t.i.curChapter})}),this.bindUiClick("btnRestart",()=>{$t.i.money>=GI.gCfg.restartComsume?($t.i.data.changeMoney({useOrGain:0,gemNum:GI.gCfg.restartComsume,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.mi_restart_level,gemdetails:""}),this.hideSelf(),$t.i.reStart()):GI.uiViewMgr.showView("AbRewardView",{reward_id:1})}),this.bindUiClick("btnNext",()=>{if($t.i.curLvl>=$t.i.data.chapterData[$t.i.curChapter].levels.length)return void GI.gInfoMgr.showInfoCont(1,"您已完成第"+$t.i.curChapter+"章所有关卡！");let t=$t.i.data.usingProp[$t.i.data.commercialCfg.prop_enum.double_point];$t.i.data.currentRank(t&&t.count>0)>=GI.gCfg.unlockNextRank||$t.i.data.isNextLvlUnlock($t.i.curChapter,$t.i.curLvl)?(this.hideSelf(),this.mgr.checkStartLvl()):GI.uiViewMgr.showView("UnlockChapterView",{fromView:this.viewID})}),this.bindUiClick("btnShareRecord",()=>{GI.gMsgCet.event("btn_share_record")}),this.bindUiClick("btnShareGame",this.shareGame),this.bindGEvt("show_custom_ad",this.showCustomAd),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})})}doShow(t){t&&t.onGameShow||(GI.gMsgCet.event("AB.SoundEvent",{eventType:5}),null!=t&&null!=t.isNewRecord&&(this.isNewRecord=t.isNewRecord),this.isSkLoaded?this.setUIData():this.loadSk(),GI.timerMgr.once(GI.gCfg.delayPopInsertAd>0?GI.gCfg.delayPopInsertAd:0,this,this.showInsertAd))}doHide(t){t&&t.onGameHide||(GI.timerMgr.clear(this,this.loopShowStar),this.panel.getTransition("panel_tremble").stop(),this.resetUi(),GI.timerMgr.clear(this,this.showInsertAd))}showInsertAd(){GI.timerMgr.clear(this,this.showInsertAd),GI.pf.showInsertAd({sourceType:this.viewID})}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}resetUi(){this.u("imgNewRecord").visible=!1,this.panel.getTransition("showNewRecord").playReverse();for(let t=1;t<=this.totalRank;t++)this["showStarSk"+t].visible=!1}setUIData(){let t=$t.i.data.chapterData[$t.i.curChapter].levels[$t.i.curLvl-1];this.get_rank=t.lastRank,this.u("txtLvl").asTextField.text=$t.i.curChapter+"-"+$t.i.curLvl,this.u("txtBestScore").asTextField.text=t.bestScore.toString();for(let e=1;e<=this.totalRank;e++)this.u("maxStar"+e).visible=e<=t.bestRank;this.isNewRecord&&(this.panel.getTransition("showNewRecord").play(),this.u("imgNewRecord").visible=!0),this.currentScore=0,this.targetScore=t.lastScore,this.txtScore.text=this.currentScore.toString(),GI.timerMgr.loop(50,this,this.loopIncreaseScore),this.rankCount=1,this.playingStarIndex=0,this.get_rank>0?(this.loopShowStar(),GI.timerMgr.loop(500,this,this.loopShowStar)):GI.gCfg.alwaysShowTurntable?(this.handleShowTurnTable({rank:this.get_rank}),this.showScreenRecordView()):this.showScreenRecordView()}loopIncreaseScore(){this.currentScore+4933>=this.targetScore?(this.currentScore=this.targetScore,GI.timerMgr.clear(this,this.loopIncreaseScore)):this.currentScore+=4933,this.txtScore.text=this.currentScore.toString()}loopShowStar(){if(this.rankCount>this.get_rank)return void GI.timerMgr.clear(this,this.loopShowStar);let t=this["showStarSk"+this.rankCount];t.visible=!0,t.play(0,!1),this.panel.getTransition("panel_tremble").play(GI.handle(this,()=>{this.playingStarIndex++,GI.gCfg.alwaysShowTurntable?this.playingStarIndex>=this.get_rank&&(this.handleShowTurnTable({rank:this.get_rank}),this.showScreenRecordView()):(this.playingStarIndex>=3&&(this.handleShowTurnTable({rank:this.get_rank}),this.showScreenRecordView()),this.get_rank<3&&this.playingStarIndex>=this.get_rank&&this.showScreenRecordView())})),this.rankCount++}handleShowTurnTable(t){!GI.gMsgCet.fetch("show_turntable_view",{rank:t&&t.rank})&&GI.uiViewMgr.showView("TurntableView")}showScreenRecordView(){GI.gMsgCet.fetch("Wm.onSuc")}loadSk(){let t="showStarSk";for(let e=1;e<=this.totalRank;e++)null==this[t+e]&&(this[t+e]=new Laya.Skeleton,this.u("starBg"+e).displayObject.addChild(this[t+e]),this[t+e].pos(this.u("starBg"+e).width/2,this.u("starBg"+e).height/2),this[t+e].load("res/ani/fx_star_show/Balttle_Icon_Xingxing.sk",GI.handle(this,()=>{this[t+e].stop(),e==this.totalRank&&(this.setUIData(),this.isSkLoaded=!0)})))}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&GI.gMsgCet.event("pf.shareGame")}})}}class bt extends GI.UIViewBase{constructor(){super(...arguments),this.blastRewardLimitType="shockwave_video_limit"}createPanel(){this.needMask=!0,this.createPanelUI("WmFailView"),this.makeFullScreen(),this.panel.getController("blastCtrl").selectedPage=GI.gCfg.failViewGetBlastPage,this.panel.getController("shareRecordCtrl").selectedPage=GI.gCfg.shareRecordCfgs&&GI.gCfg.shareRecordCfgs.length?"show":"hide",this.panel.getController("shareGameCtrl").selectedPage=GI.gCfg.shareGameBtn}doBindEvt(){this.bindUiClick("btnLevel",()=>{this.hideSelf(),GI.gMsgCet.event("AB.PlayMusic"),GI.uiViewMgr.showView("ChallengeView",{chapterId:$t.i.curChapter})}),this.bindUiClick("btnRestart",()=>{$t.i.money>=GI.gCfg.restartComsume?($t.i.data.changeMoney({useOrGain:0,gemNum:GI.gCfg.restartComsume,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.mi_restart_level,gemdetails:""}),this.hideSelf(),$t.i.shouldShowPropPoint=!0,$t.i.reStart()):GI.uiViewMgr.showView("AbRewardView",{reward_id:1})}),this.bindUiClick("btnMenu",()=>{this.hideSelf(),GI.gMsgCet.event("AB.PlayMusic"),GI.uiViewMgr.showView("SysMainUi")}),this.bindUiClick("btnBlastReward",()=>{"share"==GI.gCfg.failViewGetBlastPage?this.shareGameGetBlast():GI.gMsgCet.event("btn_get_blast",{closeFunc:this.onFinishVideo.bind(this),adIdx:6,sourceType:this.viewID})}),this.bindUiClick("btnShareRecord",()=>{GI.gMsgCet.event("btn_share_record")}),this.bindUiClick("btnShareGame",this.shareGame),this.bindGEvt("show_custom_ad",this.showCustomAd),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})})}doShow(t){t&&t.onGameShow||(this.setUIData(),GI.timerMgr.once(GI.gCfg.delayPopInsertAd>0?GI.gCfg.delayPopInsertAd:0,this,this.showInsertAd),this.refreshBlastReward(),GI.gCfg.bannerStyleCons&&GI.gCfg.bannerStyleCons.hasOwnProperty(this.viewID)&&($t.i.bannerStyleCons[this.viewID]={top:0}))}doHide(t){t&&t.onGameHide||(GI.timerMgr.clear(this,this.showInsertAd),$t.i.bannerStyleCons&&$t.i.bannerStyleCons.hasOwnProperty(this.viewID)&&($t.i.bannerStyleCons[this.viewID]={}))}refreshBlastReward(){GI.gCfg.timeLimitCfgs&&GI.gCfg.timeLimitCfgs[this.blastRewardLimitType]&&(this.u("btnBlastReward").asButton.enabled=!$t.i.data.isTimeLimitNextStage(this.blastRewardLimitType),this.u("txtRemainCount").asTextField.text="今日剩余次数："+$t.i.data.timeLimitRemainCount(this.blastRewardLimitType))}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}showInsertAd(){GI.timerMgr.clear(this,this.showInsertAd),GI.pf.showInsertAd({sourceType:this.viewID})}setUIData(){let t=$t.i.data.chapterData[$t.i.curChapter].levels[$t.i.curLvl-1];this.u("txtLvl").asTextField.text=$t.i.curChapter+"-"+$t.i.curLvl;for(let e=1;e<=t.bestRank;e++)this.u("maxStar"+e).visible=!0;this.u("txtBestScore").asTextField.text=t.bestScore.toString(),this.u("btnBlastReward").asButton.enabled=!0}onFinishVideo(t,e){if(GI.log("失败界面播放完视频广告：",t,e),!t)return;(GI.gCfg.popShareHint||GI.gCfg.tempChangeVideoToShare||e&&"videoAd"==e.type)&&($t.i.data.costTimeLimit(this.blastRewardLimitType),this.refreshBlastReward());$t.i.data.presentUpdateData($t.i.data.commercialCfg.prop_enum.blast,1);let i=$t.i.data.commercialCfg.prop[$t.i.data.commercialCfg.prop_enum.blast];$t.i.popObtainView({name:i.name,quantity:1,iconName:i.iconName})}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&GI.gMsgCet.event("pf.shareGame")}})}shareGameGetBlast(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&this.onFinishVideo(!0,{type:"videoAd"})}})}}class Gt extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("WmGuideView")}doHide(){}}class vt extends GI.UIViewBase{createPanel(){this.createPanelUI("WmGuide2View")}doShow(){GI.timerMgr.once(6e3,this,this.hideSelf)}}class St{constructor(){this._bIsShark=!1,this._sharkCallBack=null}set sharkObj(t){this._sharkObj=t}get sharkObj(){return this._sharkObj}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t}start(t,e,i,s,a=null){t&&(this.sharkObj=t,this._bIsShark=!0,this._sharkStrengthX=e,this._sharkStrengthY=i,this._sharkDuration=s,this._elapsedTime=0,this._initPosX=this.sharkObj.x,this._initPosY=this.sharkObj.y,a&&(this._sharkCallBack=a),GI.timerMgr.frameLoop(1,this,this.update))}isRunning(){return this._bIsShark}interrupt(){this._bIsShark&&(this._bIsShark=!1,this.sharkObj&&(this.sharkObj.x=this.offsetX=this._initPosX),this.sharkObj&&(this.sharkObj.y=this.offsetY=this._initPosY),GI.timerMgr.clear(this,this.update))}update(){this._elapsedTime+=GI.timerMgr.delta;let t=(this._sharkDuration-this._elapsedTime)/this._sharkDuration;if(t<0)return t=0,void this.over();let e=this.getRand(-this._sharkStrengthX,this._sharkStrengthX)*t,i=this.getRand(-this._sharkStrengthY,this._sharkStrengthY)*t;this.sharkObj.x=this.offsetX=this._initPosX+e,this.sharkObj.y=this.offsetY=this._initPosY+i}getRand(t,e){return Math.random()*(e-t)+t}over(){this._bIsShark&&(this._bIsShark=!1,this.sharkObj&&(this.sharkObj.x=this.offsetX=this._initPosX),this.sharkObj&&(this.sharkObj.y=this.offsetY=this._initPosY),null!=this._sharkCallBack&&(this._sharkCallBack.run(),this._sharkCallBack.recover(),this._sharkCallBack=null),GI.timerMgr.clear(this,this.update))}}class Rt{constructor(){this._debug=!1,this._offX=0,this._offY=0,this._offPtX=0,this._offPtY=0,this.delayTime=10,this.outstripRun=1,this._sceneOffsetStartX=700,this.isUserInput=!1,this._cameraPosX=0,this._cameraPosY=0,this._targetX=0,this._targetY=0,this._minSceneX=-2500,this._maxSceneX=100,this._minSceneY=0,this._maxSceneY=800,this.elasticBackTime=200,this.elasticDistanse=100,this.bBackAction=!1,this.userScale=0,this.minScale=.6,this.maxScale=.75,this._curScale=1,this.lastDistance=0,this.curTween=null,this.curTweenHandler=null,this.bMoveDown=!1,this.mousePoint={x:0,y:0},this._moveSpeed=2,this.sharkCtrl=new St,this.isAcceptCommand=!0,this.isEnd=!1,this.scScale=.8,this._showText=null,this._showInfo=""}get offPtX(){return this._offPtX}set offPtX(t){this._offPtX!=t&&(this._offPtX=t,this.updateOffX())}get offPtY(){return this._offPtY}set offPtY(t){this._offPtY!=t&&(this._offPtY=t,this.updateOffY())}updateOffX(){this._offX=this._offPtX*GI.gw()}updateOffY(){this._offY=this._offPtY*GI.gh()}get cameraPosX(){return this._cameraPosX}set cameraPosX(t){this._cameraPosX!=t&&(this._cameraPosX=t,GI.sceneMgr.mapX=this._cameraPosX)}get cameraPosY(){return this._cameraPosY}set cameraPosY(t){this._cameraPosY!=t&&(this._cameraPosY=t,GI.sceneMgr.mapY=this._cameraPosY)}get targetX(){return this._targetX}set targetX(t){this._targetX!=t&&(this._targetX=t)}get targetY(){return this._targetY}set targetY(t){this._targetY!=t&&(this._targetY=t)}get curMaxLeftXOffset(){return this._minSceneX*this.curScale+GI.gw()}get curMaxRightXOffset(){return this._maxSceneX*this.curScale}get curMaxDownYOffset(){return this._minSceneY*this._curScale+GI.gh()}get curMaxUpYOffset(){return this._maxSceneY*this._curScale}returnLimitX(t){return t<this.curMaxLeftXOffset?this.curMaxLeftXOffset:t>this.curMaxRightXOffset?this.curMaxRightXOffset:t}returnLimitY(t){return t<this.curMaxDownYOffset?this.curMaxDownYOffset:t>this.curMaxUpYOffset?this.curMaxUpYOffset:t}get curTopY(){return-(this._minSceneY*this.userScale+GI.gh())}get curslingshotX(){return this.returnLimitX(this._offX-($t.i.data.birdPos[0]?$t.i.data.birdPos[0].x:0)*this._curScale)}get curslingshotY(){return this.returnLimitY(this._offY-($t.i.data.birdPos[0]?$t.i.data.birdPos[0].y:0)*this._curScale)}get curPigX(){return $t.i.data.tagPos?this._curPigX=this._offX-$t.i.data.tagPos.x*this._curScale:this._curPigX=this.curslingshotX-this._sceneOffsetStartX*this._curScale,this.returnLimitX(this._curPigX)}get curPigY(){return $t.i.data.tagPos?this._curPigY=this._offY-$t.i.data.tagPos.y*this._curScale:this._curPigY=this.curslingshotY,this.returnLimitY(this._curPigX)}get curScale(){return this._curScale}set curScale(t){this._curScale=t,GI.sceneMgr.mapScale=this._curScale,this.cameraPosY=this._targetY=this.curslingshotY,GI.gMsgCet.event("ab.scale_scene",[{curScale:this._curScale}])}get moveSpeed(){return this._moveSpeed*this.curScale}init(t=-770,e=175){let i=$t.i.mapCtrl.mapConfig,s=$t.i.data.getCurMapLvl();this._minSceneX=i.mapCfg[s].minX,this._maxSceneX=i.mapCfg[s].maxX,this._minSceneY=i.mapCfg[s].minY,this._maxSceneY=i.mapCfg[s].maxY,this.maxScale=i.defCamInitScale?i.defCamInitScale:.8,this.minScale=i.defMinScale?i.defMinScale:.6,i.mapCfg[s].initScale&&(this.maxScale=i.mapCfg[s].initScale),i.mapCfg[s].minScale&&(this.minScale=i.mapCfg[s].minScale),this.offPtX=.3,this.offPtY=.3,this.curScale=this.maxScale,this.userScale=this.curScale,this.isAcceptCommand=!0,this.isEnd=!1,this.clearStatus(),GI.gMsgCet.on("onGResize",this,this.onGResizeAtcion),GI.gMsgCet.on("abCtrl.MOUSE_DOWN",this,this.onMouseDown),GI.gMsgCet.on("abCtrl.MOUSE_UP",this,this.onMouseUp),GI.gMsgCet.on("abCtrl.MOUSE_OUT",this,this.onMouseUp),GI.gMsgCet.on("Wm.onFinishLvl",this,this.onLvlOver),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_End",this,this.onLvlOver),GI.gMsgCet.on("ab.moveToBird",this,this.onMoveToBird),GI.gMsgCet.on("ab.onLvlShow",this,this.onLvlShow),GI.gMsgCet.on("ab.camLookAtPig",this,this.onLookAtPig),GI.gMsgCet.on("ab.askCamShake",this,this.triggerShake),this.cameraPosX=this.curPigX,this.cameraPosY=this.curPigY,this._debug&&(this.debugShow(),Laya.stage.on(Laya.Event.KEY_DOWN,this,this.onKeyDown))}onMoveToBird(){this.isAcceptCommand&&this.moveTo(this.curslingshotX,this.curslingshotY,0,this.onTweenFinish)}getDuration(t,e,i,s){let a=Math.abs(i-t),r=Math.abs(s-e);return Math.sqrt(a*a+r*r)/this.moveSpeed}onLvlShow(){this.doOver(),this.moveToDirect(this.curslingshotX,this.curslingshotY,0,this.onLvlShowFinish)}onLvlShowFinish(){GI.gMsgCet.event("ab.camArriveShotPos")}onLvlOver(){this.doOver()}doOver(){this.isEnd=!0,this.isAcceptCommand=!1,this.onTweenInterupt(),this.clearStatus(),this.sharkCtrl.isRunning&&this.sharkCtrl.interrupt()}onLookAtPig(){!this.isEnd&&this.isAcceptCommand&&(this.isAcceptCommand=!1,this.clearStatus(),this.moveTo(this.curPigX,this.curPigY,0,this.onLookAtPigFinish))}onLookAtPigFinish(){this.onTweenFinish();GI.gMsgCet.event("ab.camShake",{shadkeDuration:2500}),this.sharkCtrl&&this.sharkCtrl.start(GI.sceneMgr.scene,20,6,2500,GI.handle(this,this.onLookAtPigShakeFinish))}onLookAtPigShakeFinish(){this.isEnd||(this.isAcceptCommand=!0),this.onShakeFinish()}triggerShake(t=1500,e=10,i=3){!this.isEnd&&this.isAcceptCommand&&this.sharkCtrl&&(this.sharkCtrl.start(GI.sceneMgr.scene,e,i,t,GI.handle(this,this.onShakeFinish)),GI.gMsgCet.event("ab.camShakeBird",{shadkeDuration:t}))}onShakeFinish(){}onGResizeAtcion(){this.updateOffX(),this.updateOffY(),this.cameraPosY=this.targetY=this.returnLimitY(this.curslingshotY)}onMouseDown(t){if(!this.isAcceptCommand)return;this.isUserInput=!0,this.onTweenInterupt(),this.mousePoint.x=Laya.stage.mouseX;let e=t.touches;null!=e?e&&e.length<=1?this.bMoveDown=!0:e&&2==e.length&&(this.bMoveDown=!1,this.lastDistance=this.getDistance(e),GI.gMsgCet.on("abCtrl.MOUSE_MOVE",this,this.onChangeScale)):this.bMoveDown=!0}onMouseUp(t){this.isAcceptCommand&&(this.bMoveDown=!1,this.isUserInput=!1,GI.gMsgCet.off("abCtrl.MOUSE_MOVE",this,this.onChangeScale),this.checkArea())}checkArea(){this.cameraPosX<this.curMaxLeftXOffset?this.backToArea(this.curMaxLeftXOffset):this.cameraPosX>this.curMaxRightXOffset&&this.backToArea(this.curMaxRightXOffset)}backToArea(t){this.bBackAction=!0,GI.Tween.to(this,{cameraPosX:t},this.elasticBackTime,Laya.Ease.sineOut,Laya.Handler.create(this,this.backToAreaFinish))}backToAreaFinish(){this.bBackAction=!1,this.targetX=this.cameraPosX,this.targetY=this.cameraPosY}onChangeScale(t){t.touches;let e=this.getDistance(t.touches);let i=this.curScale+.003*(e-this.lastDistance);i>this.minScale&&i<this.maxScale&&(this.curScale=i,this.userScale=i),this.cameraPosX<this.curMaxLeftXOffset?this._targetX=this.cameraPosX=this.curMaxLeftXOffset:this.cameraPosX>this.curMaxRightXOffset&&(this._targetX=this.cameraPosX=this.curMaxRightXOffset),this.lastDistance=e}getDistance(t){let e=0;if(t&&2==t.length){let i=t[0].stageX-t[1].stageX,s=t[0].stageY-t[1].stageY;e=Math.sqrt(i*i+s*s)}return e}onUpdate(){this._debug&&this.updateInfo(),this.isAcceptCommand&&(this.bBackAction||this.curTween||($t.i.roleCtrl.isCmeraToBird?this.lookUpBird():$t.i.roleCtrl.isCmeraToTrigger?this.CameraToTrigger():!$t.i.roleCtrl.isMouseBird&&this.bMoveDown&&this.onMouseDownMove()))}clearStatus(){$t.i.roleCtrl.isCmeraToBird=!1,$t.i.roleCtrl.isCmeraToTrigger=!1,this.bBackAction=!1,this.bMoveDown=!1}lookUpBird(){if(!this.isAcceptCommand)return;this._targetX=this._offX-$t.i.roleCtrl.roleX*this.curScale;($t.i.roleCtrl.roleY-100)*this.curScale<this.curTopY?this.curScale-.003>this.minScale&&(this.curScale-=.003):($t.i.roleCtrl.roleY-100)*this.curScale>this.curTopY&&this.curScale+.003<this.userScale&&(this.curScale+=.003),this.moveToTarget(this.curMaxLeftXOffset,this.curMaxRightXOffset)}CameraToTrigger(){this.isAcceptCommand&&($t.i.roleCtrl.isCmeraToTrigger=!1,this.moveTo(this.curslingshotX,this.curslingshotY,0,this.onTweenFinish))}onMouseDownMove(){if(!this.isAcceptCommand)return;if(this.bBackAction)return;let t=1.5*(Laya.stage.mouseX-this.mousePoint.x);this.targetX=this.targetX+t;let e=this.curMaxLeftXOffset-this.elasticDistanse*this._curScale,i=this.curMaxRightXOffset+this.elasticDistanse*this._curScale;this.moveToTarget(e,i),this.mousePoint.x=Laya.stage.mouseX}moveToTarget(t,e){if(this.targetX<t?this.targetX=t:this.targetX>e&&(this.targetX=e),this.cameraPosX>this.curPigX&&this.cameraPosX<this.curslingshotX){let t=(this.cameraPosX-this.curslingshotX)/(this.curPigX-this.curslingshotX);this.cameraPosY=this.targetY=this.curslingshotY+t*(this.curPigY-this.curslingshotY)}else this.cameraPosX<this.curPigX?this.cameraPosY=this.targetY=this.curPigY:this.cameraPosX>this.curslingshotX&&(this.cameraPosY=this.targetY=this.curslingshotY);Math.abs(this.cameraPosX-this.targetX)>this.outstripRun&&(this.cameraPosX+=this.GetDelayData(this.cameraPosX,this.targetX,this.delayTime))}GetDelayData(t,e,i){let s=e-t,a=s;return a=s>this.outstripRun||s<-this.outstripRun?(a=s/i)>0?a<this.outstripRun?this.outstripRun:a:a>-this.outstripRun?-this.outstripRun:a:0}performanceBegin(){this.moveTo(this.curslingshotX,this.curslingshotY,1500,this.onTweenFinish)}moveTo(t,e,i,s=null){this.onTweenInterupt(),this.curTweenHandler=Laya.Handler.create(this,s);let a=t,r=e,o=this.getDuration(this.cameraPosX,this.cameraPosY,a,r);this.curTween=GI.Tween.to(this,{cameraPosX:a,cameraPosY:r},o,GI.Ease.linearIn,this.curTweenHandler,i,!0)}onTweenFinish(){null!=this.curTween&&(this.curTween.clear(),this.curTween=null),this.targetX=this.cameraPosX,this.targetY=this.cameraPosY}onTweenInterupt(){null!=this.curTweenHandler&&(this.curTweenHandler.run(),this.curTweenHandler.recover(),this.curTweenHandler=null),this.targetX=this.cameraPosX,this.targetY=this.cameraPosY}moveToDirect(t,e,i,s=null){let a=t,r=e,o=this.getDuration(this.cameraPosX,this.cameraPosY,a,r);GI.Tween.to(this,{cameraPosX:a,cameraPosY:r},o,GI.Ease.linearIn,Laya.Handler.create(this,s),i,!0)}get roleUiX(){return GI.uiViewMgr.getUIX(this._offX)}get roleUiY(){return GI.uiViewMgr.getUIY(this._offY)}get roleTopUiY(){return this.roleUiY}scToUi(t){return Laya.Point.create().setTo(t.x+this.cameraPosX,t.y+this.cameraPosY)}moveForward(t,e=500){GI.Tween.to(this,{scScale:t},e)}onPlay(){GI.Tween.to(this,{offPtX:$t.i.isPlay?.25:.5},500)}onLvlOn(){GI.Tween.to(this,{offPtY:$t.i.isLvlOn?.45:.6},500),this.moveForward($t.i.isLvlOn?1:1.5)}onKeyDown(t){t.keyCode==Laya.Keyboard.A&&(console.log("width: "+GI.gw()),console.log("height: "+GI.gh()),console.log("cameraPosX: "+this.cameraPosX),console.log("cameraPosY: "+this.cameraPosY),console.log("offPtX: "+this.offPtX),console.log("offPtY: "+this.offPtY),console.log("offX: "+this._offX),console.log("offY: "+this._offY),console.log("curMaxLeftXOffset: "+this.curMaxLeftXOffset),console.log("curMaxRightXOffset: "+this.curMaxRightXOffset),console.log("curMaxDownYOffset: "+this.curMaxDownYOffset),console.log("curMaxUpYOffset: "+this.curMaxUpYOffset),console.log("curScale: "+this.curScale),console.log("弹弓位置: "+$t.i.data.birdPos[0].x),console.log("弹弓位置: "+$t.i.data.birdPos[0].y),console.log("curPigX: "+this.curPigX),console.log("curPigY: "+this.curPigY),console.log("curslingshotX: "+this.curslingshotX),console.log("curslingshotY: "+this.curslingshotY),console.log("this.bBackAction: "+this.bBackAction),console.log("WmMgr.i.roleCtrl.isCmeraToBird: "+$t.i.roleCtrl.isCmeraToBird),console.log("WmMgr.i.roleCtrl.isCmeraToTrigger: "+$t.i.roleCtrl.isCmeraToTrigger),console.log("this.bMoveDown: "+this.bMoveDown)),t.keyCode==Laya.Keyboard.B&&(this.curScale==this.maxScale?(this.curScale=this.minScale,this.userScale=this.curScale):this.curScale==this.minScale&&(this.curScale=this.maxScale,this.userScale=this.curScale)),t.keyCode==Laya.Keyboard.C&&GI.gMsgCet.event("ab.moveToBird"),t.keyCode==Laya.Keyboard.D&&GI.gMsgCet.event("ab.camLookAtPig")}debugShow(){null==this._showText&&(this._showText=new Laya.Text,this._showText.x=Laya.stage.width/4,this._showText.y=Laya.stage.height/4,this._showText.fontSize=30,Laya.stage.addChild(this._showText))}updateInfo(){this._showInfo="isAcceptCommand: "+this.isAcceptCommand+"\n",this._showInfo+="isUserInput: "+this.isUserInput+"\n",this._showInfo+="bBackAction: "+this.bBackAction+"\n",this._showInfo+="WmMgr.i.roleCtrl.isCmeraToBird: "+ +$t.i.roleCtrl.isCmeraToBird+"\n",this._showInfo+="WmMgr.i.roleCtrl.isCmeraToTrigger: "+$t.i.roleCtrl.isCmeraToTrigger+"\n",this._showInfo+="this.bMoveDown: "+this.bMoveDown+"\n",this._showText.text=this._showInfo}}class _t extends GI.CfgCtrl{constructor(t){super(),this._curUseID=-1,this._flag=t}get data(){return this._data}get activeCfgs(){return this._activeCfgs}get activeCount(){return this._activeCfgs?this._activeCfgs.length:0}parseCfgData(t){this._data=t,GI.cfgMgr.parseCfgData(this.data.datas,{ctrl:this}),this.every((t,e,i)=>{(t.price<=0||GI.localDataMgr.getBool("Wm.isActiveID."+this._flag+"."+t.id))&&this.active(t.id)})}active(t){let e=this.getCfg(t);e&&!e.active&&(e.active=!0,this._activeCfgs||(this._activeCfgs=[]),this._activeCfgs.push(e),GI.localDataMgr.setBool("Wm.isActiveID."+this._flag+"."+e.id,!0),GI.gMsgCet.event("Wm.part.active",{partData:this,id:t,cfg:e}),GI.gMsgCet.event("Wm.part.active."+this._flag,{partData:this,id:t,cfg:e}))}isActive(t){let e=this.getCfg(t);return e&&e.active}get canActiveCount(){let t=0;return this.every((e,i,s)=>{!e.active&&$t.i.money>=e.price&&t++}),t}get curUseID(){return this._curUseID<0&&(this._curUseID=GI.localDataMgr.getInt("Wm.curUseID."+this._flag)),this._curUseID}set curUseID(t){this._curUseID!=t&&(this.active(t),this._curUseID=t,GI.localDataMgr.setInt("Wm.curUseID."+this._flag,this._curUseID),GI.gMsgCet.event("Wm.part.curUseID."+this._flag,{id:this._curUseID}),GI.gMsgCet.event("Wm.part.curUseID",{partData:this,id:this._curUseID}))}get curUseData(){return this.getCfg(this.curUseID)}}class Lt{constructor(t,e,i){this.x=t,this.y=e,this.type=i}}class Mt{constructor(t,e){this.x=t,this.y=e}}class Pt{constructor(){this.balloonPar=new Array,this.offsetPos=new Array,this.birdPos=new Array,this._groundY=0,this._mapWidht=0,this._mapHeight=0,this._maxRightx=-1,this._minLeftx=-1,this._maxY=-1,this._minY=-1,this.guideSceneLvl=2e4,this._totalLvl=1,this._MaxGameGrade=0,this._gameGrade=0,this._money=-1,this._money2=-1,this.failLvlData={chapter:-1,lvl:-1,count:0},this._curChapter=-1,this._curLvl=-1,this._finishedLvl=-1,this._curStep=0,this._historyPlayTimes=-1,this._playTimes=0,this._propGuideId=-1,this._viewBeforeGuide={},this.isDailyChallengeScene=!1,this.dailyChallengeData={},this._bodyData=new _t("body"),this._rodData=new _t("rod"),this._hatData=new _t("hat"),this._jewelryData=new _t("jewelry"),this._guideStep=0}setBallonPar(t){this.balloonPar.push(t)}clearBalloonPar(){if(this.balloonPar)for(;this.balloonPar.pop(););}desRopeJoint(){if(this.balloonPar)for(let e=0;e<this.balloonPar.length;e++){var t=this.balloonPar[e];GI.gMsgCet.event("balloon.ropeJoint.des",t)}}setOffsetPos(t,e){let i=new Mt(t,e);this.offsetPos.push(i)}clearOffsetPos(){for(;this.offsetPos.pop(););}getOffsetPos(){return this.offsetPos}setCurBirdPos(t,e,i){let s=new Lt(t,e,i);this.birdPos.push(s)}clearBirdPos(){for(;this.birdPos.pop(););}getBirdPos(){return this.birdPos}getBirdPosByIndex(t){return this.birdPos[t]}get groundY(){return this._groundY}set groundY(t){this._groundY=t}get mapWidht(){return this._mapWidht}set mapWidht(t){this._mapWidht=t}get mapHeight(){return this._mapHeight}set mapHeight(t){this._mapHeight=t}get maxRightX(){return this._maxRightx}set maxRightX(t){t>this._maxRightx&&(this._maxRightx=t)}get minLeftX(){return this._minLeftx}set minLeftX(t){t<this._minLeftx&&(this._minLeftx=t)}get maxY(){return this._maxY}set maxY(t){t>this._maxRightx&&(this._maxY=t)}get minY(){return this._minY}set minY(t){t<this._minLeftx&&(this._minY=t)}get tagPos(){return this._tagPos}set tagPos(t){this._tagPos=t}get scoreUiCfg(){return this._scoreUiCfg}set scoreUiCfg(t){this._scoreUiCfg=t}get commercialCfg(){return this._commercialCfg}set commercialCfg(t){this._commercialCfg=t}get soundsCfg(){return this._soundsCfg}set soundsCfg(t){this._soundsCfg=t}get usingProp(){return null==this._usingProp&&this.resetUsingProp(),this._usingProp}set usingProp(t){this._usingProp=t}get courseData(){return this._courseData=GI.localDataMgr.getJSON("course_data"),this._courseData}set courseData(t){this._courseData=t,GI.localDataMgr.setJSON("course_data",this._courseData)}get offlineInitFeather(){return this._offlineInitFeather=GI.localDataMgr.getInt("offline_init_feather"),this._offlineInitFeather}set offlineInitFeather(t){this._offlineInitFeather=t,GI.localDataMgr.setInt("offline_init_feather",this._offlineInitFeather)}get vipData(){return this._vipData=GI.localDataMgr.getJSON("vip_data"),this._vipData}set vipData(t){this._vipData=t,GI.localDataMgr.setJSON("vip_data",this._vipData)}get shareGameDate(){return this._shareGameDate=GI.localDataMgr.getInt("share_game_date"),null==this._shareGameDate&&(this.shareGameDate=-1),this._shareGameDate}set shareGameDate(t){this._shareGameDate=t,GI.localDataMgr.setInt("share_game_date",t)}get chestCollectCount(){return this._chestCollectCount=GI.localDataMgr.getInt("chestCollectCount"),this._chestCollectCount}set chestCollectCount(t){this._chestCollectCount=t,GI.localDataMgr.setJSON("chestCollectCount",this._chestCollectCount)}get beginOfflineTime(){return this._beginOfflineTime=GI.localDataMgr.getInt("beginOfflineTime"),this._beginOfflineTime}set beginOfflineTime(t){this._beginOfflineTime=t,GI.localDataMgr.setInt("beginOfflineTime",this._beginOfflineTime)}get surpriseChestTime(){return this._surpriseChestTime=GI.localDataMgr.getInt("surpriseChestTime"),this._surpriseChestTime}set surpriseChestTime(t){this._surpriseChestTime=t,GI.localDataMgr.setInt("surpriseChestTime",this._surpriseChestTime)}get timeLimitData(){return this._timeLimitData=GI.localDataMgr.getJSON("time_limit_data"),null==this._timeLimitData&&(this.timeLimitData={}),this._timeLimitData}set timeLimitData(t){this._timeLimitData=t,GI.localDataMgr.setJSON("time_limit_data",t)}get videoBlastCount(){return this._videoBlastCount}addVideoBlastCt(t=1){this._videoBlastCount+=t}initTimeLimitData(){let t={};if(GI.gCfg.timeLimitCfgs){let e=this.timeLimitData;t=GI.gCfg.timeLimitCfgs;for(let i in GI.gCfg.timeLimitCfgs){let s=e.hasOwnProperty(i);t[i].nextTimestamp=s?e[i].nextTimestamp:-1,t[i].currentCount=s?e[i].currentCount:0,t[i].curDay=s?e[i].curDay:0}}this.timeLimitData=t}costTimeLimit(t){let e=this.timeLimitData;e[t]&&(new Date).getTime()>e[t].nextTimestamp&&(e[t].curDay=this.getCurDay(),e[t].currentCount++,e[t].currentCount>=e[t].maxTimes&&(e[t].nextTimestamp=new Date((new Date).toDateString()).getTime()+864e5,e[t].currentCount=0),this.timeLimitData=e)}isTimeLimitNextStage(t){let e=this.timeLimitData[t];return e&&Date.now()<e.nextTimestamp}timeLimitRemainCount(t){let e=this.timeLimitData;return this.getCurDay()!=e[t].curDay&&(e[t].currentCount=0,this.timeLimitData=e),e[t]&&this.isTimeLimitNextStage(t)?0:e[t]&&e[t].maxTimes-e[t].currentCount}getCurDay(){return Math.floor(GI.timerMgr.currTimer/864e5)}get lvlPlayTimes(){return this._lvlPlayTimes=GI.localDataMgr.getJSON("ab.lvlPlayTimes"),this._lvlPlayTimes}set lvlPlayTimes(t){this._lvlPlayTimes=t,GI.localDataMgr.setJSON("ab.lvlPlayTimes",this._lvlPlayTimes)}get totalLvl(){return this._totalLvl}get MaxGameGrade(){return this._MaxGameGrade}set MaxGameGrade(t){this._MaxGameGrade=t}set GameGrade(t){this._gameGrade=t}get GameGrade(){return this._gameGrade}AddGrade(t){this._gameGrade+=t,GI.gMsgCet.event("ab.AddGrade")}get money(){return this._money<0&&(this._money=GI.localDataMgr.getInt("Wm.money")),this._money}set money(t){this._money!=t&&(this._money=t,GI.localDataMgr.setInt("Wm.money",this._money),GI.gMsgCet.event("Wm.money"))}get money2(){return this._money2<0&&(this._money2=this.money),this._money2}set money2(t){this._money2!=t&&(this._money2=t,GI.gMsgCet.event("Wm.money2"))}updateMoney2(){this.money2=this.money}get props(){return this._props=GI.localDataMgr.getJSON("commercial_props"),this._props}set props(t){this._props=t,GI.localDataMgr.setJSON("commercial_props",this._props),GI.gMsgCet.event("ab.prop_change")}plusFailLvl(t,e){e==this.failLvlData.lvl&&t==this.failLvlData.chapter||(this.failLvlData.chapter=t,this.failLvlData.lvl=e,this.failLvlData.count=0),this.failLvlData.count++}clearFailLvlData(){this.failLvlData={chapter:-1,lvl:-1,count:0}}get curChapter(){return this._curChapter}set curChapter(t){this._curChapter!=t&&(this._curChapter=t)}get chapterData(){return this._chapterData=GI.localDataMgr.getJSON("chapter_data"),this._chapterData}set chapterData(t){this._chapterData=t,GI.localDataMgr.setJSON("chapter_data",this._chapterData)}getLevelsAmount(t){return this.chapterData[t].levels.length}getCurMapLvl(){return this.isGuideScene&&this.commercialCfg.prop[this.propGuideId]?this.commercialCfg.prop[this.propGuideId].map_id:$t.i.isEventScene?GI.gCfg.timelimitEvent.mapId:this.isDailyChallengeScene?this.dailyChallengeMaps[this.dailyChallengeData.curStep]:this.chapterCfgs[this.curChapter].levels[this.curLvl-1].map_id}get curLvl(){return this._curLvl<0&&(this._curLvl=GI.localDataMgr.getInt("Wm.curLvl")),this._curLvl}set curLvl(t){this._curLvl!=t&&(this._curLvl=t,this._playTimes=0,GI.localDataMgr.setInt("Wm.curLvl",this._curLvl),GI.gMsgCet.event("Wm.curLvl"))}get finishedLvl(){return this._finishedLvl<0&&(this._finishedLvl=GI.localDataMgr.getInt("Wm.finishedLvl")),this._finishedLvl}set finishedLvl(t){t>=this.guideSceneLvl||(t>=1e4?GI.localDataMgr.setBool("Wm.challenge."+t,!0):(this._finishedLvl=t,GI.localDataMgr.setInt("Wm.finishedLvl",this._finishedLvl),GI.gMsgCet.event("Wm.finishedLvl")))}get curStep(){return this._curStep}set curStep(t){this._curStep!=t&&(this._curStep=t,GI.gMsgCet.event("Wm.curStep"))}get historyPlayTimes(){return this._historyPlayTimes<0&&(this._historyPlayTimes=GI.localDataMgr.getInt("Wm.historyPlayTimes")),this._historyPlayTimes}set historyPlayTimes(t){this._historyPlayTimes!=t&&(this._historyPlayTimes=t,GI.localDataMgr.setInt("Wm.historyPlayTimes",this._historyPlayTimes))}get playTimes(){return this._playTimes}addPlayTimes(){this._playTimes++,this.historyPlayTimes++}storeLvlPlayTimes(t,e){let i=this.lvlPlayTimes;i||(i={}),i[t+"_"+e]&&i[t+"_"+e]++||(i[t+"_"+e]=1),this.lvlPlayTimes=i}getLvlPlayTime(t,e){return this.lvlPlayTimes&&this.lvlPlayTimes[t+"_"+e]||0}get chapterCfgs(){return this._chapterCfgs}get BirdCfgs(){return this.birdCfgs}get ModuleCfgs(){return this.birdCfgs.modules}get propGuideId(){return this._propGuideId}set propGuideId(t){this._propGuideId=t}clearPropGuideId(){this.propGuideId=-1}get viewBeforeGuide(){return this._viewBeforeGuide}clearDailyChallengeData(){this.dailyChallengeData={score:0,curStep:0,curScore:0,propId:0}}get dailyChallengeMaps(){return this._dailyChallengeMaps=GI.localDataMgr.getJSON("dailyChallengeMaps"),this._dailyChallengeMaps}set dailyChallengeMaps(t){this._dailyChallengeMaps=t,GI.localDataMgr.setJSON("dailyChallengeMaps",this._dailyChallengeMaps)}get rankScore(){return this._rankScore=GI.localDataMgr.getInt("rankScore"),this._rankScore}set rankScore(t){this._rankScore!=t&&(this._rankScore=t,GI.localDataMgr.setInt("rankScore",this._rankScore),this.finishWelfareTask(7),GI.gMsgCet.event("rankScoreUpdate"))}get lastRankScore(){return this._lastRankScore=GI.localDataMgr.getInt("lastRankScore"),this._lastRankScore}set lastRankScore(t){this._lastRankScore!=t&&(this._lastRankScore=t,GI.localDataMgr.setInt("lastRankScore",this._lastRankScore),GI.gMsgCet.event("lastRankScoreUpdate"))}addRankScore(t,e){GI.gCfg.rankData&&!this.isTimeLimitNextStage(t)&&(this.rankScore+=e,this.costTimeLimit(t))}getRankPercent(t){return Math.min(99,Math.max(1,Math.round(100*(1-(t-GI.gCfg.rankData.initScore)/(GI.gCfg.rankData.totalScore-GI.gCfg.rankData.initScore)))))}hasLastRankReward(){return this.lastRankScore&&this.getRankPercent(this.lastRankScore)<=GI.gCfg.rankData.rewards[GI.gCfg.rankData.rewards.length-1].rankPercent}get rookieWelfare(){return this._rookieWelfare=GI.localDataMgr.getJSON("rookieWelfare"),this._rookieWelfare}set rookieWelfare(t){this._rookieWelfare=t,GI.localDataMgr.setJSON("rookieWelfare",this._rookieWelfare)}recordGuideBeforeView(t){if(!this.duringGuideProcess)if("show"==t.type)this.isViewToGuide(t.view)?this._viewBeforeGuide.viewPath=[t.view]:this._viewBeforeGuide.viewPath&&this._viewBeforeGuide.viewPath.push(t.view),null!=t.chapter&&(this._viewBeforeGuide.chapter=t.chapter),null!=t.lvl&&(this._viewBeforeGuide.lvl=t.lvl);else{let e=this._viewBeforeGuide.viewPath&&this._viewBeforeGuide.viewPath.indexOf(t.view);null!=e&&-1!=e&&this._viewBeforeGuide.viewPath.splice(e,1)}}clearViewBeforeGuide(){this._viewBeforeGuide={}}isViewToGuide(t){return["SysMainUi","GamePlayView","ChapterView","ChallengeView"].indexOf(t)>-1}get bodyData(){return this._bodyData}get curBodyID(){return this.bodyData.curUseID}set curBodyID(t){this.bodyData.curUseID=t}get rodData(){return this._rodData}get curRodID(){return this.rodData.curUseID}set curRodID(t){this.rodData.curUseID=t}get hatData(){return this._hatData}get curHatID(){return this.hatData.curUseID}set curHatID(t){this.hatData.curUseID=t}get jewelryData(){return this._jewelryData}get curJewelryID(){return this.jewelryData.curUseID}set curJewelryID(t){this.jewelryData.curUseID=t}preInit(){this._totalLvl=GI.gCfg.wmMaxLevel,GI.d.bindKey(this,"_videoBlastCount","shop.videoBlastCount",{local:!0,dv:0,clearTimer:!0,clear:1})}onCfgsLoaded(){this._chapterCfgs=GI.resMgr.getRes("res/chapter/chapterCfg.cfg.json"),this.scoreUiCfg=GI.resMgr.getRes("res/score/scoreUiCfg.cfg.json"),this.birdCfgs=GI.resMgr.getRes("res/role/birdCfg.cfg.json"),this.commercialCfg=GI.resMgr.getRes("res/score/commercialCfg.cfg.json"),this.soundsCfg=GI.resMgr.getRes("res/sound/soundsCfg.cfg.json"),this.initLocalData()}get checkStartLvl(){return this.curLvl>=this.getLevelsAmount(this.curChapter)?(this.curChapter<this.getChapterCount()&&this.curChapter++,1):this.curLvl+1}get canActiveCount(){return this.bodyData.canActiveCount+this.rodData.canActiveCount+this.hatData.canActiveCount+this.jewelryData.canActiveCount}get guideStep(){return this._guideStep}set guideStep(t){this._guideStep!=t&&(this._guideStep=t,GI.gMsgCet.event("Wm.guideStep"))}get isGuideScene(){return this.propGuideId>0}initLocalData(){this.initLvlData(),this.preUnlockLvl(),this.initPropData(),this.initCourseData(),this.initSignData(),this.initTimeLimitData(),this.initVideoShockwaveTimes(),this.initVipData(),this.initOfflineData(),this.initRookieWelfare()}initVideoShockwaveTimes(){0==GI.localDataMgr.getInt("ab.videoShockwaveTimes")&&GI.localDataMgr.setInt("ab.videoShockwaveTimes",0)}initSignData(){let t=new Date;GI.localDataMgr.getInt("dayGet.lastDay")!=t.getDate()&&(GI.localDataMgr.setInt("dayGet.lastDay",t.getDate()),GI.localDataMgr.setInt("dayGet.isGet",1))}initLvlData(){let t=this.chapterData,e=this.chapterCfgs;if(null!=t&&Object.keys(t).length)for(let i in e){let s=e[i].levels.length,a=t[i].levels.length;if(s<a){let e=a-s;t[i].levels.splice(s,e)}else if(s>a)for(let r=a+1;r<=s;r++){let s=e[i].levels[r-1];t[i].levels.push({id:s.id,lastScore:0,bestScore:0,lastRank:0,bestRank:0,name:s.name,locked:r==a+1&&t[i].levels[a-1]&&0==t[i].levels[a-1].locked?0:1,chestCollectCount:0})}}else{t={};for(let i in e){t[i]={locked:"1"==i?0:1,levels:[]};for(let s of e[i].levels)t[i].levels.push({id:s.id,lastScore:0,bestScore:0,lastRank:0,bestRank:0,name:s.name,locked:1==s.id?0:1,chestCollectCount:0})}}this.chapterData=t}preUnlockLvl(){let t=GI.gCfg.start_unlock_lvl;if(t){let e=this.chapterData;for(let i in e)if(t[i]){e[i].locked=0;for(let s=0;s<e[i].levels.length;s++){let a=e[i].levels[s];if(!(a.id<=t[i]))break;1==a.locked&&(a.locked=0)}}this.chapterData=e}}updateChapterData(t,e){let i=this.chapterData,s=i[this.curChapter].levels,a=!1;return i[this.curChapter].levels[this.curLvl-1].lastScore=t,i[this.curChapter].levels[this.curLvl-1].lastRank=e,t>s[this.curLvl-1].bestScore&&(a=!0,i[this.curChapter].levels[this.curLvl-1].bestScore=t),e>s[this.curLvl-1].bestRank&&(i[this.curChapter].levels[this.curLvl-1].bestRank=e),this.chapterData=i,a}isNextLvlUnlock(t,e){let i=!1,s=this.chapterData;return e>=s[t].levels.length?t<this.getChapterCount()&&s[t+1].levels.length>0&&(i=0==s[t+1].levels[0].locked):i=0==s[t].levels[e].locked,i}getLvlNum(t,e){let i=0,s=this.chapterData;for(let e=1;e<=t;e++)e!=t&&(i+=s[e].levels.length);return i+e}getLastUnlockLvl(){let t=-1,e=-1,i=this.chapterData;for(let s in i){let a=Number(s);if(1==i[a].locked){let s=0;for(let r of i[a-1].levels){if(1==r.locked){t=a-1,e=s;break}s++}-1==e&&(t=a,e=0);break}if(a==this.getChapterCount()){-1==t&&(t=a);let s=0;for(let r of i[t].levels){if(1==r.locked){t=a,e=s;break}s++}break}}return{chapter:t,lvl:e}}unlockLevel(t,e){if(0==t&&!e)return!1;let i=this.getLastUnlockLvl(),s=i.chapter,a=i.lvl,r=this.chapterData;if(-1!=s&&-1!=a){if(e){for(let t=a;t<r[s].levels.length;t++)r[s].levels[t].locked=0;r[s].locked=0}else{let e=a+t-this.getLevelsAmount(s);if(e>=0){for(let t=a;t<this.getLevelsAmount(s);t++)r[s].levels[t].locked=0;if(r[s].locked=0,s<this.getChapterCount())return this.chapterData=r,this.unlockLevel(e,!1)}else{r[s].locked=0;for(let e=a;e<a+t;e++)r[s].levels[e].locked=0}}return this.chapterData=r,GI.gMsgCet.event("ab.chapter_update"),!0}return!1}getChapterCount(){return Object.keys(this.chapterData).length}getUiCfgByEventId(t,e){if(t<this.birdCfgs.modules.datas.length){let i=this.birdCfgs.modules.datas[t].score_ui_id[e];if(null!=i)return this.scoreUiCfg[i]}return null}currentRank(t){let e=0,i=t?2*this.GameGrade:this.GameGrade,s=this.getVipPrivilege();s&&(i=Math.round(i*(1+s.extraPoint)));let a=i/this.MaxGameGrade;for(let t in GI.gCfg.rankCfg)a>=GI.gCfg.rankCfg[t]&&e++;return e}isGameLastLevel(t,e){let i=!1;return e>=this.chapterData[t].levels.length&&(i=!(t<this.getChapterCount())||this.chapterData[t+1].levels.length<=0),i}initPropData(){let t=this.props;if(null==t){t={};for(let e in this.commercialCfg.prop)t[e]={name:this.commercialCfg.prop[e].name,quantity:0,guide_done:0,start_free_done:0}}else{for(let e in t)this.commercialCfg.prop.hasOwnProperty(e)||delete t[e];for(let e in this.commercialCfg.prop)t.hasOwnProperty(e)||(t[e]={name:this.commercialCfg.prop[e].name,quantity:0,guide_done:0,start_free_done:0})}this.props=t}freeUseUpdateStats(t){let e=this.props;e[t].start_free_done=1,this.props=e}buyPropUpdateData(t){let e=this.props;e[t.type_id].quantity+=t.count,this.props=e,this.changeMoney({useOrGain:0,gemNum:t.cost,gemtype:this.commercialCfg.moneyEvtEnum.mi_buy_prop,gemdetails:""}),GI.gMsgCet.event("ab.get_prop",t),GI.gMsgCet.event("AB.SoundEvent",{eventType:7}),$t.i.reportShopAction({Item_id:t.type_id,Use_resource_type:1,Use_num:t.count})}presentUpdateData(t,e=1,i=!1){let s=this.props;s[t].quantity+=e,this.props=s,i||GI.gMsgCet.event("ab.get_prop",{type_id:t,count:e}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7}),$t.i.reportShopAction({Item_id:t,Use_resource_type:1,Use_num:e})}deductProp(t,e){let i=this.props;i[t].quantity-=e,this.props=i}usePropUpdateData(t,e){if(!e){let e=this.props;e[t].quantity>0&&(e[t].quantity--,this.props=e),$t.i.reportShopAction({Item_id:t,Use_resource_type:0,Use_num:1})}this.usingProp[t].count++,GI.gMsgCet.event("ab.use_prop",{prop_id:t}),GI.gMsgCet.event("AB.SoundEvent",{eventType:6})}resetUsingProp(){this.usingProp={};for(let t in this.props)this.usingProp[t]={count:0}}initCourseData(){let t=this.courseData;if(null==t){t={};for(let e in GI.gCfg.coursePageCfg)t[e]={show_count:0}}else{for(let e in t)GI.gCfg.coursePageCfg.hasOwnProperty(e)||delete t[e];for(let e in GI.gCfg.coursePageCfg)t.hasOwnProperty(e)||(t[e]={show_count:0})}this.courseData=t}finishPropGuide(t){let e=!1,i=this.props,s=GI.gCfg.propGuideRewardCount;return(null==i[t].guide_done||i[t].guide_done<=0)&&(e=!0,i[t].guide_done=1,this.props=i,s&&this.presentUpdateData(t,s)),e}isPropGuideAllDone(){let t=this.props;for(let e in t)if(!t[e].guide_done)return!1;return!0}firstUndoneGuideId(){let t=this.props;for(let e in t)if(!t[e].guide_done)return Number(e);return-1}changeMoney(t){0==t.useOrGain&&(t.gemNum=-t.gemNum),this.money+=t.gemNum,GI.gMsgCet.event("gem_use_or_gain",t)}initVipData(){let t=this.vipData;if(null==t){let e={};for(let t in this.commercialCfg.vipCfg)e[t]="none";t={lvl:0,exp:0,giftBag:e},this.vipData=t}}addVipExp(){if(!GI.gCfg.offline_chest_module)return;let t=Object.keys(this.commercialCfg.vipCfg).length;if(this.vipData.lvl>=t)return!1;let e=this.vipData;return e.exp++,e.exp>=this.commercialCfg.vipCfg[this.vipData.lvl+1].exp?(e.lvl++,e.lvl<t&&(e.exp=0),"none"==e.giftBag[e.lvl]&&(e.giftBag[e.lvl]="collect"),this.vipData=e,GI.gMsgCet.event("ab.vip_upgrade")):(this.vipData=e,GI.gMsgCet.event("ab.add_exp")),!0}getVipPrivilege(){return GI.gCfg.offline_chest_module&&this.commercialCfg.vipCfg[this.vipData.lvl]}initOfflineData(){GI.localDataMgr.getBool("already_enter_game")||(GI.localDataMgr.setBool("already_enter_game",!0),this.offlineInitFeather=10)}initRookieWelfare(){if(this.rookieWelfare)return;let t={};for(let e in GI.gCfg.rookieWelfare)t[e]={process:"rank"==GI.gCfg.rookieWelfare[e].key?this.getRankPercent(this.rankScore):0,maxProcess:"rank"==GI.gCfg.rookieWelfare[e].key?this.getRankPercent(this.rankScore):0,curStage:0,status:"process"};this.rookieWelfare=t}finishWelfareTask(t){if(!GI.gCfg.rookieWelfare)return;let e=this.rookieWelfare,i=GI.gCfg.rookieWelfare[t];if("rank"==i.key){if(e[t].process<=i.stages[i.stages.length-1].require)return;e[t].process=this.getRankPercent(this.rankScore),e[t].maxProcess>=e[t].process&&(e[t].maxProcess=e[t].process),e[t].status=e[t].maxProcess<=i.stages[e[t].curStage].require?"done":"process"}else{if(e[t].process>=i.stages[i.stages.length-1].require)return;e[t].process++,e[t].maxProcess<=e[t].process&&(e[t].maxProcess=e[t].process),e[t].status=e[t].maxProcess>=i.stages[e[t].curStage].require?"done":"process"}this.rookieWelfare=e,GI.gMsgCet.event("welfareRefresh")}receiveWelfareReward(t){if(!GI.gCfg.rookieWelfare)return;let e=this.rookieWelfare,i=GI.gCfg.rookieWelfare[t];if(e[t].curStage++,e[t].curStage>=i.stages.length)e[t].status="received";else{let s=0;for(let a=i.stages.length-1;a>=0;a--)if("rank"!=i.key&&e[t].maxProcess>=i.stages[a].require||"rank"==i.key&&e[t].maxProcess<=i.stages[a].require){s=a+1;break}e[t].status=e[t].curStage>=s?"process":"done"}this.rookieWelfare=e;let s=!0;for(let t in e)if("received"!=e[t].status){s=!1;break}s&&GI.localDataMgr.setBool("doneAllWelfare",!0),GI.gMsgCet.event("welfareRefresh")}clearWelfareProcess(t){if(!GI.gCfg.rookieWelfare)return;let e=this.rookieWelfare;"rank"==GI.gCfg.rookieWelfare[t].key?e[t].process=this.getRankPercent(this.rankScore):e[t].process=0,this.rookieWelfare=e}}class xt extends GI.UIViewBase{constructor(){super(...arguments),this._lockMouse=!1,this._guideDes={1:"拖动您的手指控制高跷",2:"将高跷移动到目标位置",3:"将高跷移动到目标位置",4:"走一步",5:"走到检查点",6:"走到第二个检查点",7:"跨过障碍",8:"走到终点"},this._guideStep=1}createPanel(){this._layer=GI.UiLayerEnum.base,this.createPanelUI("WmCtrGuideView"),this.makeFullScreen()}doBindEvt(){let t=this.u("ctrlArea");this.bindUiEvt(t,Laya.Event.MOUSE_DOWN,t=>{this.mgr.canPlay&&!this._lockMouse&&(GI.gMsgCet.event("wmCtrl.MOUSE_DOWN",t),this.u("handGuide").visible&&(this.u("handGuide").asCom.getTransition("ani").stop(),this.u("handGuide").visible=!1))}),this.bindUiEvt(t,Laya.Event.MOUSE_UP,t=>{this.mgr.canPlay&&!this._lockMouse&&GI.gMsgCet.event("wmCtrl.MOUSE_UP",t)}),this.bindUiEvt(t,Laya.Event.MOUSE_OUT,t=>{this.mgr.canPlay&&!this._lockMouse&&GI.gMsgCet.event("wmCtrl.MOUSE_OUT",t)}),this.bindGEvt("Wm.money2",()=>{this.u("txtGold").asLabel.text=this.mgr.money2.toString()},!0),this.bindUiClick("btnBack",()=>{this.mgr.returnToLvl()}),this.bindGFetch("SysMainUI.Coin.Pos",()=>this.u("imgCoin").localToGlobal()),this.bindGEvt("Wm.onLvlEnd",this.hideSelf),this.bindGEvt("Wm.guideStep",this.updateGuideDes,!0),this.bindGEvt("wmCtrl.RodInPointStart",this.doPrgTw),this.bindGEvt("wmCtrl.RodInPointOut",this.clearPrgTw)}doShow(){}doPrgTw(){this.clearPrgTw(),this._prgTw=GI.Tween.fromTo(this.u("prg").asCom.getChild("bar"),{alpha:0},{alpha:1},600,null,GI.handle(this,()=>{this._prgTw=null}))}clearPrgTw(){this._prgTw&&(this._prgTw.clear(),this._prgTw=null),this.u("prg").asCom.getChild("bar").alpha=0}updateGuideDes(){switch(this.u("prg").visible=this.mgr.data.guideStep>=2&&this.mgr.data.guideStep<=3,this.u("txtDesBg").visible=this.u("imgOkBg").visible=!0,this.mgr.data.guideStep){case 1:this.u("handGuide").visible=!0,this.u("handGuide").asCom.getTransition("ani").play(null,-1);break;case 2:case 3:this.clearPrgTw();break;case 4:this._lockMouse=!0;default:GI.timerMgr.clear(this,this.onUpdate)}if(this._guideStep==this.mgr.data.guideStep)return GI.timerMgr.clear(this,this.onUpdate),void this.updateGuideDes2();this.u("imgOkBg").asImage.color=this.u("txtDes").asLabel.color="#c5ff63",this.u("imgOk").visible=!0,GI.timerMgr.once(1e3,this,this.updateGuideDes2)}updateGuideDes2(){if(this.visible)switch(this._guideStep=this.mgr.data.guideStep,this._lockMouse=!1,this.u("txtDesBg").visible=this.u("imgOkBg").visible=!!this._guideDes[this.mgr.data.guideStep],this.u("imgOkBg").asImage.color=this.u("txtDes").asLabel.color="#ffffff",this.u("imgOk").visible=!1,this.u("txtDes").asLabel.text=this._guideDes[this.mgr.data.guideStep],this.u("imgOkBg").x=(GI.gw()-(this.u("imgOkBg").width+this.u("txtDes").asLabel.width+10))/2,this.u("txtDes").x=this.u("imgOkBg").x+this.u("imgOkBg").width+10,this.mgr.data.guideStep){case 4:GI.uiViewMgr.showView("WmGuideView")}}onUpdate(){let t=this.globalToLocal(this.mgr.camera.scToUi(this._prgGPt));this.u("prg").setXY(t.x,t.y)}}class kt extends GI.UIViewBase{constructor(){super(...arguments),this.startClick=!1,this.fastClickCount=0,this.maxClickCount=8,this.alreadyShowAd=!1}createPanel(){this.needMask=!0,this.createPanelUI("WmRewardView"),this.makeFullScreen(),this.chestTrembleAni=this.panel.getTransition("chest_tremble"),this.panel.getTransition("ui_enter").play(),this.hideAd()}doBindEvt(){this.bindUiClick("btnOpenChest",this.ClickOpenChestBtn),this.bindUiClick("btnNextStep",this.nextStep)}doShow(){this.u("bottom").visible=!0,this.panel.getTransition("ui_enter").play()}doHide(){}ClickOpenChestBtn(){let t=Date.now();if(this.chestTrembleAni.playing||this.chestTrembleAni.play(),this.startClick)if(this.clickInterval=t-this.currentTime,this.currentTime=t,this.clickInterval<500){this.fastClickCount++;let t=Math.random()*this.maxClickCount-1;!this.alreadyShowAd&&this.fastClickCount>=t&&(this.popAd(),setTimeout(()=>{this.hideAd()},2e3)),this.fastClickCount>=this.maxClickCount&&this.OpenChest()}else this.fastClickCount=1;else this.startClick=!0,this.currentTime=t,this.fastClickCount=1}OpenChest(){this.u("bottom").visible=!1,this.panel.getTransition("open_chest").play()}popAd(){this.alreadyShowAd=!0}hideAd(){}afterShowAd(){this.hideAd(),this.OpenChest()}nextStep(){this.hideSelf(),GI.uiViewMgr.showView("WmSucView")}}class Dt{preInit(){}initRole(t=230,e=710){}RemoveRole(){}GetMousePos(){let t=Laya.Point.create();return t.x=Laya.stage.mouseX,t.y=Laya.stage.mouseY,t}onUpdate(){}StartPhysicsDebug(){ie.physicsDebug&&Laya.PhysicsDebugDraw.enable(-1)}UpdatePhysicsRun(){ie.physicsDebug&&null!=Laya.PhysicsDebugDraw.I&&(Laya.PhysicsDebugDraw.I.x=GI.sceneMgr.worldRoot.x,Laya.PhysicsDebugDraw.I.y=GI.sceneMgr.worldRoot.y,Laya.PhysicsDebugDraw.I.scaleX=GI.sceneMgr.worldRoot.scaleX,Laya.PhysicsDebugDraw.I.scaleY=GI.sceneMgr.worldRoot.scaleY)}AddInRigidWorld(t,e=-1){null!=t&&(e>=0?GI.sceneMgr.worldRoot.addChildAt(t,e):GI.sceneMgr.worldRoot.addChild(t))}Clamp(t,e,i){return t<e?t=e:t>i&&(t=i),t}}class Bt extends Laya.Script{constructor(){super(),this.roleUrl="res/role/Rabit_jump.sk",this.crouchedCollDatas=[],this.standingDatas=["18,98,48,82,38,97,51,126,22,133,17,120,14,108","24,133,52,126,52,157,46,169,26,173,20,163"],this.crouched=!0}SetCrouched(t){this.crouched=t,this.roleJumpSkil.play(0,!1);let e=this.role.getComponents(Laya.PolygonCollider);for(let t=0;t<e.length;++t){let i=e[t];"PolygonCollider"!=i.label&&i.destroy()}if(this.crouched){this.roleJumpSkil.index=11;let t=this.role.addComponent(Laya.PolygonCollider);t.points=this.crouchedCollDatas[0],t.label="1",t.density=8,t.friction=5e3;let e=this.role.addComponent(Laya.PolygonCollider);e.points=this.crouchedCollDatas[1],e.label="2",e.density=8,e.friction=5e3}else{this.roleJumpSkil.index=6;let t=this.role.addComponent(Laya.PolygonCollider);t.points=this.standingDatas[0],t.label="1",t.density=8,t.friction=5e3;let e=this.role.addComponent(Laya.PolygonCollider);e.points=this.standingDatas[1],e.label="2",e.density=8,e.friction=5e3}}InitRole(){let t=this.role.getChildByName("node");this.roleJumpSkil=t.getChildByName("jump"),this.StopRodAnim();let e=this.role.getComponents(Laya.PolygonCollider);for(let t=0;t<e.length;++t){let i=e[t];"1"==i.label?this.crouchedCollDatas[0]=i.points:"2"==i.label?this.crouchedCollDatas[1]=i.points:"3"==i.label?this.standingDatas[0]=i.points:"4"==i.label&&(this.standingDatas[1]=i.points)}}GetContactEdge(t){let e=new Array;if(null!=t){let i=t.body.GetContactList();for(;null!=i;)e.push(i),i=i.next}return e}RemoveRole(){te.RemoveNodes(this.role),this.role.destroy(),this.role=null}IsInRod(){return this.GetContactEdge(this.roleJumpJc).length>0}StopRodAnim(){null!=this.roleJumpSkil.player?this.roleJumpSkil.player.stop():GI.timerMgr.once(5,this,t=>{this.StopRodAnim()})}get x(){return this.role.x}get y(){return this.role.y}set x(t){this.role.x=t}set y(t){this.role.y=t}get IsCrouched(){return this.crouched}get IsKinematic(){return"kinematic"==this.roleRigid.type}}!function(t){t[t.UP=87]="UP",t[t.Down=83]="Down",t[t.Left=65]="Left",t[t.Right=68]="Right"}(ft||(ft={}));class Tt extends Dt{constructor(){super(...arguments),this.RollTorqueCrouching=60,this.RollTorqueStanding=75,this.JumpForce=12,this.JumpCooldownTime=12,this.MaxRoleTorqueSpeed=4.5,this.MinRoleTorqueSpeed=1,this.RoleTorqueSpeed=0,this.rolePrefabData=null,this.rolePath="res/role/role.json",this.doJump=!0,this.Alive=!0,this.isMouseDown=!1,this.addX=0,this.RoleX=0,this.mousex=0}get roleX(){return this.role?this.role.x:-1}get roleY(){return this.role?this.role.y:-1}preInit(){GI.gMsgCet.off("Su.SuRoleTorqu",this,this.SuRoleTorqu),GI.gMsgCet.on("Su.SuRoleTorqu",this,this.SuRoleTorqu),GI.gMsgCet.off("Su.StartRoleStartTorqu",this,this.StartRoleStartTorqu),GI.gMsgCet.on("Su.StartRoleStartTorqu",this,this.StartRoleStartTorqu),GI.gMsgCet.off("Su.EndRoleStartTorqu",this,this.EndRoleStartTorqu),GI.gMsgCet.on("Su.EndRoleStartTorqu",this,this.EndRoleStartTorqu)}InitAttribute(){this.Alive=!0,this.doJump=!0,this.isMouseDown=!1}SuRoleTorqu(t){this.RoleTorqueSpeed=t>=53?this.MaxRoleTorqueSpeed/50*t-this.MaxRoleTorqueSpeed:t<=47?this.MaxRoleTorqueSpeed/47*t-this.MaxRoleTorqueSpeed:0}StartRoleStartTorqu(){this.isMouseDown=!0,this.RoleTorqueSpeed=0}EndRoleStartTorqu(){this.isMouseDown=!1,this.onJump()}initRole(t=230,e=710){if(this.InitAttribute(),null==this.rolePrefabData){let i=[{url:this.rolePath,type:Laya.Loader.JSON}];Laya.loader.load(i,Laya.Handler.create(this,i=>{this.rolePrefabData=Laya.loader.getRes(this.rolePath),this.CreateRoles(t,e)}))}else this.CreateRoles(t,e);this.StartPhysicsDebug()}CreateRoles(t=230,e=710){let i=new Laya.Prefab;i.json=this.rolePrefabData;let s=i.create();this.role=s.getComponent(Bt),s.x=t,s.y=e,this.role.InitRole(),this.AddInRigidWorld(s)}RemoveRole(){null!=this.role&&this.role.RemoveRole(),this.role=null}onJump(){if(!(0==this.doJump&&GI.timerMgr.currFrame-this.JumpTime<this.JumpCooldownTime)){if(this.role.IsInRod()){let t=.0174532924*this.role.role.rotation,e=this.JumpForce*Math.sin(t),i=this.JumpForce*Math.cos(t);this.role.roleRigid.body.m_linearVelocity.y=-i,this.role.roleRigid.body.m_linearVelocity.x=e}this.doJump=!1,GI.timerMgr.clear(this,this.JumpAnimEnd),this.role.SetCrouched(!1),GI.timerMgr.frameOnce(6,this,this.JumpAnimEnd)}}JumpAnimEnd(){this.role.SetCrouched(!0)}onRoll(t){t=this.Clamp(t,-1,1),this.role.IsCrouched?this.role.roleRigid.applyTorque(this.RollTorqueCrouching*-t*GI.timerMgr.delta):this.role.roleRigid.applyTorque(this.RollTorqueStanding*-t*GI.timerMgr.delta)}OnMouseRun(){this.isMouseDown&&(this.role.roleRigid.body.m_angularVelocity=this.RoleTorqueSpeed)}onUpdate(){this.UpdatePhysicsRun(),this.OnMouseRun()}}class At{constructor(t,e,i){this.isPlaying=!1,this.dataQueue=new Vt,this.panel=e,this.transitionCallback=i}addData(t){let e=this.getConfigData(t);return e&&this.dataQueue.Enqueue(t),e}getConfigData(t){for(let e in GI.gCfg.hintConfig.infoTypes)if(e==t.infoCfg.infoType)return this.infoType=GI.gCfg.hintConfig.infoTypes[e],this.infoType.id=t.infoType,!0;return GI.log("HintView.ts -> 未找到hint配置"),!1}loopPlay(){this.isPlaying||this.dataQueue.IsEmpty()||(this.isPlaying=!0,this.playAniFunc(),GI.timerMgr.loop(this.infoType.showInterval,this,this.playAniFunc))}playAniFunc(){if(this.dataQueue.IsEmpty())return this.isPlaying=!1,void GI.timerMgr.clear(this,this.playAniFunc);let t=this.dataQueue.Dequeue(),e=this.uiPoolDequeue();null==e&&(e=GI.uiViewMgr.createUiObj("HintText").asCom,this.panel.addChild(e)),e.getChild("hintText").text=t.info,e.getTransition(this.infoType.ani).play(GI.handle(this,()=>{this.uiPoolEnqueue(e),this.transitionCallback&&this.transitionCallback()}))}uiPoolEnqueue(t){this.uiQueues||(this.uiQueues=new Vt),this.uiQueues.Enqueue(t)}uiPoolDequeue(){let t=this.uiQueues;return t&&t.Count()>0?t.Dequeue():null}}class Vt{constructor(){this.item=[]}Enqueue(t){this.item.push(t)}Dequeue(){return this.IsEmpty()?null:this.item.shift()}Count(){return this.item.length}IsEmpty(){return this.Count()<=0}Clear(){this.item=[]}}class Et extends GI.UIViewBase{constructor(){super(...arguments),this.allMessages={}}createPanel(){this.autoShowOnGShow=!1,this._layer=GI.UiLayerEnum.info,this.createPanelUI("HintView"),this.initData()}initData(){this.clickCount=0}doShow(t){if(null==t)return void this.hideSelf();let e=this.allMessages[t.infoCfg.infoType];null==e&&(e=new At(t,this.panel,()=>{this.clickCount--,this.clickCount<=0&&(this.clickCount=0,delete this.allMessages[t.infoCfg.infoType],this.hideSelf())}),this.allMessages[t.infoCfg.infoType]=e),e.addData(t)&&(this.clickCount++,e.loopPlay())}}class Ut{static CreateBezierPoints(t,e){for(var i=[],s=0;s<e;s++){var a=this.MultiPointBezier(t,s/e);i.push(a)}return i}static MultiPointBezier(t,e){let i=t.length,s=0,a=0;for(let r=0;r<i;r++){let o=t[r];s+=o.x*Math.pow(1-e,i-1-r)*Math.pow(e,r)*this.erxiangshi(i-1,r),a+=o.y*Math.pow(1-e,i-1-r)*Math.pow(e,r)*this.erxiangshi(i-1,r)}return{x:s,y:a}}static erxiangshi(t,e){let i=1,s=1;for(;e>0;)i*=t,s*=e,t--,e--;return i/s}}class Ot{constructor(t){this.IsTriggerFirst=!0,this.BirdId=0,this.density=10,this.friction=.2,this.gravity=1,this.angularDamping=.2,this.BirdNum=1,this.BirdAnimNum=1,this.isInLauncher=!1,this.birdType=w.RedBird,this.MaxSpeed={x:13,y:25},this.MinSpeed={x:7,y:15},this.size={x:50,y:50},this.rubberNum=6,this.trackIdx=0,this.isCanMouse=!1,this.removeTime=240,this.IsRemoveTime=!1,this.IsTrigger=!1,this.grage=0,this.grageId=5,this.isBiggerBird=!1,this.BiggerBirdNum=2,this.zayanIdx=0,this.rotationSeep=0,this.isRotation=!1,this.BirdRunBezierDatas=null,this.jiaoIdx=0,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=0,this.BirdId=t}InitBird(t,e,i,s,a="normal"){this.launcher=s;let r=new Laya.Prefab;r.json=i;let o=r.create();this.birdSprite=o,this.presentType=a;let n=$t.i.data.BirdCfgs.birds[this.birdType];this.grageId=n.moduleId,this.MaxSpeed=n.MaxSpeed,this.MinSpeed=n.MinSpeed,this.density=n.density,this.friction=n.friction,this.gravity=n.gravity,this.angularDamping=n.angularDamping,this.friction=n.friction;let h=$t.i.data.ModuleCfgs.datas[this.grageId];this.grage=h.grage,this.InitGetAllBirds(),this.IsTriggerFirst=!0,this.isCanMouse=!1,this.IsTrigger=!1,this.IsRemoveTime=!1,$t.i.data.MaxGameGrade=$t.i.data.MaxGameGrade+this.grage,s.AddInRigidWorld(this.birdSprite,3),this.bird1.pos(t-this.bird1.pivotX,e-this.bird1.pivotY),this.worldPoint=Laya.Point.create(),this.worldPoint.setTo(this.bird1.x,this.bird1.y),this.OnInitBird(),GI.timerMgr.clear(this,this.UpdateBirdRun),GI.timerMgr.frameOnce(150,this,this.UpdateBirdRun)}OnInitBird(){}ToLauncherInit(){this.bird1.x=this.iPosX,this.bird1.y=this.iPosY,GI.timerMgr.clear(this,this.BirdRun),this.bird1.rotation=0,this.isInLauncher=!0}ToLauncher(){this.ToLauncherInit(),this.birdRigid.type="kinematic",this.PlayLauncher()}BirdVictory(){this.Jump();let t=Laya.Point.create();t.setTo(this.bird1.width/2,this.bird1.height/2),$t.i.data.AddGrade(this.grage),t=this.bird1.localToGlobal(t,!1,GI.sceneMgr.worldRoot),GI.gMsgCet.event("AddGameGrade",{grage:this.grage,isBird:!0,id:this.grageId,point:{x:t.x,y:t.y},score_type:"destroy"})}UpdateBirdRun(){if(null!=this.bird1){if(this.isInLauncher)Math.random()>.35?this.SquintPhiz():this.ShoutPhiz();else{let t=Math.random();t<.3?(this.SquintPhiz(),this.Jump()):t<.6?this.JumpBirdPhiz():this.ShoutPhiz()}GI.timerMgr.frameOnce(150*Math.random()+100,this,this.UpdateBirdRun)}}InitGetAllBirds(){this.birdRigids=[],this.birdObjList=[],this.birdAnimObjes=[];for(let t=0;t<this.BirdNum;++t){let e=this.birdSprite.getChildByName("bird"+(t+1)),i=e.getComponent(Laya.RigidBody),s=e.getComponents(Laya.ColliderBase);for(let t=0;t<s.length;++t)s[t].density=this.density,s[t].friction=this.friction,s[t].label=this.BirdId+"";0==t?(this.bird1=e,this.iPosX=this.bird1.x,this.iPosY=this.bird1.y,this.birdRigid=i):(e.alpha=0,e.active=!1),this.birdObjList.push(e),this.birdRigids.push(i),this.InitGetBirdAnim(e),i.linearDamping=0,i.category=2,i.mask=1,i.allowSleep=!0,i.angularDamping=this.angularDamping,i.gravityScale=this.gravity,i.bullet=!0,i.type="kinematic"}}InitGetBirdAnim(t){let e=[];for(let i=0;i<this.BirdAnimNum;++i){let s=t.getChildByName("bird"+i);e.push(s),i>0&&(s.alpha=0)}this.birdAnimObjes.push(e)}GetWorldPoint(){let t=Laya.Point.create();t.setTo(this.bird1.x,this.bird1.y);let e=GI.sceneMgr.worldRoot;return(t=this.bird1.localToGlobal(t,!1,e)).x+=this.bird1.width/2*this.bird1.scaleX,t.y+=this.bird1.height/2*this.bird1.scaleY,t}ToWorld(){let t=this.GetWorldPoint();this.launcher.AddInRigidWorld(this.bird1,3),this.bird1.pos(t.x,t.y)}GetBirdSpeed(t,e,i){var s=Laya.Point.create();let a=t.distance(0,0),r=t.y/a,o=t.x/a;return s.x=o*this.MaxSpeed.x*e*i*1.5,s.y=r*this.MaxSpeed.y*e*1.6,s}RunBird(t,e,i){this.IsTriggerFirst=!0,GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.clear(this,this.UpdateBirdRun),this.birdRigid.type="dynamic",Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun),this.bird1.on(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter,[0]),this.ToWorld();let s=this.GetBirdSpeed(t,e,i);this.birdRigid.linearDamping=0,this.birdRigid.body.m_linearVelocity.x=s.x,this.birdRigid.body.m_linearVelocity.y=s.y,GI.timerMgr.clear(this,this.OnRunTrackLink),this.trackIdx=1,GI.timerMgr.frameLoop(3,this,this.OnRunTrackLink),GI.timerMgr.clear(this,this.RemoveJC),GI.timerMgr.frameOnce(400,this,this.RemoveJC),this.OnRunTrackLink(),this.RunPhiz(),$t.i.GameMgr.AddRunBird(this),D.startGameTime=!0,GI.gMsgCet.event("bird_eject",[[this.isBiggerBird,this.birdType==w.ShockWaveBird]]),null!=this.effectMoFaYaoShui&&(this.effectMoFaYaoShui.load(this.launcher.GetEffectByType(It.MoFaYaoFS)),this.effectMoFaYaoShui.x=0)}RemoveJC(){this.RemoveBird()}OnRunTrackLink(){for(let t=0;t<this.birdObjList.length;++t)this.birdObjList[t].alpha>0&&this.CreateTrack(t);this.trackIdx++}CreateSkeleton(){var t=new Laya.Skeleton;return this.bird1.addChild(t),t.pos(this.bird1.pivotX,this.bird1.pivotY),t}StartBiggerBird(){if(this.isBiggerBird)return!1;this.isBiggerBird=!0;for(let e=0;e<this.birdObjList.length;++e){this.birdObjList[e].scaleX=this.BiggerBirdNum,this.birdObjList[e].scaleY=this.BiggerBirdNum;let i=this.birdObjList[e].getComponent(Laya.ColliderBase);var t=this.birdObjList[e].active;this.birdObjList[e].active=!0,i.refresh(),i.resetShape(!0),i.refresh(),this.birdObjList[e].active=t,null==this.effectMoFaYaoShui&&(this.effectMoFaYaoShui=this.CreateSkeleton()),this.effectMoFaYaoShui.load(this.launcher.GetEffectByType(It.MoFaYaoCX),GI.handle(this,()=>{this.effectMoFaYaoShui&&this.effectMoFaYaoShui.play(0,!0)}))}return!0}CreateTrack(t){let e=this.birdObjList[t];this.CreateTrackByObj(e)}CreateTrackByObj(t){if(1==t.alpha){let e=Laya.Point.create();e.setTo(t.pivotX,t.pivotY),e=t.localToGlobal(e,!1,GI.sceneMgr.worldRoot),this.launcher.trackCtrl.CreateTrack(e.x,e.y,this.trackIdx)}}OnMouseDownRun(){for(let t=0;t<this.birdObjList.length;++t)this.PlayEffect(t,"mou_eff");return Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun),!this.IsTrigger&&(0==this.isCanMouse&&(this.isCanMouse=!0,this.MousePhiz()),this.PlaySkillSound(),!0)}OnTriggerEnter(t,e){null!=e&&null!=e.owner&&(null!=e.owner.getComponent(D)&&null!=e.owner.getComponent(Ot)||this.PlayTriggerSound()),null!=this.effectMoFaYaoShui&&(this.effectMoFaYaoShui.destroy(),this.effectMoFaYaoShui=null),this.IsTriggerFirst=!1,this.isCanMouse=!0,GI.timerMgr.clear(this,this.RemoveJC),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun),this.IsTrigger=!0,0==this.IsRemoveTime&&(this.launcher.isCmeraToBird=!1,this.StartRemoveCountdown(),GI.timerMgr.clear(this,this.OnRunTrackLink),this.launcher.trackCtrl.RemoveOldLink(),this.TriggerPhiz())}StartRemoveCountdown(){this.IsRemoveTime||(this.IsRemoveTime=!0,GI.timerMgr.clear(this,this.RemoveBird),GI.timerMgr.frameOnce(this.removeTime,this,this.RemoveBird))}PlayEffect(t,e="die_eff"){1==this.birdObjList[t].alpha&&this.PlayEffectByObj(this.birdObjList[t],e)}PlayEffectByObj(t,e="die_eff"){let i=$t.i.data.BirdCfgs.birds[this.birdType][e];null!=i?GI.gMsgCet.event("ab.PlayEffect",[i.url,t.x,t.y,t.rotation,i.scaleX,i.scaleY]):console.error("PlayEffect  错误")}RemoveBird(){if(this.PlayDieSound(),GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.clear(this,this.RemoveJC),GI.timerMgr.clear(this,this.RemoveBird),GI.timerMgr.clear(this,this.ReductionPhiz),GI.timerMgr.clear(this,this.OnRunTrackLink),GI.timerMgr.clear(this,this.UpdateBirdRun),$t.i.GameMgr.RemoveRunBird(this),null!=this.bird1){if(null!=this.effectMoFaYaoShui&&(this.effectMoFaYaoShui.destroy(),this.effectMoFaYaoShui=null),null!=this.effectChonJIBo&&(this.effectChonJIBo.destroy(),this.effectChonJIBo=null),this.bird1.off(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter),null!=this.bird1.parent)for(let t=0;t<this.birdObjList.length;++t)this.PlayEffect(t),te.RemoveNodes(this.birdObjList[t]),this.birdObjList[t].active=!0,this.birdObjList[t].destroy(!0);this.birdRigids=[],this.birdObjList=[],this.birdAnimObjes=[],this.birdSprite.destroy(!0),this.birdSprite=null,this.bird1=null}}ReductionPhiz(t=0){this.CloseAllPhiz(t),this.birdAnimObjes[t][0].alpha=1}CloseAllPhiz(t=0){if(null!=this.bird1)for(let e=0;e<this.birdAnimObjes[t].length;++e)this.birdAnimObjes[t][e].alpha=0}get birdX(){return this.bird1?this.bird1.x:-1}get birdY(){return this.bird1?this.bird1.y:-1}SquintPhiz(t=0){if(null==this.bird1)return;this.CloseAllPhiz(t),GI.timerMgr.clear(this,this.ReductionPhiz),this.birdAnimObjes[t][this.zayanIdx].alpha=1,GI.timerMgr.frameOnce(10,this,this.ReductionPhiz)}JumpBirdPhiz(){var t=[],e={x:this.bird1.x,y:this.bird1.y};t.push({x:this.bird1.x,y:this.bird1.y}),t.push({x:this.bird1.x,y:this.bird1.y-200}),t.push({x:this.bird1.x,y:this.bird1.y}),this.BirdRunBezierDatas=Ut.CreateBezierPoints(t,25),this.BirdRunBezierDatas.push(e),this.bird1.rotation=0,this.rotationSeep=Math.random()>.5?360/26:-360/26,this.isRotation=!0,GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.frameLoop(1,this,this.BirdRun)}Jump(){this.BirdRunAnim()}BirdRunAnim(){var t=[],e={x:this.bird1.x,y:this.bird1.y};t.push({x:this.bird1.x,y:this.bird1.y}),t.push({x:this.bird1.x,y:this.bird1.y-7}),t.push({x:this.bird1.x,y:this.bird1.y}),this.isRotation=!1,this.BirdRunBezierDatas=Ut.CreateBezierPoints(t,10),this.BirdRunBezierDatas.push(e),t.length=0,t.push({x:this.bird1.x,y:this.bird1.y}),t.push({x:this.bird1.x,y:this.bird1.y-200}),t.push({x:this.bird1.x,y:this.bird1.y}),this.BirdRunBezierDatas=this.BirdRunBezierDatas.concat(Ut.CreateBezierPoints(t,25)),this.BirdRunBezierDatas.push(e),GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.frameLoop(1,this,this.BirdRun)}BirdRun(){if(this.isRotation&&(this.bird1.rotation+=this.rotationSeep),null!=this.BirdRunBezierDatas&&this.BirdRunBezierDatas.length>0){let t=this.BirdRunBezierDatas.pop();this.bird1.pos(t.x,t.y)}else this.isRotation=!1,this.bird1.rotation=0,GI.timerMgr.clear(this,this.BirdRun)}ShoutPhiz(t=0){this.PlayStandbySound(),this.CloseAllPhiz(t),GI.timerMgr.clear(this,this.ReductionPhiz),this.birdAnimObjes[t][this.jiaoIdx].alpha=1,GI.timerMgr.frameOnce(20,this,this.ReductionPhiz)}RunPhiz(t=0){this.PlayRun(),this.CloseAllPhiz(t),this.birdAnimObjes[t][this.feiIdx].alpha=1}MousePhiz(t=0){let e=this.birdAnimObjes[t][this.mouseIdx];null!=e&&(this.CloseAllPhiz(t),e.alpha=1)}TriggerPhiz(t=0){this.CloseAllPhiz(t),this.birdAnimObjes[t][this.triggerIdx].alpha=1}PlayTriggerSound(){this.PlayBirdSound(1)}PlayRun(){this.PlayBirdSound(2)}PlayLauncher(){}PlaySkillSound(){this.PlayBirdSound(4)}PlayStandbySound(){this.PlayBirdSound(5)}PlayDieSound(){this.PlayBirdSound(6)}PlayBirdSound(t){GI.gMsgCet.event("AB.BirdSound",[this.grageId,t])}}class Nt extends Ot{constructor(){super(...arguments),this.BirdAnimNum=5,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.density=10}InitBird(t,e,i,s){e+=28,super.InitBird(t,e,i,s)}OnMouseDownRun(){return!0}}class Ft extends Ot{constructor(){super(...arguments),this.birdType=w.AvatarBird,this.BirdAnimNum=4,this.BirdNum=3,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=3}InitBird(t,e,i,s){e+=15,t-=20,super.InitBird(t,e,i,s)}OnMouseDownRun(){let t=super.OnMouseDownRun();if(t){let t=GI.sceneMgr.worldRoot,e=this.birdRigid.body.m_linearVelocity.x,i=this.birdRigid.body.m_linearVelocity.y+3;for(let s=1;s<this.birdObjList.length;++s)t.addChild(this.birdObjList[s]),this.birdObjList[s].alpha=1,this.birdObjList[s].active=!0,this.birdObjList[s].pos(this.bird1.x,this.bird1.y),this.birdRigids[s].enabled=!0,this.birdRigids[s].type="dynamic",this.birdRigids[s].body.m_linearVelocity.x=e,this.birdRigids[s].body.m_linearVelocity.y=i,this.birdObjList[s].on(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter,[s]),i-=6}return t}}class Ht extends Ot{constructor(){super(...arguments),this.birdType=w.BombBird,this.BirdAnimNum=7,this.BombForce=13,this.range=5,this.dieRange=1,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.removeTime=350,this.density=30,this.isBomb=!1}InitBird(t,e,i,s){e+=60,super.InitBird(t,e,i,s)}OnMouseDownRun(){let t=super.OnMouseDownRun();return this.RemoveBird(),t}OnTriggerEnter(t,e){0==this.IsRemoveTime&&(GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.frameOnce(60,this,this.OnBombDJS)),super.OnTriggerEnter(t,e),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun)}OnBombDJS(){this.CloseAllPhiz(),this.birdAnimObjes[0][5].alpha=1,GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.frameOnce(50,this,this.OnBombDJS2)}OnBombDJS2(){this.isBomb||(this.CloseAllPhiz(),this.birdAnimObjes[0][6].alpha=1,GI.timerMgr.clear(this,this.OnBombDJS3),GI.timerMgr.frameOnce(30,this,this.OnBombDJS3))}OnBombDJS3(){this.isBomb||(this.CloseAllPhiz(),this.RemoveBird())}RemoveBird(){GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.clear(this,this.OnBombDJS3),this.DetonatedBomb(),super.RemoveBird()}DetonatedBomb(){if(this.isBomb)return;$t.i.roleCtrl.isCmeraToBird=!1,this.isBomb=!0;for(var t=this.birdRigid.body.GetWorldCenter(),e=new Laya.Physics.I.box2d.b2Vec2,i=new Laya.Physics.I.box2d.b2Vec2,s=(this.dieRange,this.dieRange,0);s<=100;s++){var a=3.6*s,r=new Laya.Physics.I.box2d.b2RayCastInput;r.p1=t,r.p2.Set(t.x+this.range*Math.cos(a),t.y+this.range*Math.sin(a)),r.maxFraction=1;for(var o=new Laya.Physics.I.box2d.b2RayCastOutput,n=Laya.Physics.I.world.GetBodyList();n;n=n.GetNext()){var h=n.GetFixtureList();if(h)if(h.RayCast(o,r)){e.Copy(r.p1),i.Copy(r.p2),i.SelfSub(e),i.SelfMul(o.fraction),e.SelfAdd(i);var l=new Laya.Physics.I.box2d.b2Vec2;l.Copy(e),l.SelfSub(t);{let t=new Laya.Physics.I.box2d.b2Vec2(l.x*(1-o.fraction)*this.BombForce,l.y*(1-o.fraction)*this.BombForce);if(null!=h.collider&&null!=h.collider.owner){let e=h.collider.owner.getComponent(D);null!=e&&e.OnBoomerang(t.x+t.y)}n.ApplyLinearImpulseToCenter(t)}}}}}}class qt extends Ot{constructor(){super(...arguments),this.BirdAnimNum=5,this.BirdNum=2,this.BombForce=6,this.range=3,this.dieRange=1.5,this.birdType=w.EggBird,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.density=20,this.eggPoint={x:0,y:0},this.removeTime=180}InitBird(t,e,i,s){e+=55,super.InitBird(t,e,i,s)}OnInitBird(){this.egg=this.birdSprite.getChildByName("egg"),this.egg.alpha=0,this.eggRigid=this.egg.getComponent(Laya.RigidBody),this.eggRigid.linearDamping=.2,this.eggRigid.category=2,this.eggRigid.gravityScale=2,this.eggRigid.mask=1,this.eggRigid.type="kinematic",this.eggRigid.allowSleep=!0,this.egg.active=!1,this.bird4=this.birdSprite.getChildByName("birdbian"),this.bird4.alpha=0,this.brid4Rigid=this.bird4.getComponent(Laya.RigidBody),this.brid4Rigid.linearDamping=.2,this.brid4Rigid.category=2,this.brid4Rigid.gravityScale=2,this.brid4Rigid.mask=1,this.brid4Rigid.type="kinematic",this.brid4Rigid.allowSleep=!0,this.bird4.active=!1,this.birdbig=this.birdSprite.getChildByName("bigBirdbian"),this.birdbig.alpha=0,this.birdbigRigid=this.birdbig.getComponent(Laya.RigidBody),this.birdbigRigid.linearDamping=.2,this.birdbigRigid.category=2,this.birdbigRigid.gravityScale=2,this.birdbigRigid.mask=1,this.birdbigRigid.type="kinematic",this.birdbigRigid.allowSleep=!0,this.birdbig.active=!1}get birdX(){return this.isCanMouse?this.isBiggerBird?this.birdbig?this.birdbig.x:-1:this.bird4?this.bird4.x:-1:this.bird1?this.bird1.x:-1}get birdY(){return this.isCanMouse?this.isBiggerBird?this.birdbig?this.birdbig.y:-1:this.bird4?this.bird4.y:-1:this.bird1?this.bird1.y:-1}RemoveBird(){null!=this.egg&&(this.egg.active=!0,te.RemoveNodes(this.egg),this.egg.destroy(),this.egg=null),null!=this.bird4&&(this.bird4.active=!0,te.RemoveNodes(this.bird4),this.bird4.destroy(),this.bird4=null),null!=this.birdbig&&(this.birdbig.active=!0,te.RemoveNodes(this.birdbig),this.birdbig.destroy(),this.birdbig=null),super.RemoveBird()}OnRunTrackLink(){this.isCanMouse&&(this.isBiggerBird?this.CreateTrackByObj(this.birdbig):this.CreateTrackByObj(this.bird4)),super.OnRunTrackLink()}OnMouseDownRun(){let t=super.OnMouseDownRun();if(this.launcher.isCmeraToBird=!1,this.isCanMouse=!0,this.bird1.alpha=0,this.bird1.active=!1,t){this.CloseAllPhiz(),this.birdRigid.type="kinematic",this.birdRigid.body.m_linearVelocity.x=0,this.birdRigid.body.m_linearVelocity.y=0;let t=GI.sceneMgr.worldRoot;t.addChild(this.egg),this.egg.pos(this.bird1.x,this.bird1.y),this.egg.active=!0,this.egg.alpha=1,this.eggRigid.enabled=!0,this.eggRigid.type="dynamic",this.eggRigid.body.m_linearVelocity.x=0,this.eggRigid.body.m_linearVelocity.y=40,this.egg.on(Laya.Event.TRIGGER_ENTER,this,this.OnEggTriggerEnter),this.isBiggerBird?(t.addChild(this.birdbig),this.birdbig.pos(this.bird1.x,this.bird1.y),this.birdbig.active=!0,this.birdbig.alpha=1,this.birdbigRigid.enabled=!0,this.birdbigRigid.type="dynamic",this.birdbigRigid.body.m_linearVelocity.x=20,this.birdbigRigid.body.m_linearVelocity.y=-20,this.birdbigRigid.applyTorque(30)):(t.addChild(this.bird4),this.bird4.pos(this.bird1.x,this.bird1.y),this.bird4.active=!0,this.bird4.alpha=1,this.brid4Rigid.enabled=!0,this.brid4Rigid.type="dynamic",this.brid4Rigid.body.m_linearVelocity.x=20,this.brid4Rigid.body.m_linearVelocity.y=-20,this.brid4Rigid.applyTorque(30)),this.StartRemoveCountdown()}return t}OnEggTriggerEnter(){this.DetonatedBomb()}DetonatedBomb(){for(var t=this.eggRigid.body.GetWorldCenter(),e=new Laya.Physics.I.box2d.b2Vec2,i=new Laya.Physics.I.box2d.b2Vec2,s=0;s<=100;s++){var a=3.6*s,r=new Laya.Physics.I.box2d.b2RayCastInput;r.p1=t,r.p2.Set(t.x+1*Math.cos(a),t.y+1*Math.sin(a)),r.maxFraction=1;for(var o=new Laya.Physics.I.box2d.b2RayCastOutput,n=this.dieRange*this.dieRange,h=Laya.Physics.I.world.GetBodyList();h;h=h.GetNext()){var l=h.GetFixtureList();if(l)if(l.RayCast(o,r)){e.Copy(r.p1),i.Copy(r.p2),i.SelfSub(e),i.SelfMul(o.fraction),e.SelfAdd(i);var d=new Laya.Physics.I.box2d.b2Vec2;d.Copy(e),d.SelfSub(t);new Laya.Physics.I.box2d.b2Vec2(d.x*(1-o.fraction)*this.BombForce,d.y*(1-o.fraction)*this.BombForce);if(d.LengthSquared()<=n){if(null!=l.collider&&null!=l.collider.owner){let t=l.collider.owner.getComponent(D);null!=t&&t.MustDie()}}else{let t=new Laya.Physics.I.box2d.b2Vec2(d.x*(1-o.fraction)*this.BombForce,d.y*(1-o.fraction)*this.BombForce);null!=l.collider&&l.collider.owner,h.ApplyLinearImpulseToCenter(t)}}}}this.eggPoint.x=this.egg.x,this.eggPoint.y=this.egg.y,this.PlayEffectByObj(this.egg),te.RemoveNodes(this.egg),this.PlayBirdSound(7),this.egg.destroy(),this.egg=null}StartBiggerBird(){var t=super.StartBiggerBird();return this.bird1.active=!1,this.bird1.alpha=0,this.bird1=this.birdObjList[1],this.bird1.active=!0,this.bird1.alpha=1,this.bird1.scaleX=1,this.bird1.scaleY=1,this.birdRigid=this.birdRigids[1],this.ToLauncherInit(),t}}class Jt extends Ot{constructor(){super(...arguments),this.birdType=w.FastBird,this.BirdAnimNum=6,this.zayanIdx=2,this.BirdNum=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=4,this.triggerIdx=5}InitBird(t,e,i,s){e+=45,super.InitBird(t,e,i,s)}OnMouseDownRun(){let t=super.OnMouseDownRun();return t&&(this.birdRigid.body.m_linearVelocity.x+=15),t}StartBiggerBird(){var t=super.StartBiggerBird();return this.bird1.alpha=0,this.bird1.active=!1,this.bird1=this.birdObjList[1],this.bird1.alpha=1,this.bird1.active=!0,this.bird1.scaleX=1,this.bird1.scaleY=1,this.birdRigid=this.birdRigids[1],this.ToLauncherInit(),t}}class jt{constructor(){this.trackPath={0:"role/angerbird/Track1.PNG",1:"role/angerbird/Track2.PNG",2:"role/angerbird/Track3.PNG",3:"role/angerbird/mzx.png"},this.trackSzie={0:{x:9,y:9},1:{x:16,y:11},2:{x:14,y:13},3:{x:16,y:16}},this.birdRun=null,this.poolParent=null,this.trackListPool=[],this.trackList1=[],this.trackList2=[],this.aimList=[]}InitTrack(){null==this.poolParent&&(this.poolParent=new Laya.Sprite,GI.sceneMgr.worldRoot.addChild(this.poolParent),this.poolParent.pos(-1e3,-1e4)),null==this.birdRun&&(this.birdRun=new Laya.Sprite,GI.sceneMgr.worldRoot.addChild(this.birdRun),this.birdRun.pos(0,0)),this.RemoveAllTracks()}CreateTrack(t,e,i){let s=this.GetTrack();this.birdRun.addChild(s);let a=i%3;s.loadImage(this.trackPath[a]),s.width=this.trackSzie[a].x,s.height=this.trackSzie[a].y,s.pivot(this.trackSzie[a].x/2,this.trackSzie[a].y/2),s.pos(t,e),this.trackList1.push(s)}RemoveOldLink(){this.trackList1.length>0&&(this.RecycleList(this.trackList2),this.trackList2=this.trackList1,this.trackList1=[])}CreateAim(t,e){let i=this.GetTrack();this.birdRun.addChild(i);i.loadImage(this.trackPath[3]),i.width=this.trackSzie[3].x,i.height=this.trackSzie[3].y,i.pivot(this.trackSzie[3].x/2,this.trackSzie[3].y/2),i.pos(t,e),this.aimList.push(i)}RemoveAim(){this.RecycleList(this.aimList),this.aimList=[]}RemoveAllTracks(){for(this.RecycleList(this.trackList2),this.RecycleList(this.trackList1),this.RemoveAim();this.trackListPool.length>0;){this.trackListPool.pop().destroy(!0)}}GetTrack(){return this.trackListPool.length>0?this.trackListPool.pop():new Laya.Sprite}RecycleList(t){for(;t.length>0;){let e=t.pop();this.poolParent.addChild(e),e.pos(0,0),this.trackListPool.push(e)}}}class Wt extends Ot{constructor(){super(...arguments),this.BirdAnimNum=3,this.zayanIdx=2,this.jiaoIdx=1,this.BirdNum=2,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=0,this.density=20,this.birdType=w.BigRedBird}InitBird(t,e,i,s){e+=28,super.InitBird(t,e,i,s)}StartBiggerBird(){var t=super.StartBiggerBird();return this.bird1.alpha=0,this.bird1.active=!1,this.bird1=this.birdObjList[1],this.bird1.alpha=1,this.bird1.active=!0,this.bird1.scaleX=1,this.bird1.scaleY=1,this.birdRigid=this.birdRigids[1],this.ToLauncherInit(),t}}class Yt extends Ot{constructor(){super(...arguments),this.birdType=w.BoomerangBird,this.BirdAnimNum=4,this.BirdNum=2,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=3,this.density=10,this.endxSpeed=0,this.speed=0}InitBird(t,e,i,s){e+=28,super.InitBird(t,e,i,s)}get birdX(){return this.isCanMouse?this.hlbBird?this.hlbBird.x:-1:this.bird1?this.bird1.x:-1}get birdY(){return this.isCanMouse?this.hlbBird?this.hlbBird.y:-1:this.bird1?this.bird1.y:-1}OnInitBird(){this.hlbBird=this.birdSprite.getChildByName("hlbBird"),this.hlbBird.alpha=0,this.hlbBird.active=!1,this.hlbBirdRigid=this.hlbBird.getComponent(Laya.RigidBody),this.hlbBirdRigid.linearDamping=this.birdRigid.linearDamping,this.hlbBirdRigid.category=this.birdRigid.category,this.hlbBirdRigid.gravityScale=this.gravity,this.hlbBirdRigid.mask=this.birdRigid.mask,this.hlbBirdRigid.type="kinematic",this.bigHlbBird=this.birdSprite.getChildByName("bigHlbBird"),this.bigHlbBird.alpha=0,this.bigHlbBird.active=!1,this.bigHlbBirdRigid=this.bigHlbBird.getComponent(Laya.RigidBody),this.bigHlbBirdRigid.linearDamping=this.birdRigid.linearDamping,this.bigHlbBirdRigid.category=this.birdRigid.category,this.bigHlbBirdRigid.gravityScale=this.gravity,this.bigHlbBirdRigid.mask=this.birdRigid.mask,this.bigHlbBirdRigid.type="kinematic"}OnRunTrackLink(){this.hlbBird.alpha>0&&this.CreateTrackByHLB(),super.OnRunTrackLink()}CreateTrackByHLB(){let t=this.hlbBird,e=Laya.Point.create();e.setTo(t.pivotX,t.pivotY),e=t.localToGlobal(e,!1,GI.sceneMgr.worldRoot),this.launcher.trackCtrl.CreateTrack(e.x,e.y,this.trackIdx)}OnMouseDownRun(){if(super.OnMouseDownRun()){GI.timerMgr.clear(this,this.BoomerangUpdate);var t=null,e=null;this.isBiggerBird?(t=this.bigHlbBirdRigid,e=this.bigHlbBird):(t=this.hlbBirdRigid,e=this.hlbBird),this.endxSpeed=1.2*-this.birdRigid.body.m_linearVelocity.x,this.speed=2*this.endxSpeed/60,this.bird1.off(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter),e.on(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter,[0]),GI.sceneMgr.worldRoot.addChild(e),e.pos(this.bird1.x,this.bird1.y),e.alpha=1,e.active=!0,t.enabled=!0,t.type="dynamic",t.body.m_linearVelocity.x=this.birdRigid.body.m_linearVelocity.x,t.body.m_linearVelocity.y=this.birdRigid.body.m_linearVelocity.y,t.angularVelocity=15,this.bird1.alpha=0,this.bird1.active=!1,this.birdRigid.body.m_linearVelocity.x=0,this.birdRigid.body.m_linearVelocity.y=0,this.birdRigid.type="kinematic",GI.timerMgr.frameLoop(1,this,this.BoomerangUpdate)}return!0}BoomerangUpdate(){var t=null;(t=this.isBiggerBird?this.bigHlbBirdRigid:this.hlbBirdRigid).body.m_linearVelocity.x+=this.speed,this.endxSpeed>t.body.m_linearVelocity.x&&GI.timerMgr.clear(this,this.BoomerangUpdate)}OnTriggerEnter(t,e){super.OnTriggerEnter(t,e),GI.timerMgr.clear(this,this.BoomerangUpdate)}RemoveBird(){null!=this.hlbBird&&(this.hlbBird.active=!0,te.RemoveNodes(this.hlbBird),this.hlbBird.destroy(),this.hlbBird=null),null!=this.bigHlbBird&&(this.bigHlbBird.active=!0,te.RemoveNodes(this.bigHlbBird),this.bigHlbBird.destroy(),this.bigHlbBird=null),super.RemoveBird(),GI.timerMgr.clear(this,this.BoomerangUpdate)}RunBird(t,e,i){super.RunBird(t,e,i),this.birdRigid.angularVelocity=10}StartBiggerBird(){var t=super.StartBiggerBird();return this.bird1.alpha=0,this.bird1.active=!1,this.bird1=this.birdObjList[1],this.bird1.alpha=1,this.bird1.active=!0,this.bird1.scaleX=1,this.bird1.scaleY=1,this.birdRigid=this.birdRigids[1],this.ToLauncherInit(),t}}class Xt extends Ot{constructor(){super(...arguments),this.birdType=w.ShockWaveBird,this.BirdAnimNum=7,this.BombForce=13,this.Range=7,this.DieRange=1,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.removeTime=350,this.density=30,this.ShockIdx=0,this.isBomb=!1,this.effectCJB=null}InitBird(t,e,i,s){e+=28,super.InitBird(t,e,i,s),this.effectChonJIBo=this.CreateSkeleton(),this.effectChonJIBo.load(this.launcher.GetEffectByType(It.CJBCX)),this.effectCJB=this.CreateSkeleton(),this.effectCJB.load(this.launcher.GetEffectByType(It.CJBBZ),GI.handle(this,()=>{this.effectCJB.stop()}))}OnMouseDownRun(){super.OnMouseDownRun();return this.birdRigid.type="kinematic",this.OnBombDJS2(),!0}OnTriggerEnter(t,e){0==this.IsRemoveTime&&(GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.frameOnce(60,this,this.OnBombDJS)),super.OnTriggerEnter(t,e),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun)}OnBombDJS(){this.CloseAllPhiz(),this.birdAnimObjes[0][5].alpha=1,GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.frameOnce(50,this,this.OnBombDJS2)}OnBombDJS2(){this.isBomb||(this.CloseAllPhiz(),this.birdAnimObjes[0][6].alpha=1,this.birdRigid.type="kinematic",this.birdRigid.body.m_linearVelocity.x=0,this.birdRigid.body.m_linearVelocity.y=0,this.birdRigid.angularVelocity=0,GI.timerMgr.clear(this,this.OnShock),this.ShockIdx=0,this.effectCJB.play(0,!1),GI.timerMgr.clear(this,this.OnDengBomb),GI.timerMgr.frameOnce(40,this,this.OnDengBomb))}OnDengBomb(){GI.gMsgCet.event("ab.askCamShake"),GI.timerMgr.frameLoop(6,this,this.OnShock),GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.clear(this,this.OnBombDJS3)}OnShock(){this.ShockIdx++,this.ShockIdx>this.Range?(this.ShockWave(this.Range+4,this.Range),GI.timerMgr.clear(this,this.OnShock),GI.timerMgr.clear(this,this.RemoveBird),GI.timerMgr.frameOnce(30,this,this.RemoveBird)):this.ShockWave(this.ShockIdx+2,this.ShockIdx)}OnBombDJS3(){this.isBomb||(this.CloseAllPhiz(),this.birdRigid.type="kinematic",this.RemoveBird())}RemoveBird(){GI.timerMgr.clear(this,this.OnDengBomb),GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.clear(this,this.OnBombDJS3),null!=this.effectCJB&&(this.effectCJB.active=!0,this.effectCJB.destroy(),this.effectCJB=null),super.RemoveBird()}ShockWave(t,e){$t.i.roleCtrl.isCmeraToBird=!1,this.isBomb=!0;for(var i=this.birdRigid.body.GetWorldCenter(),s=new Laya.Physics.I.box2d.b2Vec2,a=new Laya.Physics.I.box2d.b2Vec2,r=e*e,o=0;o<=100;o++){var n=3.6*o,h=new Laya.Physics.I.box2d.b2RayCastInput;h.p1=i,h.p2.Set(i.x+t*Math.cos(n),i.y+t*Math.sin(n)),h.maxFraction=1;for(var l=new Laya.Physics.I.box2d.b2RayCastOutput,d=Laya.Physics.I.world.GetBodyList();d;d=d.GetNext()){var g=d.GetFixtureList();if(g)if(g.RayCast(l,h)){s.Copy(h.p1),a.Copy(h.p2),a.SelfSub(s),a.SelfMul(l.fraction),s.SelfAdd(a);var c=new Laya.Physics.I.box2d.b2Vec2;if(c.Copy(s),c.SelfSub(i),c.LengthSquared()<=r){if(null!=g.collider&&null!=g.collider.owner){let t=g.collider.owner.getComponent(D);null!=t&&t.MustDie()}}else{let t=new Laya.Physics.I.box2d.b2Vec2(c.x*(1-l.fraction)*this.BombForce,c.y*(1-l.fraction)*this.BombForce);d.ApplyLinearImpulseToCenter(t)}}}}}}!function(t){t[t.DiZheng=0]="DiZheng",t[t.MoFaYaoShuiStart=1]="MoFaYaoShuiStart",t[t.MoFaYaoCX=2]="MoFaYaoCX",t[t.MoFaYaoFS=3]="MoFaYaoFS",t[t.CJBStart=4]="CJBStart",t[t.CJBCX=5]="CJBCX",t[t.CJBBZ=6]="CJBBZ"}(It||(It={}));class zt extends Dt{constructor(){super(...arguments),this.effectPath=new Map([[It.DiZheng,"res/Effect/fx_earthquake_cast.sk"],[It.MoFaYaoShuiStart,"res/Effect/fx_Potion_cast_02.sk"],[It.MoFaYaoCX,"res/Effect/fx_Potion_cast.sk"],[It.MoFaYaoFS,"res/Effect/fx_Potion_cast_03.sk"],[It.CJBStart,"res/Effect/fx_shock_wave_cast01.sk"],[It.CJBCX,"res/Effect/fx_shock_wave_cast03.sk"],[It.CJBBZ,"res/Effect/fx_shock_wave_cast02.sk"]]),this.birdId=0,this.birdPrefabs=[],this.trackCtrl=new jt,this.rolePrefabData=null,this.rolePath="res/role/Launcher.json",this.isUser=!1,this.isMouseDown=!1,this.isMouseBird=!1,this.isCmeraToBird=!1,this.isCmeraToTrigger=!1,this.IsMouseRun=!0,this.minCamera={x:-2500,y:1024},this.MaxCamera={x:0,y:0},this.mousePoint={x:0,y:0},this.MinLauncherNum=30,this.FixMaxLauncherNum=100,this.MaxLauncherNum=100,this.birdDatas=[],this.launcherPoint={x:0,y:0},this.birdList=[],this.birdListDatas=[],this.rsBirdList=[],this.isUseBow=!1,this.addXFore=1,this.isUseBiggerBird=!1,this.isUseAim=!1,this.isVictory=!1,this.mouseTouchId=0,this.BirdRunBezierDatas=null,this.birdRunIdx=0,this.birdRun=null,this.isBirdAnimAdd=!1,this.rotationSeep=0,this.startAimIdx=0,this.aimSize=5,this.aimMaxNum=0}preInit(){this.MaxCamera={x:GI.sceneMgr.worldRoot.x,y:GI.sceneMgr.worldRoot.y},GI.gMsgCet.on("ab.scale_scene",this,this.onScaleScene)}onScaleScene(t){t&&t.curScale&&(this.MaxLauncherNum=100*t.curScale)}InitAttribute(){this.birdId=0,this.birdDatas=[],this.birdList=[],this.rsBirdList=[],this.birdListDatas=[],this.trackCtrl.InitTrack(),this.birdDatas=[],this.isUseBow=!1,this.addXFore=1;let t=$t.i.data.getBirdPos();this.launcherPoint=t[0];for(let e=t.length-1;e>0;--e)this.birdDatas.push(t[e]);this.minCamera={x:600-$t.i.data.maxRightX,y:1024},this.isUser=!1,this.isMouseDown=!1,this.isMouseBird=!1,this.isCmeraToBird=!1,this.IsMouseRun=!0,this.isCmeraToTrigger=!1,this.isUseBow=!1,this.isUseBiggerBird=!1,this.bird=null,this.runBird=null,this.isVictory=!1,this.isUseAim=!1,this.addXFore=1}initRole(t=230,e=400){this.InitAttribute();let i=$t.i.data.BirdCfgs.birds;if(null==this.rolePrefabData){let s=[{url:this.rolePath,type:Laya.Loader.JSON}],a=8;if(0==this.birdPrefabs.length)for(let t=0;t<a;++t)s.push({url:i[t].url,type:Laya.Loader.JSON});Laya.loader.load(s,Laya.Handler.create(this,s=>{if(this.rolePrefabData=Laya.loader.getRes(this.rolePath),0==this.birdPrefabs.length)for(let t=0;t<a;++t)this.birdPrefabs[t]=Laya.loader.getRes(i[t].url);this.CreateRoles(t,e),$t.i.autoUseChallengeProp()}))}else this.CreateRoles(t,e),$t.i.autoUseChallengeProp();this.StartPhysicsDebug()}OnMouseDownRole(t){null==this.bird||this.isMouseDown||(this.isMouseDown=!0,this.isCmeraToTrigger=!1,this.launcher.IsMouseDown()&&0==$t.i.GameMgr.IsVictory&&$t.i.canOperate?(this.isMouseBird=!0,this.mouseTouchId=t.touchId,this.SetTriggerPoss()):this.isMouseDown=!1,this.mousePoint.x=Laya.stage.mouseX,this.mousePoint.y=Laya.stage.mouseY)}OnMouseUpRole(t){if(this.mouseTouchId==t.touchId){if(this.trackCtrl.RemoveAim(),this.isMouseBird){if(this.launcher.InitAimJin(),this.launcher.GetPullLenght()<=this.MinLauncherNum)return this.launcher.ReductionTrigger(),this.isMouseDown=!1,void(this.isMouseBird=!1);this.BirdLaunching()}this.isMouseDown=!1,this.isMouseBird=!1}}GetLauncherAddMousePoint(){let t=this.GetTriggerPoint(),e=this.launcher.triggerPoint;return t.x=e.x-t.x,t.y=e.y-t.y,t}GetEffectByType(t){return this.effectPath.get(t)}BirdLaunching(){if(null==this.bird)return;let t=this.GetLauncherAddMousePoint(),e=t.distance(0,0);e=e<this.MinLauncherNum?this.MinLauncherNum:e,e/=this.FixMaxLauncherNum,this.bird.RunBird(t,e,this.addXFore),this.isCmeraToBird=!0,this.launcher.InitRubber(),GI.timerMgr.clear(this,this.TriggerLoadingBird),GI.timerMgr.frameOnce(50,this,this.TriggerLoadingBird),this.runBird=this.bird,this.bird=null,this.isMouseBird=!1,this.trackCtrl.RemoveAim()}TriggerLoadingBird(){this.LoadNextBird()}SetTriggerPoss(){let t=this.GetTriggerPoint();this.launcher.UpdateRubberSpingAngle(this.GetSpringAngle()),this.bird.birdSprite.x=0,this.bird.birdSprite.y=0,this.bird.ToLauncher(),this.launcher.SetTriggerPoss(t.x,t.y),t.recover(),this.mousePoint.x=Laya.stage.mouseX,this.mousePoint.y=Laya.stage.mouseY}RoleVictory(){GI.log("LauncherCtrl RoleVictory"),this.isVictory=!0;let t=0;this.birdList.length>0||null!=this.bird?(GI.gMsgCet.event("ab.onLvlShow"),GI.gMsgCet.event("AB.SoundEvent",{eventType:3})):(t++,this.SeedVictory(t))}DengDaiVictory(){let t=0;$t.i.data.isDailyChallengeScene||(null!=this.bird&&(this.bird.BirdVictory(),t=1),this.birdList.length>0&&(GI.timerMgr.frameOnce(60,this,this.DenBird,[this.birdList.length-1]),t+=this.birdList.length)),t=Math.max(1,t),this.SeedVictory(t)}DenBird(t){t>=0&&this.birdList.length>t&&(this.birdList[t].BirdVictory(),--t>=0&&GI.timerMgr.frameOnce(60,this,this.DenBird,[t]))}SeedVictory(t){GI.timerMgr.frameOnce(100*t,this,this.victory)}victory(){GI.gMsgCet.event("FinishLevel"),GI.gMsgCet.event("Wm.onFinishLvl")}GetTriggerPoint(){let t=this.GetMousePos(),e=this.launcher.GetPullLenght(),i=this.launcher.GetTriggerPoint(),s=t.x-i.x,a=t.y-i.y,r=this.MaxLauncherNum;if(e>45&&a>0&&(s<=0&&s>-30||s>=0&&s<60)&&(r=35),r<this.MaxLauncherNum||e>=this.MaxLauncherNum){let o=r/e;i.x=s*o+i.x,i.y=a*o+i.y,t=this.launcher.launcherObj.globalToLocal(i)}else t=this.launcher.launcherObj.globalToLocal(t);return t}GetSpringAngle(){let t=this.GetMousePos(),e=this.launcher.GetTriggerPoint();return this.getAngle(t,e)}getAngle(t,e){return t&&e?180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI:0}RemoveRole(){GI.timerMgr.clear(this,this.Earthquake1),GI.timerMgr.clear(this,this.Earthquake2),GI.timerMgr.clear(this,this.Earthquake3),GI.timerMgr.clear(this,this.Earthquake4),GI.timerMgr.clear(this,this.Earthquake5),this.trackCtrl.RemoveAllTracks(),GI.gMsgCet.off("ab.camShake",this,this.UpdateEarthquake),GI.gMsgCet.off("ab.camArriveShotPos",this,this.DengDaiVictory),GI.gMsgCet.off("ab.use_prop",this,this.UserProps),GI.gMsgCet.off("ab.vip_upgrade",this,this.updateLauncherSkin),GI.timerMgr.clear(this,this.DengDaiVictory),GI.timerMgr.clear(this,this.DenBird),GI.timerMgr.clear(this,this.victory),GI.timerMgr.clear(this,this.TriggerLoadingBird),GI.timerMgr.clear(this,this.BirdRun),null!=this.bird&&this.bird.RemoveBird(),null!=this.runBird&&this.runBird.RemoveBird();for(let t=0;t<this.birdList.length;++t)this.birdList[t].RemoveBird();for(let t=0;t<this.rsBirdList.length;++t)this.rsBirdList[t].RemoveBird();null!=this.launcher&&this.launcher.Remove(),this.birdListDatas=[],this.birdList=[],this.rsBirdList=[],this.bird=null,this.launcher=null,this.runBird=null,Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRole),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.OnMouseUpRole)}LoadNextBird(){if(null==this.bird&&!this.isVictory&&this.birdList.length>0){this.bird=this.birdList.pop();let t=this.launcher.GetWorldBird();t.x-=.5*this.bird.bird1.pivotX,t.y-=.5*this.bird.bird1.pivotY,this.bird.ToLauncherInit(),this.BirdRunAnim(t,this.bird.worldPoint,this.bird,!1),GI.gMsgCet.event("ab.UpdateRole"),GI.gMsgCet.event("ab.load_bird",{birdList:this.birdList}),this.isUseBiggerBird&&this.StartBiggerBird()}}CreateBirds(){this.birdList=[];for(let t=0;t<this.birdDatas.length;++t){let e=this.birdDatas[t],i=this.CreateBird(e.type);i.InitBird(e.x,e.y,this.birdPrefabs[e.type],this),this.birdList.push(i),this.birdListDatas.push(i)}if(this.rsBirdList=[],$t.i.isNormalSc)for(let t=0;t<this.birdDatas.length;++t){let e=this.birdDatas[t],i=this.CreateBird(e.type);this.rsBirdList.push(i)}}GetBirdById(t){for(let e=0;e<this.birdListDatas.length;++e)if(this.birdListDatas[e].BirdId+""==t)return this.birdListDatas[e];return null}GetBirdNum(){var t=0;return null!=this.bird&&t++,t+=this.birdList.length+this.rsBirdList.length}CreateBird(t){switch(t){case w.RedBird:return new Nt(this.birdId++);case w.AvatarBird:return new Ft(this.birdId++);case w.BombBird:return new Ht(this.birdId++);case w.EggBird:return new qt(this.birdId++);case w.FastBird:return new Jt(this.birdId++);case w.BigRedBird:return new Wt(this.birdId++);case w.BoomerangBird:return new Yt(this.birdId++);case w.ShockWaveBird:return new Xt(this.birdId++)}return console.error("错误 创建的鸟没有这个类型    "+t),null}CreateRoles(t,e){GI.gMsgCet.off("ab.camShake",this,this.UpdateEarthquake),GI.gMsgCet.on("ab.camShake",this,this.UpdateEarthquake),GI.gMsgCet.off("ab.camArriveShotPos",this,this.DengDaiVictory),GI.gMsgCet.on("ab.camArriveShotPos",this,this.DengDaiVictory);let i=new Laya.Prefab;i.json=this.rolePrefabData;let s=i.create();this.launcher=s.getComponent(ee),this.AddInRigidWorld(s,3);let a=1;GI.gCfg.offline_chest_module&&$t.i.data.vipData.lvl&&(a=$t.i.data.vipData.lvl+2),this.launcher.SetShowLauncher(a),s.x=this.launcherPoint.x,s.y=this.launcherPoint.y+100,this.launcher.MinLauncherNum=this.MinLauncherNum,this.launcher.MaxLauncherNum=this.MaxLauncherNum,this.launcher.InitData(),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRole),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.OnMouseUpRole),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.OnMouseRun),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRole),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.OnMouseUpRole),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.OnMouseRun),GI.gMsgCet.off("ab.use_prop",this,this.UserProps),GI.gMsgCet.on("ab.use_prop",this,this.UserProps),GI.gMsgCet.off("ab.vip_upgrade",this,this.updateLauncherSkin),GI.gMsgCet.on("ab.vip_upgrade",this,this.updateLauncherSkin),this.CreateBirds(),this.LoadNextBird()}UserProps(t){let e=t.prop_id;D.startGameTime=!0,GI.gMsgCet.event("AB.UserProp",[e]),1==e?this.StartBiggerBird():2==e?this.StartEnergyBow():3==e?this.StartAim():4==e?this.StartEarthquake():6==e&&this.AddChongJiBo()}StartEnergyBow(){this.isUseBow=!0,this.addXFore=1.2,this.launcher.SetShowLauncher(2)}PlayerEffect(t,e=1){let i=this.launcher.GetWorldPoint();GI.gMsgCet.event("ab.PlayEffect",[this.effectPath.get(t),i.x,i.y,0,e,e])}StartBiggerBird(){if(null!=this.bird){this.PlayerEffect(It.MoFaYaoShuiStart,1.3),this.bird.StartBiggerBird()&&(this.isUseBiggerBird=!1)}else this.isUseBiggerBird=!0}StartAim(){this.isUseAim=!0,this.launcher.ShowAim()}StartEarthquake(){this.isMouseBird=!1,GI.gMsgCet.event("ab.camLookAtPig")}UpdateEarthquake(t){GI.gMsgCet.event("AB.SoundEvent",{eventType:8});var e=$t.i.data.tagPos;null!=e&&(GI.gMsgCet.event("ab.PlayEffect",[this.effectPath.get(It.DiZheng),e.x,$t.i.data.groundY+150,0,1.4,1.4]),GI.gMsgCet.event("ab.PlayEffect",[this.effectPath.get(It.DiZheng),e.x+300,$t.i.data.groundY+150,0,1.4,1.4]),GI.gMsgCet.event("ab.PlayEffect",[this.effectPath.get(It.DiZheng),e.x+600,$t.i.data.groundY+150,0,1.4,1.4]));var i=t.shadkeDuration;GI.timerMgr.clear(this,this.Earthquake1),GI.timerMgr.clear(this,this.Earthquake2),GI.timerMgr.clear(this,this.Earthquake3),GI.timerMgr.clear(this,this.Earthquake4),GI.timerMgr.clear(this,this.Earthquake5);let s=.5*(Math.random()+1)*9.5;s=Math.random()>.5?s:-s,GI.timerMgr.once(.4*i,this,this.Earthquake1,[.7*s]),GI.timerMgr.once(.5*i,this,this.Earthquake2,[.8*s]),GI.timerMgr.once(.6*i,this,this.Earthquake3,[.8*s]),GI.timerMgr.once(.8*i,this,this.Earthquake4,[s]),GI.timerMgr.once(.9*i,this,this.Earthquake5,[s])}Earthquake1(t){$t.i.GameMgr.StartEarthquake(!0,t)}Earthquake2(t){$t.i.GameMgr.StartEarthquake(!0,t)}Earthquake3(t){$t.i.GameMgr.StartEarthquake(!0,t)}Earthquake4(t){$t.i.GameMgr.StartEarthquake(!0,t)}Earthquake5(t){$t.i.GameMgr.StartEarthquake(!0,t)}AddChongJiBo(){null!=this.bird&&this.BirdRunAnim(this.bird.GetWorldPoint(),this.bird.worldPoint,this.bird,!0),this.bird=this.CreateBird(w.ShockWaveBird),this.bird.InitBird(0,0,this.birdPrefabs[w.ShockWaveBird],this),this.launcher.LoadBird(this.bird),this.PlayerEffect(It.CJBStart)}BirdRunAnim(t,e,i,s=!1){var a=[];a.push(t),a.push({x:.5*(e.x+t.x),y:.5*(t.y-e.y)+t.y}),a.push(e),this.birdRun=i,this.isBirdAnimAdd=s,this.BirdRunBezierDatas=Ut.CreateBezierPoints(a,30),this.BirdRunBezierDatas.push(e),this.rotationSeep=s?360/31:-360/31,this.birdRunIdx=s?0:this.BirdRunBezierDatas.length-1,GI.sceneMgr.worldRoot.addChild(i.birdSprite),i.birdSprite.pos(0,0),s?i.bird1.pos(t.x,t.y):i.bird1.pos(e.x,e.y),GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.frameLoop(1,this,this.BirdRun)}BirdRun(){let t=this.BirdRunBezierDatas[this.birdRunIdx];this.birdRun.bird1&&(this.birdRun.bird1.pos(t.x,t.y),this.isBirdAnimAdd?this.birdRunIdx++:this.birdRunIdx--,(this.isBirdAnimAdd&&this.birdRunIdx>=this.BirdRunBezierDatas.length||0==this.isBirdAnimAdd&&this.birdRunIdx<0)&&(this.isBirdAnimAdd?this.birdList.push(this.birdRun):this.launcher.LoadBird(this.birdRun),this.birdRun=null,this.BirdRunBezierDatas=[],GI.timerMgr.clear(this,this.BirdRun)))}LockTrigger(t=!1){null!=this.bird||this.birdList.length>0?t&&(this.isCmeraToTrigger=!0,this.isCmeraToBird=!1):0==this.isVictory&&null==this.bird&&0==this.birdList.length&&t&&(this.rsBirdList.length?$t.i.openResurgeView():this.evtFail())}resurge(){for(let t=0;t<this.birdList.length;++t)this.birdList[t].RemoveBird();this.birdList=[];for(let t=0;t<this.rsBirdList.length;t++){let e=this.birdDatas[t],i=this.rsBirdList[t];i&&e&&i.InitBird(e.x,e.y,this.birdPrefabs[e.type],this,"resurge"),this.birdList.push(this.rsBirdList[t])}this.rsBirdList=[]}evtFail(){GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"),GI.gMsgCet.event("AB.SoundEvent",{eventType:4})}GetPositionWhen(t,e,i,s){var a,r,o=new Laya.Point;return r=e.y*(1/60)*i+1/60*(1/60)*s*(i+1)*i/2,a=e.x*(1/60)*i,o.y=t.y+50*r,o.x=t.x+50*a,o}UpdateAim(){if(null!=this.bird){let t=this.GetLauncherAddMousePoint(),e=t.distance(0,0);e=e<this.MinLauncherNum?this.MinLauncherNum:e,e/=this.FixMaxLauncherNum;let i=this.bird.GetBirdSpeed(t,e,this.addXFore),s=this.bird.GetWorldPoint(),a=$t.i.data.groundY;this.bird.birdRigid.linearDamping,this.trackCtrl.RemoveAim(),this.trackCtrl.CreateAim(s.x,s.y),this.startAimIdx=0,this.startAimIdx=this.aimSize;Laya.Point.create(),Math.tanh(i.x/i.y),Math.PI;let r=this.bird.gravity*Laya.Physics.I.world.GetGravity().y;for(let t=0;t<2e3;++t){let t=this.GetPositionWhen(s,i,this.startAimIdx,r);if(this.startAimIdx+=this.aimSize,t.y>a)return;this.trackCtrl.CreateAim(t.x,t.y)}}}OnMouseRun(t){this.isMouseDown&&this.isMouseBird&&0==this.isVictory&&this.mouseTouchId==t.touchId&&(this.SetTriggerPoss(),this.isUseAim&&this.UpdateAim())}onUpdate(){this.UpdatePhysicsRun()}get roleX(){return null!=this.runBird?this.runBird.birdX-50:null!=this.bird?this.bird.birdX-50:-1}get roleY(){return null!=this.runBird?this.runBird.birdY:null!=this.bird?this.bird.birdY:-1}updateLauncherSkin(){GI.gCfg.offline_chest_module&&this.launcher.SetShowLauncher($t.i.data.vipData.lvl+2)}}class Kt{constructor(){this.pigLists=new Map,this.rigidList=[],this.runBird=new Map,this.isOver=!1,this.UpTime=0,this.physicsTimeOut=0,GI.gMsgCet.on("ab.AddGrade",this,this.AddGrade)}AddGrade(){0==this.pigLists.size&&(this.UpTime=Laya.timer.currTimer)}RemoveDatas(){this.pigLists.clear(),this.rigidList=[],this.runBird.clear(),this.isOver=!1,this.UpTime=0,GI.timerMgr.clear(this,this.DetectRun),GI.timerMgr.clear(this,this.delayVictory)}StartDetect(){this.physicsTimeOut=GI.timerMgr.currTimer+GI.gCfg.roundPhysTimeOut,GI.timerMgr.clear(this,this.DetectRun),GI.timerMgr.frameLoop(30,this,this.DetectRun)}StartEarthquake(t,e=5){let i=e;if(this.pigLists.forEach((t,e)=>{null!=t&&null!=t.sp&&t.rigid.applyLinearImpulseToCenter({x:i,y:0})}),t)for(var s=0;s<this.rigidList.length;++s){var a=this.rigidList[s];if(null!=a&&null!=a.rigid&&Math.abs(a.rigid.body.m_angularVelocity)<.1&&4!=a.propId&&null!=a.sp&&null!=a.rigid&&a.HP>0&&Math.random()>.6){var r=1+.5*Math.random();a.rigid.applyLinearImpulseToCenter({x:i*r,y:0})}}}delayVictory(){Laya.timer.currTimer-this.UpTime>=300&&(this.RoleVictory(),GI.timerMgr.clear(this,this.delayVictory))}DetectRun(){if((0==this.IsRigidItemPhysicsRun()||1==this.isPhysiceTimeOut())&&Laya.timer.currTimer-this.UpTime>=200){if(this.isOver)return void GI.timerMgr.clear(this,this.DetectRun);0==$t.i.roleCtrl.GetBirdNum()&&0==this.runBird.size&&(GI.gMsgCet.event("ab.RigEnd"),this.isOver=!0),GI.timerMgr.clear(this,this.DetectRun),GI.timerMgr.clear(this,this.LockTrigger),0==this.runBird.size&&GI.timerMgr.frameOnce(10,this,this.LockTrigger)}else GI.timerMgr.clear(this,this.LockTrigger)}isPhysiceTimeOut(){return!!(GI.gCfg.roundPhysTimeOut&&GI.gCfg.roundPhysTimeOut>0&&GI.timerMgr.currTimer>this.physicsTimeOut)}stopRigidItemPhysics(){for(let t=0;t<this.rigidList.length;++t){let e=this.rigidList[t];null!=e&&null!=e.sp&&null!=e.rigid&&(e.rigid.type="static",e.rigid.body.m_linearVelocity.x=0,e.rigid.body.m_linearVelocity.y=0,e.rigid.body.m_angularVelocity=0)}}LockTrigger(){$t.i.roleCtrl.LockTrigger(0==this.runBird.size)}RoleVictory(){$t.i.roleCtrl.RoleVictory(),GI.timerMgr.clear(this,this.DetectRun)}IsRigidItemPhysicsRun(){for(let t=0;t<this.rigidList.length;++t){let e=this.rigidList[t];if(null!=e&&null!=e.sp&&(Math.abs(50*e.rigid.body.m_linearVelocity.x)>1||Math.abs(50*e.rigid.body.m_linearVelocity.y)>1))return!0}return!1}get IsVictory(){return 0==this.pigLists.size}AddPig(t){this.pigLists.set(t.rigidId,t)}AddRigidItem(t){this.rigidList.push(t)}AddRunBird(t){this.runBird.set(t.BirdId,t)}RemovePigItem(t){if(this.pigLists.delete(t.rigidId),0==this.pigLists.size){if(GI.gMsgCet.event("ab.RigEnd"),this.isOver)return;this.isOver=!0,this.AddGrade(),GI.timerMgr.clear(this,this.DetectRun),GI.timerMgr.clear(this,this.LockTrigger),GI.timerMgr.clear(this,this.delayVictory),GI.timerMgr.frameLoop(10,this,this.delayVictory)}}RemoveRigidItem(t){}RemoveRunBird(t){this.runBird.delete(t.BirdId),0==this.runBird.size&&0==this.isOver&&this.StartDetect()}}class Qt{constructor(t){this._visible=!1,this.firstIndex=0,this.firstDelay=0,this._uBtn=t;let e=this._uBtn.asCom.getChild("img");this._icon=new Laya.Sprite,this._icon.mouseEnabled=!0,this._icon.size(e.width,e.height),e.displayObject.addChild(this._icon),this._txtGName=this._uBtn.asCom.getChild("txtGName").asLabel,this._bg=this._uBtn.asCom.getChild("bg").asImage,this._txtMark=this._uBtn.asCom.getChild("txtMark").asLabel,this._markBg=this._uBtn.asCom.getChild("markBg").asImage}static create(t,e=null,i=null){return GI.util.bindPros(new Qt(GI.util.bindPros(t,i)),e)}get visible(){return this._visible}bindNativeAdEvt(t){return t.bindUiClick(this._icon,()=>{this._curGame&&GI.gMsgCet.event("pf.goHtNativeGame",{htData:this._curGame})}),t.bindGEvt("pf.onHtNativeGames",this.onHtNativeGames.bind(this)),t.bindGEvt("pf.afterGoHtGame",this.afterGoHtGame.bind(this)),this}doShow(t){GI.gCfg.htForbidList&&t.sourceType&&GI.gCfg.htForbidList[t.sourceType]||(this._visible=!0,GI.gMsgCet.event("pf.getHtNativeGames",t),this._uBtn.visible=!1)}doHide(){this._visible=!1,GI.timerMgr.clear(this,this.updateHtNativeGame),GI.timerMgr.clear(this,this.afterFirstDelay)}onHtNativeGames(t){this._games=t?t.dataList:[],this._curGIndex=this.firstIndex-1,this.updateHtNativeGame(),this.firstDelay>0?GI.timerMgr.once(this.firstDelay,this,this.afterFirstDelay):this.afterFirstDelay()}afterFirstDelay(){GI.timerMgr.loop(GI.gCfg.htNativeGamesFrequency,this,this.updateHtNativeGame)}updateHtNativeGame(){this._curGIndex=(this._curGIndex+1)%this._games.length,this._curGame=this._games[this._curGIndex],this._curGame&&this._icon.loadImage(this._curGame.iconUrl,GI.handle(this,()=>{this.visible&&(this._uBtn.visible=!0,this._txtGName.text=this._curGame.txt,this._bg.color=GI.gCfg.htBoxGmaeColors[this._curGIndex%GI.gCfg.htBoxGmaeColors.length],this._txtMark.text=this._curGame.mark||"",this._markBg.visible=!!this._curGame.mark,this._curGame.mark&&(this._markBg.asImage.color=GI.gCfg.htAdMarkColors[this._curGame.mark]||GI.gCfg.htAdMarkColors.default))}))}afterGoHtGame(t){0==t.isSuc&&GI.uiViewMgr.showView("FullScrollAdView")}}class Zt extends GI.UIViewBase{constructor(){super(...arguments),this.featherRewardLimit="feather_reward_limit"}createPanel(){this.needMask=!0,this.createPanelUI("AbRewardView"),this.makeFullScreen(),this.u("btnVideo").asCom.getController("hintCtrl").selectedPage=GI.gCfg.abRewardViewHintPage}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnVideo",()=>{this.hideSelf(),GI.gMsgCet.event("btn_feather_reward",{closeFunc:this.onFinishVideo.bind(this),adIdx:2,sourceType:this.viewID})}),this.bindGEvt("show_custom_ad",this.showCustomAd),this._nativeHt=Qt.create(this.u("nativeHt")).bindNativeAdEvt(this)}onFinishVideo(t,e){if(GI.log("奖励界面播放完视频广告：",t,e),t){if((GI.gCfg.popShareHint||GI.gCfg.tempChangeVideoToShare||e&&"videoAd"==e.type)&&(GI.gMsgCet.event("videoad_accum_reward"),$t.i.data.costTimeLimit(this.featherRewardLimit),this.handleTimeLimitUI()),this.rewardData.isCurrency){let t=this.rewardData.quantity;$t.i.data.changeMoney({useOrGain:1,gemNum:t,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_Feather_reward,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7}),GI.timerMgr.once(1e3,this,()=>{GI.uiViewMgr.hideView("ObtainView")})}else $t.i.data.usePropUpdateData(this.rewardData.prop_id,!0);$t.i.popObtainView({name:this.rewardData.name,quantity:this.rewardData.quantity,iconName:this.rewardData.iconName})}}doShow(t){if(GI.gMsgCet.event("ab.hideGridAd"),$t.i.canOperate=!1,this.handleSk(),null==t||null==t.reward_id)return;let e=$t.i.data.commercialCfg.reward[t.reward_id];this.rewardData={};for(let t in e)this.rewardData[t]=e[t];null!=this.rewardData&&(this.u("txtTitle").asTextField.text=this.rewardData.name,this.u("imgObj").asLoader.url=GI.uiViewMgr.getItemURL(this.rewardData.iconName),GI.gCfg.videoIconShrinkPage&&(this.panel.getController("hintCtrl").selectedPage=GI.gCfg.videoIconShrinkPage),this.handleTimeLimitUI(),this.updateVipPrivilege(),this._nativeHt.doShow({htId:1,sourceType:this.viewID}),GI.uiViewMgr.showView("VideoTimesProgressView"))}doHide(){GI.gMsgCet.event("ab.showGridAd"),$t.i.canOperate=!0,this.sk.stop(),this._nativeHt.doHide(),GI.uiViewMgr.hideView("VideoTimesProgressView")}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}handleSk(){let t=this.u("imgObj");null==this.sk?(this.sk=new Laya.Skeleton,this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,1),this.sk.pos(t.x,t.y)):(this.sk.pos(t.x,t.y),this.sk.play(0,!0))}handleTimeLimitUI(){if($t.i.data.timeLimitData[this.featherRewardLimit]){let t=$t.i.data.isTimeLimitNextStage(this.featherRewardLimit);this.u("btnVideo").enabled=!t,this.u("imgVideo",this.u("btnVideo")).enabled=!t,this.u("txtRemainCount").asTextField.text="今日剩余次数："+$t.i.data.timeLimitRemainCount(this.featherRewardLimit)}}updateVipPrivilege(){let t=$t.i.data.getVipPrivilege();t&&this.rewardData.isCurrency&&(this.rewardData.quantity=Math.round(this.rewardData.quantity*(1+t.extraFeatherReward))),this.u("txtVideoRewardHint").text="观看视频即可获得"+this.rewardData.quantity+"个金色羽毛"}}class $t extends GI.Module{constructor(){super(...arguments),this._data=new Pt,this._mapCtrl=new nt,this._gameControl=new Kt,this._roleCtrl=new wt,this._roleSuCtrl=new Tt,this._LauncherCtrl=new zt,this._camera=new Rt,this._curChapter=-1,this._curLvl=-1,this._canPlayTime=-1,this.isWaitWin=!1,this.shouldShowPropPoint=!1,this.bannerStyleCons={},this.isLastLvlFail=!1,this.isEventScene=!1,this.lastEventSceneScore=0,this.enterNoramlScene=!1}get data(){return this._data}get mapCtrl(){return this._mapCtrl}get GameMgr(){return this._gameControl}get roleCtrl(){return this._LauncherCtrl}get camera(){return this._camera}get money(){return this.data.money}set money(t){this.data.money=t}get money2(){return this.data.money2}set money2(t){this.data.money2=t}get curChapter(){return this.data.curChapter}set curChapter(t){this.data.curChapter=t}get curLvl(){return this.data.curLvl}set curLvl(t){this.data.curLvl=t}get curStep(){return this.data.curStep}set curStep(t){this.data.curStep=t}get isLvlOn(){return this._isLvlOn}set isLvlOn(t){this._isLvlOn!=t&&(this._isLvlOn=t,GI.gMsgCet.event("Wm.isLvlOn"))}get canPlay(){return this._isLvlOn&&GI.timerMgr.currTimer>=this._canPlayTime}get isPlay(){return this._isPlay}set isPlay(t){this._isPlay!=t&&(this._isPlay=t)}get canOperate(){return this._canOperate}set canOperate(t){this._canOperate!=t&&(this._canOperate=t,GI.gMsgCet.event("Ab.canOperate",this._canOperate))}preInit(){this.data.preInit(),this.roleCtrl.preInit(),this.registerView("WmSucView",Ct),this.registerView("WmFailView",bt),this.registerView("WmGuideView",Gt),this.registerView("WmGuide2View",vt),this.registerView("WmCtrGuideView",xt),this.registerView("WmRewardView",kt),this.registerView("AbRewardView",Zt),this.registerView("HintView",Et),GI.gMsgCet.on("ReachLine",this,this.onFinishStep),GI.gMsgCet.on("ReachMidStep",this,this.onFinishStep),GI.gMsgCet.on("Wm.onFinishLvl",this,this.onFinishLvl),GI.gMsgCet.on("Wm.onFail",this,this.onFail),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_End",this,()=>{this.onFail()}),GI.gMsgCet.on("ab.RigEnd",this,()=>{this.isWaitWin=!0}),GI.gMsgCet.on("ab.camShakeBird",this.mapCtrl,this.mapCtrl.playDarkEffect),GI.gMsgCet.on("ab.camShake",this.mapCtrl,this.mapCtrl.playDarkEffect),GI.gMsgCet.on("ab.load_bird",this,this.onBirdUp),this.checkEventValid(),this.checkRankValid()}enterWm(){this.loadCfgs()}loadCfgs(){GI.gMsgCet.event("Wm.onLoading",{loading_step:1,state:0}),GI.prgMgr.load([{url:"res/role/birdCfg.cfg.json",type:Laya.Loader.JSON},{url:"res/map/item.json",type:Laya.Loader.JSON},{url:"res/chapter/chapterCfg.cfg.json",type:Laya.Loader.JSON},{url:"res/score/scoreUiCfg.cfg.json",type:Laya.Loader.JSON},{url:"res/score/commercialCfg.cfg.json",type:Laya.Loader.JSON},{url:"res/sound/soundsCfg.cfg.json",type:Laya.Loader.JSON}],GI.handle(this,this.onCfgsLoaded))}onCfgsLoaded(){GI.gMsgCet.event("Wm.onLoading",{loading_step:1,state:1}),this.data.onCfgsLoaded(),GI.prgMgr.openScene("res/scene/Main.scene",this.onOpenSc.bind(this))}onOpenSc(){let t=new Laya.Sprite;GI.sceneMgr.scene.addChild(t),GI.sceneMgr.worldRoot=t,this.mapCtrl.init(GI.handle(this,this.afterInitMap))}afterInitMap(){GI.uiViewMgr.showView("SysMainUi");let t=GI.localDataMgr.getInt("dayGet.day");0!=GI.localDataMgr.getInt("dayGet.isGet")&&t<=7&&GI.uiViewMgr.showView("DailyAttendanceView"),GI.gCfg.timelimitEvent&&this.isEventValid&&GI.uiViewMgr.showView("EventAnnounceView"),this.initOfflineReward(),this.autoShowOfflineView(),GI.gCfg.htPages&&GI.gCfg.htPages.autoShowFullScrollAd&&GI.uiViewMgr.showView("FullScrollAdView")}checkStartLvl(){this.startLvl(this.data.checkStartLvl)}startLvl(t){this.curStep=0,this.curLvl=t,GI.localDataMgr.setInt("lastEnterLvl",this.data.getLvlNum(this.curChapter,this.curLvl)),this.isNormalSc&&this.data.storeLvlPlayTimes(this.curChapter,t),this.doStart()}startPropGuideLvl(){this.isPlay&&this.quitPlay();let t=this.data.commercialCfg.prop[$t.i.data.propGuideId];GI.gMsgCet.event("pf.enterGuide",{propName:t&&t.name}),this.doStart()}doStart(){this.isPlay=!0,this.isWaitWin=!1,this.data.MaxGameGrade=0,this.data.GameGrade=0;let t=this.curLvl;this.data.isGuideScene&&this.data.commercialCfg.prop[$t.i.data.propGuideId]?t=this.data.commercialCfg.prop[$t.i.data.propGuideId].map_id:this.isEventScene?(t=GI.gCfg.timelimitEvent.mapId,this.lastEventSceneScore=0):this.data.isDailyChallengeScene?t=this.data.dailyChallengeMaps[this.data.dailyChallengeData.curStep]:this.enterNoramlScene=!0,GI.gMsgCet.event("Wm.beforeChangeMap",{lvl:t}),this.data.addPlayTimes(),GI.timerMgr.clear(this,this.onUpdate),this.roleCtrl.RemoveRole(),this.GameMgr.RemoveDatas(),GI.gMsgCet.event("Wm.onLoading",{loading_step:2,state:0}),this.data.desRopeJoint(),this.mapCtrl.changeMap(GI.handle(this,this.onMapChanged)),this.data.resetUsingProp(),this.canOperate=!0}quitPlay(){GI.timerMgr.clear(this,this.onUpdate),this.GameMgr.RemoveDatas(),this.onLvlEnd(!1,3)}onMapChanged(){GI.uiViewMgr.showView("GamePlayView"),GI.gMsgCet.event("Wm.onLoading",{loading_step:2,state:1}),GI.timerMgr.clear(this,this.onMapChangedtime),GI.timerMgr.frameOnce(5,this,this.onMapChangedtime),this.isNormalSc&&GI.gMsgCet.event("Wm.afterChangeMap",{lvl:this.curLvl})}onMapChangedtime(){GI.gMsgCet.event("Wm.onLoading",{loading_step:3,state:0});let t=this.mapCtrl.getLaunchePos();t?(this.roleCtrl.initRole(t.x-20,t.y-120),this.camera.init(t.x-1e3,t.y-250)):(this.roleCtrl.initRole(),this.camera.init()),GI.gMsgCet.event("Wm.onLoading",{loading_step:3,state:1}),GI.timerMgr.frameLoop(1,this,this.onUpdate),this._canPlayTime=GI.timerMgr.currTimer+800,this.isLvlOn=!0,this.checkCheerRoles(),this.showViewBeforePlay()}get totalStep(){return this.curLvl>=6?3:2}onFinishStep(t){}onFinishLvl(){if(!this.isPlay)return;this.data.clearFailLvlData();let t=this.isEventScene,e=this.data.isDailyChallengeScene;if(this.onLvlEnd(!0,1),this.curStep++,this.data.finishedLvl=this.curLvl,GI.uiViewMgr.hideView("WmFailView"),this.data.isGuideScene){let t=this.data.finishPropGuide(this.data.propGuideId);GI.uiViewMgr.showView("PropGuideEndView",{isWin:!0,propId:this.data.propGuideId,isFirstWin:t})}else if(t)this.handleEventSceneEndView(!0);else if(e)this.handleChallengeSceneEndView();else{let t=this.data.GameGrade,e=this.data.usingProp[this.data.commercialCfg.prop_enum.double_point];e&&e.count>0&&(t*=2);let i=this.data.getVipPrivilege();i&&(t=Math.round(t*(1+i.extraPoint)));let s=this.data.currentRank(e&&e.count>0);s>=GI.gCfg.unlockNextRank&&GI.gMsgCet.event("pf.finishLvl",{chapter:this.curChapter,lvl:this.curLvl}),s>=3&&(GI.gCfg.rankData&&this.data.addRankScore("addRank_threeStar",GI.gCfg.rankData.increase.threeStar),this.data.finishWelfareTask(8));let a=this.data.updateChapterData(t,s);this.data.isGameLastLevel(this.curChapter,this.curLvl)||s>=GI.gCfg.unlockNextRank&&!this.data.isNextLvlUnlock(this.curChapter,this.curLvl)&&this.data.unlockLevel(1,!1),GI.uiViewMgr.showView("WmSucView",{isNewRecord:a}),GI.gCfg.finishlevelautoshortcut&&(GI.log("-------关卡胜利自动创建快捷方式弹出--------"),GI.gMsgCet.event("ab.createShortCut",{succesFunc:()=>{GI.log("-------桌面快捷方式创建成功--------")},failFunc:()=>{GI.log("-------桌面快捷方式创建失败--------")},completeFunc:()=>{GI.log("-------桌面快捷方式完成回调--------")},fromview:"clear"})),this.isLastLvlFail=!1}}onFail(){if(!this.isPlay)return;this.data.plusFailLvl(this.curChapter,this.curLvl);let t=this.isEventScene,e=this.data.isDailyChallengeScene;this.onLvlEnd(!0),this.data.isGuideScene?GI.uiViewMgr.showView("PropGuideEndView",{isWin:!1,propId:this.data.propGuideId}):t?this.handleEventSceneEndView(!1):e?this.handleChallengeSceneEndView():(GI.uiViewMgr.showView("WmFailView"),GI.gMsgCet.fetch("Wm.onFail"),this.isLastLvlFail=!0)}onLvlEnd(t=!1,e=0,i=!1){this.isPlay=!1,this.isLvlOn=!1;let s=["GamePlayView","AbRewardView","EventSceneFailView","EventSceneSucView","AssistPropView"];for(let t of s)GI.uiViewMgr.hideView(t);this.isNormalSc&&GI.gMsgCet.event("Wm.onLvlEnd",{resultFlag:e,lvl:this.curLvl,isResume:i}),t||GI.gMsgCet.event("AB.PlayMusic")}reStart(t=!1){this.onLvlEnd(!1,2,t),this.doStart()}returnToLvl(){this.onLvlEnd(!1,2),this.checkStartLvl()}onUpdate(){this.roleCtrl.onUpdate(),this.camera.onUpdate()}get roleUiX(){return this.camera.roleUiX}get roleUiY(){return this.camera.roleUiY}get roleTopUiY(){return this.camera.roleTopUiY}checkCheerRoles(){this.mapCtrl.checkCheerRoles()}checkShowRewardView(t){return GI.gCfg.reward_display_judge[(t-1)%GI.gCfg.reward_display_judge.length]}showViewBeforePlay(){if(this.data.isGuideScene||this.data.isDailyChallengeScene)return;if(this.isEventScene)return void GI.gMsgCet.event("ab.moveToBird");let t=GI.gCfg.coursePageCfg;for(let e in t)if(t[e].chapter==this.curChapter&&t[e].lvl==this.curLvl){let t=this.data.courseData;return t[e]&&t[e].show_count>0?void(!GI.gMsgCet.fetch("start_lvl_show_view")&&GI.uiViewMgr.showView("PropRewardView")):(GI.uiViewMgr.showView("AbGuideView",{isSingle:!0,guidePage:e,callback:()=>{!GI.gMsgCet.fetch("start_lvl_show_view")&&GI.uiViewMgr.showView("PropRewardView")}}),t[e].show_count++,void(this.data.courseData=t))}!GI.gMsgCet.fetch("start_lvl_show_view")&&GI.uiViewMgr.showView("PropRewardView")}popObtainView(t,e){let i=t&&t.extraReward?"ObtainExtraView":"ObtainView";e?GI.uiViewMgr.showView(i,t):GI.timerMgr.once(1e3,this,()=>{GI.uiViewMgr.showView(i,t)})}reportShopAction(t){GI.gMsgCet.event("shop_action",t)}breakOffPlay(){this.data.clearFailLvlData()}onGameShow(){}onGameHide(){}initOfflineReward(){GI.gCfg.offline_chest_module&&!this.data.beginOfflineTime&&(this.data.beginOfflineTime=Date.now())}startOfflineReward(){GI.gCfg.offline_chest_module&&(this.data.beginOfflineTime=Date.now())}autoShowOfflineView(){let t=this.data.beginOfflineTime;GI.gCfg.offline_chest_module&&t&&(this.data.offlineInitFeather>0||Date.now()-t>=GI.gCfg.offline_chest_module.duration)&&GI.uiViewMgr.showView("OfflineRewardView")}toGuide(t){if(t&&t.propId&&t.fromView){this.data.duringGuideProcess=!0,this.data.propGuideId=t.propId,this.breakOffPlay();for(let t of["ShopView","SysMainUi","GamePlayView","ChapterView","ChallengeView","DailyAttendanceView","DailyChallengeView","ResurgeView"])GI.uiViewMgr.hideView(t);this.startPropGuideLvl()}}quitGuide(){$t.i.data.clearPropGuideId();let t=this.data.viewBeforeGuide;if(GI.gMsgCet.event("AB.PlayMusic"),t.viewPath&&"GamePlayView"==t.viewPath[0]&&t.hasOwnProperty("chapter")&&t.hasOwnProperty("lvl"))GI.uiViewMgr.showView("ShopView",{from:"propGuide"});else{this.data.duringGuideProcess=!1;let e=t.viewPath;if(e&&e.length)for(let t of e)GI.uiViewMgr.showView(t)}}popShareHintView(t){GI.gCfg.popShareHint&&t&&t.doneFunc&&GI.uiViewMgr.showView("ShareHintView",{doneFunc:t.doneFunc})}onChestCollect(t){let e=this.data.chapterData;if(e[this.curChapter].levels[this.curLvl-1].chestCollectCount>0)return;e[this.curChapter].levels[this.curLvl-1].chestCollectCount=1,this.data.chapterData=e;let i=this.data.chestCollectCount;null==i&&(i=0),i++,this.data.chestCollectCount=i,this.data.surpriseChestTime&&1!=i||this.updateSurpriseChestTime(),GI.gMsgCet.event("ab.chestItemCollect",t)}updateSurpriseChestTime(){this.data.surpriseChestTime=Date.now()+432e5}abbreviateNumber(t){let e=t;if(t>=1e3){var i=["","k","m","g","t"],s=Math.floor((t.toFixed(0).length-1)/3);s>=i.length&&(s=i.length-1);var a=0!=s?t/Math.pow(1e3,s):t;a%1!=0&&(a=Math.floor(a)),e=a+i[s]}return e.toString()}toEventLvl(){for(let t of["ShopView","SysMainUi","GamePlayView","ChapterView","ChallengeView","DailyAttendanceView","PropCollegeView"])GI.uiViewMgr.hideView(t);this.isEventScene=!0,this.lastEventSceneScore=0,GI.pf.setBannerAdForbidSrc("GamePlayView",!0),this.doStart()}quitEventLvl(){this.isEventScene=!1,GI.pf.setBannerAdForbidSrc("GamePlayView",!1),GI.uiViewMgr.showView("ChapterView")}handleEventSceneEndView(t){let e=GI.gCfg.timelimitEvent.medals,i=null;for(let t of e)if(this.lastEventSceneScore>=t.score){i={};for(let e in t)i[e]=t[e];break}i?GI.uiViewMgr.showView("EventSceneSucView",{medal:i}):GI.uiViewMgr.showView("EventSceneFailView"),this.data.finishWelfareTask(6)}checkEventValid(){GI.gCfg.timelimitEvent&&(this.checkEventFunc(),GI.timerMgr.loop(1e4,this,this.checkEventFunc))}checkEventFunc(){let t=Date.now();t<new Date(GI.gCfg.timelimitEvent.startDay).getTime()?this.isEventValid=!1:t>new Date(GI.gCfg.timelimitEvent.endDay).getTime()+864e5?(GI.timerMgr.clear(this,this.checkEventFunc),this.isEventValid=!1):this.isEventValid=!0}openEventEntrance(){GI.gCfg.dailyChallenge?GI.uiViewMgr.showView("EventSummaryView"):GI.uiViewMgr.showView("LimitEventEntranceView")}toDailyChallengeLvl(t){this.data.isDailyChallengeScene=!0;for(let t of["ShopView","SysMainUi","GamePlayView","ChapterView","ChallengeView","DailyAttendanceView","PropCollegeView"])GI.uiViewMgr.hideView(t);this.data.dailyChallengeData.curStep||(this.data.clearDailyChallengeData(),(!this.data.dailyChallengeMaps||GI.gCfg.timeLimitCfgs&&GI.gCfg.timeLimitCfgs.dailyChallenge&&!$t.i.data.isTimeLimitNextStage("dailyChallenge"))&&(this.data.dailyChallengeMaps=this.getRandomMapId()),t&&(this.data.dailyChallengeData.propId=t)),GI.pf.setBannerAdForbidSrc("GamePlayView",!0),$t.i.data.costTimeLimit("dailyChallenge"),GI.localDataMgr.setBool("isChallengeCost",!0),this.doStart()}quitDailyChallengeLvl(){this.data.isDailyChallengeScene=!1,this.data.clearDailyChallengeData(),GI.pf.setBannerAdForbidSrc("GamePlayView",!1),GI.uiViewMgr.showView("ChapterView")}getRandomMapId(t=[],e=[]){if(!t.length)for(let e of GI.gCfg.dailyChallenge.mapIds)t.push(e);let i=Math.floor(Math.random()*t.length);return e.push(t[i]),e.length>=GI.gCfg.dailyChallenge.totalStep?e:(t.splice(i,1),this.getRandomMapId(t,e))}handleChallengeSceneEndView(){GI.uiViewMgr.showView("DailyChallengeEndView")}autoUseChallengeProp(){GI.timerMgr.once(300,this,this.challengeSceneUseProp)}challengeSceneUseProp(){if(GI.timerMgr.clear(this,this.challengeSceneUseProp),!this.data.isDailyChallengeScene)return;let t=this.data.dailyChallengeData.propId;0!=t&&(this.data.presentUpdateData(t,1),this.data.usePropUpdateData(t,!1),t!=this.data.commercialCfg.prop_enum.quake&&GI.gMsgCet.event("ab.moveToBird"))}checkRankValid(){GI.gCfg.rankData&&GI.timerMgr.loop(1e3,this,this.loopCheckTime)}loopCheckTime(){let t=GI.localDataMgr.getInt("rankClearTime");if(Date.now()>t){let e=new Date;e.setDate(e.getDate()-(e.getDay()||7)+8),e.setHours(0,0,0,0),t=e.getTime(),GI.localDataMgr.setInt("rankClearTime",t),this.data.hasLastRankReward()||(this.data.lastRankScore=this.data.rankScore),this.data.rankScore=GI.gCfg.rankData.initScore}GI.gMsgCet.event("loopCheckTime")}handleChallengeWelfare(){let t=GI.localDataMgr.getInt("challengeWelfareBeginTime"),e=GI.localDataMgr.getInt("challengeWelfareEndTime"),i=Date.now();if(!t||i<=e&&i>=t||i>e){i>e&&this.data.clearWelfareProcess(5),this.data.finishWelfareTask(5);let t=new Date;t.setDate(t.getDate()+1),t.setHours(0,0,0,0),GI.localDataMgr.setNum("challengeWelfareBeginTime",t.getTime()),GI.localDataMgr.setInt("challengeWelfareEndTime",t.getTime()+864e5)}}onBirdUp(t){t.birdList&&0==t.birdList.length&&this.isNormalSc&&GI.uiViewMgr.showView("AssistPropView")}get isNormalSc(){return!this.data.isGuideScene&&!this.isEventScene&&!this.data.isDailyChallengeScene}openResurgeView(){GI.uiViewMgr.showView("ResurgeView")}resurge(){this.roleCtrl.resurge(),this.roleCtrl.LoadNextBird(),GI.gMsgCet.event("ab.moveToBird")}cancelResurge(){this.onFail()}}class te{constructor(){}static AddRigidBody(t,e,i=1){let s=new Laya.RigidBody;return s.category=e,s.mask=i,s.allowSleep=!1,s.bullet=!0,t.addComponentIntance(s),s}static AddBoxCollider(t){let e=t.addComponent(Laya.BoxCollider);return e.x=0,e.y=0,e.width=t.width,e.height=t.height,e.restitution=0,e}static CreateSprite(t,e,i,s,a,r,o){let n=new Laya.Sprite;return GI.sceneMgr.worldRoot.addChild(n),n.loadImage(t),n.width=e,n.height=i,n.pivot(s,a),n.x=r,n.y=o,n}static CreateWeldJoint(t,e=[0,0],i=10){let s=new Laya.WeldJoint;return s.otherBody=t,s.frequency=i,s.anchor=e,s}static CreateWheelJoint(t,e=null){let i=new Laya.WheelJoint;return i.otherBody=t,i.anchor=e,i}static CreateRevoluteJoint(t,e=null){let i=new Laya.RevoluteJoint;return i.otherBody=t,i.anchor=e,i.collideConnected=!1,i}static RemoveComponent(t,e,i=!1){let s=t.getComponents(e);if(null!=s)for(let t=0;t<s.length;++t){let e=s[t];i&&(e.enabled=!1),e.destroy()}}static RemoveNode(t){null!=t&&(this.RemoveComponent(t,Laya.JointBase,!0),this.RemoveComponent(t,Laya.ColliderBase),this.RemoveComponent(t,Laya.RigidBody))}static RemoveNodes(t){if(null!=t){this.RemoveNode(t);for(let e=0;e<t.numChildren;e++)this.RemoveNode(t.getChildAt(e));$t.i.mapCtrl.roleLayer.removeChild(t)}}}class ee extends Laya.Script{constructor(){super(),this.MaxRubberSize=24,this.MinRubberSize=10,this.MinLauncherNum=40,this.rubberData={},this.rubberA=0,this.rubberB=0,this.MaxLauncherNum=100,this.launcherUps=[],this.launcherDowns=[],this.UpdateRubberTime=0,this.NumRubber=0,this.aimIdx=0}onAwake(){this.triggerPoint=Laya.Point.create(),this.triggerPoint.setTo(this.trigger.x,this.trigger.y),this.rubberData={x:this.leftRubber.x,y:this.leftRubber.y,rotation:this.leftRubber.rotation,width:this.leftRubber.width,height:this.leftRubber.height,pivotX:this.leftRubber.pivotX,pivotY:this.leftRubber.pivotY},this.launcherDowns=[],this.launcherUps=[];var t=this.launcherObj.getChildByName("up");for(let e=1;e<=t.numChildren;e++)this.launcherUps.push(t.getChildByName("up"+e));var e=this.launcherObj.getChildByName("down");for(let t=1;t<=e.numChildren;t++)this.launcherDowns.push(e.getChildByName("down"+t));this.aimTou=this.launcherObj.getChildByName("aimTou"),this.aimJin=this.launcherObj.getChildByName("aimJin")}ShowAim(){this.aimJin.alpha=1,this.aimTou.alpha=1}SetShowLauncher(t=1){t--;for(let e=0;e<this.launcherUps.length;++e)e!=t?(this.launcherUps[e].alpha=0,this.launcherDowns[e].alpha=0):(this.launcherUps[e].alpha=1,this.launcherDowns[e].alpha=1);2!=++t&&(t=1);let e="role/angerbird/rubber"+t+".png";this.rightRubber.skin=e,this.leftRubber.skin=e,this.rubber.loadImage(e)}GetWorldPoint(){let t=Laya.Point.create();t.setTo(0,0);let e=GI.sceneMgr.worldRoot;return t=this.bird.localToGlobal(t,!1,e)}Remove(){te.RemoveNodes(this.launcherObj),this.launcherObj.destroy()}InitData(){this.rubberA=(this.MinRubberSize-this.MaxRubberSize)/(this.MaxLauncherNum-this.MinLauncherNum),this.rubberB=this.MaxRubberSize-this.MinLauncherNum*this.rubberA}LoadBird(t){this.bird.addChild(t.birdSprite),t.birdSprite.x=0,t.birdSprite.y=0,t.ToLauncher()}GetWorldBird(){if(null==this.birdWorld){let t=Laya.Point.create();t.setTo(this.bird.x,this.bird.y);let e=GI.sceneMgr.worldRoot;t=this.bird.localToGlobal(t,!1,e),this.birdWorld=t}return this.birdWorld}IsMouseDown(){let t=Laya.stage.mouseX,e=Laya.stage.mouseY,i=this.detect.localToGlobal(new Laya.Point(0,0));return t>=i.x&&t<=i.x+this.detect.width&&e>=i.y&&e<=i.y+this.detect.height}getAngle(t,e){return t&&e?180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI:0}SetTriggerPoss(t,e){this.trigger.pos(t,e),this.rubber.pos(t,e),this.UpdateRubberWidths()}UpdateRubberWidths(){GI.timerMgr.clear(this,this.AimAnim);let t=this.UpdateRubberLenght(this.leftRubber);this.aimJin.rotation=this.leftRubber.rotation-90;let e=this.UpdateRubberLenght(this.rightRubber),i=t<e?t:e;GI.timerMgr.currTimer-this.UpdateRubberTime>150&&Math.abs(this.NumRubber-i)>30&&(this.NumRubber=i,this.UpdateRubberTime=GI.timerMgr.currTimer,GI.gMsgCet.event("AB.SoundEvent",{eventType:2})),this.UpdateRubberWidth(i,this.leftRubber),this.UpdateRubberWidth(i,this.rightRubber)}InitAimJin(){this.aimIdx=60,Math.abs(this.aimJin.rotation)<5?this.aimJin.rotation=0:(this.aimSpeed=-this.aimJin.rotation/this.aimIdx,GI.timerMgr.clear(this,this.AimAnim),GI.timerMgr.frameLoop(1,this,this.AimAnim))}AimAnim(){this.aimJin.rotation+=this.aimSpeed,this.aimIdx--,this.aimIdx<=0&&(this.aimJin.rotation=0,GI.timerMgr.clear(this,this.AimAnim))}InitRubber(){this.leftRubber.width=this.rubberData.width,this.leftRubber.height=this.rubberData.height,this.leftRubber.rotation=this.rubberData.rotation,this.leftRubber.pivotX=this.rubberData.pivotX,this.leftRubber.pivotY=this.rubberData.pivotY,this.leftRubber.x=this.rubberData.x,this.leftRubber.y=this.rubberData.y,this.rightRubber.height=1,this.trigger.pos(this.triggerPoint.x,this.triggerPoint.y),this.rubber.pos(this.triggerPoint.x,this.triggerPoint.y),this.rubber.rotation=0}GetPullLenght(){let t=Laya.stage.mouseX,e=Laya.stage.mouseY;return this.GetTriggerPoint().distance(t,e)}ReductionTrigger(){this.trigger.pos(this.triggerPoint.x,this.triggerPoint.y),this.rubber.pos(this.triggerPoint.x,this.triggerPoint.y),this.UpdateRubberWidths(),this.UpdateRubberSpingAngle(0)}UpdateRubberWidth(t,e){e.width=this.rubberA*t+this.rubberB,e.width<this.MinRubberSize&&(e.width=this.MinRubberSize),e.pivotX=e.width/2}UpdateRubberLenght(t){let e=Laya.Point.create();e.setTo(t.x,t.y);let i=Laya.Point.create();i.setTo(11,20),i=this.rubber.localToGlobal(i,!1,this.launcherObj),t.height=e.distance(i.x,i.y);let s=e.distance(this.rubber.x,this.rubber.y);return t.rotation=this.getAngle(t,this.rubber)-90,s>this.MaxLauncherNum&&(s=this.MaxLauncherNum),s}UpdateRubberSpingAngle(t){this.rubber.rotation=t}GetTriggerPoint(){return this.launcherObj.localToGlobal(this.triggerPoint,!0)}}class ie{constructor(){}static init(){(0,Laya.ClassUtils.regClass)("script/as/LauncherObj.ts",ee)}}ie.width=1280,ie.height=720,ie.scaleMode="fixedauto",ie.screenMode="horizontal",ie.alignV="middle",ie.alignH="center",ie.startScene="res/scene/Main.scene",ie.sceneRoot="",ie.debug=!1,ie.stat=!1,ie.physicsDebug=!1,ie.exportSceneToJson=!0,ie.init();class se extends GI.UIViewBase{constructor(){super(...arguments),this.canGroundMove=!0,this.isSetOpen=!1,this.isMoreOpen=!1,this.treeTweens=[],this.groundTweens=[],this.treeOriginX=0,this.groundOriginX=0,this.alreadyPopLogin=!1,this.featherRewardLimit="feather_reward_limit"}createPanel(){this._layer=GI.UiLayerEnum.base,this.createPanelUI("SysMainUi"),this.makeFullScreen(),this.initOriginData()}initOriginData(){this.treeOriginX=this.u("trees1").x,this.treeOriginX=this.u("ground1").x,this.panel.getController("tryPlayCtrl").selectedPage=GI.gCfg.rookieWelfare?"show":"hide"}doBindEvt(){this.bindUiClick("btnStart",()=>{this.hideSelf(),GI.uiViewMgr.showView("ChapterView"),this.alreadyPopLogin||(GI.gMsgCet.event("pop_login"),this.alreadyPopLogin=!0)}),this.bindUiClick("btnVoice",()=>{GI.soundMgr.triggerMuted()}),this.bindGEvt("sound.muted",()=>{this.u("imgMute").visible=GI.soundMgr.muted},!0),this.bindUiClick("btnShop",()=>{this.stopBgScroll(),GI.uiViewMgr.showView("ShopView",{from:"SysMainUi"})}),this.bindGEvt("hide_shop_view",t=>{this.displayIcons(!0),this.startBgScroll()}),this.bindGEvt("show_shop_view",()=>{this.displayIcons(!1),this.stopBgScroll()}),this.bindUiClick("btnClear",()=>{GI.localDataMgr.clear(),$t.i.data.initLocalData(),GI.gInfoMgr.showInfo(3,null)}),this.bindUiClick("btnSgin",()=>{GI.uiViewMgr.showView("DailyAttendanceView")}),GI.gMsgCet.on("wm.getDayAward",this,this.notShowRed),this.bindGEvt("Wm.money",this.refreshLimitUI),this._nativeHt=Qt.create(this.u("nativeHt")).bindNativeAdEvt(this),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})}),this.bindUiClick("btnEventEnter",this.openEventEntrance),this.bindUiClick("btnTryPlay",this.openTryPlayView),this.bindGEvt("updateTryPlayData",this.onTryDataUpdate),this.bindGEvt("directGoEventView",this.hideSelf),this.panel.getController("ctrlRank").selectedPage=GI.pf.openRank?"show":"hide",this.bindUiClick("btnRank",()=>{GI.uiViewMgr.showView("RankView")})}doShow(t){t&&t.onGameShow||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"show"}),this.displayIcons(!0),this.initData(),this.initUI(),this.startBgScroll(),this.showSignSymbol(),this._nativeHt.doShow({htId:1,sourceType:this.viewID}),GI.gCfg.debugView&&GI.uiViewMgr.showView("debugview"),this.panel.getController("eventCtrl").selectedPage=$t.i.isEventValid?"show":"hide",this.onTryDataUpdate())}doHide(t){t&&t.onGameHide||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"hide"}),this.stopBgScroll(),this._nativeHt.doHide())}initData(){this.isMoreOpen=!1,this.isSetOpen=!1}initUI(){this.u("btnClear").visible=this.u("txtClear").visible=GI.isDebug,this.refreshLimitUI()}refreshLimitUI(){$t.i.data.timeLimitData[this.featherRewardLimit]&&(this.panel.getController("redShopCtrl").selectedPage=$t.i.data.isTimeLimitNextStage(this.featherRewardLimit)?"hide":"show")}startBgScroll(){this.canGroundMove=!0,this.u("trees1").x=this.treeOriginX,this.u("trees2").x=this.treeOriginX+this.u("trees1").width-1,this.u("ground1").x=this.groundOriginX,this.u("ground2").x=this.groundOriginX+this.u("ground1").width-1,this.groundTweens=this.loopScroll("ground1","ground2",3e4),this.treeTweens=this.loopScroll("trees1","trees2",35e3)}loopScroll(t,e,i,s){null==s&&(s=!0);let a=s?this.u(t):this.u(e),r=s?this.u(e):this.u(t);return[GI.Tween.to(a,{x:a.x-a.width},i,Laya.Ease.linearNone,null,0,!0),GI.Tween.to(r,{x:a.x},i,Laya.Ease.linearNone,GI.handle(this,()=>{a.x=r.x+r.width-1,this.canGroundMove&&this.loopScroll(t,e,i,!s)}),0,!0)]}stopBgScroll(){this.canGroundMove=!1;for(let t of this.treeTweens)t.clear();for(let t of this.groundTweens)t.clear()}displayIcons(t){this.u("imgTitle").visible=t,this.u("bgStart").visible=t,this.u("btnShop").visible=t,this.u("btnVoice").visible=t,GI.soundMgr.muted&&(this.u("imgMute").visible=t),GI.isDebug&&(this.u("btnClear").visible=this.u("txtClear").visible=t),this.u("redShop").visible=t}updateCountDown(){let t=this.endTime.getTime()-Date.now();if(t>0){let a=parseInt((t/1e3).toString()),r=Math.floor(a/3600);var e=a;0!=r&&(e=a%(60*r*60));var i=Math.floor(e/60);i>0&&(e%=60*i);var s=e;this.txtRemain.text=r+":"+i+":"+s}else GI.timerMgr.clear(this,this.updateCountDown),this.displayCountDown(!1)}displayCountDown(t){this.u("btnGift").visible=this.u("imgTimeLimit").visible=this.u("txtTimeLimit").visible=t}showSignSymbol(){let t=GI.localDataMgr.getInt("dayGet.day");1==GI.localDataMgr.getInt("dayGet.isGet")&&t<=7?this.u("red").visible=!0:this.u("red").visible=!1}notShowRed(){this.u("red").visible=!1}openEventEntrance(){$t.i.openEventEntrance()}openTryPlayView(){GI.uiViewMgr.showView("TryPlayView")}onTryDataUpdate(){let t=GI.localDataMgr.getJSON("tryPlayData"),e=!1;for(let i in t)if("done"==t[i].status){e=!0;break}this.u("tryPlayRed").visible=e}}!function(t){t[t.main=0]="main",t[t.prop=1]="prop",t[t.blast=2]="blast"}(yt||(yt={}));class ae extends GI.UIViewBase{constructor(){super(...arguments),this.propArr=[],this.isDraggingList=!1,this._currentPropType=1,this.isDirectClose=!1,this.featherRewardLimit="feather_reward_limit"}set currentStage(t){this._currentStage!=t&&(this._currentStage=t,GI.gCfg.shopViewBannerForbid&&GI.pf.setBannerAdForbidSrc(this.viewID,this._currentStage!=yt.main&&{priority:99}))}get currentStage(){return this._currentStage}get currentPropType(){return this._currentPropType}set currentPropType(t){this.currentPropType!=t&&(this._currentPropType=t)}createPanel(){this.needMask=!0,this.createPanelUI("ShopView"),this.makeFullScreen(),this.initUIData()}initUIData(){let t=$t.i.data.commercialCfg.prop_enum,e=$t.i.data.commercialCfg.prop;this.currentStage=yt.main,this.propList=this.u("propList"),this.propList.itemRenderer=GI.handle(this,this.renderPropListItem,null,!1),this.propArr=[],this.blastList=this.u("blastList"),this.blastList.itemRenderer=GI.handle(this,this.renderBlastListItem,null,!1),this.blastArr=[],this.videoBlastArr=[];for(let i in e)for(let s=0;s<e[i].commodity.length;s++){let a=e[i].commodity[s];if(a.type_id==t.blast){if(this.blastArr.push(a),0==s){let t={};for(let e in a)t[e]=a[e];t.cost=-1,this.videoBlastArr.push(t)}s<e[i].commodity.length-1&&this.videoBlastArr.push(a)}else this.propArr.push(a)}this.propList.numItems=this.propArr.length}refreshBlastList(){this.blastList.numItems=this.videoBlastRemain()?this.videoBlastArr.length:this.blastArr.length}doBindEvt(){this.bindUiClick("btnBack",()=>{if("propGuide"==this.fromView&&(this.isDirectClose=!1),this.currentStage==yt.main){let t=$t.i.data.viewBeforeGuide;$t.i.data.duringGuideProcess&&null!=t.chapter&&null!=t.lvl?this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.hideSelf(),GI.gMsgCet.event("hide_shop_view",{from:this.fromView}),$t.i.data.duringGuideProcess=!1,$t.i.data.clearViewBeforeGuide(),$t.i.curChapter=t.chapter,$t.i.startLvl(t.lvl)})):this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.hideSelf(),GI.gMsgCet.event("hide_shop_view",{from:this.fromView}),"DailyChallengeView"==this.fromView&&GI.uiViewMgr.showView("DailyChallengeView")}))}else this.isDirectClose?(this.currentStage=yt.main,this.panel.getTransition("drop_detail").playReverse(GI.handle(this,()=>{this.hideSelf(),GI.gMsgCet.event("hide_shop_view",{from:this.fromView})}))):(this.currentStage=yt.main,this.u("btnBack").enabled=!1,this.panel.getTransition("drop_detail").playReverse(GI.handle(this,()=>{this.panel.getTransition("drop_panel").play(GI.handle(this,()=>{this.u("btnBack").enabled=!0}))})))}),this.bindUiClick("btnIntensify",()=>{this.currentStage=yt.prop,this.updateDesc(this.currentPropType),this.panel.getController("displayCtrl").selectedPage="prop_page",this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.panel.getTransition("drop_detail").play()}))}),this.bindUiClick("btnBlast",()=>{this.currentStage=yt.blast,this.panel.getController("displayCtrl").selectedPage="blast_page",this.updateDesc($t.i.data.commercialCfg.prop_enum.blast),this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.panel.getTransition("drop_detail").play()}))}),this.bindUiClick("btnFeather",()=>{GI.uiViewMgr.showView("AbRewardView",{reward_id:1})}),this.bindUiClick("btnPropCollege",()=>{let t=this.currentStage==yt.blast?$t.i.data.commercialCfg.prop_enum.blast:this.currentPropType;GI.uiViewMgr.showView("PropCollegeView",{prop_id:t,from:this.fromView})});let t=$t.i.data.commercialCfg.prop;for(let e in t)e!=$t.i.data.commercialCfg.prop_enum.blast&&(this.bindUiClick("btnPropType"+e,()=>{this.switchPropType(Number(e))}),this.bindUiEvt("btnPropType"+e,Laya.Event.MOUSE_DOWN,t=>{this.u("btnPropType"+e).setScale(.8,.8)}),this.bindUiEvt("btnPropType"+e,Laya.Event.MOUSE_UP,t=>{this.u("btnPropType"+e).setScale(1,1)}));this.bindUiEvt("propList",fgui.Events.CLICK_ITEM,this.onItemClick),this.bindUiEvt("blastList",fgui.Events.CLICK_ITEM,this.onItemClick),this.bindUiEvt(this.panel,Laya.Event.MOUSE_UP,()=>{this.isDraggingList&&(this.isDraggingList=!1,GI.timerMgr.once(250,this,this.onListScroll))}),this.bindUiEvt("propList",Laya.Event.MOUSE_DOWN,()=>{this.isDraggingList=!0}),this.bindGEvt("Wm.money",()=>{this.u("coinCorner").asCom.getChild("txtCoin").asTextField.text=$t.i.abbreviateNumber($t.i.money)},!0),this.bindGEvt("ab.prop_change",this.updatePropCount),this.bindGEvt("ab.get_prop",this.afterBuyProp),this.bindGEvt("ab.RigEnd",()=>{$t.i.isPlay&&this.hideSelf()}),this.bindGEvt("Wm.money",this.refreshLimitUI),GI.gMsgCet.on("pf.enterGuide",this,()=>{"DailyChallengeView"==this.fromView&&(this.fromView="")}),this.bindGEvt("shop.videoBlastCount.clear",this.refreshBlastList)}doShow(t){if(t&&t.onGameShow)return;$t.i.data.recordGuideBeforeView({view:this.viewID,type:"show"}),GI.gMsgCet.event("ab.hideGridAd");let e=$t.i.data.commercialCfg.prop_enum.blast;if(null!=t){if(t.hasOwnProperty("prop_id"))switch(t.prop_id==e?this.currentStage=yt.blast:(this.currentStage=yt.prop,this.currentPropType=t.prop_id),this.isDirectClose=!0,this.currentStage){case yt.prop:this.panel.getController("displayCtrl").selectedPage="prop_page",this.panel.getTransition("drop_detail").play(),this.switchPropType(this.currentPropType);break;case yt.blast:this.panel.getController("displayCtrl").selectedPage="blast_page",this.panel.getTransition("drop_detail").play()}t.hasOwnProperty("from")&&(t.hasOwnProperty("prop_id")||(this.isDirectClose=!1),this.fromView=t.from,this.currentStage==yt.main&&this.panel.getTransition("drop_panel").play())}this.updateDesc(this.currentStage==yt.prop?this.currentPropType:e),$t.i.canOperate=!1,GI.gMsgCet.event("show_shop_view"),this.isDraggingList=!1,this.updatePropCount(),GI.timerMgr.once(GI.gCfg.delayPopInsertAd>0?GI.gCfg.delayPopInsertAd:0,this,this.showInsertAd),this.initUI(),this.refreshBlastList(),this.displayBottomDesc()}doHide(t){t&&t.onGameHide||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"hide"}),GI.gMsgCet.event("ab.showGridAd"),$t.i.canOperate=!0,GI.timerMgr.clear(this,this.showInsertAd))}initUI(){this.refreshLimitUI()}refreshLimitUI(){$t.i.data.timeLimitData[this.featherRewardLimit]&&(this.panel.getController("redShopCtrl").selectedPage=$t.i.data.isTimeLimitNextStage(this.featherRewardLimit)?"hide":"show")}showInsertAd(){GI.timerMgr.clear(this,this.showInsertAd),GI.pf.showInsertAd({sourceType:this.viewID})}renderPropListItem(t,e){if(!e)return;let i=this.propArr[t];e.data=i,this.u("imgLoader",e.asCom).asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.prop[i.type_id].iconName),this.u("txtCount",e.asCom).asTextField.text="x"+i.count,this.u("txtCost",e.asCom).asTextField.text=i.cost}renderBlastListItem(t,e){if(!e)return;let i=this.videoBlastRemain()?this.videoBlastArr[t]:this.blastArr[t];e.data=i,this.u("imgLoader",e.asCom).asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.prop[i.type_id].iconName),this.u("txtCount",e.asCom).asTextField.text="x"+i.count,e.asCom.getController("cost").selectedPage=-1==i.cost?"video":"feather",-1==i.cost?this.u("txtCostFree",e.asCom).asTextField.setVar("num",this.videoBlastRemain().toString()).flushVars():this.u("txtCost",e.asCom).asTextField.text=i.cost}switchPropType(t){this.currentPropType=t,this.propList.scrollToView(4*(t-1),!0),this.movePointer(this.u("btnPropType"+t).x),this.updateDesc(t)}onItemClick(t,e){t&&null!=t.data&&(-1==t.data.cost?GI.pf.showVideoAd({closeFunc:this.onFinishBlastVideo.bind(this),adIdx:13,sourceType:this.viewID}):$t.i.data.money>=t.data.cost?$t.i.data.buyPropUpdateData(t.data):GI.uiViewMgr.showView("AbRewardView",{reward_id:1}))}onFinishBlastVideo(t,e){t&&($t.i.data.presentUpdateData($t.i.data.commercialCfg.prop_enum.blast),$t.i.data.addVideoBlastCt(),this.refreshBlastList())}videoBlastRemain(){return GI.gCfg.shopVideoBlast-$t.i.data.videoBlastCount}onListScroll(t){let e=this.panel.getController("listCtrl").selectedIndex+1;this.currentPropType=e,this.movePointer(this.u("btnPropType"+e).x),this.updateDesc(e)}movePointer(t){GI.Tween.to(this.u("imgPointer"),{x:t},300)}updatePropCount(){let t=$t.i.data.props;for(let e in t){let i=this.u("txtPropCount"+e);null!=i&&(i.asTextField.text=t[e].quantity)}}updateDesc(t){this.u("txtDesc").asTextField.text=$t.i.data.commercialCfg.prop[t].desc,this.panel.getController("descCtrl").selectedPage="prop"+t;let e=$t.i.data.props[t];this.u("imgStar").visible=null!=e.guide_done&&e.guide_done>0}afterBuyProp(t){let e=$t.i.data.commercialCfg.prop[t.type_id];e&&$t.i.popObtainView({name:e.name,quantity:t.count,iconName:e.iconName},!0)}displayBottomDesc(){GI.gCfg.timelimitEvent&&(this.panel.getController("guideCtrl").selectedPage=$t.i.isEventScene?"hide":"show")}}class re extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("RoleView"),this.makeFullScreen(),this._cfgs=[$t.i.data.bodyData,$t.i.data.hatData,$t.i.data.jewelryData,$t.i.data.rodData],this._txtUsingPosX=this.u("txtUsing").x}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnUse",this.onUse),this.bindUiEvt("typeList",fgui.Events.CLICK_ITEM,this.onTypeSelect),this.bindUiEvt("list",fgui.Events.CLICK_ITEM,this.onItemSelect),this.bindGEvt("Wm.money",()=>{this.u("txtGold").asLabel.text=$t.i.money.toString()},!0),this.bindGEvt(["Wm.money","Wm.part.active","Wm.part.curUseID"],this.onItemSelect),this.bindGEvt(["Wm.part.active"],this.updateTypePrg),this.u("list").asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.u("list").asList.setVirtual()}doShow(){this.u("list").asList.numItems=0,this.u("typeList").asList.selectedIndex=0,this.onTypeSelect(),GI.gCfg.challengeShowInsertAd&&GI.pf.showInsertAd({sourceType:this.viewID})}doHide(){this.u("list").asList.numItems=0,this.clearRolePreview()}onTypeSelect(){this._curTypeCtrl=this._cfgs[this.u("typeList").asList.selectedIndex],this.u("txtTitle").asLabel.text=this._curTypeCtrl?this._curTypeCtrl.data.name:"",this.updateTypePrg(),this.u("list").asList.numItems=this._curTypeCtrl.cfgCount,this.u("list").asList.selectedIndex=Math.max(0,this._curTypeCtrl.getIndexByID(this.curTypeUseID)),this.u("list").asList.scrollToView(this.u("list").asList.selectedIndex),this.onItemSelect()}updateTypePrg(){this.u("txtProgress").asLabel.text=this._curTypeCtrl?this._curTypeCtrl.activeCount+"/"+this._curTypeCtrl.cfgCount:"",this.u("prg").asProgress.value=this._curTypeCtrl?100*this._curTypeCtrl.activeCount/this._curTypeCtrl.cfgCount:0,this._cfgs.forEach((t,e)=>{let i=this.u("typeList").asList.getChildAt(this.u("typeList").asList.itemIndexToChildIndex(e));if(!i)return;let s=t.canActiveCount;i.getChild("txtRoleNotice").asLabel.text=(s||"").toString(),i.getChild("imgRoleNotice").visible=s>0})}renderListItem(t,e){if(!e)return;e.data=t,e.icon=GI.uiViewMgr.getItemURL(this._curTypeCtrl.getCfgByIndex(t).icoUrl);let i=e.displayObject.getChildByName("img");i||((i=new Laya.Sprite).name="img",i.pos(10,36),e.displayObject.addChild(i)),i.loadImage(this._curTypeCtrl.getCfgByIndex(t).icoUrl)}onItemSelect(){if(this.clearRolePreview(),this._curItemData=this._curTypeCtrl.getCfgByIndex(this.u("list").asList.selectedIndex),this._curItemData)if(this._curItemData.id==this.curTypeUseID)this.u("btnUse").asButton.grayed=!0,this.u("imgPrice").visible=!1,this.u("txtUsing").asLabel.text="当前选择",this.u("txtUsing").x=this.u("btnUse").x;else if(this._curItemData.active)this.u("btnUse").asButton.grayed=!1,this.u("imgPrice").visible=!1,this.u("txtUsing").asLabel.text="选择",this.u("txtUsing").x=this.u("btnUse").x;else{let t=$t.i.money>=this._curItemData.price;this.u("btnUse").asButton.grayed=!t,this.u("imgPrice").visible=!0,this.u("imgPrice").asImage.grayed=!t,this.u("txtUsing").asLabel.text=this._curItemData.price.toString(),this.u("txtUsing").x=this._txtUsingPosX}else;switch(this._curTypeCtrl){case $t.i.data.bodyData:case $t.i.data.rodData:this._rolePreviewData=this._curItemData,this._parPreviewData=null;break;case $t.i.data.hatData:case $t.i.data.jewelryData:this._rolePreviewData=$t.i.data.bodyData.curUseData,this._parPreviewData=this._curItemData;break;default:this._rolePreviewData=null,this._parPreviewData=null}let t=[this._rolePreviewData.uiRes];this._parPreviewData&&this._parPreviewData.uiRes&&t.push(this._parPreviewData.uiRes),GI.resMgr.load(t,GI.handle(this,t=>{this.clearRolePreview(!1),this._rolePreview=this.createPreview(this._rolePreviewData),this._rolePreview&&(this._partPreview=this.createPreview(this._parPreviewData,this._rolePreview.getChildByName(this._curTypeCtrl.data.bindPtName)))}),null,Laya.Loader.JSON)}createPreview(t,e=null){if(!t)return null;let i=new Laya.Prefab;if(i.json=GI.resMgr.getRes(t.uiRes),!i.json)return null;let s=Laya.Pool.getItemByCreateFun(t.uiRes,i.create,i);return e?(GI.util.bindPros(e,t.ctrl.data.uiPtPros),e.addChild(s),s.pos(0,0),t.showPros&&t.showPros[$t.i.data.bodyData.curUseID]&&GI.util.bindPros(s,t.showPros[$t.i.data.bodyData.curUseID].ui)):(this.u("rolePt").displayObject.parent.addChild(s),s.pos(this.u("rolePt").x,this.u("rolePt").y-(e?200:0))),s}clearRolePreview(t=!0){this.recoverPreview(this._partPreview,this._parPreviewData),this._partPreview=null,t&&(this._parPreviewData=null),this.recoverPreview(this._rolePreview,this._rolePreviewData),this._rolePreview=null,t&&(this._rolePreviewData=null)}recoverPreview(t,e){t&&(t.parent.removeChild(t),GI.util.bindPros(t,e.ctrl.data.resetPros),Laya.Pool.recover(e.uiRes,t))}get curTypeUseID(){switch(this.u("typeList").asList.selectedIndex){case 0:return $t.i.data.curBodyID;case 1:return $t.i.data.curHatID;case 2:return $t.i.data.curJewelryID;case 3:return $t.i.data.curRodID}return-1}onUse(){this._curItemData&&this._curItemData.id!=this.curTypeUseID&&(this._curItemData.active?this._curTypeCtrl.curUseID=this._curItemData.id:$t.i.money>=this._curItemData.price&&($t.i.money-=this._curItemData.price,$t.i.money2-=this._curItemData.price,this._curTypeCtrl.active(this._curItemData.id),this._curTypeCtrl.curUseID=this._curItemData.id))}}class oe extends GI.UIViewBase{constructor(){super(...arguments),this.chapterId=-1,this.featherRewardLimit="feather_reward_limit",this._curPage=0}set curPage(t){this._curPage=t,this.pageIndexRecord[this.chapterId]=t,this.u("btnPre").visible=t>0,this.u("btnNext").visible=this.u("list").asList.numItems>21*(t+1)}get curPage(){return this._curPage}scrollPageView(t,e){this.list.scrollToView(21*t,e)}createPanel(){this.createPanelUI("ChallengeView"),this.makeFullScreen(),this.list=this.u("list").asList,this.pageIndexRecord={};for(let t in $t.i.data.chapterData)this.pageIndexRecord[t]=0}doBindEvt(){this.bindUiClick("btnBack",()=>{this.hideSelf(),GI.uiViewMgr.showView("ChapterView")}),this.bindUiClick("btnNext",()=>{this.curPage++,this.scrollPageView(this.curPage,!0)}),this.bindUiClick("btnPre",()=>{this.curPage--,this.scrollPageView(this.curPage,!0)}),this.bindUiClick("tbtnVideo",()=>{GI.gMsgCet.event("btn_challenge_reward",{closeFunc:this.onFinishVideo.bind(this),adIdx:0,sourceType:this.viewID})}),this.bindUiClick("btnPropGuide",()=>{let t=$t.i.data.firstUndoneGuideId();-1!=t&&GI.uiViewMgr.showView("PropCollegeView",{prop_id:t,from:this.viewID})}),this.bindUiClick("btnShop",()=>{GI.uiViewMgr.showView("ShopView",{from:this.viewID})}),this.bindUiEvt("list",fgui.Events.CLICK_ITEM,this.onItemClick),this.list.asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.list.asList.setVirtual(),this.bindGEvt("ab.chapter_update",this.doShow),this.bindGEvt("Wm.money",this.refreshLimitUI),this._nativeHt=Qt.create(this.u("nativeHt")).bindNativeAdEvt(this),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})}),this.bindUiClick("btnShareGame",this.shareGame),this.bindUiClick("btnEventEnter",this.openEventEntrance),this.bindGEvt("directGoEventView",this.hideSelf)}doShow(t){if(t&&t.onGameShow)return;$t.i.data.recordGuideBeforeView({view:this.viewID,type:"show"}),null!=t&&null!=t.chapterId&&(this.chapterId=Number(t.chapterId)),this.chapterData=$t.i.data.chapterData[this.chapterId],this.list.numItems=$t.i.data.getLevelsAmount(this.chapterId);let e=this.pageIndexRecord[this.chapterId];this.curPage=e,this.scrollPageView(e,!1),this._nativeHt.doShow({htId:3,sourceType:this.viewID}),GI.timerMgr.once(GI.gCfg.delayPopInsertAd>0?GI.gCfg.delayPopInsertAd:0,this,this.showInsertAd),GI.gCfg.showPropGuideBtn&&(this.panel.getController("propGuideCtrl").selectedPage=GI.gCfg.showPropGuideBtn),this.refreshLimitUI(),this.u("btnPropGuide").visible=!$t.i.data.isPropGuideAllDone(),this.u("btnShareGame").visible=!!GI.gCfg.challengeViewShareGame,this.popPropGuideHint(),this.panel.getController("eventCtrl").selectedPage=$t.i.isEventValid?"show":"hide",this.showBeforeView()}doHide(t){t&&t.onGameHide||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"hide"}),this.list.numItems=0,this._nativeHt.doHide(),GI.timerMgr.clear(this,this.showInsertAd))}popPropGuideHint(){if(GI.gCfg.showCollegeViewAfterFail&&$t.i.isLastLvlFail&&!$t.i.data.isPropGuideAllDone()){let t=$t.i.data.firstUndoneGuideId();-1!=t&&GI.uiViewMgr.showView("PropCollegeView",{prop_id:t,from:this.viewID})}}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&GI.gMsgCet.event("pf.shareGame")}})}showInsertAd(){GI.timerMgr.clear(this,this.showInsertAd),GI.gCfg.challengeShowInsertAd&&GI.pf.showInsertAd({sourceType:this.viewID})}renderListItem(t,e){if(!e)return;e.data=t;$t.i.data.chapterCfgs[this.chapterId].levels;this.u("txtLvl",e.asCom).asLabel.text=(t+1).toString();for(let t=1;t<=3;t++)this.u("star"+t,e.asCom).visible=!1;if(1==this.chapterData.levels[t].locked&&0==GI.gCfg.unlock_all_chapter)e.asCom.getController("displayCtrl").selectedPage="lock";else{e.asCom.getController("displayCtrl").selectedPage="enable";for(let i=1;i<=this.chapterData.levels[t].bestRank;i++)this.u("star"+i,e.asCom).visible=!0}GI.gCfg.offline_chest_module&&(this.u("imgChest1",e.asCom).visible=this.u("imgChest2",e.asCom).visible=(t+1)%5==0&&!this.chapterData.levels[t].chestCollectCount)}onItemClick(t,e){if(!t||null==t.data)return;let i=Number(t.data);1!=this.chapterData.levels[i].locked||0!=GI.gCfg.unlock_all_chapter?$t.i.data.getLvlPlayTime(this.chapterId,i+1)?$t.i.money>=GI.gCfg.restartComsume?($t.i.data.changeMoney({useOrGain:0,gemNum:GI.gCfg.restartComsume,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.mi_restart_level,gemdetails:""}),this.toLvl(i+1)):GI.uiViewMgr.showView("AbRewardView",{reward_id:1}):this.toLvl(i+1):GI.uiViewMgr.showView("UnlockChapterView",{fromView:this.viewID})}toLvl(t){this.hideSelf(),$t.i.startLvl(t)}onFinishVideo(t,e){if(GI.log("关卡界面播放完视频广告：",t,e),!t)return;let i=$t.i.data.commercialCfg.reward;this.rewardId=Math.round(Math.random()*(Object.keys(i).length-1))+1;let s=i[this.rewardId];if(1==s.isCurrency)$t.i.data.changeMoney({useOrGain:1,gemNum:s.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_Feather_reward,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7});else{let t=s.prop_id;$t.i.data.presentUpdateData(t,s.quantity)}$t.i.popObtainView({name:s.name,quantity:s.quantity,iconName:s.iconName})}refreshLimitUI(){$t.i.data.timeLimitData[this.featherRewardLimit]&&(this.panel.getController("redShopCtrl").selectedPage=$t.i.data.isTimeLimitNextStage(this.featherRewardLimit)?"hide":"show")}openEventEntrance(){$t.i.openEventEntrance()}showBeforeView(){GI.gCfg.dailyChallenge&&0==$t.i.data.isTimeLimitNextStage("popEventAnnounce")&&$t.i.enterNoramlScene&&($t.i.enterNoramlScene=!1,$t.i.data.costTimeLimit("popEventAnnounce"),GI.uiViewMgr.showView("EventAnnounceView"))}}class ne extends GI.UIViewBase{constructor(){super(...arguments),this.featherRewardLimit="feather_reward_limit"}createPanel(){this.needMask=!0,this.createPanelUI("ChapterView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnBack",()=>{this.hideSelf(),GI.uiViewMgr.showView("SysMainUi")}),this.bindUiClick("tbtnVideo",()=>{GI.gMsgCet.event("btn_chapter_reward",{closeFunc:this.onFinishVideo.bind(this),adIdx:0,sourceType:this.viewID})}),this.bindUiClick("btnPropGuide",()=>{let t=$t.i.data.firstUndoneGuideId();-1!=t&&GI.uiViewMgr.showView("PropCollegeView",{prop_id:t,from:this.viewID})}),this.bindUiClick("btnShop",()=>{GI.uiViewMgr.showView("ShopView",{from:this.viewID})});let t=$t.i.data.chapterCfgs;for(let e in t)this.bindUiClick("btnChapter"+e,()=>{Number(e)>2?GI.gInfoMgr.showInfoCont(1,"章节尚未开启"):1!=$t.i.data.chapterData[e].locked||0!=GI.gCfg.unlock_all_chapter?(this.hideSelf(),$t.i.curChapter=Number(e),GI.uiViewMgr.showView("ChallengeView",{chapterId:e})):GI.gInfoMgr.showInfoCont(1,"本章节尚未解锁")});this.bindGEvt("ab.chapter_update",this.doShow),this.bindGEvt("Wm.money",this.refreshLimitUI),this._nativeHt=Qt.create(this.u("nativeHt")).bindNativeAdEvt(this),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})}),this.bindUiClick("btnEventEnter",this.openEventEntrance),this.bindUiClick("btnRank",this.openRankView),this.bindGEvt("lastRankScoreUpdate",this.updateRankRewardHint),this.bindGEvt("rankScoreUpdate",this.updateRankScore),this.panel.getController("ctrlRank").selectedPage=GI.pf.openRank?"show":"hide",this.bindUiClick("btnRank2",()=>{GI.uiViewMgr.showView("RankView")})}doShow(t){t&&t.onGameShow||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"show"}),this.initUI(),this._nativeHt.doShow({htId:2,sourceType:this.viewID}),this.popPropGuideHint(),this.panel.getController("eventCtrl").selectedPage=$t.i.isEventValid?"show":"hide",this.updateRankScore(),this.updateRankRewardHint(),this.panel.getController("rankCtrl").selectedPage=GI.gCfg.rankData&&$t.i.isEventValid?"show":"hide")}doHide(t){t&&t.onGameHide||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"hide"}),this._nativeHt.doHide())}onFinishVideo(t,e){if(GI.log("章节界面播放完视频广告：",t,e),!t)return;let i=$t.i.data.commercialCfg.reward;this.rewardId=Math.round(Math.random()*(Object.keys(i).length-1))+1;let s=i[this.rewardId];if(1==s.isCurrency)$t.i.data.changeMoney({useOrGain:1,gemNum:s.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_Feather_reward,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7});else{let t=s.prop_id;$t.i.data.presentUpdateData(t,s.quantity)}let a=$t.i.data.commercialCfg.reward[this.rewardId];$t.i.popObtainView({name:a.name,quantity:a.quantity,iconName:a.iconName})}initUI(){let t=$t.i.data.chapterData;for(let e in t){let i=t[e];this.u("lock"+e).visible=Number(e)>2||1==i.locked&&0==GI.gCfg.unlock_all_chapter;let s=0,a=0,r=0;for(let t of i.levels)s+=t.bestScore,a+=t.bestRank,r+=3;this.u("txtScore"+e).asTextField.text=s.toString(),this.u("txtRank"+e).asTextField.text=a+"/"+r}GI.gCfg.showPropGuideBtn&&(this.panel.getController("propGuideCtrl").selectedPage=GI.gCfg.showPropGuideBtn),this.refreshLimitUI(),this.u("btnPropGuide").visible=!$t.i.data.isPropGuideAllDone()}refreshLimitUI(){$t.i.data.timeLimitData[this.featherRewardLimit]&&(this.panel.getController("redShopCtrl").selectedPage=$t.i.data.isTimeLimitNextStage(this.featherRewardLimit)?"hide":"show")}popPropGuideHint(){if(!GI.gCfg.showCollegeViewAfterFail&&GI.gCfg.showPropGuideBtn&&!$t.i.data.isPropGuideAllDone()){let t=$t.i.data.firstUndoneGuideId();-1!=t&&GI.uiViewMgr.showView("PropCollegeView",{prop_id:t,from:this.viewID})}}openEventEntrance(){$t.i.openEventEntrance()}openRankView(){GI.uiViewMgr.showView("RankInfoView")}updateRankRewardHint(){this.u("red").visible=$t.i.data.hasLastRankReward()}updateRankScore(){this.u("txtRank").text=$t.i.data.rankScore.toString()}}class he{constructor(t){this._visible=!1,this.txtBar=new Array,this.txtArray=GI.gCfg.barrages,this._uBtn=t}static create(t,e=null,i=null){return GI.util.bindPros(new he(GI.util.bindPros(t,i)),e)}get visible(){return this._visible}doShow(t){this._visible=!0,this.showStep()}updatePos(t){null!=t&&(this._uBtn.y=t-this._uBtn.height)}showStep(){this.txtArray&&(this.showTxt(!0),GI.timerMgr.once(Math.floor(Math.random()*(GI.gCfg.barrageMaxTime-GI.gCfg.barrageMinTime))+GI.gCfg.barrageMinTime,this,this.showStep))}showTxt(t=!1){let e=Laya.Pool.getItemByCreateFun("BarrageTxt",this.CreateTxtFunc,this);e.text=this.txtArray[Math.floor(Math.random()*this.txtArray.length)],e.color=GI.gCfg.barrageColors[Math.floor(Math.random()*GI.gCfg.barrageColors.length)],t&&this.txtBar.push(e),this._uBtn.displayObject.addChild(e);let i=GI.gw()+100,s=Math.floor(Math.random()*this._uBtn.height);e.pos(i,s),this.forwardFunc(e)}twEnd(t){null!=t&&(t._tw=null,this.circleTxt(t))}circleTxt(t){t.x=2e3,Laya.Pool.recover("BarrageTxt",t)}doHide(){this._visible=!1;for(let t=0;t<this.txtBar.length;t++){let t=this.txtBar.pop();null!=t._tw&&(GI.Tween.clear(t._tw),t._tw=null),this.circleTxt(t)}GI.timerMgr.clear(this,this.showStep)}bindNativeAdEvt(t){return this}forwardFunc(t){t._tw=GI.Tween.to(t,{x:-750},5e3,null,Laya.Handler.create(this,this.twEnd,[t]),0,!1,!1)}CreateTxtFunc(){let t=new Laya.Text;return t.fontSize=30,t.font="Arial",t.bold=!0,t}}class le extends GI.UIViewBase{constructor(){super(...arguments),this.isPropBarOpen=!1,this._isGuiding=!1,this.guideIdMap={1:6,2:7,3:8,4:9,5:10,6:11},this.propUseData={}}set isGuiding(t){this._isGuiding!=t&&(this._isGuiding=t,$t.i.canOperate=!t)}get isGuiding(){return this._isGuiding}createPanel(){this.createPanelUI("GamePlayView"),this.makeFullScreen();let t=GI.gMsgCet.fetch("GamePlayView-propShareCtrl");t&&(this.panel.getController("propShareCtrl").selectedPage=t),GI.log("------------------------------- "+GI.gCfg.shortcut),this.panel.getController("shortcut").selectedPage=GI.gCfg.shortcut,GI.gCfg.GamePlayViewShowCoin&&(this.panel.getController("coinCtrl").selectedPage="show"),this.dropBirdComp=this.u("dropBird").asCom,this.eventPrgBar=this.u("eventPrgBar").asProgress}doBindEvt(){this._barrageComp=he.create(this.u("barrage")).bindNativeAdEvt(this),this.bindGEvt("Wm.money",()=>{this.showRestartIconInfo(),this.refreshLimitUI(),this.refreshCoinUi()});let t=this.u("ctrlArea");this.bindUiEvt(t,Laya.Event.MOUSE_DOWN,t=>{GI.gMsgCet.event("abCtrl.MOUSE_DOWN",t)}),this.bindUiEvt(t,Laya.Event.MOUSE_UP,t=>{GI.gMsgCet.event("abCtrl.MOUSE_UP",t)}),this.bindUiEvt(t,Laya.Event.MOUSE_OUT,t=>{GI.gMsgCet.event("abCtrl.MOUSE_OUT",t)}),this.bindUiEvt(t,Laya.Event.MOUSE_MOVE,t=>{GI.gMsgCet.event("abCtrl.MOUSE_MOVE",t)}),this.bindUiClick("btnPause",()=>{this.displayPausePanel(!0)}),this.bindUiClick("btnRestart",()=>{$t.i.data.isGuideScene?(this.hideSelf(),this.restartLvl(!0,null)):$t.i.isEventScene?GI.pf.showVideoAd({closeFunc:this.doneEventRestartVideo.bind(this),adIdx:1,sourceType:this.viewID}):$t.i.data.timeLimitData.feather_reward_limit&&$t.i.data.isTimeLimitNextStage("feather_reward_limit")&&$t.i.money<GI.gCfg.moneyLimit?GI.gMsgCet.event("btn_restart_game",{closeFunc:this.restartLvl.bind(this),adIdx:1,sourceType:this.viewID}):$t.i.money>=GI.gCfg.restartComsume?($t.i.money-=GI.gCfg.restartComsume,this.restartLvl2(!0)):GI.uiViewMgr.showView("AbRewardView",{reward_id:1})}),this.bindGEvt("ab.showGridAd",()=>{this.showGridInfo()}),this.bindGEvt("ab.hideGridAd",()=>{this.hideGridInfo()}),this.bindGEvt("AddGameGrade",t=>{this.updateCurrentScore()}),this.bindUiClick("btnOpenProp",()=>{this.directHidePropPoint(),this.displayProBar(!this.isPropBarOpen)}),this.bindUiClick("btnShop",()=>{GI.uiViewMgr.showView("ShopView",{from:"GamePlayView"})}),this.bindUiClick("btnShareGame",this.shareGame),this.bindUiClick("btnShortcut",this.createShortcut),this.bindGEvt("ab.RigEnd",()=>{this.displayProBar(!1,()=>{this.displayIcons(!1),this.checkPropHintDisplay()})}),this.bindGEvt("ab.prop_change",this.updatePropCount);for(let t in $t.i.data.props)null!=this.u("btnProp"+t)&&this.bindUiClick("btnProp"+t,()=>{let e=0!=$t.i.data.props[t].quantity;if($t.i.data.isGuideScene&&(e=Number(t)==$t.i.data.propGuideId,GI.gMsgCet.event("ab.moveToBird")),e){$t.i.data.usePropUpdateData(t,$t.i.data.isGuideScene),$t.i.shouldShowPropPoint=!1,this.displayPropPoint();let e={6:9,1:10,2:11,3:12,4:13};!$t.i.data.isGuideScene&&$t.i.data.finishWelfareTask(e[t])}else GI.gMsgCet.fetch("btn_use_empty_prop",{from:"GamePlayView",prop_id:t,alreadyShare:this.propUseData[t].alreadyShare,doneFunc:this.clickPropAfterShare.bind(this)})||GI.uiViewMgr.showView("ShopView",{from:"GamePlayView",prop_id:t})});this.bindGEvt("ab.use_prop",this.onUseProp),this.bindGEvt("bird_eject",this.onBirdEject),this.bindGEvt("ab.camShake",this.onQuakeFinish),this.bindGEvt("ab.load_bird",this.updatePropCount),this._nativeHt=Qt.create(this.u("nativeHt")).bindNativeAdEvt(this),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})}),this.bindGEvt("show_prop_pointer",this.displayPropPoint),this.bindUiClick("btnVip",this.openVipView),this.bindUiClick("btnChest",this.openChestView),this.dropBirdComp.getChild("imgLoader").onClick(this,this.dropBirdSay),this.bindGEvt("ab.pigRemove",this.onPigRemove),this.bindUiClick("btnRewardPreview",this.clickRewardPreview),this.bindUiClick("btnFreeProp",this.openFreeProp),this.bindGEvt("propRewardGive",this.displayFreePropBtn,!1),this.bindUiClick("btnWelfare",this.openWelfareView),this.bindGEvt("welfareRefresh",this.checkWelfareBtn)}doShow(t){t&&t.onGameShow||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"show",chapter:$t.i.curChapter,lvl:$t.i.curLvl}),this.resetPropUseData(),this.applyUI(),GI.uiViewMgr.showView("ScoreView"),$t.i.data.isGuideScene||this._barrageComp.doShow(),this._nativeHt.doShow({htId:4,sourceType:this.viewID}),this.showRestartIconInfo(),this.refreshLimitUI(),this.showGridInfo(),this.u("btnShareGame").visible=!!GI.gCfg.shareCfgs,this.directHidePropPoint(),this.refreshChestRed(),GI.gCfg.offline_chest_module&&GI.timerMgr.loop(1e3,this,this.refreshChestRed),this.lockedBirdDrop(),this.refreshCoinUi(),this.initEventUi(),this.panel.getController("topBarCtrl").selectedPage=GI.gCfg.offline_chest_module&&!$t.i.data.isDailyChallengeScene?"gapTwoBtn":"normal",this.displayFreePropBtn(!$t.i.data.isTimeLimitNextStage("start_prop_reward")&&!$t.i.data.isGuideScene),this.checkWelfareBtn(),this.checkPropHintDisplay())}checkPropHintDisplay(){this.panel.getController("propHint").selectedPage=$t.i.isNormalSc&&!$t.i.isWaitWin&&"hide"==this.panel.getController("propBarPointCtrl").selectedPage?"y":"n"}slowHidePropPointer(){GI.timerMgr.clear(this,this.displayPropPoint),GI.Tween.to(this.u("propHintBg"),{alpha:0},1e3*this.panel.getTransition("hidePropBarPoint").getLabelTime("fadeOut")),this.panel.getTransition("hidePropBarPoint").play(GI.handle(this,this.directHidePropPoint))}directHidePropPoint(){GI.timerMgr.clear(this,this.displayPropPoint),this.panel.getController("propBarPointCtrl").selectedPage="hide",this.checkPropHintDisplay()}doHide(t){t&&t.onGameHide||($t.i.data.recordGuideBeforeView({view:this.viewID,type:"hide"}),this.displayPausePanel(!1),this.displayProBar(!1),GI.uiViewMgr.hideView("ScoreView"),$t.i.data.isGuideScene||this._barrageComp.doHide(),this._nativeHt.doHide(),GI.gMsgCet.off("Wm.money",this,this.showRestartIconInfo),this.hideGridInfo(),GI.gCfg.offline_chest_module&&GI.timerMgr.clear(this,this.refreshChestRed),this.hideDropBirdSay())}displayPropPoint(){GI.timerMgr.clear(this,this.displayPropPoint),$t.i.shouldShowPropPoint?(this.panel.getController("propBarPointCtrl").selectedPage="show",this.checkPropHintDisplay(),$t.i.shouldShowPropPoint=!1,GI.timerMgr.once(2e3,this,this.displayPropPoint)):this.slowHidePropPointer()}clickPropAfterShare(t){this.propUseData[t.prop_id]&&(this.propUseData[t.prop_id].alreadyShare=!0),t.delay?GI.timerMgr.once(t.delay,this,()=>{$t.i.data.usePropUpdateData(t.prop_id,!0)}):$t.i.data.usePropUpdateData(t.prop_id,!0)}resetPropUseData(){let t=$t.i.data.props;for(let e in t)this.propUseData[e]={alreadyShare:!1}}applyUI(){let t=$t.i.data.isGuideScene;if(this.panel.getController("displayCtrl").selectedPage=t?"guide":"game",!t&&!$t.i.isEventScene&&!$t.i.data.isDailyChallengeScene){let t=$t.i.data.chapterData[$t.i.curChapter].levels[$t.i.curLvl-1];this.u("txtBestScore").asTextField.text=t.bestScore}let e=$t.i.data.commercialCfg.prop_enum.double_point;null!=$t.i.data.usingProp[e]&&(this.u("txtDoublePoint").visible=$t.i.data.usingProp[e].count>0),this.displayIcons(!$t.i.isWaitWin),this.updatePropCount(),this.updateCurrentScore(),this.displayProBar(!0,()=>{$t.i.data.isGuideScene&&(GI.guideMgr.start(this.guideIdMap[$t.i.data.propGuideId]),this.isGuiding=!0)})}displayIcons(t){this.panel.getController("waitEndCtrl").selectedPage=t?"show":"hide"}updateCurrentScore(){this.u("txtScore").asTextField.text=$t.i.data.GameGrade.toString()}displayProBar(t,e){if($t.i.data.isDailyChallengeScene)return;if(this.isPropBarOpen==t)return void(e&&e());let i=this.panel.getTransition("openProp");t?i.play(GI.handle(this,e)):i.playReverse(GI.handle(this,e)),this.isPropBarOpen=t}displayPausePanel(t){$t.i.data.isDailyChallengeScene?(t&&GI.uiViewMgr.showView("DailyChallengePauseView"),!t&&GI.uiViewMgr.hideView("DailyChallengePauseView")):(t&&GI.uiViewMgr.showView("GamePauseView"),!t&&GI.uiViewMgr.hideView("GamePauseView"))}showInsertAd(){GI.gCfg.challengeShowInsertAd&&GI.pf.showInsertAd({sourceType:this.viewID})}updatePropCount(){let t=$t.i.data.props,e=$t.i.data.isGuideScene,i=$t.i.data.propGuideId;if(e)for(let e in t)Number(e)==i?t[e].quantity=-1:t[e].quantity=0;for(let s in t){let a=this.u("btnProp"+s),r=this.u("txtPropCount"+s),o=this.u("imgAddProp"+s);if(null!=a){let t=$t.i.data.usingProp[s].count,r=!e||Number(s)==i;a.enabled=t<=0&&r}if(null!=r){let e=t[s].quantity;r.asTextField.text=-1==e?"∞":e,r.visible=0!=t[s].quantity}null!=o&&(o.visible=0==t[s].quantity&&!e)}}onUseProp(t){this.isGuiding&&$t.i.data.isGuideScene&&(GI.guideMgr.stopCurGuide(),this.isGuiding=!1);let e=Number(t.prop_id),i=this.panel.getTransition("useProp"+e);i&&i.play(),this.updatePropCount();let s=$t.i.data.commercialCfg.prop_enum;switch(e){case s.bird_intensify:this.u("btnProp"+s.blast).enabled=!1;break;case s.double_point:this.u("txtDoublePoint").visible=!0;break;case s.blast:$t.i.data.props[s.bird_intensify].quantity>0&&!$t.i.data.isGuideScene&&(this.u("btnProp"+s.bird_intensify).enabled=!0)}}onBirdEject(t){if(t&&Array.isArray(t)){let e=$t.i.data.commercialCfg.prop_enum,i={0:e.bird_intensify,1:e.blast};for(let e=0;e<t.length;e++)1==t[e]&&this.doneUseProp(i[e])}}onQuakeFinish(t){t&&t.shadkeDuration&&GI.timerMgr.once(t.shadkeDuration,this,()=>{this.doneUseProp($t.i.data.commercialCfg.prop_enum.quake),this.updatePropCount()})}doneUseProp(t){let e=$t.i.data.usingProp[t];e&&e.count>0&&e.count--}restartLvl2(t=!1){this.hideSelf(),$t.i.shouldShowPropPoint=!0,$t.i.reStart(t)}restartLvl(t,e){GI.log("游戏界面重开，播放完视频广告：",t,e),t&&this.restartLvl2()}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&GI.gMsgCet.event("pf.shareGame")}})}createShortcut(){GI.log("-----------创建快捷方式---------"),GI.gMsgCet.event("ab.createShortCut",{succesFunc:()=>{GI.log("-------桌面快捷方式创建成功--------")},failFunc:t=>{GI.log("-------桌面快捷方式创建失败--------",t)},completeFunc:t=>{GI.log("-------桌面快捷方式完成回调--------",t)},fromview:"click"})}showRestartIconInfo(){this.panel.getController("videoTimes").selectedPage="show",$t.i.data.isGuideScene?this.panel.getController("videoTimes").selectedPage="hide":$t.i.data.timeLimitData.feather_reward_limit&&$t.i.data.isTimeLimitNextStage("feather_reward_limit")&&$t.i.money<GI.gCfg.moneyLimit?this.panel.getController("videoTimes").selectedPage="hide":this.panel.getController("videoTimes").selectedPage="show"}refreshLimitUI(){$t.i.data.timeLimitData.feather_reward_limit&&(this.panel.getController("shopRedIconCtrl").selectedPage=$t.i.data.isTimeLimitNextStage("feather_reward_limit")?"hide":"show")}showGridInfo(){!GI.gCfg.gridSwitch||$t.i.isEventScene||$t.i.data.isDailyChallengeScene||GI.gMsgCet.event("btn_show_gridAd")}hideGridInfo(){!GI.gCfg.gridSwitch||$t.i.isEventScene||$t.i.data.isDailyChallengeScene||GI.gMsgCet.event("close_show_gridAd")}showDesktopQuick(){GI.gCfg.desktopQuick}openChestView(){GI.uiViewMgr.showView("OfflineRewardView")}openVipView(){GI.uiViewMgr.showView("SuperShooterView")}refreshChestRed(){GI.gCfg.offline_chest_module&&($t.i.data.offlineInitFeather>0||(this.u("chestRed").visible=Date.now()-$t.i.data.beginOfflineTime>GI.gCfg.offline_chest_module.duration||$t.i.data.chestCollectCount>0))}lockedBirdDrop(){if(!GI.gCfg.unlockBirdHint)return;let t=$t.i.data.courseData,e="",i=GI.gCfg.coursePageCfg;for(let t in i)if(Number(t)<6&&$t.i.curChapter<=i[t].chapter&&$t.i.curLvl<i[t].lvl){e=t;break}let s=t[e]&&t[e].show_count<=0&&!$t.i.isEventScene&&!$t.i.data.isDailyChallengeScene;this.panel.getController("dropBirdCtrl").selectedPage=s?"show":"hide",s&&i[e].bird_icon&&(this.dropBirdComp.getChild("imgLoader").asLoader.url=GI.uiViewMgr.getItemURL(i[e].bird_icon),this.dropBirdComp.getChild("txtSay").text=i[e].desc,this.dropBirdSay())}dropBirdSay(){this.dropBirdComp.getController("sayCtrl").selectedPage="show",GI.timerMgr.once(3e3,this,this.hideDropBirdSay)}hideDropBirdSay(){GI.timerMgr.clear(this,this.hideDropBirdSay),this.dropBirdComp.getController("sayCtrl").selectedPage="hide"}onChestItemCollect(t){let e=GI.uiViewMgr.createUiObj("FlyChest").asCom,i=this.globalToLocal(Laya.Point.TEMP.setTo(t.point.x+GI.sceneMgr.mapX-GI.gScale()*this.panel.width/2,t.point.y+GI.sceneMgr.mapY-GI.gScale()*this.panel.height/2));e.setXY(i.x,i.y),e.setScale(0,0),this.panel.addChild(e),GI.Tween.to(e,{scaleX:1,scaleY:1},500,Laya.Ease.bounceOut,GI.handle(this,()=>{GI.Tween.to(e,{x:this.u("btnChest").x,y:this.u("btnChest").y,scaleX:.2,scaleY:.2},1500,Laya.Ease.linearNone,GI.handle(this,()=>{this.panel.removeChild(e),this.refreshChestRed()}))}))}refreshCoinUi(){GI.gCfg.GamePlayViewShowCoin&&(this.u("coinCorner").asCom.getChild("txtCoin").asTextField.text=$t.i.abbreviateNumber($t.i.money))}initEventUi(){if(!GI.gCfg.timelimitEvent)return;let t="normal";$t.i.isEventScene?t="event":$t.i.data.isDailyChallengeScene&&(t="challenge",this.u("txtChallengeStep").text="当前进度："+($t.i.data.dailyChallengeData.curStep+1)+"/"+GI.gCfg.dailyChallenge.totalStep,this.u("txtChallengeScore").text="当前积分："+$t.i.data.dailyChallengeData.score.toString()),this.panel.getController("eventSceneCtrl").selectedPage=t,this.eventPrgBar.max=GI.gCfg.timelimitEvent.prgMax,this.eventPrgBar.value=0,this.u("txtEventPrg").text="0/"+GI.gCfg.timelimitEvent.prgMax;for(let t of GI.gCfg.timelimitEvent.medals)this.u("txtMedal"+t.id).text=t.score.toString(),this.u("medalCheck"+t.id).visible=!1,this.u("imgMedal"+t.id).x=this.u("eventPrgBar").x+this.u("eventPrgBar").width*t.score/GI.gCfg.timelimitEvent.prgMax}onPigRemove(t){if($t.i.isEventScene){this.eventPrgBar.value=t.score,this.u("txtEventPrg").text=this.eventPrgBar.value+"/"+GI.gCfg.timelimitEvent.prgMax;for(let e of GI.gCfg.timelimitEvent.medals)if(t.score>=e.score){this.u("medalCheck"+e.id).visible=!0;break}}else $t.i.data.isDailyChallengeScene&&(this.u("txtChallengeScore").text="当前积分："+t.score)}doneEventRestartVideo(t,e){t&&(this.hideSelf(),$t.i.reStart())}clickRewardPreview(){let t="";$t.i.isEventScene?t="event":$t.i.data.isDailyChallengeScene&&(t="challenge"),GI.uiViewMgr.showView("EventRewardView",{type:t})}openFreeProp(){GI.uiViewMgr.showView("PropRewardView",{type:"manulOpen"})}displayFreePropBtn(t){this.u("btnFreeProp").visible=this.u("imgFreeProp").visible=t}openWelfareView(){GI.uiViewMgr.showView("RookieWelfareView")}checkWelfareBtn(){if(GI.gCfg.rookieWelfare){let t=GI.localDataMgr.getBool("doneAllWelfare");if(this.panel.getController("shortcut").selectedPage=t?"none":"welfare",!t){let t=!1,e=$t.i.data.rookieWelfare;for(let i in e)if("done"==e[i].status){t=!0;break}this.u("welfareRed").visible=t}}}}class de extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("PrgView"),this._bar=this.u("bar").asProgress}doBindEvt(){this.bindGEvt("PrgMgr.progress",()=>{this._bar.value=GI.prgMgr.prg},!0)}}class ge extends GI.UIViewBase{createPanel(){this._layer=GI.uiViewMgr.getMaskViewLayer(this.viewID),this.autoShowOnGShow=!1,this.createPanelUI("MaskView"),this.makeFullScreen(),this.defaultAlpha=this.u("bg").asCom.alpha}get curMaskview(){return GI.uiViewMgr.curMaskview}autoUpdatePanelDepth(){this.bringToBottom(),this.curMaskview&&this.curMaskview.panel.parent==this.panel.parent&&this.panel.parent.setChildIndex(this.panel,this.panel.parent.getChildIndex(this.curMaskview.panel)-1)}doBindEvt(){this.bindUiClick(this.panel,()=>{GI.uiViewMgr.onMaskClick()})}doShow(){let t=this.curMaskview.maskPros;this.u("bg").alpha=t?t.alpha:this.defaultAlpha}doHide(){}}class ce{constructor(t,e){this.adType="nativeAd",this._visible=!1,this._curAdIndex=-1,this._uBtn=t,this._pros=e,this._pros&&this._pros.adType&&(this.adType=this._pros.adType),this._adIconBg=this._uBtn.asCom.getChild("adIconBg"),this._btnAdClose=this._uBtn.asCom.getChild("btnAdClose"),this._icon=new Laya.Sprite,this._icon.mouseEnabled=!0,this._uBtn.displayObject.addChild(this._icon),this._uBtn.displayObject.setChildIndex(this._icon,this._uBtn.asCom.getChildIndex(this._adIconBg)+1),this._uBtn.visible=!1}static create(t,e=null){return new ce(t,e)}get visible(){return this._visible}get iconX(){return this._icon.x}get iconY(){return this._icon.y}get iconWidth(){return this._icon.displayWidth}get iconHeight(){return this._icon.displayHeight}bindNativeAdEvt(t){return t.bindUiClick(this._icon,()=>{this.clickAdFunc()}),t.bindUiClick(this._btnAdClose,()=>{this._uBtn.visible=!1}),this}doShow(){this._visible=!0,this._adData=GI.pf.showNativeAd({adType:this.adType,pros:this._pros}),this._adData?this.updateData():this._pros&&this._pros.closeOnEmpty?this.doHide():this.onNativeAdError()}doHide(){this._visible=!1,this.clearData(!0),this.closeFunc&&this.closeFunc()}clearData(t=!1){t&&(this._uBtn.visible=!1),GI.timerMgr.clear(this,this.onNativeAdTimer),GI.timerMgr.clear(this,this.onNativeAdErrorTimer);let e=this._adData;this._adData=null,this._curAdIndex=-1,GI.pf.hideNativeAd({adData:e})}get adData(){return this._adData}updateData(){this._curAdIndex=-1,this.onNativeAdTimer(),GI.timerMgr.loop(GI.gCfg.nativeAdTime,this,this.onNativeAdTimer)}onNativeAdTimer(){if(this._curAdIndex++,this._curAdIndex>=this._adData.adList.length)return this.clearData(),void this.doShow();let t=this._adData.adList[this._curAdIndex];GI.pf.reportAdShow({adData:this._adData,adInfo:t}),t&&t.imgUrlList&&this._icon.loadImage(t.imgUrlList[0],GI.handle(this,()=>{this._pros&&this._pros.fill?this._icon.size(this._uBtn.width,this._uBtn.height):(this._icon.scaleX=this._icon.scaleY=this._pros&&this._pros.keepOrigin?Math.min(1,.5*Laya.stage.designWidth/this._icon.texture.width,.5*Laya.stage.designHeight/this._icon.texture.height):Math.min(this._uBtn.width/this._icon.texture.width,this._uBtn.height/this._icon.texture.height),this._icon.size(this._icon.texture.width,this._icon.texture.height)),this._adIconBg.setSize(this._icon.displayWidth-2*this._adIconBg.x,this._icon.displayHeight-2*this._adIconBg.y),this._pros&&this._pros.keepOrigin&&this._uBtn.setSize(this._icon.displayWidth,this._icon.displayHeight),this._uBtn.visible=!0,this.loadImageFunc&&this.loadImageFunc(t)}))}onNativeAdError(){this.clearData(!0),GI.timerMgr.once(GI.gCfg.nativeAdErrorTime,this,this.onNativeAdErrorTimer)}onNativeAdErrorTimer(){this.doShow()}clickAdFunc(){this._adData&&GI.pf.reportAdClick({adData:this._adData,adInfo:this._adData.adList[this._curAdIndex]})}}class ue extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.autoShowOnGShow=!1,this.createPanelUI("InsertAdView"),this.makeFullScreen(),this.u("nativeAd").asCom.getChild("btnAdClose").visible=!1}doBindEvt(){this._nativeAd=ce.create(this.u("nativeAd"),{keepOrigin:!0,adType:"insertAd",closeOnEmpty:!0}).bindNativeAdEvt(this),this.bindClickHide("btnClose"),this._nativeAd.loadImageFunc=this.onNativeAdLoad.bind(this),this.bindUiClick("bgContian",()=>{this._nativeAd.clickAdFunc()}),GI.gCfg.ShowInsertAdLogo&&(this.u("InnerAdLogo").asCom.visible=!0,this.u("InnerAdLogoWord").asCom.visible=!0)}doShow(){GI.gMsgCet.event("pf.InsertAdView.show"),this._nativeAd.closeFunc=this.hideSelf.bind(this),this._nativeAd.doShow()}doHide(){this._nativeAd.closeFunc=null,this._nativeAd.doHide(),GI.gMsgCet.event("pf.InsertAdView.hide")}onNativeAdLoad(t){this.u("nativeAdText").text=t.title}}class pe extends GI.UIViewBase{constructor(){super(...arguments),this._idView=null}createPanel(){this._layer=GI.UiLayerEnum.pop,this.autoShowOnGShow=!1,this.createPanelUI("BannerAdView"),this.makeFullScreen(),this.u("nativeAd").asCom.getChild("btnAdClose").visible=this.u("descSmall").visible=!1}doBindEvt(){this._nativeAd=ce.create(this.u("nativeAd"),{adType:"bannerAd",fill:!0}).bindNativeAdEvt(this),this.bindUiClick("btnClose",()=>{this.closeView()}),this._nativeAd.loadImageFunc=this.onNativeAdLoad.bind(this),this.bindUiClick("btnAd",()=>{this._nativeAd.clickAdFunc()})}doShow(t){this._idView=null;let e=null;if(GI.gCfg.bannerStyleCons&&t.args){let i="default";for(let s in GI.gCfg.bannerStyleCons)if(s==t.args.viewId.split("_")[1]&&t.args.view){GI.gCfg.bannerStyleCons[s].styleCtrl&&(i=GI.gCfg.bannerStyleCons[s].styleCtrl),e=GI.gCfg.bannerStyleCons[s].nativeImgStyle;break}this.panel.getController("styleCtrl").selectedPage=i}let i=t&&t.style;i.x?this.u("n43").asCom.x=i.x:this.u("n43").asCom.x=(GI.gw()-this.u("n43").width)/2;let s=this.u("n43").asCom.x,a=this.u("btnClose").asCom.width;this.u("n43").asCom.y=i.top-GI.uiViewMgr.uiOffY,this.u("nativeAd").setSize(i.width,i.height),e&&this.u("nativeAd").setSize(e.width,e.height),this.u("nativeAd").setXY(s+a,i.top-GI.uiViewMgr.uiOffY),this.u("n43").asCom.visible=!1,this.u("btnClose").asCom.visible=!1,this.u("descSmall").visible=!1,this._nativeAd.closeFunc=this.hideSelf.bind(this),this._nativeAd.doShow(),GI.gMsgCet.event("nativeBanner.showSuccess")}doHide(){this._nativeAd.closeFunc=null,this._nativeAd.doHide()}closeView(){GI.gMsgCet.event("banner.adview"),this.hideSelf()}onNativeAdLoad(t){this.u("n43").asCom.visible=!0,this.u("btnClose").asCom.visible=!0,this.u("descSmall").visible=!0,this.u("nativeAd").y,this._nativeAd.iconY,this.u("btnClose").height,this.u("btnClose").scaleY,this.u("title").text=t.title,this.u("desc").text=t.desc}}class me extends GI.UIViewBase{constructor(){super(...arguments),this._currentPage=0,this.totalPage=7}set currentPage(t){if(this._currentPage==t)return;let e=this._currentPage;this._currentPage=t,this.changePage(e)}get currentPage(){return this._currentPage}createPanel(){this.createPanelUI("AbGuideView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("guidePanel",()=>{}),this.bindUiClick("mask",()=>{!this.isSinglePage&&this.closeGuide()}),this.bindUiClick("btnNext",()=>{this.isSinglePage||this.currentPage>=this.totalPage?this.closeGuide():this.currentPage++})}doShow(t){null!=t&&null!=t.isSingle&&null!=t.guidePage&&(this.currentPage=t.guidePage,this.isSinglePage=t.isSingle,this.callback=t.callback),$t.i.canOperate=!1}doHide(){$t.i.canOperate=!0}changePage(t){null!=this.u("guide"+t)&&(this.u("guide"+t).visible=!1),null!=this.u("guide"+this.currentPage)&&(this.u("guide"+this.currentPage).visible=!0)}closeGuide(){this.hideSelf(),this.u("guide"+this.currentPage).visible=!1,this.currentPage=0,this.callback&&this.callback()}}class fe extends GI.UIViewBase{constructor(){super(...arguments),this.scorePool={}}get isShowingScore(){return this._isShowingScore}set isShowingScore(t){this._isShowingScore=t}doOnUpdate(){for(let t in this.scorePool){let e=$t.i.camera.scToUi(new Laya.Point(this.scorePool[t].x,this.scorePool[t].y));this.scorePool[t].component.asCom.setXY(e.x,e.y)}}createPanel(){this._layer=GI.UiLayerEnum.sceneui,this.createPanelUI("ScoreView"),this.makeFullScreen()}doBindEvt(){this.bindGEvt("AddGameGrade",t=>{this.isShowingScore||(this.isShowingScore=!0);let e=$t.i.data.getUiCfgByEventId(t.id,t.score_type);e&&this.popScore(t,e)}),this.bindGEvt("ab.chestItemCollect",this.onChestItemCollect)}doShow(){this.isShowingScore=!1,this.scorePool={}}doHide(){}popScore(t,e){let i=GI.uiViewMgr.createUiObj("ScoreText").asCom;i.x=t.point.x,i.y=t.point.y;let s=this.getNoUseId(0);this.scorePool[s]={x:t.point.x,y:t.point.y,component:i};let a=i.getChild("txtScore").asTextField;a.text=t.grage.toString(),a.font=e.font_url,this.panel.addChild(i),i.getTransition(e.ani_code).play(GI.handle(this,()=>{this.panel.removeChild(i),delete this.scorePool[s],Object.keys(this.scorePool).length<=0&&(this.isShowingScore=!1)}))}getNoUseId(t){for(let e in this.scorePool)if(Number(e)==t)return this.getNoUseId(t+1);return t}onChestItemCollect(t){this.flyChest||(this.flyChest=GI.uiViewMgr.createUiObj("FlyChest").asCom),this.flyChest.setXY(t.point.x,t.point.y),this.flyChest.setScale(.2,.2),this.panel.addChild(this.flyChest),GI.Tween.to(this.flyChest,{scaleX:1,scaleY:1},1e3,Laya.Ease.bounceOut,GI.handle(this,()=>{GI.Tween.to(this.flyChest,{scaleX:0,scaleY:0},300,Laya.Ease.linearNone,GI.handle(this,()=>{this.panel.removeChild(this.flyChest)}))}))}}class Ie extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.tip,this.autoShowOnGShow=!1,this.createPanelUI("GuideView"),this.makeFullScreen(),this._panelOff=Laya.Point.create().setTo((GI.gw()-this.panel.width)/2,(GI.gh()+GI.uiViewMgr.uiOffY-this.panel.height)/2)}doBindEvt(){}doShow(){this.updateGuide()}doHide(){this.recoverUis()}setGPos(t,e,i){return t&&t.setXY(e-this._panelOff.x,i-this._panelOff.y),t}updateGuide(){this.recoverUis();let t=GI.guideMgr.curGuideCfg,e=GI.guideMgr.guideRect;this._guideUis=GI.guideMgr.guideUis,this.panel.getController("aniCtrl").selectedPage=t.guideAni||"none";let i=t.bgMaskAlpha>=0;this.u("bg").visible=i,i&&(this.u("bg").alpha=t.bgMaskAlpha),this.setGPos(this.u("center"),e.x,e.y).setSize(e.width,e.height);for(let t=0;this._guideUis&&t<this._guideUis.length;t++){const e=this._guideUis[t];e&&e.u&&(e.u.localToGlobal(0,0,Laya.Point.TEMP.reset()),this.u("uiCon").asCom.addChild(e.u),this.setGPos(e.u,Laya.Point.TEMP.x,Laya.Point.TEMP.y))}if(t.guideAni){let e=this.u(t.guideAni).asCom;e.getTransition("ani").play(null,-1);let i=this.u(t.guideAni+"Pt");e.setXY(i.x+(t.aniOffX||0),i.y+(t.aniOffY||0)),this.u("txtDes").asLabel.text=t.des||"",t.des&&(this.u("desPt",e).localToGlobal(0,0,Laya.Point.TEMP.reset()),this.setGPos(this.u("txtDes"),Laya.Point.TEMP.x,Laya.Point.TEMP.y))}}recoverUis(){if(this._guideUis){for(let t=0;t<this._guideUis.length;t++){const e=this._guideUis[t];e&&e.u&&e.p&&(e.p.addChild(e.u),e.p.setChildIndex(e.u,e.i),e.u.setXY(e.x,e.y))}this._guideUis=null}}}class ye extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("ObtainView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick(this.panel,this.hideSelf)}doShow(t){if(t&&t.onGameShow)return;this.handleSk(),null!=t&&null!=t.name&&(this.uiData=t);let e=this.u("imgLoader");e.asLoader.url=GI.uiViewMgr.getItemURL(this.uiData.iconName),this.panel.getTransition("show").play(),this.u("txtDesc").asTextField.text="恭喜获得"+this.uiData.name,this.u("txtCount").asTextField.text="x"+this.uiData.quantity,this.u("txtCount").x=e.x+e.width}doHide(t){t&&t.onGameHide||(this.panel.getTransition("show").playReverse(),this.sk&&this.sk.stop(),GI.gMsgCet.event("obtain_view_hide"))}handleSk(){let t=this.u("imgLoader");null==this.sk?(this.sk=new Laya.Skeleton,t&&this.sk.pos(t.x,t.y),this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,0)):(t&&this.sk.pos(t.x,t.y),this.panel.displayObject.setChildIndex(this.sk,0),this.sk.play(0,!0))}}class we extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("UnlockChapterView"),this.makeFullScreen(),this.unlockCfg=$t.i.data.commercialCfg.unlock_chapter}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnUnlock1",()=>{this.unlockLvl(this.unlockCfg.unlock_items[1])}),this.bindUiClick("btnUnlock2",()=>{this.unlockAllChapter(this.unlockCfg.unlock_items[2])}),GI.gMsgCet.on("Wm.money",this,this.updateShrinkUI)}doShow(t){t&&t.onGameShow||(t.fromView&&(this.fromView=t.fromView),this.setUI())}doHide(t){!t||t.onGameHide}setUI(){this.u("txtTitle").asTextField.text=this.unlockCfg.name,this.u("txtDesc").asTextField.text=this.unlockCfg.desc;for(let t in this.unlockCfg.unlock_items)null!=this.u("txtUnlock"+t)&&(this.u("txtUnlock"+t).asTextField.text=this.unlockCfg.unlock_items[t].desc);this.updateShrinkUI()}unlockLvl(t){GI.gMsgCet.event("btn_unlock_lvl",{fromView:this.fromView,unlockItem:t,doneFunc:this.afterUnlockLvl.bind(this)})}unlockAllChapter(t){$t.i.data.money<t.cost?GI.uiViewMgr.showView("AbRewardView",{reward_id:1}):this.afterUnlockLvl(t)}afterUnlockLvl(t,e,i){$t.i.data.unlockLevel(t.unlock_count,t.whole_chapter)&&!e&&$t.i.data.changeMoney({useOrGain:0,gemNum:t.cost,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.mi_unlock_level,gemdetails:""}),i&&GI.timerMgr.once(i,this,()=>{GI.gInfoMgr.showInfo(4)}),!i&&GI.gInfoMgr.showInfo(4),this.hideSelf()}updateShrinkUI(){let t=GI.gMsgCet.fetch("ab.unlock_view_icon",this.fromView);t&&(this.panel.getController("iconCtrl").selectedPage=t)}}class Ce extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("PropCollegeView"),this.makeFullScreen(),GI.gCfg.showStartTextBtn&&(this.panel.getController("startBtnCtrl").selectedPage="start")}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick(["btnPlay","btnPlayStart"],()=>{$t.i.isPlay?this.panel.getController("displayCtrl").selectedPage="pop":this.toGuide()}),this.bindUiClick("btnPopNo",()=>{this.panel.getController("displayCtrl").selectedPage="normal"}),this.bindUiClick("btnPopYes",()=>{this.toGuide()}),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})})}doShow(t){t&&t.onGameShow||(t&&t.prop_id&&t.from&&(this.currentPropId=t.prop_id,this.fromView=t.from,this.panel.getController("displayCtrl").selectedPage="normal"),this.updateUI())}doHide(t){!t||t.onGameHide}updateUI(){this.u("txtCount").asTextField.text=GI.gCfg.propGuideRewardCount;let t=$t.i.data.props;for(let e in t){let i=this.u("imgProp"+e);if(null!=i){let t=Number(e)==this.currentPropId;i.alpha=t?1:.5}let s=this.u("txtDone"+e);s&&(s.visible=t[e].guide_done)}}toGuide(){$t.i.toGuide({propId:this.currentPropId,fromView:this.fromView,chapter:$t.i.curChapter,lvl:$t.i.curLvl}),this.hideSelf()}}class be extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("PropGuideEndView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnBack",()=>{this.quitGuide()}),this.bindUiClick("btnRestart",()=>{this.hideSelf(),$t.i.reStart()}),this.bindUiClick("btnNext",()=>{null==$t.i.data.commercialCfg.prop[this.propId+1]?this.quitGuide():(this.hideSelf(),$t.i.data.propGuideId=this.propId+1,$t.i.startPropGuideLvl())}),this.bindGEvt("obtain_view_hide",this.afterCloseObtainView),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})})}doShow(t){t&&t.onGameShow||(t&&null!=t.isWin&&null!=t.propId&&(this.isWin=t.isWin,this.propId=Number(t.propId)),this.isFirstWin=t.isFirstWin,this.canShowReward=!0,this.applyUI(),GI.timerMgr.once(GI.gCfg.delayPopInsertAd>0?GI.gCfg.delayPopInsertAd:0,this,this.showInsertAd))}doHide(t){t&&t.onGameHide||GI.timerMgr.clear(this,this.showInsertAd)}showInsertAd(){GI.timerMgr.clear(this,this.showInsertAd),GI.pf.showInsertAd({sourceType:this.viewID})}applyUI(){this.panel.getController("stageCtrl").selectedPage=this.isWin?"win":"fail";let t=$t.i.data.commercialCfg.prop[this.propId];t&&(this.u("propLoader").asLoader.url=GI.uiViewMgr.getItemURL(t.iconName),this.isFirstWin&&GI.gCfg.propGuideRewardCount&&$t.i.popObtainView({name:t.name,quantity:GI.gCfg.propGuideRewardCount,iconName:t.iconName},!0))}quitGuide(){this.hideSelf(),$t.i.quitGuide()}afterCloseObtainView(){GI.gCfg.guideCommercialReward&&(this.canShowReward&&this.isFirstWin&&GI.uiViewMgr.showView("PropGuideRewardView",{propId:this.propId}),this.canShowReward=!1)}}class Ge extends GI.UIViewBase{constructor(){super(...arguments),this.canTurn=!0,this.stageDic={free:"free"},this.shareRecordLimitType="turntable_sharerecord",this.shareVideoAdLimitType="turntable_limit"}createPanel(){this.needMask=!0,this.createPanelUI("TurntableView"),this.makeFullScreen(),this.initData()}initData(){this.turntableData=[],this.turnComp=this.u("turntableComp").asCom}doBindEvt(){this.bindUiClick("btnClose",this.closeViewClear),this.bindUiClick("btnPlay",this.playVideo),this.bindGEvt("show_custom_ad",this.showCustomAd)}doShow(t){t&&t.onGameShow||(t&&t.targetIndex>=0&&t.targetIndex<8?this.targetIndex=t.targetIndex:this.targetIndex=Math.round(7*Math.random()),this.stage=t&&t.stage,this.getCfgRewards(),this.updateUI(),this.stage!=this.stageDic.free&&GI.uiViewMgr.showView("VideoTimesProgressView"))}doHide(t){t&&t.onGameHide||GI.uiViewMgr.hideView("VideoTimesProgressView")}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}getCfgRewards(){this.turntableData=[];let t=$t.i.data.commercialCfg.turntableCfg.rewards;for(let e in t){let i=[];for(let s of t[e].list)i.push(s);for(let s=0;s<t[e].count;s++){let t=Math.floor(Math.random()*(i.length-1));this.turntableData.push(i[t]),i.splice(t,1)}}this.turntableData.sort(()=>Math.random()-.5)}updateUI(){let t=1;for(let e of this.turntableData){let i=this.u("item"+t,this.u("turntableComp"));i&&(this.u("txtCount",i.asCom).asTextField.text="x"+e.count,this.u("imgLoader",i.asCom).asLoader.url=GI.uiViewMgr.getItemURL(e.iconName)),t++}if(this.changeTurnStats(!1),1==GI.gCfg.delayClose){let t=this.u("btnClose");t.visible=!1,GI.timerMgr.once(GI.gCfg.delayCloseTurntableViewDuration,this,()=>{t.visible=!0})}GI.gCfg.videoIconShrinkPage&&(this.panel.getController("btnIconCtrl").selectedPage=GI.gCfg.videoIconShrinkPage),this.handleTimeLimitUI()}playVideo(){this.canTurn&&(this.stage==this.stageDic.free?this.startTurntable(!0,null):GI.gMsgCet.event("btn_turntable_reward",{closeFunc:this.delayStartTurntable.bind(this),adIdx:5,timeLimitType:this.shareRecordLimitType,sourceType:this.viewID}))}delayStartTurntable(t,e){GI.timerMgr.once(1e3,this,this.startTurntable,[t,e])}startTurntable(t,e){GI.log("转盘奖励界面播放完视频广告：",t,e),t&&($t.i.data.costTimeLimit("turntable_free"),$t.i.data.costTimeLimit(this.shareRecordLimitType),$t.i.data.costTimeLimit(this.shareVideoAdLimitType),this.handleTimeLimitUI(),this.stage!=this.stageDic.free&&(GI.gCfg.popShareHint||GI.gCfg.tempChangeVideoToShare||e&&"videoAd"==e.type)&&GI.gMsgCet.event("videoad_accum_reward"),this.changeTurnStats(!0),this.rotateSpeed=90,this.endTime=Date.now()+$t.i.data.commercialCfg.turntableCfg.accelerate_duration,GI.timerMgr.frameLoop(1,this,this.accelerateLoopFunc))}accelerateLoopFunc(){if(this.turnComp.rotation+=this.rotateSpeed*GI.timerMgr.delta/1e3,this.rotateSpeed+=GI.timerMgr.delta/1e3*90,this.endTime-Date.now()<=0){GI.timerMgr.clear(this,this.accelerateLoopFunc);let t=360-(45*this.targetIndex+35*Math.random()+5);this.rotateGap=Math.round(t%360-this.turnComp.rotation%360)+720,this.maxRotateGap=this.rotateGap,this.maxRotateSpeed=this.rotateSpeed,GI.timerMgr.frameLoop(1,this,this.slowLoopFunc)}}slowLoopFunc(){this.rotateSpeed<3&&(this.rotateSpeed=3);let t=this.rotateSpeed*GI.timerMgr.delta/1e3;this.rotateSpeed=this.rotateGap/this.maxRotateGap*this.maxRotateSpeed+3,this.turnComp.rotation+=t,this.rotateGap-=t,this.rotateGap<=0&&(GI.timerMgr.clear(this,this.slowLoopFunc),this.presentProp())}presentProp(){let t=this.turntableData[this.targetIndex];if(t){1==t.isCurrency?($t.i.data.changeMoney({useOrGain:1,gemNum:t.count,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_turntable_Passreward,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7})):$t.i.data.presentUpdateData(t.prop_id,t.count),this.hideSelf();let e={name:t.name,quantity:t.count,iconName:t.iconName};GI.gCfg.turntableExtraReward&&(e.extraReward=t),$t.i.popObtainView(e,!0)}}changeTurnStats(t){this.canTurn=!t,this.u("btnClose").asButton.enabled=!t,this.u("imgVideo").grayed=this.u("imgShareRecord").grayed=this.u("imgShareGame").grayed=this.u("imgFree").grayed=t}closeViewClear(){GI.timerMgr.clear(this,this.accelerateLoopFunc),GI.timerMgr.clear(this,this.slowLoopFunc),this.hideSelf()}handleTimeLimitUI(){if(this.stage==this.stageDic.free)this.panel.getController("btnIconCtrl").selectedPage=this.stage;else{let t=$t.i.data.timeLimitData[this.shareRecordLimitType];GI.gMsgCet.fetch("turntable_has_timelimit")&&t&&(this.panel.getController("btnIconCtrl").selectedPage=$t.i.data.isTimeLimitNextStage(this.shareRecordLimitType)?t.nextStage:t.preStage)}$t.i.data.timeLimitData[this.shareVideoAdLimitType]&&(this.u("txtRemainCount").asTextField.text="今日剩余次数："+$t.i.data.timeLimitRemainCount(this.shareVideoAdLimitType))}}class ve extends GI.UIViewBase{constructor(){super(...arguments),this.propRewardLimit="start_prop_reward"}createPanel(){this.needMask=!0,this.createPanelUI("PropRewardView"),this.makeFullScreen(),this.initData()}initData(){}doBindEvt(){let t=$t.i.data.commercialCfg.start_prop_reward;for(let e in t){let t=this.u("btnPlay"+e);t&&this.bindUiClick(t,()=>{this.rewardPropId=Number(e),this.clickPlayBtn()});let i=this.u("btnShareRecord"+e);i&&this.bindUiClick(i,()=>{this.rewardPropId=Number(e),this.clickPlayBtn(!0)})}this.bindClickHide("btnClose"),this.bindGEvt("ab.get_prop",this.afterGetProp),this.bindGEvt("obtain_view_hide",this.afterHideObtainView),this.bindGEvt("show_custom_ad",this.showCustomAd),GI.gMsgCet.on("ab.RigEnd",this,this.hideSelfView)}doShow(t){GI.gMsgCet.event("ab.hideGridAd"),t&&t.onGameShow||($t.i.canOperate=!1,t&&"manulOpen"==t.type||this.calculateMutiResult(),this.updateUI(),GI.uiViewMgr.showView("VideoTimesProgressView"),GI.gCfg.videoIconShrinkPage&&(this.panel.getController("shrinkVideoCtrl").selectedPage=GI.gCfg.videoIconShrinkPage),t&&t.shareRecordPage&&(this.panel.getController("shrinkVideoCtrl").selectedPage=t.shareRecordPage))}doHide(t){GI.gMsgCet.event("ab.showGridAd"),t&&t.onGameHide||($t.i.canOperate=!0,GI.gMsgCet.event("show_prop_pointer"),GI.gMsgCet.event("ab.moveToBird"),GI.uiViewMgr.hideView("VideoTimesProgressView"))}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}updateUI(){let t=$t.i.data.commercialCfg.start_prop_reward;for(let e in t){let i=this.u("imgProp"+e);if(i&&(i.asLoader.url=GI.uiViewMgr.getItemURL(t[e].iconName)),this.propRewardData[e]){let i=this.propRewardData[e].multiResult.id;for(let s of t[e].multiRatio){let t=this.u("imgMulti"+e+"_"+s.id);t&&(t.visible=s.id==i)}}}if(1==GI.gCfg.delayClose){let t=this.u("btnClose");t.visible=!1,GI.timerMgr.once(GI.gCfg.delayCloseDuration,this,()=>{t.visible=!0})}this.handleTimelimitUI()}clickPlayBtn(t){!GI.gMsgCet.fetch("btn_startlvl_reward",{closeFunc:this.onFinishVideo.bind(this),adIdx:4,isShareRecord:t,sourceType:this.viewID})&&GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:4,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("开局道具界面播放完视频广告：",t,e),t&&((GI.gCfg.popShareHint||GI.gCfg.tempChangeVideoToShare||e&&"videoAd"==e.type)&&(GI.gMsgCet.event("videoad_accum_reward"),$t.i.data.costTimeLimit(this.propRewardLimit),this.handleTimelimitUI()),GI.timerMgr.once(800,this,this.giveReward))}giveReward(){let t=this.propRewardData[this.rewardPropId].multiResult;GI.gMsgCet.event("propRewardGive"),1!=t.count||$t.i.data.usingProp[this.rewardPropId].count?$t.i.data.presentUpdateData(this.rewardPropId,t.count):(this.autoUseProp(),this.hideSelf())}calculateMutiResult(){let t=$t.i.data.commercialCfg.start_prop_reward;this.propRewardData={};for(let e in t){this.propRewardData[e]={};let i=0,s=[];for(let a of t[e].multiRatio){let t=a.ratio,e=$t.i.data.getVipPrivilege();e&&4==a.id&&(t+=e.startPropFiveFoldRate),i+=t,s.push({ratioLimit:i})}let a=Math.random()*i;for(let i=0;i<t[e].multiRatio.length;i++)if(s[i]&&a<s[i].ratioLimit){this.propRewardData[e].multiResult=t[e].multiRatio[i];break}}}afterGetProp(t){let e=this.propRewardData[this.rewardPropId],i=$t.i.data.commercialCfg.start_prop_reward[this.rewardPropId];i&&e&&$t.i.popObtainView({name:i.name,quantity:e.multiResult.count,iconName:i.iconName},!0)}afterHideObtainView(){this.hideSelf(),this.autoUseProp()}handleTimelimitUI(){$t.i.data.timeLimitData[this.propRewardLimit]&&(this.u("txtRemainCount").asTextField.text="今日剩余次数："+$t.i.data.timeLimitRemainCount(this.propRewardLimit))}autoUseProp(){$t.i.data.usingProp[this.rewardPropId].count||$t.i.data.usePropUpdateData(this.rewardPropId,!1)}hideSelfView(){$t.i.isPlay&&this.hideSelf()}}class Se extends GI.UIViewBase{constructor(){super(...arguments),this.sks=[]}initData(){this.currDay=GI.localDataMgr.getInt("dayGet.day")}createPanel(){this.initData(),this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("DailyAttendanceView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("closeBtn"),this.bindUiClick("doubleGetBtn",()=>{GI.gMsgCet.event("btn_signin_reward",{closeFunc:this.onFinishVideo.bind(this),adIdx:3,sourceType:this.viewID})}),this.bindUiClick("getBtn",()=>{this.clickFunc();let t=GI.localDataMgr.getInt("dayGet.day"),e=$t.i.data.commercialCfg.daySign[t];7==t?($t.i.data.changeMoney({useOrGain:1,gemNum:e.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_Sign_in_reward,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7})):$t.i.data.presentUpdateData(e.prop_id,e.quantity),$t.i.popObtainView({name:e.name,quantity:e.quantity,iconName:e.iconName},!0)}),this.getDailyItem(),this.bindGEvt("show_custom_ad",this.showCustomAd)}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}onFinishVideo(t,e){if(GI.log("签到界面播放完视频广告：",t,e),!t)return;this.clickFunc();let i=GI.localDataMgr.getInt("dayGet.day");if(7==i){let t=2*$t.i.data.commercialCfg.daySign[i].quantity;$t.i.data.changeMoney({useOrGain:1,gemNum:t,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_Sign_in_reward,gemdetails:""})}else $t.i.data.presentUpdateData($t.i.data.commercialCfg.daySign[i].prop_id,2*$t.i.data.commercialCfg.daySign[i].quantity);let s=$t.i.data.commercialCfg.daySign[i];$t.i.popObtainView({name:s.name,quantity:2*s.quantity,iconName:s.iconName})}clickFunc(){GI.gMsgCet.event("wm.getDayAward");let t=GI.localDataMgr.getInt("dayGet.day");t+=1,GI.localDataMgr.setInt("dayGet.day",t),t>=1&&t<=7&&(this.u("d".concat(t.toString())).asCom.getChild("grey").asCom.visible=!0,this.u("d".concat(t.toString())).asCom.getChild("countText").asLabel.text="已领取"),GI.localDataMgr.setInt("dayGet.lastDay",(new Date).getDate()),this.showGeryBtn(!0),GI.localDataMgr.setInt("dayGet.isGet",0)}getDailyItem(){for(let t=1;t<=7;t++)this.u("d".concat(t.toString())).asCom.getChild("dayText").asLabel.text=$t.i.data.commercialCfg.daySign[t].dayDes,this.u("d".concat(t.toString())).asCom.getChild("countText").asLabel.text="x"+$t.i.data.commercialCfg.daySign[t].quantity,this.u("d".concat(t.toString())).asCom.getChild("grey").asCom.visible=!1,7==t?(this.u("d".concat(t.toString())).asCom.getChild("icon1Loader").asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.daySign[t].iconName),this.u("d".concat(t.toString())).asCom.getChild("icon2Loader").asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.daySign[t].iconName),this.u("d".concat(t.toString())).asCom.getChild("icon3Loader").asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.daySign[t].iconName2)):(this.u("d".concat(t.toString())).asCom.getChild("iconLoader").asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.daySign[t].iconName),this.u("d".concat(t.toString())).asCom.getChild("strongest").asCom.visible=!1),2==t&&(this.u("d".concat(t.toString())).asCom.getChild("strongest").asCom.visible=!0,this.u("d".concat(t.toString())).asCom.getChild("bgHighlight").visible=!0),t<=this.currDay&&(this.u("d".concat(t.toString())).asCom.getChild("grey").asCom.visible=!0,this.u("d".concat(t.toString())).asCom.getChild("countText").asLabel.text="已领取")}showGeryBtn(t=!1){this.u("getBtn").asButton.enabled=!1,this.u("playIcon",this.u("doubleGetBtn")).asImage.grayed=!0,this.u("doubleGetBtn").asButton.enabled=!1}doShow(t){if(t&&t.onGameShow)return;if(1!=GI.localDataMgr.getInt("dayGet.isGet")&&this.showGeryBtn(),GI.localDataMgr.getInt("dayGet.day")>=7&&this.showGeryBtn(),1==GI.gCfg.delayClose){let t=this.u("closeBtn"),e=this.u("getBtn"),i=this.u("getText"),s=this.u("n31");t.visible=e.visible=i.visible=s.visible=!1,GI.timerMgr.once(GI.gCfg.delayCloseSigninViewDuration,this,()=>{t.visible=e.visible=i.visible=s.visible=!0})}!GI.gCfg.disableDailyViewShrink&&GI.gCfg.videoIconShrinkPage&&(this.panel.getController("videoIconCtrl").selectedPage=GI.gCfg.videoIconShrinkPage),GI.gCfg.bannerStyleCons&&GI.gCfg.bannerStyleCons.hasOwnProperty(this.viewID)&&($t.i.bannerStyleCons[this.viewID]={left:this.u("doubleGetBtn").x+this.u("doubleGetBtn").width+20,top:this.u("doubleGetBtn").y-20,styleCtrl:"small"}),GI.gCfg.dailyAttendenceViewHideGetBtn&&(this.panel.getController("getBtnCtrl").selectedPage="hide"),this.handleSk()}doHide(t){if(!t||!t.onGameHide){$t.i.bannerStyleCons&&$t.i.bannerStyleCons.hasOwnProperty(this.viewID)&&($t.i.bannerStyleCons[this.viewID]={});for(let t of this.sks)t&&t.stop()}}handleSk(){let t=[2,7],e=0;for(let i of t){let t=this.sks[e];null==t?((t=new Laya.Skeleton).load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{})),this.u("d"+i).asCom.getChild("sk").displayObject.addChild(t),t.pos(this.u("sk",this.u("d"+i)).width/2,this.u("sk",this.u("d"+i)).height/2),t.scale(.5,.5),this.sks.push(t)):t.play(0,!0),e++}}}class Re extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("GamePauseView"),this.makeFullScreen(),this.panel.getController("shareGameCtrl").selectedPage=GI.gCfg.shareGameBtn,GI.gCfg.showStartTextBtn&&(this.panel.getController("startBtnCtrl").selectedPage="start")}doBindEvt(){this.bindUiClick("coverBg",this.hidePauseView),this.bindUiClick("btnPauseRestart",()=>{GI.gMsgCet.event("btn_restart_game",{closeFunc:this.restartLvl.bind(this),adIdx:1,sourceType:this.viewID})}),this.bindUiClick("btnGuideRestart",this.clickGuideRestart),this.bindUiClick("btnVoice",()=>{GI.soundMgr.triggerMuted()}),this.bindGEvt("sound.muted",()=>{this.u("imgMute").visible=GI.soundMgr.muted},!0),this.bindUiClick("btnBack",()=>{this.clickBack()}),this.bindUiClick(["btnExpand","btnGuideExpand","btnExpandStart","btnGuideExpandStart"],this.hidePauseView),this.bindUiClick("btnLvl",()=>{$t.i.breakOffPlay(),this.hideGameView(),$t.i.quitPlay(),GI.uiViewMgr.showView("ChallengeView",{chapterId:$t.i.curChapter})}),this.bindUiClick("btnMenu",()=>{$t.i.breakOffPlay(),this.hideGameView(),$t.i.quitPlay(),GI.uiViewMgr.showView("SysMainUi")}),this.bindUiClick("btnGuide",()=>{this.hideSelf(),GI.uiViewMgr.showView("AbGuideView",{isSingle:!1,guidePage:1})}),this.bindUiClick("btnShareGame",this.shareGame),this.bindGEvt("show_custom_ad",this.showCustomAd),this.bindGEvt("show_block_ad",()=>{GI.pf.showBlockAd({sourceType:this.viewID})})}doShow(t){t&&t.onGameShow||(!$t.i.data.isGuideScene&&GI.gMsgCet.event("ab.openPauseView"),$t.i.canOperate=!1,this.applyUI(),GI.timerMgr.once(GI.gCfg.delayPopInsertAd>0?GI.gCfg.delayPopInsertAd:0,this,this.showInsertAd))}doHide(t){t&&t.onGameHide||($t.i.canOperate=!0,GI.timerMgr.clear(this,this.showInsertAd))}applyUI(){let t=$t.i.data.isGuideScene;if(this.panel.getController("displayCtrl").selectedPage=t||$t.i.isEventScene?"guide":"game",this.panel.getController("eventCtrl").selectedPage=$t.i.isEventScene?"show":"hide",!t&&!$t.i.isEventScene){let t=$t.i.data.chapterData[$t.i.curChapter].levels[$t.i.curLvl-1];this.u("txtPauseBestScore").asTextField.text=t.bestScore,this.u("txtLvl").asTextField.text=$t.i.curChapter+"-"+$t.i.curLvl;for(let e=1;e<=3;e++)this.u("maxStar"+e).visible=e<=t.bestRank}this.panel.getTransition("show").play()}showInsertAd(){GI.timerMgr.clear(this,this.showInsertAd),GI.pf.showInsertAd({sourceType:this.viewID})}restartLvl(t,e){GI.log("游戏界面重开，播放完视频广告：",t,e),t&&(this.hideGameView(),$t.i.shouldShowPropPoint=!0,$t.i.reStart())}clickBack(){this.hideGameView(),$t.i.quitPlay(),$t.i.isEventScene?$t.i.quitEventLvl():$t.i.quitGuide()}hideGameView(){this.hideSelf(),GI.uiViewMgr.hideView("GamePlayView")}hidePauseView(){this.panel.getTransition("show").playReverse(GI.handle(this,()=>{this.hideSelf()}))}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&GI.gMsgCet.event("pf.shareGame")}})}clickGuideRestart(){$t.i.data.isGuideScene?(this.hidePauseView(),this.restartLvl(!0,null)):$t.i.isEventScene&&GI.pf.showVideoAd({closeFunc:this.doneEventRestartVideo.bind(this),adIdx:1,sourceType:this.viewID})}doneEventRestartVideo(t,e){t&&(this.hideGameView(),$t.i.reStart())}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}}class _e extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("BlastRewardView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnGet",this.clickGetBlast)}doShow(t){!t||t.onGameShow}doHide(t){t&&t.onGameHide||GI.gMsgCet.event("ab.moveToBird")}clickGetBlast(){GI.gMsgCet.fetch("start_lvl_get_blast",{closeFunc:this.finishCommercial.bind(this)})}finishCommercial(t,e){GI.log("开局冲击波界面分享完：",t,e),t&&GI.timerMgr.once(800,this,this.giveReward)}giveReward(){$t.i.data.usePropUpdateData($t.i.data.commercialCfg.prop_enum.blast,!0),this.hideSelf()}}class Le extends GI.UIViewBase{constructor(){super(...arguments),this.ff=new Array}createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("VideoTimesProgressView")}doBindEvt(){GI.gMsgCet.on("videoad_accum_reward",this,this.updateProgress)}doShow(t){for(let t=0;t<3;t++){let e="f".concat((t+1).toString());this.ff[t]=this.u(e).asCom}this.notShowProgress(),this.showProgress()}doHide(t){}notShowProgress(){for(let t=0;t<this.ff.length;t++)this.ff[t].visible=!1}showProgress(){let t=GI.localDataMgr.getInt("ab.videoShockwaveTimes");for(let e=0;e<t;e++)this.ff[e].visible=!0}updateProgress(){let t=GI.localDataMgr.getInt("ab.videoShockwaveTimes");(t+=1)>=GI.gCfg.comsumeTimes?(GI.uiViewMgr.showView("GetShockwaveView"),this.hideSelf(),GI.localDataMgr.setInt("ab.videoShockwaveTimes",0),this.notShowProgress()):GI.localDataMgr.setInt("ab.videoShockwaveTimes",t),this.showProgress()}onFinishVideo(t,e){}}class Me extends GI.UIViewBase{constructor(){super(...arguments),this.ff=new Array}createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("GetShockwaveView"),this.needMask=!0}doBindEvt(){}doShow(t){$t.i.data.presentUpdateData(6,1,!0)}doHide(){}}class Pe extends GI.UIViewBase{constructor(){super(...arguments),this.sks={}}get isChestFree(){return this._isChestFree}set isChestFree(t){this._isChestFree!=t&&(this._isChestFree=t,this.panel.getController("chestTimeCtrl").selectedPage=this._isChestFree?"free":"video")}createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("OfflineRewardView"),this.makeFullScreen(),this.panel.getController("hasCountdown").selectedPage=GI.gCfg.dailyChallenge?"has":"none"}doBindEvt(){this.bindUiClick("btnClose",this.hideSelf),this.bindUiClick("btnGet",this.getOfflineReward),this.bindUiClick("btnVideo",this.clickVideo),this.bindUiClick("btnGetChest",this.clickOpenChest),this.bindUiClick("btnGo",this.goChapterView),this.bindGEvt("ab.RigEnd",()=>{$t.i.isPlay&&this.hideSelf()}),this.bindGEvt("show_custom_ad",this.showCustomAd)}doShow(t){t&&t.onGameShow||(GI.gMsgCet.event("ab.hideGridAd"),$t.i.canOperate=!1,this.updateUI(),this.startLoopCountDown(),this.startChestCountdown(),this.handleSk())}doHide(t){if(!t||!t.onGameHide){GI.gMsgCet.event("ab.showGridAd"),$t.i.canOperate=!0,this.clearLoopCountDown(),this.clearChestCountdown();for(let t in this.sks)this.sks[t].stop()}}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}updateUI(){this.refreshCurrentRwardCount(),this.u("txtCount").asTextField.text="x"+this.rewardCount,this.u("txtVideo").asTextField.text=(2==GI.gCfg.offline_chest_module.commercialMulti?"双":GI.gCfg.offline_chest_module.commercialMulti)+"倍领取",this.u("txtCountDown").text="奖励升级倒计时：00:00",this.refreshChestUi()}handleSk(){let t=[this.u("imgObj"),this.u("chest1")];for(let e=0;e<t.length;e++)null==this.sks[e]?(this.sks[e]=new Laya.Skeleton,this.sks[e].load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sks[e].play(0,!0)})),this.panel.displayObject.addChild(this.sks[e]),this.panel.displayObject.setChildIndex(this.sks[e],1),this.sks[e].pos(t[e].x,t[e].y)):(this.sks[e].pos(t[e].x,t[e].y),this.sks[e].play(0,!0))}checkHasOfflineReward(){return this.rewardCount||GI.gInfoMgr.showInfoCont(1,"奖励正在赶来的路上~"),!!this.rewardCount}clickVideo(){this.checkHasOfflineReward()&&GI.pf.showVideoAd({closeFunc:this.getMultiReward.bind(this),adIdx:9,sourceType:this.viewID})}getOfflineReward(){this.checkHasOfflineReward()&&this.rewardFunc(this.rewardCount)}getMultiReward(t,e){t&&(this.refreshCurrentRwardCount(),this.rewardFunc(this.rewardCount*GI.gCfg.offline_chest_module.commercialMulti))}rewardFunc(t){this.hideSelf(),$t.i.data.changeMoney({useOrGain:1,gemNum:t,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_offline_reward,gemdetails:""}),$t.i.data.offlineInitFeather>0&&($t.i.data.offlineInitFeather=0),GI.gMsgCet.event("AB.SoundEvent",{eventType:7}),$t.i.popObtainView({name:GI.gCfg.offline_chest_module.rewardName,quantity:t,iconName:GI.gCfg.offline_chest_module.rewardIcon}),$t.i.startOfflineReward()}startLoopCountDown(){this.refreshCountDownFunc(),GI.timerMgr.loop(1e3,this,this.refreshCountDownFunc)}clearLoopCountDown(){GI.timerMgr.clear(this,this.refreshCountDownFunc)}refreshCountDownFunc(){if(Date.now()-$t.i.data.beginOfflineTime+$t.i.data.offlineInitFeather*GI.gCfg.offline_chest_module.duration>=GI.gCfg.offline_chest_module.limitReward*GI.gCfg.offline_chest_module.duration)return this.refreshCurrentRwardCount(),this.u("txtCount").asTextField.text="x"+this.rewardCount,void this.clearLoopCountDown();let t=GI.gCfg.offline_chest_module.duration-(Date.now()-$t.i.data.beginOfflineTime)%GI.gCfg.offline_chest_module.duration,e=new Date(0);this.refreshCurrentRwardCount(),e=new Date(t),this.u("txtCount").asTextField.text="x"+this.rewardCount,this.u("txtCountDown").text="奖励升级倒计时："+this.formatNum(e.getMinutes())+":"+this.formatNum(e.getSeconds())}startChestCountdown(){GI.gCfg.dailyChallenge&&(this.refreshChestCountdown(),GI.timerMgr.loop(1e3,this,this.refreshChestCountdown))}refreshChestCountdown(){let t=$t.i.data.surpriseChestTime-Date.now();if(t<=0)return this.clearChestCountdown(),this.u("txtChestRemain").text="宝箱开启倒计时：0h 00:00",void(this.isChestFree=!0);this.isChestFree=!1;let e=new Date(t);this.u("txtChestRemain").text="宝箱开启倒计时："+e.getUTCHours()+"h "+this.formatNum(e.getMinutes())+":"+this.formatNum(e.getSeconds())}clearChestCountdown(){GI.timerMgr.clear(this,this.refreshChestCountdown)}formatNum(t){return t>=10?t.toString():"0"+t.toString()}clickOpenChest(){this.isChestFree?this.getChestReward():GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:8,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("奖励界面播放完视频广告：",t,e),t&&this.getChestReward()}refreshChestUi(){this.panel.getController("chestCtrl").selectedPage=$t.i.data.chestCollectCount?"has_chest":"empty",null!=$t.i.data.chestCollectCount&&(this.u("txtChestCount").text="持有宝箱数："+$t.i.data.chestCollectCount)}getChestReward(){let t={};this.getRandomReward(t);for(let e in t)$t.i.data.presentUpdateData(Number(e),t[e].quantity,!0);t.feather={};for(let e in $t.i.data.commercialCfg.sceneChestFeather)t.feather[e]=$t.i.data.commercialCfg.sceneChestFeather[e];let e=Math.round(Math.random()*(t.feather.maxCount-t.feather.minCount)+t.feather.minCount);for(let t=1;t<5&&e%5!=0;t++){if((e+t)%5==0){e+=t;break}if((e-t)%5==0){e-=t;break}}t.feather.quantity=e,$t.i.data.changeMoney({useOrGain:1,gemNum:t.feather.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_surprise_chest,gemdetails:""}),GI.uiViewMgr.showView("ObtainMultiView",{rewards:t});let i=$t.i.data.chestCollectCount;i&&i--,$t.i.data.chestCollectCount=i,this.refreshChestUi(),i>0&&($t.i.updateSurpriseChestTime(),this.startChestCountdown())}getRandomReward(t={}){let e=$t.i.data.commercialCfg.sceneChestReward,i=0;for(let s in e)t.hasOwnProperty(s)||(i+=e[s].ratio);let s=Math.random()*i,a=0,r="";for(let i in e)if(!t.hasOwnProperty(i)&&(a+=e[i].ratio)>s){r=i;break}if(""!=r){t[r]={};for(let i in e[r])t[r][i]=e[r][i];if(t[r].quantity=Math.round(Math.random()*(t[r].maxCount-t[r].minCount)+t[r].minCount),Object.keys(t).length>=2)return t;this.getRandomReward(t)}}goChapterView(){this.hideSelf(),GI.uiViewMgr.hideView("DailyAttendanceView"),GI.uiViewMgr.hideView("SysMainUi"),GI.uiViewMgr.hideView("EventAnnounceView"),$t.i.isPlay&&($t.i.breakOffPlay(),GI.uiViewMgr.hideView("GamePlayView"),$t.i.quitPlay(),$t.i.data.isGuideScene&&$t.i.quitGuide(),$t.i.isEventScene&&$t.i.quitEventLvl()),GI.uiViewMgr.showView("ChapterView")}refreshCurrentRwardCount(){this.rewardCount=Math.min(Math.floor((Date.now()-$t.i.data.beginOfflineTime)/GI.gCfg.offline_chest_module.duration)*GI.gCfg.offline_chest_module.rewardUnit+$t.i.data.offlineInitFeather,GI.gCfg.offline_chest_module.limitReward)}}class xe extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("FeatherReceiveView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnGet",this.receiveFeather),this.bindUiClick("btnVideo",()=>{GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:2,sourceType:this.viewID})}),this.bindUiClick("btnShareGame",this.shareGame)}receiveFeatherFunc(t,e){$t.i.data.changeMoney({useOrGain:1,gemNum:t,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_Feather_reward,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7}),$t.i.popObtainView({name:this.rewardData.name,quantity:t,iconName:this.rewardData.iconName},e),$t.i.data.costTimeLimit("showFeatherReward"),this.hideSelf()}receiveFeather(){this.receiveFeatherFunc(this.rewardData.quantity,!0)}onFinishVideo(t,e){GI.log("奖励界面播放完视频广告：",t,e),t&&this.receiveFeatherFunc(this.rewardData.quantity*this.rewardData.multi,!1)}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&this.receiveFeatherFunc(this.rewardData.quantity*this.rewardData.multi,!1)}})}doShow(t){this.handleSk(),this.rewardData=$t.i.data.commercialCfg.featherReceive,this.u("txtTitle").asTextField.text=this.rewardData.name,this.u("txtVideoRewardHint").asTextField.text=this.rewardData.desc+"(今日剩余次数："+$t.i.data.timeLimitRemainCount("showFeatherReward")+")",this.u("imgObj").asLoader.url=GI.uiViewMgr.getItemURL(this.rewardData.iconName),this.u("txtVideo").asTextField.text=this.rewardData.multi+"倍领取",GI.gCfg.videoIconShrinkPage&&(this.panel.getController("shrinkCtrl").selectedPage=GI.gCfg.videoIconShrinkPage),GI.gCfg.featherReceiveShareGame&&(this.panel.getController("shrinkCtrl").selectedPage="shareGame")}doHide(){this.sk.stop()}handleSk(){let t=this.u("imgObj");null==this.sk?(this.sk=new Laya.Skeleton,this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,1),this.sk.pos(t.x,t.y)):(this.sk.pos(t.x,t.y),this.sk.play(0,!0))}}class ke extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("PropGuideRewardView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnVideo",()=>{GI.gCfg.propGuideRewardViewShare?this.shareGame():GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:2,sourceType:this.viewID})})}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&this.giveReward()}})}onFinishVideo(t,e){GI.log("奖励界面播放完视频广告：",t,e),t&&this.giveReward()}giveReward(){this.hideSelf(),$t.i.data.presentUpdateData(this.propId,GI.gCfg.guideCommercialReward.extraCount),$t.i.popObtainView({name:this.rewardData.name,quantity:GI.gCfg.guideCommercialReward.extraCount,iconName:this.rewardData.iconName})}doShow(t){if(!t||!t.onGameShow){if(t.hasOwnProperty("propId")&&(this.propId=t.propId,this.rewardData=$t.i.data.commercialCfg.prop[this.propId],this.rewardData)){let t=GI.gCfg.propGuideRewardViewShare?"分享":"观看视频";this.u("txtTitle").asTextField.text=this.rewardData.name,this.u("txtVideoRewardHint").asTextField.text="通过"+t+"可额外获得"+GI.gCfg.guideCommercialReward.extraCount+'个"'+this.rewardData.name+'"',this.u("imgObj").asLoader.url=GI.uiViewMgr.getItemURL(this.rewardData.iconName)}this.handleSk(),GI.gCfg.videoIconShrinkPage&&(this.panel.getController("shrinkCtrl").selectedPage=GI.gCfg.videoIconShrinkPage),GI.gCfg.propGuideRewardViewShare&&(this.panel.getController("shrinkCtrl").selectedPage="share")}}doHide(){this.sk.stop()}handleSk(){let t=this.u("imgObj");null==this.sk?(this.sk=new Laya.Skeleton,this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,1),this.sk.pos(t.x,t.y)):(this.sk.pos(t.x,t.y),this.sk.play(0,!0))}}class De extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("debugView"),this.makeFullScreen(),this.ishowPanle=!1}doBindEvt(){this.bindUiClick("btntest",()=>{this.DoShowPanleInfo()}),this.bindUiClick("btnBack",()=>{this.DoShowPanleInfo()}),this.bindUiClick("btnAddmoney",()=>{var t=Number(this.u("moneyInput").asTextInput.text);$t.i.money+=t,GI.gInfoMgr.showInfoCont(1,"已经处理")}),this.bindUiClick("Clear",()=>{GI.localDataMgr.clear(),$t.i.data.initLocalData(),GI.gInfoMgr.showInfo(3,null),GI.gInfoMgr.showInfoCont(1,"已经处理")}),this.bindUiClick("btnOpenAll",()=>{GI.gCfg.unlock_all_chapter=1,GI.gInfoMgr.showInfoCont(1,"已经处理")})}doShow(){this.panel.opaque=!1}DoShowPanleInfo(){this.ishowPanle=!this.ishowPanle,this.panel.opaque=this.ishowPanle;var t=this.u("bg"),e=this.u("btnAddmoney"),i=this.u("btnAddmoneyTxt"),s=this.u("btnBack"),a=this.u("moneyInputbg"),r=this.u("moneyInput"),o=this.u("btnOpenAll"),n=this.u("openallTxt"),h=this.u("Clear"),l=this.u("clearTxt");t.visible=this.ishowPanle,t.enabled=this.ishowPanle,e.visible=this.ishowPanle,i.visible=this.ishowPanle,s.visible=this.ishowPanle,a.visible=this.ishowPanle,r.visible=this.ishowPanle,o.visible=this.ishowPanle,o.visible=this.ishowPanle,n.visible=this.ishowPanle,h.visible=this.ishowPanle,l.visible=this.ishowPanle}}class Be extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("SettleStatisticView"),this.makeFullScreen(),this.initUI()}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnShareGame",this.shareGame),this.bindUiClick("btnShareRecord",this.shareScreenRecord)}initUI(){this.u("txtRank").asTextField.font=$t.i.data.scoreUiCfg[11].font_url}doShow(t){if(t&&t.onGameShow)return;let e=Math.round($t.i.data.GameGrade/$t.i.data.MaxGameGrade*100);this.u("txtRank").asTextField.text=e.toString(),t&&t.endFunc&&(this._args=t),this.panel.getController("btnCtrl").selectedPage=t&&t.isShareRecord?"shareRecord":"shareGame"}doHide(){}shareGame(){GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&this.hideSelf()}})}shareScreenRecord(){this.onEnd(1)}onEnd(t){let e=this._args;this._args=null,this.hideSelf(),e&&e.endFunc&&e.endFunc(e,t)}}class Te extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("ObtainExtraView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("ctrlArea",this.clickBgHide),this.bindUiClick("btnShareGame",this.showVideoAd)}doShow(t){if(t&&t.onGameShow)return;this.canHide=this.u("txtBlankHint").visible=!1,GI.timerMgr.once(2e3,this,this.enableClickHide),this.handleSk(),null!=t&&null!=t.name&&(this.uiData=t);let e=this.u("imgLoader");e.asLoader.url=GI.uiViewMgr.getItemURL(this.uiData.iconName),this.panel.getTransition("show").play(),this.u("txtDesc").asTextField.text="恭喜获得"+this.uiData.name,this.u("txtCount").asTextField.text="x"+this.uiData.quantity,this.u("txtCount").x=e.x+e.width,this.rewardProp=t&&t.extraReward}doHide(t){t&&t.onGameHide||(this.panel.getTransition("show").playReverse(),this.sk&&this.sk.stop(),GI.gMsgCet.event("obtain_view_hide"))}shareGame(){this.sharingGame||(this.sharingGame=!0,GI.timerMgr.once(1e3,this,this.resetShareStats),GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&(this.hideSelf(),this.presentProp())}}))}showVideoAd(){GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:5,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("ObtainExtraView播放完视频广告：",t,e),t&&(this.hideSelf(),this.presentProp())}resetShareStats(){GI.timerMgr.clear(this,this.resetShareStats),this.sharingGame=!1}clickBgHide(){!this.sharingGame&&this.canHide&&this.hideSelf()}presentProp(){this.rewardProp&&(1==this.rewardProp.isCurrency?($t.i.data.changeMoney({useOrGain:1,gemNum:this.rewardProp.count,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_turntable_Passreward,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7})):$t.i.data.presentUpdateData(this.rewardProp.prop_id,this.rewardProp.count),$t.i.popObtainView({name:this.rewardProp.name,quantity:this.rewardProp.count,iconName:this.rewardProp.iconName},!0))}handleSk(){let t=this.u("imgLoader");null==this.sk?(this.sk=new Laya.Skeleton,t&&this.sk.pos(t.x,t.y),this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,0)):(t&&this.sk.pos(t.x,t.y),this.panel.displayObject.setChildIndex(this.sk,0),this.sk.play(0,!0))}enableClickHide(){GI.timerMgr.clear(this,this.enableClickHide),this.canHide=this.u("txtBlankHint").visible=!0}}class Ae extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("ShareHintView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnShareGame",this.shareGame)}doShow(t){t&&t.onGameShow||t&&t.doneFunc&&(this.doneFunc=t.doneFunc.bind(this))}doHide(t){!t||t.onGameHide}shareGame(){this.isSharing||(this.isSharing=!0,GI.timerMgr.once(1e3,this,this.resetShareStats),GI.gMsgCet.event("btn_share_game",{doneFunc:(t,e)=>{t&&(this.hideSelf(),this.doneFunc&&this.doneFunc(t,e))}}))}resetShareStats(){GI.timerMgr.clear(this,this.resetShareStats),this.isSharing=!1}}class Ve extends GI.UIViewBase{constructor(){super(...arguments),this.sks={}}createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("ObtainMultiView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick(this.panel,this.hideSelf)}doShow(t){if(t&&t.onGameShow)return;null!=t&&null!=t.rewards&&(this.uiDatas=t.rewards,this.multiCount=Object.keys(this.uiDatas).length,this.panel.getController("countCtrl").selectedPage=this.multiCount.toString()),this.handleSk();let e=1;for(let t in this.uiDatas){let i=this.uiDatas[t],s=this.u("imgLoader"+e);s.asLoader.url=GI.uiViewMgr.getItemURL(i.iconName),this.panel.getTransition("show").play(),this.u("txtDesc"+e).asTextField.text="恭喜获得"+i.name,this.u("txtCount"+e).asTextField.text="x"+i.quantity,this.u("txtCount"+e).x=s.x+s.width,e++}}doHide(t){if(!t||!t.onGameHide){this.panel.getTransition("show").playReverse();for(let t in this.sks)this.sks[t].visible=!1,this.sks[t].stop();GI.gMsgCet.event("obtain_view_hide")}}handleSk(){for(let t=1;t<=this.multiCount;t++){let e=this.u("imgLoader"+t);null==this.sks[t]?(this.sks[t]=new Laya.Skeleton,e&&this.sks[t].pos(e.x,e.y),this.sks[t].load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sks[t].play(0,!0)})),this.panel.displayObject.addChild(this.sks[t]),this.panel.displayObject.setChildIndex(this.sks[t],0)):(this.sks[t].visible=!0,e&&this.sks[t].pos(e.x,e.y),this.panel.displayObject.setChildIndex(this.sks[t],0),this.sks[t].play(0,!0))}}}class Ee extends GI.UIViewBase{constructor(){super(...arguments),this._curListIndex=0}get curListIndex(){return this._curListIndex}set curListIndex(t){this._curListIndex=t,this.vipList&&this.curListIndex>=0&&this.curListIndex<this.vipList.numItems&&(this.vipList.scrollToView(this.curListIndex,!0),this.updateSwitchBtnUi())}createPanel(){this.needMask=!0,this.createPanelUI("SuperShooterView"),this.makeFullScreen(),this.initUI()}initUI(){this.vipList=this.u("list"),this.vipList.itemRenderer=GI.handle(this,this.itemRenderFunc,null,!1)}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnUpgrade",this.addExp),this.bindUiClick("btnFeather",this.getFeather),this.bindUiClick("btnNext",this.nextLvl),this.bindUiClick("btnPre",this.preLvl),this.bindGEvt("ab.get_vip_gift",this.changeGiftUI),this.bindGEvt("ab.vip_upgrade",this.onVipUpgrade),this.bindGEvt("ab.add_exp",this.updateUI),GI.gMsgCet.on("ab.RigEnd",this,this.hideSelfView),this.bindGEvt("show_custom_ad",this.showCustomAd)}doShow(t){t&&t.onGameShow||(GI.gMsgCet.event("ab.hideGridAd"),$t.i.canOperate=!1,this.vipList.numItems=Object.keys($t.i.data.commercialCfg.vipCfg).length,0==$t.i.data.vipData.lvl?this.curListIndex=0:this.curListIndex=$t.i.data.vipData.lvl-1,this.updateUI())}doHide(t){t&&t.onGameHide||(GI.gMsgCet.event("ab.showGridAd"),$t.i.canOperate=!0)}showCustomAd(){GI.pf.showCustomAd({sourceType:this.viewID,style:{x:this.u("customAd").x,y:this.u("customAd").y}})}hideSelfView(){$t.i.isPlay&&this.hideSelf()}updateUI(){let t=$t.i.data.vipData;this.u("txtLvl").text="LV."+t.lvl;let e=this.isMaxLvl()?t.lvl:t.lvl+1,i=$t.i.data.commercialCfg.vipCfg[e].exp;this.u("txtUpgrade1").text="花费"+$t.i.data.commercialCfg.vipCfg[e].costFeather+"羽毛",this.u("expBar").asProgress.max=i,this.u("expBar").asProgress.value=t.exp,this.u("txtExp").text=t.exp+"/"+i,this.updateSwitchBtnUi()}updateSwitchBtnUi(){this.u("btnNext").visible=this.u("imgNext1").visible=this.u("imgNext2").visible=this.curListIndex<Object.keys($t.i.data.commercialCfg.vipCfg).length-1,this.u("btnPre").visible=this.u("imgPre1").visible=this.u("imgPre2").visible=this.curListIndex>0,this.u("txtPriTitle").text="射手特权 Lv."+(this.curListIndex+1)}addExp(){if(this.isMaxLvl())return void GI.gInfoMgr.showInfo(12);let t=$t.i.data.commercialCfg.vipCfg[$t.i.data.vipData.lvl+1].costFeather;$t.i.money>=t?$t.i.data.addVipExp()&&($t.i.data.changeMoney({useOrGain:0,gemNum:t,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.mi_add_exp,gemdetails:""}),this.updateUI()):GI.gInfoMgr.showInfo(2)}getFeather(){$t.i.data.timeLimitData.feather_reward_limit&&$t.i.data.isTimeLimitNextStage("feather_reward_limit")?GI.gInfoMgr.showInfoCont(1,"今日视频获取羽毛数量已达上限，您可以通过挂机或通关转盘获取羽毛"):GI.uiViewMgr.showView("AbRewardView",{reward_id:1})}isMaxLvl(){return $t.i.data.vipData.lvl>=Object.keys($t.i.data.commercialCfg.vipCfg).length}itemRenderFunc(t,e){let i=t+1,s=$t.i.data.commercialCfg.vipCfg[i];s&&(this.u("txtReward1",e.asCom).text=s.slingshotName,this.u("txtReward2",e.asCom).text=100*s.startPropFiveFoldRate+"%",this.u("txtReward3",e.asCom).text=100*s.extraPoint+"%",this.u("txtReward4",e.asCom).text=100*s.extraFeatherReward+"%",this.u("txtReward5",e.asCom).text="Lv."+i+"特权礼包",this.u("red",e.asCom).visible="collect"==$t.i.data.vipData.giftBag[i],this.u("btnGiftBag",e.asCom).off(Laya.Event.CLICK,this,this.openGiftBagView),this.u("btnGiftBag",e.asCom).on(Laya.Event.CLICK,this,this.openGiftBagView,[i]))}nextLvl(){this.curListIndex>=Object.keys($t.i.data.commercialCfg.vipCfg).length-1||this.curListIndex++}preLvl(){this.curListIndex<=0||this.curListIndex--}openGiftBagView(t){GI.uiViewMgr.showView("GiftBagView",{lvl:t})}changeGiftUI(t){let e=null==t?$t.i.data.vipData.lvl-1:t-1;this.vipList&&this.itemRenderFunc(e,this.vipList.getChildAt(e))}onVipUpgrade(){this.updateUI(),this.changeGiftUI()}}class Ue extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("GiftBagView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnGet",this.getGift)}doShow(t){if(t&&t.onGameShow)return;t&&t.hasOwnProperty("lvl")&&(this.lvl=t.lvl);let e=$t.i.data.commercialCfg.vipCfg[this.lvl].propReward,i=1;for(let t of e)this.u("imgLoader"+i).asLoader.url=GI.uiViewMgr.getItemURL(t.iconName),i++;this.u("txtTitle").text="Lv."+this.lvl+"特权礼包",this.updateGetBtn()}doHide(t){!t||t.onGameHide}getGift(){let t={},e=$t.i.data.commercialCfg.vipCfg[this.lvl].propReward;for(let i of e)if(i.isFeather){t.feather={};for(let e in i)t.feather[e]=i[e]}else{t[i.propId]={};for(let e in i)t[i.propId][e]=i[e]}for(let e in t)!t[e].isFeather&&$t.i.data.presentUpdateData(t[e].propId,t[e].quantity,!0);$t.i.data.changeMoney({useOrGain:1,gemNum:t.feather.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_vip_gift,gemdetails:""}),GI.uiViewMgr.showView("ObtainMultiView",{rewards:t});let i=$t.i.data.vipData;i.giftBag[this.lvl]="done",$t.i.data.vipData=i,this.updateGetBtn(),GI.gMsgCet.event("ab.get_vip_gift",this.lvl)}updateGetBtn(){this.u("btnGet").enabled="collect"==$t.i.data.vipData.giftBag[this.lvl]}}class Oe extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("LimitEventEntranceView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnFeather",this.clickFeatherEntrance),this.bindUiClick("btnVideo",this.showVideoAd),this.bindUiClick("btnClose",this.hideSelf)}doShow(t){GI.uiViewMgr.showView("VideoTimesProgressView")}doHide(t){GI.uiViewMgr.hideView("VideoTimesProgressView")}clickFeatherEntrance(){$t.i.money>=50?($t.i.data.changeMoney({useOrGain:0,gemNum:50,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.mi_enter_event,gemdetails:""}),this.intoEventLvl()):GI.gInfoMgr.showInfo(2)}showVideoAd(){GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:11,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("ObtainExtraView播放完视频广告：",t,e),t&&((GI.gCfg.popShareHint||GI.gCfg.tempChangeVideoToShare||e&&"videoAd"==e.type)&&GI.gMsgCet.event("videoad_accum_reward"),this.intoEventLvl())}intoEventLvl(){this.hideSelf(),GI.uiViewMgr.hideView("VideoTimesProgressView"),$t.i.toEventLvl()}}class Ne extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("EventSceneFailView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnRestart",this.clickRestart),this.bindUiClick("btnEnd",this.endEvent)}doShow(t){!t||t.onGameShow}doHide(t){!t||t.onGameHide}clickRestart(){this.showVideoAd()}showVideoAd(){GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:1,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("ObtainExtraView播放完视频广告：",t,e),t&&(this.hideSelf(),$t.i.toEventLvl())}endEvent(){this.hideSelf(),$t.i.quitEventLvl()}}class Fe extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("EventSceneSucView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnEnd",this.endEvent)}doShow(t){t&&t.onGameShow||(this.medal=t&&t.medal,this.u("txtReward").text="恭喜获得 ["+this.medal.name+"]",this.u("imgLoader").asLoader.url=GI.uiViewMgr.getItemURL(this.medal.iconName),this.handleSk())}doHide(t){t&&t.onGameHide||this.sk&&this.sk.stop()}endEvent(){this.hideSelf(),$t.i.quitEventLvl(),this.giveReward()}giveReward(){let t=$t.i.data.commercialCfg.eventSceneRewards[this.medal.rewardId];if(t){let e=-1,i={};for(let s of t)if(s.isFeather){$t.i.data.changeMoney({useOrGain:1,gemNum:s.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_event_reward,gemdetails:""}),i.feather={};for(let t in s)i.feather[t]=s[t]}else if(-1==s.propId){let t=this.getRandomPropId(e);e=t;let a=$t.i.data.commercialCfg.prop[t];$t.i.data.presentUpdateData(t,s.quantity,!0),i[t]={},i[t]={name:a.name,iconName:a.iconName,quantity:s.quantity}}else{$t.i.data.presentUpdateData(s.propId,s.quantity,!0),i[s.propId]={};for(let t in s)i[s.propId][t]=s[t]}1==Object.keys(i).length&&i.feather?$t.i.popObtainView({name:i.feather.name,quantity:i.feather.quantity,iconName:i.feather.iconName},!0):GI.uiViewMgr.showView("ObtainMultiView",{rewards:i})}$t.i.data.addRankScore("addRank_Event",GI.gCfg.rankData.increase.event)}getRandomPropId(t=-1){let e=Math.ceil(Math.random()*Object.keys($t.i.data.commercialCfg.prop).length);return e==t||0==e||e==$t.i.data.commercialCfg.prop_enum.blast?this.getRandomPropId(t):e}handleSk(){let t=this.u("imgLoader");null==this.sk?(this.sk=new Laya.Skeleton,this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,1),this.sk.pos(t.x,t.y)):(this.sk.pos(t.x,t.y),this.sk.play(0,!0))}}class He extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("EventRewardView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnClose",this.hideSelf),GI.gMsgCet.on("ab.RigEnd",this,this.hideSelfView)}doShow(t){t&&t.onGameShow||(this.panel.getController("typeCtrl").selectedPage=t.type)}doHide(t){!t||t.onGameHide}hideSelfView(){$t.i.isPlay&&this.hideSelf()}}class qe extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("EventAnnounceView"),this.makeFullScreen(),this.panel.getController("confirmCtrl").selectedPage=GI.gCfg.dailyChallenge?"go":"confirm"}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnConfirm",this.popChallengeView)}doShow(t){if(t&&t.onGameShow)return;new Date(GI.gCfg.timelimitEvent.startDay),new Date(GI.gCfg.timelimitEvent.endDay)}doHide(t){!t||t.onGameHide}popChallengeView(){this.hideSelf(),GI.gCfg.dailyChallenge&&GI.uiViewMgr.showView("EventSummaryView")}}class Je extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("DailyChallengeView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnClose",this.hideSelf),this.bindUiClick("btnRule",this.clickRule),this.bindUiClick("btnStart",this.clickStart),this.bindUiClick("btnVideoEnter",this.videoEnter),this.bindUiClick("btnPropCollege",this.openShoView)}doShow(t){if(t&&t.onGameShow)return;let e=(new Date).getDay()||7;this.today=e;let i=GI.gCfg.dailyChallenge.days[this.today],s=i.enterCost.propId,a=$t.i.data.props[s];this.u("todayProp").asLoader.url=this.u("costProp").asLoader.url=this.getItemUrlByPropId(s),this.u("descIcon").asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.prop[s].descIcon),this.u("tomorrowProp").asLoader.url=this.getItemUrlByPropId(GI.gCfg.dailyChallenge.days[7==this.today?1:this.today+1].enterCost.propId),this.u("txtDesc").text=$t.i.data.commercialCfg.prop[s].desc,this.u("txtFeatherRemain").text=$t.i.money+"/"+i.enterCost.feather,this.u("txtFeatherRemain").asTextField.strokeColor=$t.i.money<i.enterCost.feather?"#ff3030":"#000000",this.u("txtPropRemain").text=a.quantity+"/"+GI.gCfg.dailyChallenge.totalStep,this.u("txtPropRemain").asTextField.strokeColor=a.quantity<GI.gCfg.dailyChallenge.totalStep?"#ff3030":"#000000";let r=$t.i.data.props[s];this.u("imgStar").visible=null!=r.guide_done&&r.guide_done>0;let o="start";GI.localDataMgr.getBool("isChallengeCost")?$t.i.data.isTimeLimitNextStage("videoEnterChallenge")||(o="video"):o="free",this.panel.getController("startCtrl").selectedPage=o}doHide(t){!t||t.onGameHide}clickRule(){GI.uiViewMgr.showView("DailyChallengeRuleView")}clickStart(){if(GI.localDataMgr.getBool("isChallengeCost")){let t=GI.gCfg.dailyChallenge.days[this.today].enterCost;$t.i.money<t.feather||$t.i.data.props[t.propId].quantity<GI.gCfg.dailyChallenge.totalStep?GI.gInfoMgr.showInfoCont(1,"金色羽毛或道具不足"):($t.i.data.deductProp(t.propId,GI.gCfg.dailyChallenge.totalStep),$t.i.data.changeMoney({useOrGain:0,gemNum:t.feather,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_Feather_reward,gemdetails:""}),this.directEnterChallenge())}else this.directEnterChallenge()}clickShop(){GI.uiViewMgr.showView("ShopView",{from:this.viewID})}getItemUrlByPropId(t){return GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.prop[t].iconName)}videoEnter(){GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:10,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("进每日挑战看视频广告：",t,e),t&&(this.directEnterChallenge(),$t.i.data.costTimeLimit("videoEnterChallenge"))}directEnterChallenge(){this.hideSelf(),$t.i.toDailyChallengeLvl(GI.gCfg.dailyChallenge.days[this.today].enterCost.propId)}openShoView(){this.hideSelf(),GI.uiViewMgr.hideView("DailyAttendanceView"),GI.uiViewMgr.showView("ShopView",{from:this.viewID})}}class je extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("EventSummaryView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnLimitEvent",this.openLimitEventView),this.bindUiClick("btnChallenge",this.openChallengeView),this.bindUiClick("btnClose",this.hideSelf),this.bindUiClick("btnRank",this.openRankView),this.bindGEvt("lastRankScoreUpdate",this.updateRankRewardHint),this.bindGEvt("rankScoreUpdate",this.updateRankScore)}doShow(t){if(t&&t.onGameShow)return;let e=new Date(GI.gCfg.timelimitEvent.startDay),i=new Date(GI.gCfg.timelimitEvent.endDay);this.u("txtDuration").text=e.getMonth()+1+"."+e.getDate()+" - "+(i.getMonth()+1)+"."+i.getDate(),this.u("iconProp").asLoader.url=GI.uiViewMgr.getItemURL($t.i.data.commercialCfg.prop[GI.gCfg.dailyChallenge.days[(new Date).getDay()||7].enterCost.propId].iconName),this.updateRankScore(),this.updateRankRewardHint()}doHide(t){!t||t.onGameHide}openChallengeView(){$t.i.isEventValid?(this.hideSelf(),GI.uiViewMgr.showView("DailyChallengeView")):GI.gInfoMgr.showInfoCont(1,"活动已结束")}openLimitEventView(){this.hideSelf(),GI.uiViewMgr.showView("LimitEventEntranceView")}openRankView(){GI.uiViewMgr.showView("RankInfoView")}updateRankRewardHint(){this.u("red").visible=$t.i.data.hasLastRankReward()}updateRankScore(){this.u("txtRank").text=$t.i.data.rankScore.toString()}}class We extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("DailyChallengePauseView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnContinue",this.hideSelf),this.bindUiClick("btnQuit",this.quitChallenge)}doShow(t){t&&t.onGameShow||($t.i.canOperate=!1)}doHide(t){t&&t.onGameHide||($t.i.canOperate=!0)}quitChallenge(){this.hideSelf(),GI.uiViewMgr.hideView("GamePlayView"),$t.i.quitPlay(),$t.i.quitDailyChallengeLvl()}}class Ye extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("DailyChallengeEndView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnGetReward",this.clickGetReard),this.bindUiClick("btnNext",this.toNextChallenge)}doShow(t){if(t&&t.onGameShow)return;$t.i.canOperate=!1;let e=$t.i.data.dailyChallengeData;this.panel.getController("displayCtrl").selectedPage=e.curStep<GI.gCfg.dailyChallenge.totalStep-1?"next":"done",this.u("txtGetPoint").text="恭喜获得积分 "+e.curScore+"！",this.u("txtCurPoint").text="当前积分 "+e.score,this.u("txtLastScore").text=e.score+"！"}doHide(t){t&&t.onGameHide||($t.i.canOperate=!0)}clickGetReard(){this.hideSelf(),$t.i.handleChallengeWelfare();let t=$t.i.data.dailyChallengeData.score;$t.i.quitDailyChallengeLvl(),this.giveReward(t)}toNextChallenge(){this.hideSelf(),$t.i.data.dailyChallengeData.curStep++,$t.i.data.dailyChallengeData.curScore=0,$t.i.toDailyChallengeLvl()}giveReward(t){let e=GI.gCfg.dailyChallenge.rewards,i=0;for(let s of e)if(t>s.score){i=s.rewardId;break}let s=$t.i.data.commercialCfg.dailyChallengeRewards[i];if(s){let t={};for(let e of s)if(e.isFeather){$t.i.data.changeMoney({useOrGain:1,gemNum:e.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_challenge_reward,gemdetails:""}),t.feather={};for(let i in e)t.feather[i]=e[i]}else if(-1==e.propId){let i=$t.i.data.commercialCfg.prop,s=this.getRandomPropId(),a=i[s];$t.i.data.presentUpdateData(s,e.quantity,!0),t[s]={},t[s]={name:a.name,iconName:a.iconName,quantity:e.quantity}}else{$t.i.data.presentUpdateData(e.propId,e.quantity,!0),t[e.propId]={};for(let i in e)t[e.propId][i]=e[i]}1==Object.keys(t).length&&t.feather?$t.i.popObtainView({name:t.feather.name,quantity:t.feather.quantity,iconName:t.feather.iconName},!0):GI.uiViewMgr.showView("ObtainMultiView",{rewards:t})}GI.gCfg.rankData&&$t.i.data.addRankScore("addRank_Challenge",GI.gCfg.rankData.increase.challenge)}getRandomPropId(){let t=Math.ceil(Math.random()*Object.keys($t.i.data.commercialCfg.prop).length);return t==$t.i.data.commercialCfg.prop_enum.blast?this.getRandomPropId():t}}class Xe extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("DailyChallengeRuleView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnClose",this.hideSelf)}doShow(){}doHide(){}}class ze extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("RankInfoView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnClose",this.hideSelf),this.bindUiClick("btnRule",this.openRuleView),this.bindGEvt("loopCheckTime",this.loopCheckRemainTime),this.bindGEvt("lastRankScoreUpdate",this.checkRankReward)}doShow(t){t&&t.onGameShow||(this.loopCheckRemainTime(),this.checkRankReward())}doHide(t){!t||t.onGameHide}loopCheckRemainTime(){let t=new Date(GI.localDataMgr.getInt("rankClearTime")-Date.now());this.rankPercent=$t.i.data.getRankPercent($t.i.data.rankScore),this.u("txtRemainTime").text=t.getUTCDate()-1+"天"+t.getUTCHours()+"小时",this.u("txtRankLevel").text="前"+this.rankPercent+"%",this.u("txtRank").text=$t.i.data.rankScore.toString()}openRuleView(){GI.uiViewMgr.showView("RankRuleView")}checkRankReward(){$t.i.data.lastRankScore&&($t.i.data.hasLastRankReward()?GI.uiViewMgr.showView("RankSettleView",{lastRankScore:$t.i.data.lastRankScore}):GI.gInfoMgr.showInfoCont(1,"很遗憾，上赛季未获取奖励"),$t.i.data.lastRankScore=0)}}class Ke extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("RankRuleView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnClose",this.hideSelf),this.bindUiClick("btnGoChapter",()=>{this.hideBeforeView(),GI.gMsgCet.event("directGoEventView"),GI.uiViewMgr.showView("ChapterView")}),this.bindUiClick("btnGoDaily",()=>{this.hideBeforeView(),GI.uiViewMgr.showView("DailyChallengeView")}),this.bindUiClick("btnGoEvent",()=>{this.hideBeforeView(),GI.uiViewMgr.showView("LimitEventEntranceView")})}doShow(t){}doHide(t){}hideBeforeView(){this.hideSelf(),GI.uiViewMgr.hideView("RankInfoView"),GI.uiViewMgr.hideView("EventSummaryView"),GI.uiViewMgr.hideView("DailyAttendanceView")}}class Qe extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("RankSettleView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnGet",this.giveReward)}doShow(t){if(t&&t.onGameShow)return;let e=t&&t.lastRankScore;this.u("txtRankLevel").text=$t.i.data.getRankPercent(e)+"%";let i=0;for(let t of GI.gCfg.rankData.rewards)if($t.i.data.getRankPercent(e)<=t.rankPercent){i=t.rewardId;break}if(this.rewards=$t.i.data.commercialCfg.rankRewards[i],this.rewards&&this.rewards.length){this.panel.getController("rewardCtrl").selectedPage=this.rewards.length.toString();for(let t=0;t<this.rewards.length;t++){let e=this.rewards[t],i="";-1==e.propId?i="txtCount2":e.propId==$t.i.data.commercialCfg.prop_enum.blast?i="txtCount1":e.isFeather&&(i="txtCount3"),this.u(i)&&(this.u(i).text="x"+e.quantity)}}}doHide(t){}giveReward(){if(this.hideSelf(),this.rewards){let t={};for(let e of this.rewards)if(e.isFeather){$t.i.data.changeMoney({useOrGain:1,gemNum:e.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_rank_reward,gemdetails:""}),t.feather={};for(let i in e)t.feather[i]=e[i]}else if(-1==e.propId){let i=$t.i.data.commercialCfg.prop,s=this.getRandomPropId(),a=i[s];$t.i.data.presentUpdateData(s,e.quantity,!0),t[s]={},t[s]={name:a.name,iconName:a.iconName,quantity:e.quantity}}else{$t.i.data.presentUpdateData(e.propId,e.quantity,!0),t[e.propId]={};for(let i in e)t[e.propId][i]=e[i]}1==Object.keys(t).length&&t.feather?$t.i.popObtainView({name:t.feather.name,quantity:t.feather.quantity,iconName:t.feather.iconName},!0):GI.uiViewMgr.showView("ObtainMultiView",{rewards:t})}}getRandomPropId(){let t=Math.ceil(Math.random()*Object.keys($t.i.data.commercialCfg.prop).length);return t==$t.i.data.commercialCfg.prop_enum.blast?this.getRandomPropId():t}}class Ze extends GI.UIViewBase{afterGoHtGame(t){0==t.isSuc&&GI.uiViewMgr.showView("FullScrollAdView")}renderListItem(t,e){if(!e)return;e.data=t;let i=this.getHtData(t);if(!i)return;let s=this.u("iconLoader",e.asCom).asCom,a=s.displayObject.getChildByName("img");a||((a=new Laya.Sprite).name="img",a.size(s.width,s.height),s.displayObject.addChild(a)),a.loadImage(i.iconUrl)}getHtData(t){if(this._htDatas)return this._htDatas[t%this._htDatas.length]}onItemClick(t,e){if(!t||null==t.data)return;let i=this.getHtData(Number(t.data));i&&GI.gMsgCet.event("pf.goHtNativeGame",{htData:i})}}class $e extends Ze{createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("HorizScrollAdView"),this.makeFullScreen(),this.listScroll=this.u("adList")}doBindEvt(){this.bindUiEvt(this.listScroll,fgui.Events.CLICK_ITEM,this.onItemClick),this.listScroll.asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.listScroll.asList.setVirtualAndLoop(),this.bindGEvt("pf.onHtNativeGames",this.onHtData),this.bindGEvt("pf.afterGoHtGame",this.afterGoHtGame)}doShow(t){t&&t.onGameShow||(t&&t.posType&&(this.panel.getController("posCtrl").selectedPage=t.posType),GI.gMsgCet.event("pf.getHtNativeGames",t),GI.timerMgr.frameLoop(1,this,this.onGoToScroll,null,!0))}doHide(t){t&&t.onGameHide||(GI.pf.setBannerAdForbidSrc(this,!1),this.listScroll.asList.numItems=0,GI.timerMgr.clear(this,this.onGoToScroll))}onHtData(t){this._htDatas=t.dataList||[],this.listScroll.asList.numItems=this._htDatas.length}onGoToScroll(){this.listScroll.scrollPane.setPosX(this.listScroll.scrollPane.posX+2)}}class ti extends Ze{constructor(){super(...arguments),this.timeNow=0}createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("VerticalScrollAdView"),this.makeFullScreen(),this.listScroll=this.u("adList"),this.listScroll2=this.u("adList2")}doBindEvt(){this.bindUiEvt([this.listScroll,this.listScroll2],fgui.Events.CLICK_ITEM,this.onItemClick),this.listScroll.asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.listScroll.asList.setVirtualAndLoop(),this.listScroll2.asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.listScroll2.asList.setVirtualAndLoop(),this.bindGEvt("pf.onHtNativeGames",this.onHtData),this.bindGEvt("pf.afterGoHtGame",this.afterGoHtGame)}doShow(t){t&&t.onGameShow||(GI.gMsgCet.event("pf.getHtNativeGames",t),GI.timerMgr.frameLoop(1,this,this.onGoToScroll,null,!0))}doHide(t){t&&t.onGameHide||(GI.pf.setBannerAdForbidSrc(this,!1),this.listScroll.asList.numItems=0,this.listScroll2.asList.numItems=0,GI.timerMgr.clear(this,this.onGoToScroll))}onHtData(t){this._htDatas=t.dataList||[],this.listScroll.asList.numItems=this._htDatas.length,this.listScroll2.asList.numItems=this._htDatas.length}onGoToScroll(){this.listScroll.scrollPane.setPosY(this.listScroll.scrollPane.posY+2),this.listScroll2.scrollPane.setPosY(this.listScroll2.scrollPane.posY+2)}}class ei extends Ze{constructor(){super(...arguments),this.singleRowNum=5,this.maskPros={alpha:1,color:"#0099FF"}}createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("FullScrollAdView"),this.makeFullScreen(),this.initData()}initData(){this.listScroll=this.u("adList").asList,this.listScroll.setVirtualAndLoop(),this.bottomListScroll=this.u("adBottomList").asList,this.bottomListScroll.setVirtualAndLoop()}doBindEvt(){this.bindUiEvt(this.listScroll,fgui.Events.CLICK_ITEM,this.onItemClick),this.listScroll.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.bindGEvt("pf.onHtNativeGames",this.onHtData),this.bottomListScroll.itemRenderer=GI.handle(this,this.renderBottomListItem,null,!1),this.bindUiClick("btnClose",this.hideSelf),GI.gMsgCet.on("ab.RigEnd",this,this.hideSelfView)}doShow(t){t&&t.onGameShow||(GI.gMsgCet.event("pf.getHtNativeGames",{htId:7}),GI.timerMgr.frameLoop(1,this,this.onGoToScroll,null,!0))}doHide(t){t&&t.onGameHide||(this.listScroll.numItems=0,GI.timerMgr.clear(this,this.onGoToScroll))}onHtData(t){GI.log("onHtData: ",t),this._htDatas=t.dataList||[],this.listScroll.numItems=this._htDatas.length,this.bottomListScroll.numItems=Math.ceil(this._htDatas.length/this.singleRowNum)}onGoToScroll(){this.listScroll.scrollPane.setPosX(this.listScroll.scrollPane.posX+2),this.bottomListScroll.scrollPane.setPosY(this.bottomListScroll.scrollPane.posY+2)}onBottomListClick(t,e){if(!t||null==t.data)return;let i=this.getHtData(Number(t.data));i&&GI.gMsgCet.event("pf.goHtNativeGame",{htData:i})}renderBottomListItem(t,e){if(!e)return;e.data=t;let i=this.u("list",e.asCom).asList;i.numItems=Math.max(this.singleRowNum,this._htDatas.length-t*this.singleRowNum);for(let e=0;e<i.numChildren;e++){let s=this.getHtData(t+e);if(!s)continue;let a=i.getChildAt(e).asCom;a.off(Laya.Event.CLICK,this,this.clickBottomItem),a.on(Laya.Event.CLICK,this,this.clickBottomItem,[s]);let r=this.u("iconLoader",a).asCom,o=r.displayObject.getChildByName("img");o||((o=new Laya.Sprite).name="img",o.size(r.width,r.height),r.displayObject.addChild(o)),o.loadImage(s.iconUrl)}}clickBottomItem(t){t&&GI.gMsgCet.event("pf.goHtNativeGame",{htData:t})}hideSelfView(){$t.i.isPlay&&this.hideSelf()}}class ii extends GI.UIViewBase{constructor(){super(...arguments),this.welfareCfgs=[]}createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("RookieWelfareView"),this.makeFullScreen(),this.initData()}initData(){this.welfareList=this.u("list"),this.welfareList.itemRenderer=GI.handle(this,this.itemRenderer,null,!1),this.welfareList.setVirtual()}doBindEvt(){this.bindUiClick("btnClose",this.hideSelf),this.bindGEvt("welfareRefresh",()=>{this.updateWelfareData()}),GI.gMsgCet.on("ab.RigEnd",this,this.hideSelfView)}doShow(t){t&&t.onGameShow||($t.i.canOperate=!1,this.updateWelfareData())}doHide(t){t&&t.onGameHide||($t.i.canOperate=!0)}updateWelfareData(){this.welfareCfgs=[];for(let t in GI.gCfg.rookieWelfare){let e={};if("received"!=$t.i.data.rookieWelfare[t].status){for(let i in GI.gCfg.rookieWelfare[t])e[i]=GI.gCfg.rookieWelfare[t][i];e.cfgId=t,this.welfareCfgs.push(e)}}for(let t=0;t<this.welfareCfgs.length;t++)"done"==$t.i.data.rookieWelfare[this.welfareCfgs[t].cfgId].status&&this.welfareCfgs.unshift(this.welfareCfgs.splice(t,1)[0]);this.welfareList.numItems=this.welfareCfgs.length,GI.localDataMgr.getBool("doneAllWelfare")&&this.hideSelf()}itemRenderer(t,e){let i=this.welfareCfgs[t];if(!i)return;let s=$t.i.data.rookieWelfare[i.cfgId];if(!s)return;let a=s.status;"process"==a&&("share"==i.key?a="share":"invite"==i.key&&(a="invite")),e.asCom.getController("stateCtrl").selectedPage=a;let r=i.stages[s.curStage>=i.stages.length?i.stages.length-1:s.curStage];this.u("txtRequire",e.asCom).text=r.desc,"rank"==i.key?this.u("txtProcess",e.asCom).text="(当前"+s.maxProcess+"%)":this.u("txtProcess",e.asCom).text="("+s.maxProcess+"/"+r.require+")";for(let t=0;t<r.rewards.length;t++){let i="",s="";r.rewards[t]&&(i=GI.uiViewMgr.getItemURL(r.rewards[t].iconName),s="x"+r.rewards[t].quantity),this.u("loader"+(t+1),e.asCom)&&(this.u("loader"+(t+1),e.asCom).asLoader.url=i),this.u("txtCount"+(t+1),e.asCom)&&(this.u("txtCount"+(t+1),e.asCom).text=s)}e.asCom.getController("countCtrl").selectedPage=r.rewards.length.toString();let o=this.u("btn",e.asCom);o.off(Laya.Event.CLICK,this,this.clickItemBtn),"received"!=s.status&&o.on(Laya.Event.CLICK,this,this.clickItemBtn,[{status:s.status,cfgId:i.cfgId}])}clickItemBtn(t){let e=GI.gCfg.rookieWelfare[t.cfgId];"done"==t.status?(this.giveReward(t.cfgId),$t.i.data.receiveWelfareReward(t.cfgId)):"share"!=e.key&&"invite"!=e.key||GI.gMsgCet.event("btn_share_game",{doneFunc:(e,i)=>{e&&(GI.gMsgCet.event("pf.shareGame"),$t.i.data.finishWelfareTask(t.cfgId))}})}giveReward(t){let e=GI.gCfg.rookieWelfare[t].stages[$t.i.data.rookieWelfare[t].curStage].rewards;if(GI.log("give reward: ",e),e){let t={};for(let i of e)if(i.isFeather){$t.i.data.changeMoney({useOrGain:1,gemNum:i.quantity,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_welfare,gemdetails:""}),t.feather={};for(let e in i)t.feather[e]=i[e]}else if(-1==i.propId){let e=$t.i.data.commercialCfg.prop,s=this.getRandomPropId(),a=e[s];$t.i.data.presentUpdateData(s,i.quantity,!0),t[s]={},t[s]={name:a.name,iconName:a.iconName,quantity:i.quantity}}else{$t.i.data.presentUpdateData(i.propId,i.quantity,!0),t[i.propId]={};for(let e in i)t[i.propId][e]=i[e]}GI.uiViewMgr.showView("ObtainMultiView",{rewards:t})}}getRandomPropId(){let t=Math.ceil(Math.random()*Object.keys($t.i.data.commercialCfg.prop).length);return t==$t.i.data.commercialCfg.prop_enum.blast?this.getRandomPropId():t}hideSelfView(){$t.i.isPlay&&this.hideSelf()}}class si extends Ze{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("TryPlayView"),this.makeFullScreen(),this.listScroll=this.u("adList")}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiEvt(this.listScroll,fgui.Events.CLICK_ITEM,this.onItemClick),this.listScroll.asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.listScroll.asList.setVirtual(),this.bindGEvt("pf.onHtNativeGames",this.onHtData)}doShow(t){t&&t.onGameShow||GI.gMsgCet.event("pf.getHtNativeGames",{htId:8})}doHide(t){t&&t.onGameHide||(GI.pf.setBannerAdForbidSrc(this,!1),this.listScroll.asList.numItems=0)}onHtData(t){this._htDatas=t.dataList||[],this.tryPlayData=GI.localDataMgr.getJSON("tryPlayData"),this.tryPlayData||(this.tryPlayData={});for(let t in this.tryPlayData){let e=!1;for(let i of this._htDatas)if(i.appID==t){e=!0;break}!e&&delete this.tryPlayData[t]}for(let t of this._htDatas)this.tryPlayData[t.appID]||(this.tryPlayData[t.appID]={status:"play"});this.updateLocalTryPlayData()}renderListItem(t,e){super.renderListItem(t,e);let i=this.getHtData(t);this.u("nameTxt",e.asCom).text=i.txt,e.asCom.getController("playCtrl").selectedPage=this.tryPlayData[i.appID].status}onItemClick(t,e){if(!t||null==t.data)return;let i=this.getHtData(Number(t.data)),s=this.tryPlayData[i.appID].status;"received"!=s&&("done"==s?(this.giveReward(),this.tryPlayData[i.appID].status="received",this.updateLocalTryPlayData()):i&&GI.gMsgCet.event("pf.goHtNativeGame",{htData:i,fromTryPlay:!0,doneFunc:(t,e)=>{t&&(this.tryPlayData[i.appID].status="done",this.updateLocalTryPlayData())}}))}giveReward(){let t="金色羽毛",e="Shangdian_Icon_Yumao",i=20;$t.i.data.changeMoney({useOrGain:1,gemNum:i,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_tryPlay,gemdetails:""}),$t.i.popObtainView({name:t,quantity:i,iconName:e},!0)}updateLocalTryPlayData(){GI.localDataMgr.setJSON("tryPlayData",this.tryPlayData),this.listScroll.asList.numItems=this._htDatas.length,GI.gMsgCet.event("updateTryPlayData")}}class ai extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("AssistPropView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("btnClose"),this.bindGEvt("ab.RigEnd",this.hideSelf),this.bindUiClick("btnUse",this.useProp)}doShow(t){t&&t.onGameShow||(this.getAssistProp(),this.u("txtDes").asTextField.setVar("name",this.assitProp.name).flushVars(),this.u("icon").asLoader.url=GI.uiViewMgr.getItemURL(this.assitProp.iconName),this.u("propIcon").asLoader.url=GI.uiViewMgr.getItemURL(this.assitProp.descIcon),this.u("txtPropDes").text=this.assitProp.desc)}getAssistProp(){let t=[];for(let e in $t.i.data.usingProp)!$t.i.data.usingProp[e].count&&Number(e)<=4&&t.push(e);this.propId=t[Math.floor(Math.random()*t.length)],this.assitProp=$t.i.data.commercialCfg.prop[this.propId],console.log("assit prop: ",this.assitProp,t)}useProp(){GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:14,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("协助道具界面播放完视频广告：",t,e),t&&($t.i.data.usePropUpdateData(this.propId,!0),this.hideSelf())}}class ri extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("ResurgeView"),this.makeFullScreen()}doBindEvt(){this.bindGEvt("ab.RigEnd",this.hideSelf),this.bindUiClick("btnUse",this.clickResurge),this.bindUiClick("btnClose",this.cancelResurge)}doShow(t){}clickResurge(){GI.pf.showVideoAd({closeFunc:this.onFinishVideo.bind(this),adIdx:12,sourceType:this.viewID})}onFinishVideo(t,e){GI.log("协助道具界面播放完视频广告：",t,e),t&&($t.i.resurge(),this.hideSelf())}cancelResurge(){$t.i.cancelResurge(),this.hideSelf()}}class oi{static init(){GI.gInfoMgr.registerView("HintView",Et),GI.prgMgr.initData(GI.uiViewMgr.registerView("PrgView",de)),GI.guideMgr.initData(GI.uiViewMgr.registerView("GuideView",Ie),GI.cfgMgr.parseCfgData(GI.gCfg.guideCfgs)),GI.moduleMgr.preInit(),GI.moduleMgr.addModule($t),GI.moduleMgr.doModulesPreInit();for(let t=0;t<GI.UiLayerEnum.num;t++)GI.uiViewMgr.registerView(GI.uiViewMgr.maskViewIDs[t],ge);GI.uiViewMgr.registerView("SysMainUi",se),GI.uiViewMgr.registerView("ShopView",ae),GI.uiViewMgr.registerView("RoleView",re),GI.uiViewMgr.registerView("ChallengeView",oe),GI.uiViewMgr.registerView("ChapterView",ne),GI.uiViewMgr.registerView("GamePlayView",le),GI.uiViewMgr.registerView("ScoreView",fe),GI.uiViewMgr.registerView("InsertAdView",ue),GI.uiViewMgr.registerView("BannerAdView",pe),GI.uiViewMgr.registerView("AbGuideView",me),GI.uiViewMgr.registerView("ObtainView",ye),GI.uiViewMgr.registerView("UnlockChapterView",we),GI.uiViewMgr.registerView("PropCollegeView",Ce),GI.uiViewMgr.registerView("PropGuideEndView",be),GI.uiViewMgr.registerView("TurntableView",Ge),GI.uiViewMgr.registerView("PropRewardView",ve),GI.uiViewMgr.registerView("DailyAttendanceView",Se),GI.uiViewMgr.registerView("GamePauseView",Re),GI.uiViewMgr.registerView("BlastRewardView",_e),GI.uiViewMgr.registerView("VideoTimesProgressView",Le),GI.uiViewMgr.registerView("GetShockwaveView",Me),GI.uiViewMgr.registerView("OfflineRewardView",Pe),GI.uiViewMgr.registerView("FeatherReceiveView",xe),GI.uiViewMgr.registerView("PropGuideRewardView",ke),GI.uiViewMgr.registerView("SettleStatisticView",Be),GI.uiViewMgr.registerView("ObtainExtraView",Te),GI.uiViewMgr.registerView("ObtainMultiView",Ve),GI.uiViewMgr.registerView("SuperShooterView",Ee),GI.uiViewMgr.registerView("debugview",De),GI.uiViewMgr.registerView("ShareHintView",Ae),GI.uiViewMgr.registerView("GiftBagView",Ue),GI.uiViewMgr.registerView("LimitEventEntranceView",Oe),GI.uiViewMgr.registerView("EventSceneFailView",Ne),GI.uiViewMgr.registerView("EventSceneSucView",Fe),GI.uiViewMgr.registerView("EventRewardView",He),GI.uiViewMgr.registerView("EventAnnounceView",qe),GI.uiViewMgr.registerView("DailyChallengeView",Je),GI.uiViewMgr.registerView("EventSummaryView",je),GI.uiViewMgr.registerView("DailyChallengePauseView",We),GI.uiViewMgr.registerView("DailyChallengeEndView",Ye),GI.uiViewMgr.registerView("DailyChallengeRuleView",Xe),GI.uiViewMgr.registerView("RankInfoView",ze),GI.uiViewMgr.registerView("RankRuleView",Ke),GI.uiViewMgr.registerView("RankSettleView",Qe),GI.uiViewMgr.registerView("HorizScrollAdView",$e),GI.uiViewMgr.registerView("VerticalScrollAdView",ti),GI.uiViewMgr.registerView("FullScrollAdView",ei),GI.uiViewMgr.registerView("RookieWelfareView",ii),GI.uiViewMgr.registerView("TryPlayView",si),GI.uiViewMgr.registerView("AssistPropView",ai),GI.uiViewMgr.registerView("ResurgeView",ri),GI.prgMgr.doPre(GI.handle(null,()=>{GI.moduleMgr.doModulesInit(),GI.moduleMgr.doModulesLateInit(),$t.i.enterWm()}))}}var ni,hi=Laya.Scene,li=Laya.ClassUtils.regClass;!function(t){!function(t){!function(t){class e extends hi{constructor(){super()}createChildren(){super.createChildren(),this.createView(e.uiView)}}e.uiView={type:"Scene",props:{y:360,x:640,width:1280,pivotY:360,pivotX:640,height:720},compId:2,child:[{type:"Sprite",props:{y:360,x:640,texture:"1stAsset/Login_Beijing_1.png",pivotY:450,pivotX:800,name:"bg"},compId:6},{type:"Sprite",props:{y:153,x:663,var:"imgLogo",texture:"1stAsset/Land_Logo_3.png",pivotY:87,pivotX:333,name:"imgLogo"},compId:3},{type:"Label",props:{y:666,x:640,width:600,var:"lblMsg",valign:"middle",strokeColor:"#000000",stroke:1,pivotY:60,pivotX:300,name:"lblMsg",height:120,fontSize:32,color:"#ffffff",bold:!0,align:"center"},compId:5}],loadList:["1stAsset/Login_Beijing_1.png","1stAsset/Land_Logo_3.png"],loadList3D:[]},t.LogoScUI=e,li("ui.res.scene.LogoScUI",e);class i extends hi{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/scene/Main")}}t.MainUI=i,li("ui.res.scene.MainUI",i)}(t.scene||(t.scene={}))}(t.res||(t.res={}))}(ni||(ni={}));function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var di={},gi=Array.prototype,ci=Object.prototype,ui=gi.slice,pi=ci.toString,mi=Object.prototype.hasOwnProperty,fi=gi.forEach,Ii=Array.isArray,yi={};di.each=function(t,e,i){if(null==t)return!1;if(fi&&t.forEach===fi)t.forEach(e,i);else if(t.length===+t.length){for(var s=0,a=t.length;s<a;s++)if(s in t&&e.call(i,t[s],s,t)===yi)return!1}else for(var r in t)if(mi.call(t,r)&&e.call(i,t[r],r,t)===yi)return!1},di.extend=function(t){return di.each(ui.call(arguments,1),function(e){for(var i in e)void 0!==e[i]&&(t[i]=e[i])}),t},di.extend2Layers=function(t){return di.each(ui.call(arguments,1),function(e){for(var i in e)void 0!==e[i]&&(di.isObject(e[i])&&di.isObject(t[i])?di.extend(t[i],e[i]):t[i]=e[i])}),t},di.isArray=Ii||function(t){return"[object Array]"===pi.call(t)},di.isFunction=function(t){try{return"function"==typeof t}catch(t){return!1}},di.isPromise=function(t){return"[object Promise]"===pi.call(t)&&null!==t},di.isObject=function(t){return"[object Object]"===pi.call(t)&&null!==t},di.isEmptyObject=function(t){if(di.isObject(t)){for(var e in t)if(mi.call(t,e))return!1;return!0}return!1},di.isUndefined=function(t){return void 0===t},di.isString=function(t){return"[object String]"===pi.call(t)},di.isDate=function(t){return"[object Date]"===pi.call(t)},di.isBoolean=function(t){return"[object Boolean]"===pi.call(t)},di.isNumber=function(t){return"[object Number]"===pi.call(t)&&/[\d\.]+/.test(String(t))},di.isJSONString=function(t){try{JSON.parse(t)}catch(t){return!1}return!0},di.decodeURIComponent=function(t){var e="";try{e=decodeURIComponent(t)}catch(i){e=t}return e},di.encodeDates=function(t){return di.each(t,function(e,i){di.isDate(e)?t[i]=di.formatDate(e):di.isObject(e)&&(t[i]=di.encodeDates(e))}),t},di.formatDate=function(e){function t(t){return t<10?"0"+t:t}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+((i=e.getMilliseconds())<100&&i>9?"0"+i:i<10?"00"+i:i);var i},di.searchObjDate=function(t){try{(di.isObject(t)||di.isArray(t))&&di.each(t,function(e,i){di.isObject(e)||di.isArray(e)?di.searchObjDate(t[i]):di.isDate(e)&&(t[i]=di.formatDate(e))})}catch(t){wi.warn(t)}},di.UUID=function(){var t=(new Date).getTime();return String(Math.random()).replace(".","").slice(1,11)+"-"+t},di.UUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})};var wi="object"===e(wi)?wi:{};wi.info=function(){if("object"===("undefined"==typeof console?"undefined":e(console))&&console.log&&wi.enabled)try{return console.log.apply(console,arguments)}catch(t){console.log(arguments[0])}},wi.warn=function(){if("object"===("undefined"==typeof console?"undefined":e(console))&&console.log&&wi.enabled)try{return console.warn.apply(console,arguments)}catch(t){console.warn(arguments[0])}};var Ci,bi=/^[a-zA-Z][a-zA-Z0-9_]{0,49}$/,Gi=function(){function e(){t(this,e)}return i(e,null,[{key:"stripProperties",value:function(t){return di.isObject(t)?(di.each(t,function(t,e){di.isString(t)||di.isNumber(t)||di.isDate(t)||di.isBoolean(t)||di.isArray(t)||wi.warn("您的数据-",e,t,"-格式不满足要求，可能无法正确入库")}),t):t}},{key:"_checkPropertiesKey",value:function(t){var e=!0;return di.each(t,function(t,i){bi.test(i)||(wi.warn("不合法的 KEY 值: "+i),e=!1)}),e}},{key:"event",value:function(t){return!(!di.isString(t)||!bi.test(t))||(wi.warn("请检查参数格式, eventName 必须是英文字母开头, 包含字母和数字和下划线的不超过50个字符的字符串: "+t),!1)}},{key:"propertyName",value:function(t){return!(!di.isString(t)||!bi.test(t))||(wi.warn("请检查参数格式, propertyName 必须是英文字母开头, 包含字母和数字和下划线的不超过50个字符的字符串: "+t),!1)}},{key:"properties",value:function(t){return this.stripProperties(t),!(t&&(di.isObject(t)?!this._checkPropertiesKey(t)&&(wi.warn("请检查参数格式, properties 的 key 只能以字母开头，包含数字、字母和下划线 _，长度最大为50个字符"),1):(wi.warn("properties 可以没有，但有的话必须是对象"),1)))}},{key:"propertiesMust",value:function(t){return this.stripProperties(t),void 0===t||!di.isObject(t)||di.isEmptyObject(t)?(wi.warn("properties必须是对象且有值"),!1):!!this._checkPropertiesKey(t)||(wi.warn("请检查参数格式, properties 的 key 只能以字母开头，包含数字、字母和下划线 _，长度最大为50个字符"),!1)}},{key:"userId",value:function(t){return!(!di.isString(t)||!/^.{1,64}$/.test(t))||(wi.warn("用户 id 必须是不能为空，且小于 64 位的字符串"),!1)}},{key:"userAddProperties",value:function(t){if(!this.propertiesMust(t))return!1;for(var e in t)if(!di.isNumber(t[e]))return wi.warn("userAdd 的属性需要为数值类型"),!1;return!0}},{key:"userAppendProperties",value:function(t){if(!this.propertiesMust(t))return!1;for(var e in t)if(!di.isArray(t[e]))return wi.warn("userAppend 的属性需要为 Array 类型"),!1;return!0}}]),e}(),vi=function e(i,s,a){var r=this;t(this,e),this.taInstance=i,GameGlobal[this.taInstance.name]=i,this.config=s||{};var o=a.getLaunchOptionsSync();o&&o.scene&&this.taInstance._setAutoTrackProperties({"#scene":o.scene}),a.onShow(function(t){r.config.appHide&&r.taInstance.timeEvent("ta_mg_hide"),t&&t.scene&&r.taInstance._setAutoTrackProperties({"#scene":t.scene}),r.config.appShow&&r.taInstance._internalTrack("ta_mg_show")}),a.onHide(function(){r.config.appHide&&r.taInstance._internalTrack("ta_mg_hide")})},Si=function e(i,s){var a=this;t(this,e),this.taInstance=i,this.config=s||{},this.config.appShow&&this.taInstance._internalTrack("ta_mg_show"),this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),qg.onShow(function(){a.config.appHide&&a.taInstance.timeEvent("ta_mg_hide"),a.config.appShow&&a.taInstance._internalTrack("ta_mg_show")}),qg.onHide(function(){a.config.appHide&&a.taInstance._internalTrack("ta_mg_hide")})},Ri=function e(i,s){var a=this;t(this,e),this.taInstance=i,this.config=s||{},this.config.appShow&&this.taInstance._internalTrack("ta_mg_show"),this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),qg.onShow(function(){a.config.appHide&&a.taInstance.timeEvent("ta_mg_hide"),a.config.appShow&&a.taInstance._internalTrack("ta_mg_show")}),qg.onHide(function(){a.config.appHide&&a.taInstance._internalTrack("ta_mg_hide")})},_i=new(function(){function e(){t(this,e)}return i(e,[{key:"getStorage",value:function(t){qg.getStorage({key:t.key,success:function(e){var i={};i.data=e,t.success(i)},fail:function(){t.fail({})}})}},{key:"setStorage",value:function(t){qg.setStorage({key:t.key,value:t.data})}},{key:"getSystemInfo",value:function(t){qg.getSystemInfo({success:function(e){var i=e,s=[e.osType,e.osVersionName].join(" ");i.brand=e.manufacturer,i.system=s,t.success(i)},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){qg.getNetworkType({success:function(e){var i=e;i.networkType=e.type,t.success(i)},complete:function(){t.complete()}})}},{key:"onNetworkStatusChange",value:function(t){qg.subscribeNetworkStatus({callback:function(e){var i=e;i.networkType=e.type,t(i)}})}},{key:"request",value:function(t){return qg.request({url:t.url,data:t.data,method:t.method,header:{"content-type":"application/json"},success:function(e){t.success(e)},fail:function(e){t.fail(e)}})}}]),e}()),Li=new(function(){function e(){t(this,e)}return i(e,[{key:"getStorageSync",value:function(t){return localStorage.getItem(t)}},{key:"setStorage",value:function(t){localStorage.setItem(t.key,t.data)}},{key:"getSystemInfo",value:function(t){qg.getSystemInfo({success:function(e){t.success(e)},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){qg.getNetworkType({success:function(e){t.success(e)},complete:function(){t.complete()}})}},{key:"onNetworkStatusChange",value:function(t){qg.onNetworkStatusChange({callback:function(e){t(e)}})}},{key:"request",value:function(t){var e=new XMLHttpRequest;return e.setRequestHeader("content-type","application/json"),e.open(t.method,t.url),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var i={statusCode:200};di.isJSONString(e.responseText)&&(i.data=JSON.parse(e.responseText)),t.success(i)}},e.ontimeout=function(){t.fail({errMsg:"timeout"})},e.send(t.data),e}},{key:"getLaunchOptionsSync",value:function(){return qg.getLaunchOptionsSync()}}]),e}()),Mi=function(){function e(){t(this,e)}return i(e,null,[{key:"init",value:function(t){Laya.Browser.onMiniGame?(Ci=wx,t.persistenceName="thinkingdata_wechat_game",t.asyncPersistence=!1):Laya.Browser.onBDMiniGame?(Ci=swan,t.persistenceName="thinkingdata_swan_game",t.asyncPersistence=!1):Laya.Browser.onVVMiniGame?(Ci=_i,t.persistenceName="thinkingdata_qg_vivo_game",t.asyncPersistence=!0):Laya.Browser.onQQMiniGame?(Ci=qq,t.persistenceName="thinkingdata_qq_game",t.asyncPersistence=!1):Laya.Browser.onQGMiniGame&&(Ci=Li,t.persistenceName="thinkingdata_qg_oppo_game",t.asyncPersistence=!1)}},{key:"getStorage",value:function(t,e,i){if(!e){var s=Ci.getStorageSync(t);return di.isJSONString(s)?JSON.parse(s):{}}Ci.getStorage({key:t,success:function(t){var e=di.isJSONString(t.data)?JSON.parse(t.data):{};i(e)},fail:function(){wi.warn("getStorage faild"),i({})}})}},{key:"setStorage",value:function(t,e){Ci.setStorage({key:t,data:e})}},{key:"getSystemInfo",value:function(t){Ci.getSystemInfo({success:function(e){Laya.Browser.onMiniGame?e.mp_platform="wechat":Laya.Browser.onBDMiniGame?e.mp_platform=e.host:Laya.Browser.onVVMiniGame?e.mp_platform="vivo_qg":Laya.Browser.onQQMiniGame?e.mp_platform="qq":Laya.Browser.onQGMiniGame&&(e.mp_platform="oppo_qg"),t.success(e)},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){Ci.getNetworkType({success:function(e){t.success(e)},complete:function(){t.complete()}})}},{key:"onNetworkStatusChange",value:function(t){Ci.onNetworkStatusChange(t)}},{key:"request",value:function(t){return Ci.request(t)}},{key:"initAutoTrackInstance",value:function(t,e){return di.isObject(e.autoTrack)&&(e.autoTrack.isPlugin=e.is_plugin),Laya.Browser.onMiniGame||Laya.Browser.onBDMiniGame||Laya.Browser.onQQMiniGame?new vi(t,e.autoTrack,Ci):Laya.Browser.onVVMiniGame?new Si(t,e.autoTrack,Ci):Laya.Browser.onQGMiniGame?new Ri(t,e.autoTrack,Ci):void 0}},{key:"getAppOptions",value:function(t){var e={};try{e=Ci.getLaunchOptionsSync()}catch(t){wi.warn("Cannot get launch options.")}if(di.isFunction(t)&&di.isFunction(Ci.onShow))try{Ci.onShow(t)}catch(t){wi.warn("Cannot register onAppShow callback.")}return e}}]),e}(),Pi=function(){function e(i,s,a,r,o){t(this,e),this.data=i,this.serverUrl=s,this.callback=o,this.tryCount=di.isNumber(a)?a:1,this.timeout=di.isNumber(r)?r:3e3}return i(e,[{key:"run",value:function(){var t=this,e=Mi.request({url:this.serverUrl,method:"POST",data:this.data,success:function(e){t.onSuccess(e)},fail:function(e){t.onFailed(e)}});setTimeout(function(){(di.isObject(e)||di.isPromise(e))&&di.isFunction(e.abort)&&e.abort()},this.timeout)}},{key:"onSuccess",value:function(t){if(200===t.statusCode){var e;switch(t.data.code){case 0:e="success";break;case-1:e="invalid data";break;case-2:e="invalid APP ID";break;default:e="Unknown return code"}this.callback({code:t.data.code,msg:e})}else this.callback({code:-3,msg:t.statusCode})}},{key:"onFailed",value:function(t){--this.tryCount>0?this.run():this.callback({code:-3,msg:t.errMsg})}}]),e}(),xi=new(function(){function e(){t(this,e),this.items=[],this.isRunning=!1}return i(e,[{key:"enqueue",value:function(t,e,i){var s=this,a=new Pi(JSON.stringify(t),e,i.maxRetries,i.sendTimeout,function(t){s.isRunning=!1,di.isFunction(i.callback)&&i.callback(t),s._runNext()});this.items.push(a),this._runNext()}},{key:"_dequeue",value:function(){return this.items.shift()}},{key:"_runNext",value:function(){this.items.length>0&&!this.isRunning&&(this.isRunning=!0,this._dequeue().run())}}]),e}()),ki={name:"thinkingdata",is_plugin:!1,maxRetries:3,sendTimeout:3e3,enablePersistence:!0,asyncPersistence:!1,enableLog:!0,strict:!1},Di={properties:{"#lib":"MG","#lib_version":"1.5.1"},initDeviceId:function(t){di.isString(t)&&(this.properties["#device_id"]=t)},getSystemInfo:function(t){var e=this;Mi.onNetworkStatusChange(function(t){e.properties["#network_type"]=t.networkType}),Mi.getNetworkType({success:function(t){e.properties["#network_type"]=t.networkType},complete:function(){Mi.getSystemInfo({success:function(t){var i={"#manufacturer":t.brand,"#device_model":t.model,"#screen_width":Number(t.screenWidth),"#screen_height":Number(t.screenHeight),"#os":t.system.split(" ")[0],"#os_version":t.system.split(" ")[1],"#mp_platform":t.mp_platform};di.extend(e.properties,i)},complete:function(){t()}})}})}},Bi=function(){function n(e,i){var s=this;t(this,n),this.enabled=e.enablePersistence,this.enabled?(e.isChildInstance?this.name=e.persistenceName+"_"+e.name:this.name=e.persistenceName,e.asyncPersistence?(this._state={},Mi.getStorage(this.name,!0,function(t){s._state=di.extend2Layers({},t,s._state),s._init(e,i),s._save()})):(this._state=Mi.getStorage(this.name)||{},this._init(e,i))):(this._state={},this._init(e,i))}return i(n,[{key:"_init",value:function(t,e){this.getDistinctId()||this.setDistinctId(di.UUID()),t.isChildInstance||(this.getDeviceId()||this._setDeviceId(di.UUID()),Di.initDeviceId(this.getDeviceId())),this.initComplete=!0,"function"==typeof e&&e(),this._save()}},{key:"_save",value:function(){this.enabled&&this.initComplete&&Mi.setStorage(this.name,JSON.stringify(this._state))}},{key:"_set",value:function(t,i){var s,a=this;"string"==typeof t?(s={})[t]=i:"object"===e(t)&&(s=t),di.each(s,function(t,e){a._state[e]=t}),this._save()}},{key:"setEventTimer",value:function(t,e){var i=this._state.event_timers||{};i[t]=e,this._set("event_timers",i)}},{key:"removeEventTimer",value:function(t){var e=(this._state.event_timers||{})[t];return di.isUndefined(e)||(delete this._state.event_timers[t],this._save()),e}},{key:"getDeviceId",value:function(){return this._state.device_id}},{key:"_setDeviceId",value:function(t){this.getDeviceId()?wi.warn("cannot modify the device id."):this._set("device_id",t)}},{key:"getDistinctId",value:function(){return this._state.distinct_id}},{key:"setDistinctId",value:function(t){this._set("distinct_id",t)}},{key:"getAccountId",value:function(){return this._state.account_id}},{key:"setAccountId",value:function(t){this._set("account_id",t)}},{key:"getSuperProperties",value:function(){return this._state.props||{}}},{key:"setSuperProperties",value:function(t,e){var i=e?t:di.extend(this.getSuperProperties(),t);this._set("props",i)}}]),n}(),Ti=function(){function e(i){t(this,e),di.isObject(i)?this.config=di.extend({},ki,i):this.config=ki,Mi.init(this.config),this._init(this.config)}return i(e,[{key:"_init",value:function(t){var e=this;if(this.name=t.name,this.appId=t.appid||t.appId,this.serverUrl=t.server_url+"/sync_xcx",this.autoTrackProperties={},this._queue=[],t.isChildInstance)this._state={};else if(wi.enabled=t.enableLog,this.instances=[],this._state={getSystemInfo:!1,initComplete:!1},Di.getSystemInfo(function(){e._updateState({getSystemInfo:!0})}),t.autoTrack)this.autoTrack=Mi.initAutoTrackInstance(this,t);else{var i=Mi.getAppOptions(function(t){t&&t.scene&&e._setAutoTrackProperties({"#scene":t.scene})});i.scene&&this._setAutoTrackProperties({"#scene":i.scene})}this.store=new Bi(t,function(){e.config.asyncPersistence&&di.isFunction(e.config.persistenceComplete)&&e.config.persistenceComplete(e),e._updateState()})}},{key:"initInstance",value:function(t,i){if(this.config.isChildInstance)wi.warn("initInstance() cannot be called on child instance");else if(di.isString(t)&&t!==this.name&&di.isUndefined(this[t])){var s=new e(di.extend({},this.config,{enablePersistence:!1,isChildInstance:!0,name:t},i));this[t]=s,this.instances.push(t),this[t]._state=this._state}else wi.warn("initInstance() failed due to the name is invalid: "+t)}},{key:"lightInstance",value:function(t){return this[t]}},{key:"_setAutoTrackProperties",value:function(t){di.extend(this.autoTrackProperties,t)}},{key:"init",value:function(){if(this._state.initComplete)return!1;this._updateState({initComplete:!0})}},{key:"_isReady",value:function(){return this._state.getSystemInfo&&this._state.initComplete&&this.store.initComplete&&this.getDeviceId()}},{key:"_updateState",value:function(t){var e=this;di.isObject(t)&&di.extend(this._state,t),this._onStateChange(),di.each(this.instances,function(t){e[t]._onStateChange()})}},{key:"_onStateChange",value:function(){var t=this;this._isReady()&&this._queue&&this._queue.length>0&&(di.each(this._queue,function(e){t[e[0]].apply(t,ui.call(e[1]))}),this._queue=[])}},{key:"_sendRequest",value:function(t,e){e=di.isDate(e)?e:new Date;var i={data:[{"#type":t.type,"#time":di.formatDate(e),"#distinct_id":this.store.getDistinctId()}]};if(this.store.getAccountId()&&(i.data[0]["#account_id"]=this.store.getAccountId()),"track"===t.type){i.data[0]["#event_name"]=t.eventName,i.data[0].properties=di.extend({"#zone_offset":0-e.getTimezoneOffset()/60},Di.properties,this.autoTrackProperties,this.store.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():{});var s=this.store.removeEventTimer(t.eventName);if(!di.isUndefined(s)){var a=(new Date).getTime()-s;i.data[0].properties["#duration"]=parseFloat((a/1e3).toFixed(3))}}else i.data[0].properties={};di.isObject(t.properties)&&!di.isEmptyObject(t.properties)&&di.extend(i.data[0].properties,t.properties),di.searchObjDate(i.data[0]),this.config.maxRetries>1&&(i.data[0]["#uuid"]=di.UUIDv4()),i["#app_id"]=this.appId,wi.info(JSON.stringify(i,null,4)),xi.enqueue(i,this.serverUrl,{maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:t.onComplete})}},{key:"_isObjectParams",value:function(t){return di.isObject(t)&&di.isFunction(t.onComplete)}},{key:"track",value:function(t,e,i,s){if(this._isObjectParams(t)){var a=t;t=a.eventName,e=a.properties,i=a.time,s=a.onComplete}Gi.event(t)&&Gi.properties(e)||!this.config.strict?this._internalTrack(t,e,i,s):di.isFunction(s)&&s({code:-1,msg:"invalid parameters"})}},{key:"_internalTrack",value:function(t,e,i,s){i=di.isDate(i)?i:new Date,this._isReady()?this._sendRequest({type:"track",eventName:t,properties:e,onComplete:s},i):this._queue.push(["_internalTrack",[t,e,i,s]])}},{key:"userSet",value:function(t,e,i){if(this._isObjectParams(t)){var s=t;t=s.properties,e=s.time,i=s.onComplete}Gi.propertiesMust(t)||!this.config.strict?(e=di.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"user_set",properties:t,onComplete:i},e):this._queue.push(["userSet",[t,e,i]])):(wi.warn("calling userSet failed due to invalid arguments"),di.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}},{key:"userSetOnce",value:function(t,e,i){if(this._isObjectParams(t)){var s=t;t=s.properties,e=s.time,i=s.onComplete}Gi.propertiesMust(t)||!this.config.strict?(e=di.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"user_setOnce",properties:t,onComplete:i},e):this._queue.push(["userSetOnce",[t,e,i]])):(wi.warn("calling userSetOnce failed due to invalid arguments"),di.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}},{key:"userUnset",value:function(t,e,i){if(this._isObjectParams(a)){var s=a;t=s.property,i=s.time,e=s.onComplete}if(Gi.propertyName(t)||!this.config.strict)if(i=di.isDate(i)?i:new Date,this._isReady()){var a={};a[t]=0,this._sendRequest({type:"user_unset",properties:a,onComplete:e},i)}else this._queue.push(["userUnset",[t,e,i]]);else wi.warn("calling userUnset failed due to invalid arguments"),di.isFunction(e)&&e({code:-1,msg:"invalid parameters"})}},{key:"userDel",value:function(t,e){if(this._isObjectParams(t)){var i=t;t=i.time,e=i.onComplete}t=di.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_del",onComplete:e},t):this._queue.push(["userDel",[t,e]])}},{key:"userAdd",value:function(t,e,i){if(this._isObjectParams(t)){var s=t;t=s.properties,e=s.time,i=s.onComplete}Gi.userAddProperties(t)||!this.config.strict?(e=di.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"user_add",properties:t,onComplete:i},e):this._queue.push(["userAdd",[t,e,i]])):(wi.warn("calling userAdd failed due to invalid arguments"),di.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}},{key:"userAppend",value:function(t,e,i){if(this._isObjectParams(t)){var s=t;t=s.properties,e=s.time,i=s.onComplete}Gi.userAppendProperties(t)||!this.config.strict?(e=di.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"user_append",properties:t,onComplete:i},e):this._queue.push(["userAppend",[t,e,i]])):(wi.warn("calling userAppend failed due to invalid arguments"),di.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}},{key:"authorizeOpenID",value:function(t){this.identify(t)}},{key:"identify",value:function(t){if("number"==typeof t)t=String(t);else if("string"!=typeof t)return!1;this.store.setDistinctId(t)}},{key:"getDistinctId",value:function(){return this.store.getDistinctId()}},{key:"login",value:function(t){if("number"==typeof t)t=String(t);else if("string"!=typeof t)return!1;this.store.setAccountId(t)}},{key:"getAccountId",value:function(){return this.store.getAccountId()}},{key:"logout",value:function(){this.store.setAccountId(null)}},{key:"setSuperProperties",value:function(t){Gi.propertiesMust(t)||!this.config.strict?this.store.setSuperProperties(t):wi.warn("setSuperProperties 的参数必须是合法的属性值")}},{key:"clearSuperProperties",value:function(){this.store.setSuperProperties({},!0)}},{key:"unsetSuperProperty",value:function(t){if(di.isString(t)){var e=this.getSuperProperties();delete e[t],this.store.setSuperProperties(e,!0)}}},{key:"getSuperProperties",value:function(){return this.store.getSuperProperties()}},{key:"setDynamicSuperProperties",value:function(t){"function"==typeof t?Gi.properties(t())||!this.config.strict?this.dynamicProperties=t:wi.warn("动态公共属性必须返回合法的属性值"):wi.warn("setDynamicSuperProperties 的参数必须是 function 类型")}},{key:"timeEvent",value:function(t,e){e=di.isDate(e)?e:new Date,this._isReady()?Gi.event(t)||!this.config.strict?this.store.setEventTimer(t,e.getTime()):wi.warn("calling timeEvent failed due to invalid eventName: "+t):this._queue.push(["timeEvent",[t,e]])}},{key:"getDeviceId",value:function(){return Di.properties["#device_id"]}}]),e}();class Ai{get canDo(){return Ti}doTaInit(t,e){if(null!=Ti){console.log("==========doTaInit================"),console.log(Ti);var i={appid:"aa59e60bdd334a1a9ac24f71150fed95",server_url:"https://tga-data-upload.hrgame.com.cn",autoTrack:{appShow:!0,appHide:!0},enableLog:!!GI.gCfg.showTaLog};this.tas=new Ti(i,new Date),this.tas.init(i),this.setUserPropOnce()}t&&t()}preInit(){GI.gMsgCet.on("Wm.beforeChangeMap",this,this.onEnterMap),GI.gMsgCet.on("Wm.onLvlEnd",this,this.onLeaveMap),GI.gMsgCet.on("Wm.onAdsButtonClick",this,this.onAdsButtonClick),GI.gMsgCet.on("Wm.onAdsPlayRet",this,this.onAdsPlayRet),GI.gMsgCet.on("gem_use_or_gain",this,this.onGemUseOrGain),GI.gMsgCet.on("pf.isInsertAdShow",this,this.onisInsertAdShow),GI.gMsgCet.on("shop_action",this,this.onShopAction),GI.gMsgCet.on("Wm.onLoading",this,this.onLoading),GI.gMsgCet.on("wm.onAssistAction",this,this.onAssistAction),GI.gMsgCet.on("pf.afterGoHtGame",this,this.onAppJump),GI.gMsgCet.on("ab.openPauseView",this,this.onOpenPauseView),GI.gMsgCet.on("cm.view.show",this,this.onViewShow),this.onLogin()}onGameStart(){this.onLoading({loading_step:2,state:0})}onGameReady(){this.onLoading({loading_step:2,state:1})}setUserPropOnce(){let t=GI.pf._adp.getLaunchOptionsSync&&GI.pf._adp.getLaunchOptionsSync();this.tas.userSetOnce({twtraceid:t&&t.scene.toString()||"",tracetime:GI.timerMgr.now,channel:GI.gCfg.taCfg.channelEnum[GI.pf.flag],gameId:5026,gameversion:GI.gCfg.gVerCode||0})}taTrack(t,e){if(null!=this.tas){let i=GI.localDataMgr.getInt("lastEnterLvl"),s=$t.i.data.getLastUnlockLvl(),a={level:i||0,scene:s?$t.i.data.getLvlNum(s.chapter,s.lvl):0,currency:$t.i.money,channel:GI.gCfg.taCfg.channelEnum[GI.pf.flag],gameId:5026,gameversion:GI.gCfg.gVerCode||0};for(let t in a)e[t]=a[t];this.tas.track(t,e)}}onEnterMap(t){this.taTrack("onEnterMap",{stageId:t.lvl.toString(),stageName:t.lvl.toString()})}onLeaveMap(t){this.taTrack("Level",{level_state:$t.i.curChapter,level_first:t.lvl,event:1==t.resultFlag?1:0,ispassed:t.resultFlag})}onLogin(){var t=GI.localDataMgr.getInt("tactrl.isFirst");0==t&&GI.localDataMgr.setInt("tactrl.isFirst",1),this.taTrack("Login",{If_new:t?0:1,channel:GI.gCfg.taCfg.channelEnum[GI.pf.flag]})}onLoading(t){this.taTrack("Loading",{loading_step:t.loading_step,state:t.state})}onAdsButtonClick(t){let e={AdsButtonClick_adsId:t.adsId,Ad_Type:t.adType};null!=t.adIdx&&(e.adsid=Number(t.adIdx)),this.taTrack("AdsButtonClick",e)}onAdsPlayRet(t){let e={AdsPlayRet_adsId:t.adsId,playRet:t.playRet,Ad_Type:t.adType};null!=t.adIdx&&(e.adsid=Number(t.adIdx)),this.taTrack("AdsPlayRet",e)}onisInsertAdShow(){}onGemUseOrGain(t){this.taTrack("gem_use_or_gain",{useOrGain:t.useOrGain,gemNum:t.gemNum,gemtype:t.gemtype,gemdetails:t.gemdetails})}onShopAction(t){this.taTrack("shop_action",{Item_id:Number(t.Item_id),Use_resource_type:t.Use_resource_type,Use_num:t.Use_num})}onAppJump(t){this.taTrack("AppJump",{Jump_appid:t.appId,Jump_click:t.isSuc,Jump_position:t.htPosId,Jump_icon:t.htIconId})}onOpenPauseView(t){this.taTrack("suspend",{})}onAssistAction(t){this.taTrack("assist_action",{assistaction_type:t})}onViewShow(t){let e=t&&t.vpData&&t.vpData.vpID;if(e&&GI.gCfg.videoViews&&null!=GI.gCfg.videoViews[e])for(let t of GI.gCfg.videoViews[e])this.taTrack("AdsExposure",{adsid:t})}}class Vi extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.createPanelUI("RankView"),this.makeFullScreen(),this.CreateWXOpendateView()}CreateWXOpendateView(){let t=this.u("contain");this.panel.displayObject.addChild((new Laya.WXOpenDataViewer).size(t.width,t.height).pos(t.x,t.y))}doBindEvt(){this.bindClickHide("btnClose")}doShow(){GI.pf.postOdcMsg("showRankList")}doHide(){GI.pf.postOdcMsg("hideRankList")}}class Ei{static initPf(t){t&&!GI.pf&&(GI.pf=GI.moduleMgr.addModule(t))}constructor(){this._isGameShow=!0,this.sysInfo=null,this.pfVer=0,this._bannerAdNum=0,this._bannerAdDay=0,this._nativeAdNum=0,this._nativeAdDay=0,this.flag=""}onGameStart(){!this.pfName&&(this.pfName=this.flag+"game"),GI.log("=======>>>pf-onGameStart:"+this.flag+",gVerName:"+GI.gCfg.gVerName+",gVerCode:"+GI.gCfg.gVerCode),this._bannerAdNum=GI.localDataMgr.getInt("pf.bannerAdNum"),this._bannerAdDay=this.getDay(GI.localDataMgr.getInt("pf.bannerAdDay")),this._nativeAdNum=GI.localDataMgr.getInt("pf.nativeAdNum"),this._nativeAdDay=this.getDay(GI.localDataMgr.getInt("pf.nativeAdDay")),this.webBasePath=GI.gCfg.webBasePath||GI.gCfg.webRoot&&GI.gCfg.webRoot+this.flag+"/release/",this.verPath=GI.gCfg.verPath||this.webBasePath&&this.webBasePath+this.flag+"Ver_"+GI.gCfg.gVerName.replace(/\./g,"_")+".json",this.verPath&&(this.verPath+="?v="+Math.floor(Date.now()/1e3)),GI.gMsgCet.on("Wm.afterChangeMap",this,this.afterChangeMap),GI.gMsgCet.on("Wm.onLvlEnd",this,this.onLvlEnd),!GI.isDebug&&(this.taCtrl=GI.moduleMgr.addModule(Ai))}login(t){this.preLogin(),!GI.isDebug&&this.taCtrl.doTaInit(),this.doLogin(t)}preLogin(){this.parseGCfg(this.flag)}doLogin(t){t&&t()}preInit(){this.initInsertAd(),this.initBanner(),this.initVideoAd(),this.initNativeAd(),this.initRank(),this.initBlockAd(),this.initCustomAd(),this.initAddToFavorites()}init(){this.afterInitRank()}get isGameShow(){return this._isGameShow}onShow(t){GI.log("game.sys.onShow",t),this._isGameShow=!0,GI.gMsgCet.event("CMEVT_ON_SHOW",{res:t})}onHide(t){GI.log("game.sys.onHide",t),this._isGameShow=!1,GI.gMsgCet.event("CMEVT_ON_HIDE",{res:t})}parseGCfg(t){t&&(GI.gCfg.bindPros(GI.gCfg[t]),this.bindPosCfg(GI.gCfg.posCfg),this.bindPosCfg(GI.gCfg.pfPosCfg))}bindPosCfg(t){if(t&&GI.gCfg.posStr)for(const e of t)if(e&&e.pos)for(const t of e.pos)if(GI.gCfg.posStr.indexOf(t)>=0){GI.gCfg.bindPros(e.cfg);break}}afterChangeMap(){}onLvlEnd(){}get bannerAdNum(){return this.getToday!=this._bannerAdDay&&(this.bannerAdNum=0),this._bannerAdNum}set bannerAdNum(t){this._bannerAdNum=t,this._bannerAdDay=this.getToday}initBanner(){if(this._bannerAdShowSrc=new Map,this._bannerAdForbidSrc=new Map,!this.bannerAdID)return;GI.gMsgCet.on("pf.isInsertAdShow",this,()=>{this.setBannerAdForbidSrc("InsertAd",this.isInsertAdShow)});let t=GI.gCfg.bannerAdCons&&GI.gCfg.bannerAdCons[GI.gCfg.bannerAdType];if(t&&t.views){this.showingBannerViews=[];for(const e in t.views){if(!t.views.hasOwnProperty(e))continue;const i=t.views[e];GI.gMsgCet.on("cm.view.show."+e,this,t=>{this.showingBannerViews.push(e)}),GI.gMsgCet.on("cm.view.hide."+e,this,()=>{this.showingBannerViews.splice(this.showingBannerViews.indexOf(e),1)}),GI.gMsgCet.on("cm.view."+e,this,t=>{t&&(i.hasOwnProperty("forbid")?this.setBannerAdForbidSrc("vSrc_"+e,t.val&&i):i?this.setBannerAdShowSrc("vSrc_"+e,t.val&&i):this.setBannerAdForbidSrc("vSrc_"+e,t.val))})}}this._bannerAdNextTime=-1,this.bannerInitTime=GI.timerMgr.currTimer,this.bannerAdType=Math.pow(2,GI.gCfg.bannerAdType-1),this.doInitBanner&&this.doInitBanner()}get bannerAdID(){return GI.gCfg.bannerAdID}getBannerStyle(t,e){e||(e=GI.gScale());let i=t&&t.bannerAdStyle||GI.gCfg.bannerAdStyle;return{top:e*(GI.gh()-i.height-i.bottomOff),left:e*(GI.gw()-i.width)/2,width:e*i.width,height:e*i.height}}get isBannerAdShow(){return this._isBannerShow}set isBannerAdShow(t){this._isBannerShow!=t&&(this._isBannerShow=t,GI.gMsgCet.event("pf.isBannerAdShow"))}setBannerAdShowSrc(t,e){this._bannerAdShowSrc.set(t,e),this.checkBannerAd()}setBannerAdForbidSrc(t,e){this._bannerAdForbidSrc.set(t,e),this.checkBannerAd()}hasBannerSrc(t){if(!this._bannerAdShowSrc.values())return!1;let e=null;for(let i of this._bannerAdShowSrc){let s=i[1];s&&(!e||(Object.is(s)&&s.priority||0)>(Object.is(e)&&e.priority||0))&&(e=s,t&&(t.source=i[0]))}return e}clearBannerTimer(){GI.timerMgr.clear(this,this.checkBannerAd)}setBannerTimer(t){this.clearBannerTimer(),GI.timerMgr.once(t,this,this.checkBannerAd)}checkBannerRatio(){return null==GI.gCfg.bannerAdRatio||Math.random()<GI.gCfg.bannerAdRatio}getMapPSrc(t,e){if(!(t&&t.values()))return!1;let i=null;for(const s of t){let t=s[1];t&&(!i||(Object.is(t)&&t.priority||0)>(Object.is(i)&&i.priority||0))&&(i=t,e&&(e.source=s[0]))}return i}checkBannerAdSrc(t){let e=this.getMapPSrc(this._bannerAdShowSrc,t),i=this.getMapPSrc(this._bannerAdForbidSrc);return e&&(!i||(Object.is(e)&&e.priority||0)>(Object.is(i)&&i.priority||0))&&e}checkBannerAd(t){let e={source:""};if(this.checkBannerAdSrc(e)&&$t.i.data.isNextLvlUnlock(1,GI.gCfg.bannershowLevel)&&this.checkBannerRatio()){if(GI.gCfg.startForbidBannerAdTime&&GI.timerMgr.currTimer-this.bannerInitTime<GI.gCfg.startForbidBannerAdTime)return this.clearBannerTimer();if(GI.gCfg.bannerAdMaxNum&&this.bannerAdNum>=GI.gCfg.bannerAdMaxNum)return this.clearBannerTimer();if(this.isBannerAdShow&&GI.timerMgr.currTimer<this._bannerAdNextTime)return;if(GI.timerMgr.gameRunTime<=GI.gCfg.bannerAd1Delay)return this.setBannerTimer(GI.gCfg.bannerAd1Delay-GI.timerMgr.gameRunTime);this.clearBannerTimer(),this._bannerAdNextTime=GI.timerMgr.currTimer+GI.gCfg.bannerAdNumTime,this.bannerAdNum++,this.isBannerAdShow=!0,this.bannerSourceType=e.source,this.doShowBanner(t)}else this.clearBannerTimer(),this.isBannerAdShow=!1,this.doHideBanner(t)}doShowBanner(t){this.bannerAd&&this.exeShowBanner(t)}exeShowBanner(t){return GI.gMsgCet.event("CMEVT_ON_BANNER_SHOW"),this.bannerAd.show()}onBannerSuc(){GI.log("bannerAd显示成功: ",this.bannerSourceType),GI.gMsgCet.event("pf.presentAd",{adType:"bannerAd",adId:GI.gCfg.bannerAdID,adBehavior:"show",sourceType:this.bannerSourceType}),this.bannerAdShowEvt&&this.bannerAdShowEvt(),GI.gCfg.bannerAdIntervals&&this.setBannerTimer(GI.gCfg.bannerAdIntervals)}onBannerError(t){GI.log("bannerAd 显示Error",t),GI.gMsgCet.event("CMEVT_ON_BANNER_ERROR"),this.setBannerTimer(GI.gCfg.bannerAdErrorTime)}doHideBanner(t){this.bannerAd&&this.exeHideBanner(t)}exeHideBanner(t){return this.bannerAd.hide()}get isInsertAdShow(){return this._isInsertAdShow}set isInsertAdShow(t){this.isInsertAdShow!=t&&(this._isInsertAdShow=t,GI.gMsgCet.event("pf.isInsertAdShow"),GI.gMsgCet.event(this._isInsertAdShow?"pf.InsertAd.show":"pf.InsertAd.hide"))}initInsertAd(){GI.gMsgCet.on("pf.InsertAdView.hide",this,this.onInsertAdHide),GI.gCfg.insertAdID&&this.doInitInsertAd&&this.doInitInsertAd()}showInsertAd(t){if(GI.gCfg.insertAdShowLevel&&!$t.i.data.isNextLvlUnlock(GI.gCfg.insertAdShowLevel.chapter,GI.gCfg.insertAdShowLevel.lvl))return!1;let e=GI.gCfg.insertAdRatio;GI.gCfg.insertAdPageRatio&&GI.gCfg.insertAdPageRatio.hasOwnProperty(t.sourceType)&&(e=GI.gCfg.insertAdPageRatio[t.sourceType].ratio);return GI.gCfg.insertAdID&&(!GI.gCfg.insertAdForbid||!t||!GI.gCfg.insertAdForbid[t.sourceType])&&!GI.guideMgr.isGuiding&&Math.random()<e&&(this.isInsertAdShow=!0,this.doShowInsertAd(t))}doShowInsertAd(t){return GI.uiViewMgr.showView("InsertAdView")}exeShowInsertAd(t){let e=this.insertAd&&this.insertAd.show();e&&e.then&&e.then(()=>{GI.log("insertAd show suc:",t),GI.gMsgCet.event("pf.presentAd",{adType:"insertAd",adId:GI.gCfg.insertAdID,adBehavior:"show",sourceType:t&&t.sourceType})}).catch(t=>{GI.log("insertAd show error:",t),this.onInsertAdHide()})}onInsertAdHide(){this.isInsertAdShow=!1}initVideoAd(){GI.gCfg.videoAdID&&this.doInitVideoAd&&this.doInitVideoAd()}showVideoAd(t){this.videoSourceType=t&&t.sourceType,this.videoData={adsId:GI.gCfg.videoAdIDs[t.adIdx],adType:2,adIdx:t.adIdx},GI.gMsgCet.event("Wm.onAdsButtonClick",this.videoData),this.videoAd&&this.exeLoadVideoAd(t)}exeLoadVideoAd(t){return this._videoAdCloseFunc=t&&t.closeFunc,this.videoAd.load()}onVideoAdLoadSuc(){return GI.log("激励视频加载成功"),this.exeShowVideoAd()}onVideoAdError(t){let e=this._videoAdCloseFunc;this._videoAdCloseFunc=null,e&&e(!1,{type:"videoAd"}),GI.log("激励视频加载失败",t),GI.gMsgCet.event("CMEVT_ON_VIDEO_ERROR"),this.videoData&&GI.gMsgCet.event("Wm.onAdsPlayRet",{adsId:this.videoData.adsId,playRet:-1,adType:2,adIdx:this.videoData.adIdx}),GI.gInfoMgr.showInfo(5),$t.i.popShareHintView({doneFunc:e})}exeShowVideoAd(){return GI.log("video显示成功：",this.videoSourceType,null!=this.videoAdIdx?this.videoAdIdx:GI.gCfg.videoAdIdxSetting.defaultIdx),GI.gMsgCet.event("pf.presentAd",{adType:"videoAd",adId:GI.gCfg.videoAdIDs[null!=this.videoAdIdx?this.videoAdIdx:GI.gCfg.videoAdIdxSetting.defaultIdx],adBehavior:"show",sourceType:this.videoSourceType}),GI.soundMgr.setSoundMuted(this,!0),this.VideoAdShowEvt&&this.VideoAdShowEvt(),this.videoAd.show()}onVideoAdClose(t,e){GI.soundMgr.setSoundMuted(this,!1);let i=this._videoAdCloseFunc;this._videoAdCloseFunc=null,e?e.type="videoAd":e={type:"videoAd"},i&&i(t,e),t?(this.videoData&&GI.gMsgCet.event("Wm.onAdsPlayRet",{adsId:this.videoData.adsId,playRet:0,adType:2,adIdx:this.videoData.adIdx}),GI.log("激励视频广告完成，发放奖励"),GI.gMsgCet.event("CMEVT_ON_VIDEO_SUC"),$t.i.data.addVipExp()):(GI.log("激励视频广告取消关闭，不发放奖励"),this.videoData&&GI.gMsgCet.event("Wm.onAdsPlayRet",{adsId:this.videoData.adsId,playRet:1,adType:2,adIdx:this.videoData.adIdx}),GI.gMsgCet.event("CMEVT_ON_VIDEO_CLOSE",{suc:t,res:e}),$t.i.popShareHintView({doneFunc:i}))}get nativeAdNum(){return this.getToday!=this._nativeAdDay&&(this.nativeAdNum=0),this._nativeAdNum}set nativeAdNum(t){this._nativeAdNum=t,this._nativeAdDay=this.getToday}get getToday(){return this.getDay(GI.timerMgr.currTimer)}getDay(t){return Math.floor(t/864e5)}initNativeAd(){GI.gCfg.nativeAds&&(this.nativeAds=GI.gCfg.nativeAds,this.nativeAdDatas={},this.tryCreateNativeAd())}tryCreateNativeAd(){if(this.nativeAds)for(const t in this.nativeAds){if(!this.nativeAds.hasOwnProperty(t))continue;const e=this.nativeAds[t];if(e.ids)for(const t of e.ids){let e=this.nativeAdDatas[t.id];if(!e)return e={id:t.id},this.nativeAdDatas[t.id]=e,this.createNativeAd(e),void e.ad.load()}}}createNativeAd(t){!t.ad&&this.doCreateNativeAd&&this.doCreateNativeAd(t)}onNativeAdLoaded(t,e){GI.gMsgCet.event("Wm.onAdsButtonClick",{adsId:GI.gCfg.insertAdID,adType:1}),GI.log("原生广告加载完成:"+t.id,e,e.adList,e.adList.length),t.adList=e.adList;let i=[];for(const e of t.adList)for(const t of e.imgUrlList)i.push(t);GI.resMgr.load(i,GI.handle(this,()=>{t.allLoaded=!0})),GI.timerMgr.once(GI.gCfg.nativeAdCreateDelay,this,this.tryCreateNativeAd)}onNativeAdError(t,e){GI.gMsgCet.event("Wm.onAdsPlayRet",{adsId:GI.gCfg.insertAdID,playRet:-1,adType:1}),GI.log("原生广告加载失败:"+t.id,t,e),GI.timerMgr.once(GI.gCfg.nativeAdErrorTime,this,()=>{t.ad.load()})}showNativeAd(t){if(!this.nativeAds||!t||!t.adType)return null;GI.gMsgCet.event("Wm.onAdsPlayRet",{adsId:GI.gCfg.insertAdID,playRet:0,adType:1});let e=this.nativeAds[t.adType]||this.nativeAds.default;if(!e||!e.ids||e.numLimit&&this.nativeAdNum>=GI.gCfg.nativeAdMaxNum)return null;let i=0;for(const t of e.ids){let e=this.nativeAdDatas[t.id];e&&e.allLoaded&&(i+=t.wv,t.tv=i)}let s=Math.random()*i;for(const i of e.ids){let a=this.nativeAdDatas[i.id];if(a&&a.allLoaded&&!(s>a.tv))return a.args=t,e.numLimit&&this.nativeAdNum++,a}return null}hideNativeAd(t){t&&t.adData&&(t.adData.args=null)}reportAdShow(t){t&&t.adData&&t.adData.ad&&t.adInfo&&t.adData.ad.reportAdShow({adId:t.adInfo.adId.toString()})}reportAdClick(t){t&&t.adData&&t.adData.ad&&t.adInfo&&t.adData.ad.reportAdClick({adId:t.adInfo.adId.toString()})}initBlockAd(){this.doInitBlockAd&&this.doInitBlockAd()}onBlockAdLoad(t){GI.log("block ad loaded: ",t)}onBlockAdError(t){GI.log("block ad error: ",t),t&&1009==t.errCode&&this.adjustBlockAdPos&&this.adjustBlockAdPos()}showBlockAd(t){}hideBlockAd(t){}initRank(){this.openRank&&(GI.uiViewMgr.registerView("RankView",Vi),this.rankUiAtlas="res/1stAsset/rank.atlas",this.rankUiPng="res/1stAsset/rank.png",this.checkLocalFiles(),this._odc=this._adp&&this._adp.getOpenDataContext&&this._adp.getOpenDataContext(),GI.prgMgr.addPre(this.rankUiAtlas).addPre(this.rankUiPng),this.checkSendRankData(),GI.gMsgCet.on("Wm.finishedLvl",this,this.checkSendRankData.bind(this)),this.postOdcMsg("initRankInfo",{pros:{_key:"finishedLvl",_pfName:this.pfName,_os:this.sysInfo&&this.sysInfo.system,_resVer:{[this.rankUiPng]:Laya.ResourceVersion.manifest&&Laya.ResourceVersion.manifest[this.rankUiPng]},_openID:this.openid}}))}afterInitRank(){this.openRank&&this._layaAdp&&this._layaAdp.sendAtlasToOpenDataContext(this.rankUiAtlas)}get openRank(){return GI.gCfg.openRank}checkLocalFiles(){let t={[this.rankUiAtlas]:!0,[this.rankUiPng]:!0};Object.defineProperties(Laya.URL,{formatURL:{value:function(e){if(!e)return"null path";if(e.indexOf(":")>0)return e;if(null!=Laya.URL.customFormat&&(e=Laya.URL.customFormat(e)),e.indexOf(":")>0)return e;if(t[e])return e;var i=e.charAt(0);if("."===i)return Laya.URL._formatRelativePath(Laya.URL._basePath+e);if("~"===i)return Laya.URL.rootPath+e.substring(1);if("d"===i){if(0===e.indexOf("data:image"))return e}else if("/"===i)return e;return Laya.URL._basePath+e}}})}checkSendRankData(){let t=this.openRank&&this.rankData;t&&this.sendRankData(t)}get rankData(){return{KVDataList:this.rankKvData,success:this.sendRankDataSuc.bind(this),fail:this.sendRankDataFail.bind(this),complete:this.sendRankDataEnd.bind(this)}}get rankKvData(){return this.getRankKvData(this.pfName)}getRankKvData(t){return[{key:"finishedLvl",value:$t.i.data.finishedLvl.toString()}]}sendRankData(t){this._adp&&this._adp.setUserCloudStorage&&this._adp.setUserCloudStorage(t)}sendRankDataSuc(){GI.log("sendRandDataSuc")}sendRankDataFail(t){GI.log("sendRandDataFail:",t)}sendRankDataEnd(){GI.log("sendRandDataEnd")}postOdcMsg(t,e){t&&this._odc&&this._odc.postMessage({msg:t,argsType:e&&Object.is(e)&&"object",args:e&&Object.is(e)?JSON.stringify(e):e})}initCustomAd(){GI.gCfg.customAdID&&this.doInitCustomAd&&this.doInitCustomAd()}showCustomAd(t){}hideCustomAd(t){}initAddToFavorites(){this.initAddToFavoritesFunc&&this.initAddToFavoritesFunc()}}class Ui{showTurntableView(t){if(!GI.gCfg.timeLimitCfgs||!GI.gCfg.timeLimitCfgs.turntable_limit)return!1;return GI.gCfg.timeLimitCfgs.turntable_free&&!$t.i.data.isTimeLimitNextStage("turntable_free")?(GI.uiViewMgr.showView("TurntableView",{stage:"free"}),this.showStasView(t),!0):($t.i.data.isTimeLimitNextStage("turntable_limit")?"showFeatherReward"==GI.gCfg.timeLimitCfgs.turntable_limit.nextStage&&GI.gCfg.timeLimitCfgs.showFeatherReward&&!$t.i.data.isTimeLimitNextStage("showFeatherReward")&&(GI.uiViewMgr.showView("FeatherReceiveView"),this.showStasView(t)):(GI.uiViewMgr.showView("TurntableView"),this.showStasView(t)),!0)}showStasView(t){GI.gCfg.showSettleStatsView&&GI.uiViewMgr.showView("SettleStatisticView")}}class Oi extends Ui{constructor(){super(),this.dataLists=[]}preInit(){GI.gMsgCet.on("pf.shareGame",this,this.onShareGameSuccess),GI.gMsgCet.on(["btn_show_gridAd"],this,this.showGridAd),GI.gMsgCet.on(["close_show_gridAd"],this,this.closeGridAd),GI.gMsgCet.on(["btn_get_blast","btn_chapter_reward","btn_challenge_reward","btn_restart_game","btn_signin_reward","btn_feather_reward","btn_turntable_reward"],this,this.showVideoAd),GI.gMsgCet.on("btn_share_game",this,this.shareGame),GI.gMsgCet.on("btn_unlock_lvl",this,this.handleUnlockLvl),GI.gMsgCet.onFatch("start_lvl_show_view",this,this.startLvlShowView),GI.gMsgCet.onFatch("show_turntable_view",this,this.showTurntableView),this.needShowHt&&(this.getCPAHtData(),GI.gMsgCet.on("pf.getHtNativeGames",this,(t={htId:1})=>{!t||null==t.htId||t.htId<1||t.htId>this.dataLists.length?GI.log("QQCtrl getHtNativeGames para err",t,this.dataList):(GI.gCfg.htNativeGames=this.dataLists[t.htId-1],this.onHtGame("pf.onHtNativeGames"))}),GI.gMsgCet.on("pf.goHtNativeGame",this,t=>{this.needShowHt?this.goHtGame(t):GI.gInfoMgr.showInfo(7)})),GI.gMsgCet.onFatch("ab.unlock_view_icon",this,this.getUnlockViewPage),GI.gMsgCet.onFatch("turntable_has_timelimit",this,()=>!0)}getCPAHtData(){var t=GI.gCfg.htUrl+"?v="+Math.floor(Date.now()/3e4);GI.netMgr.getJson(t,GI.handle(this,t=>{if(t&&t.data&&t.data.turnlist){GI.log("qq.onHtGame===",t.data);for(const n in t.data.turnlist){var e=[],i=t.data.turnlist[n];for(const h in i){var s=this.getImageUrlByID(t.data,i[h].image_id),a=i[h].name,r=this.getHtAppData(t.data,i[h].white_id);if(s&&a&&r.app_id&&r.path){var o={iconUrl:s,txt:a,appID:r.app_id,path:r.path,imageId:i[h].image_id,htPosId:n};e.push(o)}}this.dataLists.push({dataList:e})}this.dataLists.length<1||(GI.gCfg.htNativeGames=this.dataLists[0],this.onHtGame("pf.onHtNativeGames"),this.preLoadRes(t.data))}}))}preLoadRes(t){if(!t||!t.imghead||!t.imageList)return;let e=[];for(const i in t.imageList)e.push(t.imghead+t.imageList[i]);GI.resMgr.load(e),GI.log("qq.ht.preload:",e)}onHtGame(t){GI.gMsgCet.event(t,GI.gCfg.htNativeGames)}getImageUrlByID(t,e){if(!t||!t.imghead||!t.imageList)return null;for(const i in t.imageList)if(i==e)return t.imghead+t.imageList[i];return null}getHtAppData(t,e){if(!t||!t.whiteList)return null;for(const i in t.whiteList)if(i==e)return t.whiteList[i];return null}goHtGame(t){let e=t&&t.htData;e&&qq.navigateToMiniProgram({appId:e.appID,path:e.path,success:()=>{GI.log("qq.navigateToMiniProgram.suc:",e),GI.gMsgCet.event("pf.afterGoHtGame",{appId:e.appID,isSuc:1,htPosId:e.htPosId,htIconId:e.imageId})},fail:t=>{GI.log("qq.navigateToMiniProgram.fail:",e,t),GI.gMsgCet.event("pf.afterGoHtGame",{appId:e.appID,isSuc:0,htPosId:e.htPosId,htIconId:e.imageId})}})}get needShowHt(){return qq&&GI.gCfg.htUrl}onGameShow(){this.clickShareGame&&(this.afterGameShow=!0,this.clickShareGame=!1),this.handleShare()}onGameHide(){}handleShare(){if(GI.gCfg.shareCfgs&&this.hideFromShare&&this.afterGameShow){this.hideFromShare=this.afterGameShow=!1;let t=(new Date).getTime()-this.beginShareTime>GI.gCfg.shareSucDuration;this.afterShare&&this.afterShare(t,null),!t&&GI.timerMgr.once(500,this,this.showShareFailHint)}}showShareFailHint(){GI.timerMgr.clear(this,this.showShareFailHint),GI.gCfg.shareGameFailHint?GI.gInfoMgr.showInfoCont(1,GI.gCfg.shareGameFailHint):GI.gInfoMgr.showInfo(8)}onShareGameSuccess(){GI.gCfg.timeLimitCfgs.share_game_reward&&!$t.i.data.isTimeLimitNextStage("share_game_reward")&&($t.i.data.changeMoney({useOrGain:1,gemNum:GI.gCfg.shareGameRewardCount,gemtype:$t.i.data.commercialCfg.moneyEvtEnum.ad_share_game,gemdetails:""}),GI.gMsgCet.event("AB.SoundEvent",{eventType:7}),$t.i.popObtainView({name:GI.gCfg.shareGameRewardName,quantity:GI.gCfg.shareGameRewardCount,iconName:GI.gCfg.shareGameRewardIcon}),$t.i.data.costTimeLimit("share_game_reward"))}shareGame(t){this.clickShareGame=!0,this.beginShareTime=(new Date).getTime(),t&&t.doneFunc?this.afterShare=t.doneFunc:this.afterShare=null,GI.pf.shareGame({success:()=>{this.hideFromShare=!0,this.handleShare()},fail:()=>{GI.log("share game fail !!!"),this.showShareFailHint()}})}showVideoAd(t){GI.pf.showVideoAd(t)}showGridAd(t){GI.pf.showGridAd({closeFunc:t&&t.doneFunc})}closeGridAd(t){GI.pf.doHideGridAd({closeFunc:t&&t.doneFunc})}handleUnlockLvl(t){$t.i.data.money<t.unlockItem.cost?GI.uiViewMgr.showView("AbRewardView",{reward_id:1}):t&&t.doneFunc&&t.doneFunc(t.unlockItem)}getUnlockViewPage(t){return"none"}startLvlShowView(){return $t.i.data.isTimeLimitNextStage("start_prop_reward")?(GI.gMsgCet.event("show_prop_pointer"),GI.gMsgCet.event("ab.moveToBird"),!0):(GI.uiViewMgr.showView("PropRewardView"),!0)}showPropRewardView(){GI.timerMgr.clear(this,this.showPropRewardView),GI.uiViewMgr.showView("PropRewardView")}}window.qq&&Ei.initPf(class extends Ei{constructor(){super(),this.flag="qq",this._adp=qq,this._layaAdp=Laya.QQMiniAdapter,this.pixelRatio=1}get openid(){return this._openid||(this._openid=GI.localDataMgr.getItem("QQ.openid")),"-1"==this._openid?null:this._openid}set openid(t){this._openid!=t&&(this._openid=t,GI.localDataMgr.setItem("QQ.openid",this._openid))}onGameStart(){super.onGameStart(),GI.moduleMgr.addModule(Oi)}preInit(){this.sysInfo=qq.getSystemInfoSync(),GI.log("getSysamtemInfoSync: ",this.sysInfo),this.ver=qq.getSystemInfoSync().SDKVersion,GI.log("qq基础库版本：",this.ver),this.compareVersion(this.ver,"1.15.0")<0&&(GI.log("qq SDK version less than 1.15.0 ====> cannot init blockAd"),qq.showModal({title:"提示",content:"当前qq版本过低，可能会无法显示积木广告。"})),!this.isIOS()&&this.compareVersion(this.sysInfo.version,"8.3.9")<0&&(this.pixelRatio=this.sysInfo.pixelRatio),this.parseAppCfg(),super.preInit(),qq.onShow(this.onShow.bind(this)),qq.onHide(this.onHide.bind(this))}parseAppCfg(){GI.gCfg.osCfgs&&GI.gCfg.bindPros(GI.gCfg.osCfgs[this.sysInfo.platform]),GI.gCfg.appCfgs&&GI.gCfg.bindPros(GI.gCfg.appCfgs[this.sysInfo.appName]),GI.gCfg.osAppCfgs&&GI.gCfg.bindPros(GI.gCfg.osAppCfgs[this.sysInfo.appName]),GI.gCfg.ptnSwitchCfg&&GI.gCfg.ptnSwitchCfg[GI.gCfg.ptnSwitch]&&GI.gCfg.bindPros(GI.gCfg.ptnSwitchCfg[GI.gCfg.ptnSwitch])}doLogin(t){this._endFunc=t,this.qqlogin()}qqlogin(){qq.checkSession({success:()=>{GI.log("===checkSession doSuccess==="),this.openid?this.doLoginComplete():this.reLogin()},fail:()=>{GI.log("===checkSession doFail==="),this.openid="-1",this.reLogin()}})}doLoginComplete(){this.initShare(),GI.log("open id: ",this.openid),this.openid&&(GI.gMsgCet.event("pf.qqReportRegaccount"),this.subscribeAppMsg()),this._endFunc&&this._endFunc()}reLogin(){qq.login({success:t=>{t.code?(this.code=t.code,GI.log("===登录成功！code=",this.code)):GI.log("登录失败！",t)},fail:t=>{GI.log("qq.login get code,error:",t)},complete:t=>{GI.log("qq.login get code,complete:",t),this.doReLoginFinish()}})}doReLoginFinish(){this.code?this.doLoginHttpRequest():this.doLoginComplete()}doLoginHttpRequest(){if(!(this.code&&GI.gCfg.serverUrl&&GI.gCfg.appID&&GI.gCfg.appSecret))return GI.log("===doLoginHttpRequest miss info==="),void this.doLoginComplete();GI.netMgr.postJson(GI.gCfg.serverUrl+"/account/getOpenId",GI.handle(null,t=>{GI.log("请求openid返回: ",t.data);let e=t.data&&t.data._d;e&&0==e.ResCode?this.openid=e.data.openid:GI.log("请求openid失败"),this.doLoginComplete()}),"appid="+GI.gCfg.appID+"&secret="+GI.gCfg.appSecret+"&js_code="+this.code)}init(){super.init(),this.addRecentColorSign()}initShare(){GI.gCfg.shareCfgs&&this.doInitShare()}doInitShare(){qq.showShareMenu(),(this.onShareAppMessage||qq.onShareAppMessage)(this.getShareData.bind(this))}getShareData(){var t=GI.gCfg.shareCfgs[Math.floor(GI.gCfg.shareCfgs.length*Math.random())];return t.query="openid="+this.openid,GI.log("getShareData: ",t),t}get bannerAdID(){return GI.gCfg.bannerAdIDs}initVideoAd(){GI.gCfg.videoAdIDs&&this.doInitVideoAd&&this.doInitVideoAd()}doInitBanner(t){this.nowBanerAdIdx=GI.gCfg.bannerAdIdxSetting.defaultIdx,this.bannerInitArgs=t,this.createBannerAdSelf()}createBannerAdSelf(){!GI.gCfg.bannerAdIDs||GI.gCfg.bannerAdIDs.length<=0||(this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null),this.bannerAd=qq.createBannerAd({adUnitId:GI.gCfg.bannerAdIDs[this.nowBanerAdIdx],style:this.getBannerStyle(this.bannerInitArgs)}),this.bannerAd.onLoad(this.onBannerSuc.bind(this)),this.bannerAd.onError(this.onBannerError.bind(this)),this.bannerAd.onResize(t=>{GI.log("bannerAd.onResize:",t,this.bannerAd.style),this.bannerAd.style.top=Laya.Browser.clientHeight-t.height,this.bannerAd.style.left=(Laya.Browser.clientWidth-t.width)/2}),this.bannerAdIdx=this.nowBanerAdIdx)}setBannerAdShowSrc(t,e){this._bannerAdShowSrc.set(t,e),this.setBannerTimer(300)}switchBannerAd(){GI.log("===switchBannerAd=="),this.createBannerAdSelf(),GI.log("===bannerAdIdx=",this.bannerAdIdx)}getAdIdxByCfg(t){if(t&&t.different)for(var e=0;e<t.different.length;++e)if(GI.uiViewMgr.isViewNameShow(t.different[e].windowName))return t.different[e].adIdx;return t.defaultIdx}doInitInsertAd(t){qq.createInterstitialAd&&(this.insertAd=qq.createInterstitialAd({adUnitId:GI.gCfg.insertAdID}),this.insertAd.onLoad(()=>{GI.log("插屏视频广告加载成功")}),this.insertAd.onError(t=>{GI.log("insertAd onError",t),this.onInsertAdHide()}),this.insertAd.onClose(this.onInsertAdHide.bind(this)))}doShowInsertAd(t){this.exeShowInsertAd(t)}doInitVideoAd(){}createVideoAd(t){this.videoAdIdx&&this.videoAdIdx==t||(this.videoAd&&(this.videoAd.offError(),this.videoAd.offLoad(),this.videoAd.offClose()),this.videoAd=qq.createRewardedVideoAd({adUnitId:GI.gCfg.videoAdIDs[t]}),this.videoAd.onLoad(()=>{GI.log("复活激励视频 广告加载成功")}),this.videoAd.onError(this.onVideoAdError.bind(this)),this.videoAd.onClose(t=>{this.onVideoAdClose(t.isEnded,t)}),this.videoAdIdx=t,GI.log("===videoAdIdx=",this.videoAdIdx))}showVideoAd(t){var e=GI.gCfg.videoAdIdxSetting.defaultIdx;t&&null!=t.adIdx&&(e=t.adIdx),this._videoAdIdx!=e&&this.createVideoAd(e),super.showVideoAd(t)}exeLoadVideoAd(t){super.exeLoadVideoAd(t).then(this.onVideoAdLoadSuc.bind(this)).catch(t=>{GI.log("激励视频加载失败:",t)})}getLaunchOptionsSync(){return qq.getLaunchOptionsSync&&qq.getLaunchOptionsSync()}doInitBlockAd(){if(!GI.gCfg.blockAdID||!qq.createBlockAd)return;this._blockAdShowSrc=new Map,this._blockAdForbidSrc=new Map,GI.gMsgCet.on("pf.isInsertAdShow",this,()=>{this.setBlockAdForbidSrc("InsertAd",this.isInsertAdShow)});let t=GI.gCfg.blockAdCons&&GI.gCfg.blockAdCons[GI.gCfg.blockAdType];if(t&&t.views)for(const e in t.views){if(!t.views.hasOwnProperty(e))continue;const i=t.views[e];GI.gMsgCet.on("cm.view."+e,this,t=>{t&&(i?this.setBlockAdShowSrc("vSrc_"+e,t.val&&i):this.setBlockAdForbidSrc("vSrc_"+e,t.val))})}}setBlockAdShowSrc(t,e){this._blockAdShowSrc.set(t,e),this.clearBlockAdTimmer(),GI.timerMgr.once(50,this,this.checkBlockAd)}setBlockAdForbidSrc(t,e){this._blockAdForbidSrc.set(t,e),this.clearBlockAdTimmer(),GI.timerMgr.once(50,this,this.checkBlockAd)}checkBlockAd(){this.clearBlockAdTimmer(),!Map.has1(this._blockAdForbidSrc)&&this.hasBlockSrc({source:""})?GI.gMsgCet.event("show_block_ad"):this.hideBlockAd()}clearBlockAdTimmer(){GI.timerMgr.clear(this,this.checkBlockAd)}hasBlockSrc(t){if(!this._blockAdShowSrc.values())return!1;let e=null;for(let i of this._blockAdShowSrc){let s=i[1];s&&(!e||(Object.is(s)&&s.priority||0)>(Object.is(e)&&e.priority||0))&&(e=s,t&&(t.source=i[0]))}return e}showBlockAd(t){if(!GI.gCfg.blockAdID||!qq.createBlockAd)return;this.hideBlockAd();let e=GI.gCfg.viewsBlockAdStyles[t.sourceType];if(e)if(this.blockAds||(this.blockAds=[]),e instanceof Array)for(let t of e)this.blockAds.push(this.createOneBlockAd(GI.gCfg.blockAdStyles[t]));else this.blockAds.push(this.createOneBlockAd(GI.gCfg.blockAdStyles[e]))}createOneBlockAd(t){if(!GI.gCfg.blockAdID||!qq.createBlockAd)return;this.blockAds||(this.blockAds=[]);let e={x:t.x*this.sysInfo.screenWidth*this.pixelRatio,y:t.y*this.sysInfo.screenHeight*this.pixelRatio},i=e.x,s=e.y;t.right&&(i-=2*GI.gCfg.iosBlockAdSize.width),t.bottom&&(s-=2*GI.gCfg.iosBlockAdSize.height);let a=qq.createBlockAd({adUnitId:GI.gCfg.blockAdID,size:t.size||GI.gCfg.blockAdCount,orientation:t.orientation||"landscape",style:{left:i,top:s}});return a?(a.owner=this,a.onLoad(this.onBlockAdLoad.bind(a)),a.onError(this.onBlockAdError.bind(this)),a.alreadyAdjustBlockAd=!1,a):null}hideBlockAd(t){if(GI.gCfg.blockAdID&&qq.createBlockAd&&this.blockAds&&this.blockAds.length>0){for(let t=0;t<this.blockAds.length;++t)this.blockAds[t]&&(this.blockAds[t].owner=null,this.blockAds[t].destroy(),this.blockAds[t]=null);this.blockAds.length=0}}onBlockAdLoad(t){super.onBlockAdLoad(t),this.owner&&this.owner.blockAds&&this.owner.blockAds.lastIndexOf(this)>-1?this&&this.show&&this.show():this&&this.destroy&&this.destroy()}onBlockAdResize(t){console.log("resize block ad: ",t)}shareGame(t){let e=this.getShareData();qq.shareAppMessage({title:e.title,imageUrl:e.imageUrl,success:t&&t.success,fail:t&&t.fail})}getAuthorize(t){qq.getSetting({success(e){GI.log("获取用户设置: ",t.scope,e.authSetting[t.scope]),e.authSetting[t.scope]?t.callback&&t.callback(1):qq.authorize({scope:t.scope,success:()=>{t.callback&&t.callback(1)},fail:()=>{t.callback&&t.callback(0)}})},fail(t){GI.log("获取用户设置 fail: ",t)}})}addRecentColorSign(t){this.getAuthorize({scope:"scope.recentColorSign",callback:t=>{GI.log("获取彩页授权返回： ",t),t&&qq.addRecentColorSign({query:"",success(t){GI.log("添加彩签 success: ",t)},fail(t){GI.log("添加彩签 fail: ",t)},complete(t){GI.log("添加彩签 complete: ",t)}})}})}subscribeAppMsg(t){qq.subscribeAppMsg({tmplIds:GI.gCfg.sbscrTmpl,subscribe:!0,success:t=>{GI.log("一次性订阅 success: ",t,this.openid),this.openid&&GI.netMgr.postJson(GI.gCfg.serverUrl+"/subscribe/subscribe",GI.handle(null,t=>{let e=t.data&&t.data._d;GI.log("通知服务器订阅完成：",e&&e.ResCode)}),"openid="+this.openid+"&tmplIds="+JSON.stringify(GI.gCfg.sbscrTmpl))},fail:t=>{GI.log("一次性订阅 fail: ",t)}})}compareVersion(t,e){t=t.split("."),e=e.split(".");const i=Math.max(t.length,e.length);for(;t.length<i;)t.push("0");for(;e.length<i;)e.push("0");for(let s=0;s<i;s++){const i=parseInt(t[s]),a=parseInt(e[s]);if(i>a)return 1;if(i<a)return-1}return 0}isIOS(){return this.sysInfo&&this.sysInfo.system?-1!=this.sysInfo.system.toString().indexOf("iOS"):null}});class Ni{BeginContact(t){var e=t.GetFixtureA().collider,i=t.GetFixtureB().collider;e.owner,i.owner;Laya.Physics.I._eventList.push(0,t),Laya.Physics.I._eventList.push(5,t)}EndContact(t){var e=t.GetFixtureA().collider,i=t.GetFixtureB().collider;e.owner,i.owner;Laya.Physics.I._eventList.push(1,t),t.IsTouching()?Laya.Physics.I._eventList.push(2,t):Laya.Physics.I._eventList.push(3,t)}BeginContactFixtureParticle(t,e){}EndContactFixtureParticle(t,e){}BeginContactParticleParticle(t,e){}EndContactParticleParticle(t,e){}PreSolve(t,e){}PostSolve(t,e){var i=t.GetFixtureA().collider,s=t.GetFixtureB().collider,a=i.owner,r=s.owner;if(e.normalImpulses[0]>1||e.normalImpulses[1]>1){if(a){var o=[s,i,t,e];a.event("Rigid.PostSolve",o)}if(r){o=[i,s,t,e];r.event("Rigid.PostSolve",o)}}}}window.Laya3D?Laya3D.init(ie.width,ie.height):Laya.init(ie.width,ie.height,Laya.WebGL),null!=Laya.Physics&&(Laya.Physics.enable({gravity:9}),Laya.Physics.I.world.SetContactListener(new Ni)),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=ie.scaleMode,Laya.stage.screenMode=ie.screenMode,Laya.stage.alignV=ie.alignV,Laya.stage.alignH=ie.alignH,Laya.stage.bgColor="#333333",Laya.URL.exportSceneToJson=ie.exportSceneToJson,(ie.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),Laya.alertGlobalError=!0,GI.instMgrs(),GI.isDebug&&Laya.Stat.show(),GI.timerMgr.autoResumeOnGameHide=!0;let Fi=Laya.stage.addChild(new class extends ni.res.scene.LogoScUI{onEnable(){super.onEnable(),this.onResize(),Laya.stage.on(Laya.Event.RESIZE,this,this.onResize)}setMsg(t){this.lblMsg.text=t}onResize(){this.pos(GI.gw()/2,GI.gh()/2)}});GI.resMgr.load("1stAsset/localCfg.json",GI.handle(null,t=>{GI.gCfg=t||{},GI.moduleMgr.onGameStart(),GI.pf.webBasePath&&(Laya.URL.basePath=GI.pf.webBasePath),Laya.ResourceVersion.enable(GI.pf.verPath||"version.json",GI.handle(null,()=>{let t=!1;function checkGameReady(){function initFGUI(){GI.log("posStr==="+GI.gCfg.posStr),GI.uiViewMgr.initFGUI(["sceneui","base","normal","pop","tip","info"],"normal","sceneui",GI.handle(null,()=>{GI.pf.login(()=>{oi.init(),Fi&&(Fi.destroy(!0),Fi=null)})}))}t&&GI.gCfg&&GI.gCfg.bindPros&&(GI.moduleMgr.onGameReady(),GI.gCfg.reqIp?GI.netMgr.getTxt(GI.gCfg.reqIp,GI.handle(null,t=>{GI.gCfg.posStr=t.resText,initFGUI()})):initFGUI(),fgui.UIConfig.buttonSound="res/sound/click_button.mp3")}Laya.AtlasInfoManager.enable("fileconfig.json",GI.handle(null,()=>{t=!0,checkGameReady()})),GI.resMgr.load("res/g.cfg.json",GI.handle(null,t=>{if(!t)return GI.log("net error!!!"),void Fi.setMsg("网络错误，请重新加载！");GI.gCfg.bindPros=function(t){return GI.util.bindPros(GI.gCfg,t)},GI.gCfg.bindPros(t),GI.gCfg.bindPros(GI.gCfg[GI.isDebug?"debug":"release"]),checkGameReady()}))}),Laya.ResourceVersion.FILENAME_VERSION)}))}();