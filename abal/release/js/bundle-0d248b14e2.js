!function(){"use strict";String.prototype.format=function(t){if(!t)return this;var i=this;if(t instanceof Array)for(var e=0;e<t.length;e++)null!=t[e]&&(i=i.replace(new RegExp("({)"+e+"(})","g"),t[e]));else if(Object.is(t))for(var s in t)null!=t[s]&&(i=i.replace(new RegExp("({"+s+"})","g"),t[s]));return i},String.is=function(t){return"string"==typeof t},Function.is=function(t){return"function"==typeof t},Object.is=function(t){return"object"==typeof t};var t={};class i{registerView(i,e,s){s||(s={}),s.mgr=this,t.uiViewMgr.registerView(i,e,s)}}t.Module=i;class e{constructor(){this.modules=[],this.moduleTbl=new Map}preInit(){t.gMsgCet.on("CMEVT_ON_SHOW",this,t=>{this.doModulesFun("onGameShow",t)}),t.gMsgCet.on("CMEVT_ON_HIDE",this,t=>{this.doModulesFun("onGameHide",t)})}addModule(t){let i=new t;return t.i=i,this.addModuleObj(t,i)}addModuleObj(t,i){return this.modules.push(i),this.addModuleToTbl(t,i),i}addModuleToTbl(t,i){this.moduleTbl.set(t,i)}getModule(t){return this.getModleFromTbl(t)}getModleFromTbl(t){return this.moduleTbl.get(t)}doModulesFun(t,i){for(let e=0;e<this.modules.length;e++){let s=this.modules[e];s&&s[t]&&s[t](i)}}onGameStart(){this.doModulesFun("onGameStart")}onGameReady(){this.doModulesFun("onGameReady")}doModulesPreInit(){this.doModulesFun("preInit")}doModulesInit(){this.doModulesFun("init")}doModulesLateInit(){this.doModulesFun("lateInit")}}t.ModuleMgr=e;class s extends i{bindPros(t,i){if(!t||!i)return t;for(let e in i)t[e]=i[e];return t}}t.Util=s;class r extends Laya.EventDispatcher{constructor(){super(),this.fatchData=new Map}onFatch(i,e,s){i&&e&&s?this.fatchData.set(i,{caller:e,listener:s}):t.error("onFatch error")}offFatch(i,e,s){i?this.fatchData.delete(i):t.error("offFatch error")}fetch(t,i){if(!t)return null;let e=this.fatchData.get(t);if(!e)return null;let s=e.caller;return e.listener.call(s,i)}}t.GMsgCenter=r;class a extends Laya.HttpRequest{setEndFunc(t){this._endHandler=t}send(t,i,e,s,r){this._endHandler&&(this.once(Laya.Event.COMPLETE,this,this.completeHandler),this.once(Laya.Event.ERROR,this,this.errorHandler),this.on(Laya.Event.PROGRESS,this,this.processHandler)),super.send(t,i,e||"get",s||"text",r)}processHandler(t){}errorHandler(t){this.onReqEnd()}completeHandler(t){this.onReqEnd()}onReqEnd(){this._endHandler&&this._endHandler.runWith(this)}get resText(){return this.http?this.http.responseText:null}}t.HttpReq=a;class o extends i{constructor(){super(),this.MethodEnum={get:"get",post:"post",put:"put",delete:"delete"},this.ResponseTypeEnum={text:"text",document:"document",json:"json",blob:"blob",arrayBuffer:"arrayBuffer"}}getTxt(t,i,e,s){return this.doHttpReq(t,i,e,this.MethodEnum.get,this.ResponseTypeEnum.text,s)}getJson(t,i,e,s){return this.doHttpReq(t,i,e,this.MethodEnum.get,this.ResponseTypeEnum.json,s)}postTxt(t,i,e,s){return this.doHttpReq(t,i,e,this.MethodEnum.post,this.ResponseTypeEnum.text,s)}doHttpReq(i,e,s,r,o,h){t.log("http请求,类型:"+r+",url:"+i);let n=new a;return n.setEndFunc(e),n.send(i,s,r||"get",o||"text",h),n}}t.NetMgr=o;class h extends i{parseCfgData(i,e){if(!i)return null;String.is(i)&&(i=t.resMgr.getRes(i));let s=e&&e.ctrl||new n;return s.setData(i),s}}t.CfgMgr=h;class n{constructor(){this._keyName="id",this._cfgList=null,this._cfgTbl=null}get cfgCount(){return this._cfgList?this._cfgList.length:0}get cfgList(){return this._cfgList}get cfgTbl(){return this._cfgTbl}addCfgToList(t){t&&(t.cfgIndex=this._cfgList.length,this._cfgList.push(t),this._cfgTbl[t[this._keyName]]=t)}setData(t){t instanceof Array?this.setCfgList(t):this.setCfgTbl(t)}setCfgList(t){if(this._cfgList=t,this._cfgTbl={},this._cfgList)for(let t=0;t<this.cfgCount;t++){let i=this.getCfgByIndex(t);i&&(i.cfgIndex=t,this._cfgTbl[i[this._keyName]]=i,i.ctrl=this)}}setCfgTbl(t){if(this._cfgTbl=t,this._cfgList=[],this._cfgTbl)for(const t in this._cfgTbl){const i=this._cfgTbl[t];i&&(i.cfgIndex=this._cfgList.length,this._cfgList.push(i),i.ctrl=this)}}getCfgByIndex(t){return this._cfgList[t]}getCfg(t){return this._cfgTbl[t]}getIndexByID(t){let i=this.getCfg(t);return i&&i.cfgIndex>=0?i.cfgIndex:-1}every(t,i){if(t)for(let e=0;e<this.cfgCount;e++){let s=this.getCfgByIndex(e);s&&(String.is(t)?s[t]&&s[t](s,e,i):t(s,e,i))}}}t.CfgCtrl=n;class l extends i{constructor(){super(),this.gInfoViewID="HintView"}doShowInfo(i,e){i&&i.content&&t.uiViewMgr.showView(this.gInfoViewID,{infoCfg:i,args:e,info:i.content.format(e)})}showInfo(i,e){this.doShowInfo(t.gCfg.hintConfig.cfgs[i],e)}showInfoCont(t,i,e){t&&i&&this.doShowInfo({infoType:t,content:i},e)}}t.GInfoMgr=l;class d{static parseCfgs(){}static addData(t,i){let e=new d;e.vpID=t,e.parentVpID=i,d.addCfgToList(e)}static addCfgToList(t){t&&(d.cfgs.push(t),d.cfgTbl[t.vpID]=t)}static getCfgByIndex(t){return d.cfgs[t]}static getCfg(t){return d.cfgTbl[t]}static getAddData(t){if(!t)return null;let i=d.getCfg(t);return i||((i=new d).vpID=t,d.addCfgToList(i)),i}addSubVpData(t){if(!d)return;!this._subVpDatas&&(this._subVpDatas=[]);let i=!1;for(let e of this._subVpDatas)if(e&&e.vpID==t.vpID){i=!0;break}!i&&this._subVpDatas.push(t)}}d.cfgs=[],d.cfgTbl={},d.cfgCount=0,t.VPData=d;class g{constructor(t){this._vpData=t,this._vpData&&(this._vpData.vp=this,this._vpData.pros&&(this.mgr=this._vpData.pros.mgr)),this.tryCreateView()}get viewID(){return this._vpData?this._vpData.vpID:null}get visible(){return!!this._vpData&&this._vpData.visible}set visible(t){this._vpData&&(this._vpData.visible=t)}tryCreateView(){this.preCreateView(),this.createView(),this.afterCreateView()}preCreateView(){}createView(){this.tryCreatePanel()}afterCreateView(){this.updatePanelLayer(),this.resetPos(),this.removeFromDisplay()}tryCreatePanel(){this.preCreatePanel(),this.createPanel(),this.afterCreatePanel()}preCreatePanel(){}createPanel(){}afterCreatePanel(){this.bindEvt()}updatePanelLayer(){}bringToTop(){this.panel&&this.panel.parent&&this.panel.parent.setChildIndex(this.panel,this.panel.parent.numChildren-1)}bringToBottom(){this.panel&&this.panel.parent&&this.panel.parent.setChildIndex(this.panel,0)}resetPos(){}globalToLocal(t,i){return(i||this.panel).displayObject.globalToLocal(t)}show(t,i){this.visible&&null==i||(this.visible||(this.visible=!0,this.addBaseNotify(),this.addNotify()),this.beforShow(i),this.showPanel(i),this.doShow(i),this.updateEvtFuncs(),this.afterShow(i),this.noticeMgrViewShow(),this.checkGuide())}beforShow(t){}doShow(t){}afterShow(t){}noticeMgrViewShow(){}isShow(t){return this.visible&&(!t||this.viewID==t)}getCurShowViewID(){return this.visible?this.viewID:null}hide(t,i){this.visible&&(this.visible&&(this.visible=!1,this.removeBaseNotify(),this.removeNotify()),this.checkStopGuide(),this.beforHide(i),this.hidePanel(i),this.doHide(i),this.afterHide(i),this.noticeMgrViewHide())}beforHide(t){}doHide(t){}afterHide(t){}noticeMgrViewHide(){}hideSelf(){t.uiViewMgr.hideView(this.viewID)}get panel(){return this._panel}setPanel(t){this._panel=t}createPanelUI(i){if(null==i||""==i)return null;let e=t.uiViewMgr.createUiObj(i).asCom;return this.setPanel(e),e}showPanel(t){this.doShowPanelDirectly()}addToDisplay(){this.panel.visible=!0,this.autoUpdatePanelDepth()}autoUpdatePanelDepth(){this.bringToTop()}startShowPanel(){this.stopShowHideTween(),this.addToDisplay()}afterShowPanel(){this.showHideTween=null}hidePanel(t){this.doHidePanelDirectly()}removeFromDisplay(){this.panel.visible=!1}startHidePanel(){this.stopShowHideTween()}afterHidePanel(){this.showHideTween=null,this.removeFromDisplay()}doShowPanelDirectly(){this.startShowPanel(),this.afterShowPanel()}doHidePanelDirectly(){this.startHidePanel(),this.afterHidePanel()}stopShowHideTween(){null!=this.showHideTween&&(this.showHideTween.clear(),this.showHideTween=null)}bindEvt(){this.bindGetUIEvt(),this.bindGuideCheck(),this.doBindEvt()}doBindEvt(){}unBind(){this._bEvtDatas=null}addBEvtData(t){t&&(this._bEvtDatas||(this._bEvtDatas=[]),this._bEvtDatas.push(t))}updateEvtFuncs(){if(this._bEvtDatas&&this.visible)for(const t of this._bEvtDatas)t.args&&t.func()}doBEvtDataExeFunc(t){if(!this._bEvtDatas)return;let i=this._bEvtDatas.length,e=null;for(let s=0;s<i;s++){let i=this._bEvtDatas[s];i.exeOnce&&(e||(e=[])).push(s),i.exeFunc&&i.exeFunc(i,t)}if(e)for(i=e.length-1;i>=0;i--)this._bEvtDatas.slice(e[i])}addBaseNotify(){this.doBEvtDataExeFunc("on")}addNotify(){}removeBaseNotify(){this.doBEvtDataExeFunc("off")}removeNotify(){}bindGEvt(t,i,e){if(t&&i)if(t instanceof Array)for(const s of t)this.bindGEvt(s,i,e);else this.addBEvtData({evt:t,func:i.bind(this),args:e,exeFunc:this.doGEvts.bind(this)})}doGEvts(i,e){t.gMsgCet[e](i.evt,this,i.func)}bindGFetch(t,i){if(t&&i)if(t instanceof Array)for(const e of t)this.bindGFetch(e,i);else this.addBEvtData({evt:t,func:i.bind(this),exeFunc:this.doGFetch.bind(this)})}doGFetch(i,e){t.gMsgCet[e+"Fatch"](i.evt,this,i.func)}bindUiEvt(t,i,e){if(t&&i&&e)if(t instanceof Array)for(const s of t)this.bindUiEvt(s,i,e);else String.is(t)&&(t=this.u(t)),this.addBEvtData({u:t,evt:i,func:e.bind(this),exeFunc:this.doUiEvts.bind(this)})}bindUiClick(t,i){this.bindUiEvt(t,Laya.Event.CLICK,i)}bindClickHide(t){this.bindUiClick(t,()=>{this.hideSelf()})}bindBtnScale(t,i=null){this.bindUiEvt(t,Laya.Event.MOUSE_DOWN,()=>{this.setBtnScale(i||t,.9)}),this.bindUiEvt(t,Laya.Event.MOUSE_UP,()=>{this.setBtnScale(i||t,1)})}setBtnScale(t,i){if(t)if(t instanceof Array)for(const e of t)this.setBtnScale(e,i);else t.setScale(i,i)}doUiEvts(t,i){t.u[i](t.evt,this,t.func)}tmOnce(t,i,e,s){this.doTimer("once",t,i,e,s)}tmLoop(t,i,e,s){this.doTimer("loop",t,i,e,s)}doTimer(i,e,s,r,a){t.timerMgr[i](e,this,s,r,a),this.addBEvtData({func:s,exeFunc:this.doTimerEvts.bind(this),exeOnce:!0})}doTimerEvts(i,e){t.timerMgr.clear(this,i.func)}bindGetUIEvt(){this.bindGFetch("GET_VIEW_UI_BY_NAME"+this.viewID,this.u)}u(t,i){return t?(i||this.panel).getChild(t):null}bindGuideCheck(){this.bindGEvt("CMEVT_GUIDE_STEP_STAET"+this.viewID,this.checkGuide)}checkGuide(){t.guideMgr&&t.guideMgr.onViewCheckEnd(this)}startGuide(i,e){i&&t.guideMgr.start(i)}checkStopGuide(){t.guideMgr&&t.guideMgr.checkGuideOnVPHide(this)}}t.UIVPBase=g;var u,c,p=t.UiLayerEnum={};t.UIViewBase=class extends g{constructor(t){super(t)}preCreateView(){super.preCreateView(),this._layer=t.uiViewMgr.defaultLayer,this.autoHideOnGHide=!0,this.autoShowOnGShow=!0}get layer(){return this._layer}set layer(t){this._layer=t,this.updatePanelLayer()}updatePanelLayer(){let i=t.uiViewMgr.getLayerContainer(this.layer);i!=this.panel.parent&&i.addChild(this.panel)}makeFullScreen(){this.onGResize(),t.gMsgCet.on("onGResize",this,this.onGResize)}onGResize(){this.panel.setSize(t.uiViewMgr.uw,t.uiViewMgr.uh)}noticeMgrViewShow(){this.visible&&t.uiViewMgr.onViewShow(this)}noticeMgrViewHide(){!this.visible&&t.uiViewMgr.onViewHide(this)}onMaskClick(){this.hideSelf()}doShowPanelZoom(){this.startShowPanel(),this.showHideTween=t.Tween.fromTo(this.panel,{alpha:.5,scaleX:.5,scaleY:.5},{alpha:1,scaleX:1,scaleY:1},.3,t.Ease.elasticInOut,t.handle(this,this.afterShowPanel))}doHidePanelZoom(){this.startHidePanel(),this.showHideTween=t.Tween.to(this.panel,{alpha:.5,scaleX:.5,scaleY:.5},.3,t.Ease.elasticInOut,t.handle(this,this.afterHidePanel))}};class m{constructor(){this._curUiPosYOnLH=0,this._defaultLayer=2,this._sceneuiLayer=0,this._sceneui=null,this._layerCons=[],this._uiOffY=0,this._uCenterX=0,this._uCenterY=0,this._uw=0,this._uh=0,this._gScale=1,this._viewOpens=[],this._maskViewIDs={},this._maskViewLayer={},this.viewOnGameShowEnd=!0}get defaultLayer(){return this._defaultLayer}get sceneuiLayer(){return this._sceneuiLayer}get sceneui(){return this._sceneui}initFGUI(t,i,e,s){t&&t.forEach((t,i)=>{p[t]=i,p[i]=t}),p.num=t&&t.length,this._defaultLayer=String.is(i)?p[i]:i,this._sceneuiLayer=String.is(e)?p[e]:e,fgui.UIPackage.loadPackage("res/UI/GameUI",s)}createUiObj(t){return fgui.UIPackage.createObject("GameUI",t)}getItemURL(t){return fgui.UIPackage.getItemURL("GameUI",t)}get curUiPosYOnLH(){return this._curUiPosYOnLH}get uiOffY(){return this._uiOffY}get uw(){return this._uw}get uh(){return this._uh}get gScale(){return this._gScale}preInit(){t.stage.addChild(fgui.GRoot.inst.displayObject);for(let t=0;t<p.num;t++){let i=this.createUiObj("BasePanel").asCom;i.name=p[t].toString(),i.opaque=!1,fgui.GRoot.inst.addChild(i),this._layerCons[t]=i,this._maskViewIDs[t]="maskView-"+p[t].toString(),this._maskViewLayer[this._maskViewIDs[t]]=t}this._sceneui=this.getLayerContainer(this.sceneuiLayer),this._sceneui.setPivot(0,0),this._sceneui.setXY(0,0),Laya.stage.on(Laya.Event.RESIZE,this,this.onResize),this.onResize()}onResize(){this._gScale=Math.min(Laya.Browser.clientWidth/Laya.stage.width,Laya.Browser.clientHeight/Laya.stage.height),this._uiOffY=t.gh()/t.gw()>17/9?100:0,this._uw=t.gw(),this._uh=t.gh()-this._uiOffY,this._uCenterX=this._uw/2,this._uCenterY=this._uiOffY+this._uh/2;for(const t of this._layerCons)t.x=this._uCenterX,t.y=this._uCenterY;t.gMsgCet.event("onGResize")}getLayerContainer(t){return this._layerCons[t]}getUIX(t){return t}getUIY(t){return t-this._uiOffY}getAddVpData(t){return d.getAddData(t)}getVpData(t){return d.getCfg(t)}registerView(i,e,s){if(!i)return t.error("UIViewMgr.registerView_error:empty_viewID"),null;if(!e)return t.error("UIViewMgr.registerView_error:empty_cls"),null;let r=this.getAddVpData(i);return r.cls=e,r.pros=s,r}registerSubPanel(i,e,s){let r=this.getVpData(s);if(!r)return t.error("UIViewMgr.registerSubPanel_error:empty_parentVpData"),null;let a=this.registerView(i,e);return!a||a.parentVpID?(t.error("UIViewMgr.registerSubPanel_error:parentVpID_not_empty"),null):(a.parentVpID=s,r.addSubVpData(a),a)}getView(t,i){return t&&this.getViewByVpData(this.getVpData(t),i)}getViewByVpData(i,e){if(!i)return t.error("UIViewMgr.getView_error:empty_vpData"),null;if(e&&!i.vp){if(!i.cls)return t.error("UIViewMgr.getView_error:empty_cls"),null;new i.cls(i)}return i.vp}showView(t,i){return this.doShowView(this.getView(t,!0),t,i)}showViewByVpData(t,i){return this.doShowView(this.getViewByVpData(t,!0),t.vpID,i)}isViewNameShow(t){return this.isViewVpDataShow(this.getVpData(t))}isViewVpDataShow(t){return this.isViewShow(this.getViewByVpData(t,!1))}isViewShow(t){return!(!t||!t.visible)}hideView(t,i){return this.doHideView(this.getView(t,!1),t,i)}hideViewByVpData(t,i){return this.doHideView(this.getViewByVpData(t,!1),t.vpID,i)}triggerView(t,i){let e=this.getView(t,!1);return null==e?this.showView(t,i):e.isShow(t)?this.doHideView(e,t,i):this.doShowView(e,t,i)}doShowView(t,i,e){return t&&t.show(i,e),t}doHideView(t,i,e){return t&&t.hide(i,e),t}onViewShow(t){if(null==t||!t.visible)return;this._viewOpens.indexOf(t)>=0||(this._viewOpens.push(t),this.checkMaskView())}onViewHide(t){if(null==t||t.visible)return;let i=this._viewOpens.indexOf(t);i<0||(this._viewOpens.splice(i,1),this.checkMaskView())}getViewUi(i){if(!i)return null;let e,s;if(Object.is(i))e=i.viewID,s=i.uiName;else if(String.is(i)){let t=i.split("|");e=t[0],s=t[1]}return e&&t.gMsgCet.fetch("GET_VIEW_UI_BY_NAME"+e,s)}get maskViewIDs(){return this._maskViewIDs}getMaskViewLayer(t){return this._maskViewLayer[t]}checkMaskView(){let t=null;for(let i=this._viewOpens.length-1;i>=0;i--){let e=this._viewOpens[i];if(e&&e.needMask){t=e;break}}this._curMaskView!=t&&(this._curMaskView&&this.hideMaskView(this._curMaskView.layer),this._curMaskView=t,this._curMaskView&&this.showMaskView(this._curMaskView.layer))}showMaskView(t){this.showView(this._maskViewIDs[t],!0)}hideMaskView(t){this.hideView(this._maskViewIDs[t])}onMaskClick(){this._curMaskView&&this._curMaskView.onMaskClick()}get curMaskview(){return this._curMaskView}onGameShow(){if(this._viewIDsOnGShow){for(let t of this._viewIDsOnGShow)this.showView(t,{onGameShow:!0});this._viewIDsOnGShow=null,this.viewOnGameShowEnd=!0,t.gMsgCet.event("CMEVT_VIEW_ON_SHOW_END")}}onGameHide(){this.viewOnGameShowEnd=!1,this._viewIDsOnGShow||(this._viewIDsOnGShow=[]);let t,i=[];for(let e of this._viewOpens)e&&(t=e.getCurShowViewID())&&(e.autoHideOnGHide&&i.push(t),e.autoShowOnGShow&&this._viewIDsOnGShow.push(t));for(t of i)this.hideView(t,{onGameHide:!0})}}t.UIViewMgr=m;t.Tween=class extends Laya.Tween{static fromTo(i,e,s,r,a,o,h,n,l){return t.util.bindPros(i,e),Laya.Tween.to(i,s,r,a,o,h,n,l)}static yoyo(t,i,e,s,r,a,o,h,n,l){return y.getTwYoyo().yoyo(t,i,e,s,r,a,o,h,n,l)}};class y{static getTwYoyo(){return new y}yoyo(t,i,e,s,r,a,o,h,n,l){return this.target=t,this.num=i,this.props0=e,this.props=s,this.duration=r,this.ease=a,this.complete=o,this.delay=h,this.coverBefore=n,this.autoRecover=l,this.start(),this}start(){this.clearTw(),t.Tween.bind(this.target,this.props0),this.m_index=0,this.doTw()}doTw(){this.m_curTw=null,this.m_index>=this.num?this.onComplete():this.m_curTw=t.Tween.to(this.target,this.m_index%2==0?this.props:this.props0,this.duration,this.ease,t.handle(this,this.onTwComplete),this.delay,this.coverBefore,this.autoRecover)}clearTw(){this.m_curTw&&(this.m_curTw.clear(),this.m_curTw=null)}onTwComplete(){this.m_index++,this.doTw()}onComplete(){let t=this.complete;this.clear(),t&&t.run()}clear(){this.clearTw(),this.target=null,this.num=0,this.props0=null,this.props=null,this.duration=0,this.ease=null,this.complete=null,this.delay=0,this.coverBefore=!1,this.autoRecover=!1}}t.TwYoyo=y;class f{constructor(){this._guidePt=Laya.Point.EMPTY,this._guideRect=Laya.Rectangle.create()}initData(t,i){this._guideViewVpData=t,this._cfgCtrl=i}onGameShow(){this._curGuideCfg&&t.timerMgr.once(300,this,this.checkGuideCfg)}onGameHide(){t.timerMgr.clear(this,this.checkGuideCfg)}get isGuiding(){return!!this.curGuideCfg}get curGuideCfg(){return this._curGuideCfg}get guidePt(){return this._guidePt}get guideRect(){return this._guideRect}start(t){this.doGuide(t)}stop(t){t&&this._curGuideCfg&&this._curGuideCfg.id==t&&this.stopCurGuide()}stopCurGuide(){this._curGuideCfg=null,t.timerMgr.clear(this,this.onGuideDelayEnd),this.hideGuide()}hideGuide(){t.uiViewMgr.hideViewByVpData(this._guideViewVpData)}doGuide(t){this.hideGuide(),this._curGuideCfg=this._cfgCtrl.getCfg(t),this.checkGuideCfg()}checkGuideCfg(){(!this._curGuideCfg||!this.doGuideCfg())&&this.stopCurGuide()}doGuideCfg(){if(this._curGuideCfg.actCtrl&&t.gMsgCet.event(this._curGuideCfg.actCtrl),2==this._curGuideCfg.actType)return t.timerMgr.once(Number(this._curGuideCfg.actTypeParam),this,this.onGuideDelayEnd),!0;if(3==this._curGuideCfg.actType)return t.gMsgCet.event(t.enum.evtEnum.CHECK_VIEW_GUIDE+this._curGuideCfg.viewID),!0;let i=this.tryGetCurGuideUi(this._curGuideCfg.uiName),e=this.tryGetCurGuideUi(this._curGuideCfg.pointName)||i,s=this.tryGetCurGuideUi(this._curGuideCfg.uiRect)||i;if(!e)return!1;if(this._guidePt=s.localToGlobal(),s?this._guideRect.setTo(this._guidePt.x-s.width*s.pivotX,this._guidePt.y-s.height*s.pivotY,s.width,s.height):this._guideRect.reset(),this._guidePt=e.localToGlobal(),t.uiViewMgr.showViewByVpData(this._guideViewVpData,{msg:"updateGuide"}),i&&0==this._curGuideCfg.actType)this._clickTarget=i,this._clickTarget.on(this._curGuideCfg.actTypeParam||Laya.Event.CLICK,this,this.onGuideTargetClick,this.getEvtArgs());else{if(1!=this._curGuideCfg.actType||!this._curGuideCfg.actTypeParam)return t.error("GuideMgr-doGuideCfg-Error:No-Evt!");t.gMsgCet.once(this.getActTypeParam(),this,this.onGuideStepEnd,this.getEvtArgs()),this._curGuideCfg._actTypeParam2&&t.gMsgCet.event(this._curGuideCfg._actTypeParam2)}return!0}getEvtArgs(){return[{guideCfg:this._curGuideCfg}]}checkEvtArgs(t){return t&&this._curGuideCfg&&this._curGuideCfg==t.guideCfg}tryGetCurGuideUi(i){return t.uiViewMgr.getViewUi({viewID:this._curGuideCfg.viewID,uiName:i})}getActTypeParam(){if(this._curGuideCfg){if(!this._curGuideCfg._actTypeParam){let t=this._curGuideCfg.actTypeParam.split("|");this._curGuideCfg._actTypeParam=t[0],t[1]&&(this._curGuideCfg._actTypeParam2=t[1])}return this._curGuideCfg._actTypeParam}}checkGuideOnVPHide(i){if(i&&this._curGuideCfg&&this._curGuideCfg.viewID==i.viewID)if(t.pf.isGameShow)t.timerMgr.frameOnce(1,this,this.checkGuideVPHide);else{let t=this._curGuideCfg;this.stopCurGuide(),this._curGuideCfg=t}}checkGuideVPHide(){this._curGuideCfg&&this._curGuideCfg.viewID&&!t.uiViewMgr.isViewNameShow(this._curGuideCfg.viewID)&&(1==this._curGuideCfg.vpHide?this.tryGoNextGuide():this.stopCurGuide())}onGuideTargetClick(t){this.checkEvtArgs(t)&&(this._clickTarget.off(this._curGuideCfg.actTypeParam||Laya.Event.CLICK,this,this.onGuideTargetClick),this._clickTarget=null,this.tryGoNextGuide())}onGuideStepEnd(t){this.checkEvtArgs(t)&&this.tryGoNextGuide()}onGuideDelayEnd(){this.tryGoNextGuide()}onViewCheckEnd(t){t&&this._curGuideCfg&&3==this._curGuideCfg.actType&&this._curGuideCfg.viewID==t.viewID&&this.tryGoNextGuide()}tryGoNextGuide(){this.doGuide(this._curGuideCfg?this._curGuideCfg.nextId:-1)}onEsc(){return!0}}t.GuideMgr=f;class I extends i{preInit(){this._soundMuteSrc=new Map,Laya.SoundManager.autoReleaseSound=!1,Laya.SoundManager.autoStopMusic=!1,this.onGameShow()}onGameShow(){this.setSoundMuted("sysSetMuted",t.localDataMgr.getBool("Sound.muted"))}onGameHide(){t.localDataMgr.setBool("Sound.muted",this._soundMuteSrc.get("sysSetMuted")),this.checkSound(),Laya.SoundManager.stopAll()}get muted(){return this._soundMuteSrc.get("sysSetMuted")}set muted(i){this._soundMuteSrc.get("sysSetMuted")!=i&&(t.localDataMgr.setBool("Sound.muted",i),this.setSoundMuted("sysSetMuted",i),t.gMsgCet.event("sound.muted"))}setSoundMuted(t,i){t&&(this._soundMuteSrc.set(t,i),this.checkSound())}checkSound(){let i=!t.pf.isGameShow;!i&&this._soundMuteSrc.forEach(t=>{t&&(i=!0)}),Laya.SoundManager.muted!=i&&(Laya.SoundManager.muted=i,!i&&this.musicUrl&&this.doPlayMusic(this.musicUrl))}triggerMuted(){this.muted=!this.muted}playMusic(t,i,e,s){return this.musicUrl!=t?this.doPlayMusic(t,i,e,s):null}doPlayMusic(i,e,s,r){return t.log("play music:"+i+",startTime:"+(r||0)),this.musicUrl=i,Laya.SoundManager.playMusic(this.musicUrl,e,s,r)}playSound(t,i,e,s,r){return Laya.SoundManager.playSound(t,i,e,s,r)}}t.SoundManager=I;t.localDataMgr=class extends Laya.LocalStorage{static setNum(t,i){this.setItem(t,i.toString())}static getNum(t){return Number.parseFloat(this.getItem(t))||0}static setInt(t,i){this.setItem(t,i.toString())}static getInt(t){return Number.parseInt(this.getItem(t))||0}static setBool(t,i){this.setItem(t,i?"1":null)}static getBool(t){return"1"==this.getItem(t)}static setJson(t,i){this.setItem(t,JSON.stringify(i))}static getJson(t){return JSON.parse(this.getItem(t))}};class C extends i{constructor(){super(),this.prgViewID="PrgView"}get prg(){return this._prg}start(){this._prg=0,t.uiViewMgr.showView(this.prgViewID)}onProgress(i){this._prg=i,t.gMsgCet.event("PrgMgr.progress",{progress:this._prg})}onEnd(){this._prg=1,t.uiViewMgr.hideView(this.prgViewID)}load(i,e,s,r,a,o,h,n,l){this.start(),t.resMgr.load(i,t.handle(this,()=>{this.onEnd(),e&&e.run()}),t.handle(this,t=>{this.onProgress(t),s&&s.run()}),r,a,o,h,n,l)}openScene(i,e,s){this.start(),t.sceneMgr.openScene(i,()=>{this.onEnd(),e&&e()},t=>{this.onProgress(t),s&&s(t)})}}t.PrgMgr=C;class w{get scene(){return this._scene}setScene(t){this._scene=t,this._scene&&this._scene.parent&&this._scene.parent.parent&&this._scene.parent.parent.setChildIndex(this._scene.parent,0)}get scenePath(){return this._scenePath}get worldRoot(){return Laya.Physics.I.worldRoot}set worldRoot(t){Laya.Physics.I.worldRoot=t}get mapX(){return this.worldRoot.x}set mapX(i){this.worldRoot.x=t.uiViewMgr.sceneui.x=i}get mapY(){return this.worldRoot.y}set mapY(i){this.worldRoot.y=t.uiViewMgr.sceneui.y=i}setMapXY(t,i){this.mapX=t,this.mapY=i}get mapScale(){return this.worldRoot.scaleX}set mapScale(i){this.worldRoot.scale(i,i),t.uiViewMgr.sceneui.setScale(i,i)}init(){}openScene(i,e,s){this._scenePath=i,Laya.Scene.open(this._scenePath,!0,null,t.handle(this,this.onSceneOpen,[{funcOnEnd:e}]),s?t.handle(null,s):null)}onSceneOpen(t,i){this.setScene(i),t.funcOnEnd&&t.funcOnEnd()}}t.SceneMgr=w;t.ScCompBase=class extends Laya.Script{onEnable(){t.sceneMgr.setScene(this.owner.scene)}},t.Ease=Laya.Ease,t.isDebug="file:"==Laya.Browser.window.location.protocol,!t.moduleMgr&&(t.moduleMgr=new e),t.instMgrs=function(){t.stage=Laya.stage,!t.util&&(t.util=t.moduleMgr.addModule(s)),!t.timerMgr&&(t.timerMgr=t.moduleMgr.addModuleObj("TimerMgr",Object.defineProperties(Laya.timer,{_gPreInitTime:{value:0,writable:!0},preInit:{value:function(){this._gPreInitTime=this.currTimer}},gameRunTime:{get:function(){return this.currTimer-this._gPreInitTime}},onGameShow:{value:function(){t.timerMgr.resume()}},onGameHide:{value:function(){t.timerMgr.pause()}}}))),!t.resMgr&&(t.resMgr=t.moduleMgr.addModuleObj("Loader",Laya.loader)),!t.netMgr&&(t.netMgr=t.moduleMgr.addModule(o)),!t.soundMgr&&(t.soundMgr=t.moduleMgr.addModule(I)),!t.cfgMgr&&(t.cfgMgr=t.moduleMgr.addModule(h)),!t.gMsgCet&&(t.gMsgCet=t.moduleMgr.addModule(r)),!t.uiViewMgr&&(t.uiViewMgr=t.moduleMgr.addModule(m)),!t.gInfoMgr&&(t.gInfoMgr=t.moduleMgr.addModule(l)),!t.guideMgr&&(t.guideMgr=t.moduleMgr.addModule(f)),!t.prgMgr&&(t.prgMgr=t.moduleMgr.addModule(C)),!t.sceneMgr&&(t.sceneMgr=t.moduleMgr.addModule(w))},t.M=function(i){return t.moduleMgr.getModule(i)},t.handle=function(t,i,e,s){return Laya.Handler.create(t,i,e,s)},t.log=function(t,...i){i&&i.length>0?console.log(t,i):console.log(t)},t.error=function(t){console.error(t)},t.gw=function(){return Laya.stage.width},t.gh=function(){return Laya.stage.height},t.gScale=function(){return t.uiViewMgr.gScale},window.GI=t;class b extends Laya.Script{constructor(){super(...arguments),this.ti=0}onEnable(){}onAwake(){this.tri=!0,this.ani=!0,this.sp=this.owner,this.start=this.sp.y+5,this.end=this.sp.y+this.sp.height/2,this.startTween()}forwardFunc(){GI.timerMgr.once(1e3,this,this.backFunc)}backFunc(){GI.Tween.to(this.sp,{y:this.start},2e3,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTween(){GI.Tween.to(this.sp,{y:this.end},2e3,null,Laya.Handler.create(this,this.forwardFunc),0,!1,!1)}}class R{constructor(){}static regComp(t,i){null==R.items[t]?R.items[t]=i:GI.log(t+"名字对应的组件已存在")}static getComp(t){if(null!=t&&""!=t){if(null!=R.items[t])return R.items[t];GI.log(t+"名字对应的组件没有找到")}else GI.log("CompRegister Comp value is unvalue")}}R.items=[];class L extends Laya.Script{constructor(){super(...arguments),this.flag=0}onEnable(){}onAwake(){this.sp=this.owner,this.sp.pivotX=0,this.sp.pivotY=0}onStart(){}onTriggerEnter(t){this.onFlagUpdate()}onTriggerStay(t){}onTriggerExit(t){}onCollisionEnter(t){}onCollisionStay(t){}onCollisionExit(t){}onFlagUpdate(){1!=this.flag&&GI.soundMgr.playSound("res/sound/SavePoint.mp3"),this.flag=1,GI.Tween.to(this.sp,{rotation:-90},300,null,Laya.Handler.create(this,this.onFlagComplete),0,!1,!1)}onFlagVertical(){this.sp.rotation=-90}onFlagComplete(){}}class G extends L{onAwake(){super.onAwake(),GI.gMsgCet.on("ReachLine",this,this.onFlagUpdate),GI.gMsgCet.on("PlayAgain",this,this.onFlagVertical)}onDestroy(){super.onDestroy(),GI.gMsgCet.off("ReachLine",this,this.onFlagUpdate),GI.gMsgCet.off("PlayAgain",this,this.onFlagVertical)}}class S extends Laya.Script{constructor(){super(...arguments),this.texName="",this.MaxHP=100,this.HP=100,this.propIdx=1,this.restitution=.1,this.linearDamping=.5,this.friction=.3,this.density=20,this.propId=0,this.propMaxNum=4,this.specificId=0}AwakeItem(){this.sp=this.owner}initData(t){this.from=t.from,this.to=t.to,this.delay=t.delay,this.isH=t.isH,this.duration=t.duration,this.isChange=t.isChange,this.texName=t.texName,this.typeParam=t.typeParam,this.forceX=t.forceX,this.forceY=t.forceY,this.px=t.pivotX,this.py=t.pivotY,this.density=t.density,this.ratote=t.ratote,this.MaxHP=t.maxHp,this.HP=t.hp,this.restitution=t.restitution,this.linearDamp=t.linearDamping,this.friction=t.friction,this.propId=t.propId,this.propMaxNum=t.propMaxNum,this.specificId=t.specificId,0==this.duration&&(this.duration=2e3),0==this.delay&&(this.delay=10)}}class x extends S{constructor(){super(...arguments),this.times=0,this.maxTimes=1,this._contact={role:!0}}setMaxTimes(t){this.maxTimes=t}setFootContact(t){this._contact.left=this._contact.right=t}setRoleContact(t){this._contact.role=t}setAllContact(){this.setFootContact(!0),this.setRoleContact(!0)}getStepByPos(t,i){return Xi.i.mapCtrl.getStepByPos(t,i)}onEnable(){}AwakeItem(){super.AwakeItem(),this.sp=this.owner}onStart(){}onTriggerEnter(t){this.times<this.maxTimes&&this._contact[t.label]&&this.TriggerEnter(t)}TriggerEnter(t){}onTriggerStay(t){}onTriggerExit(t){}onCollisionEnter(t){}onCollisionStay(t){}onCollisionExit(t){}DisableBox(){let t=this.sp.getComponent(Laya.BoxCollider);null!=t&&t.destroy()}JudgeFlag(t){return Xi.i.curStep>=t&&0!=Xi.i.curStep}onUpdate(){}onPreRender(){}onPostRender(){}onDisable(){}onDestroy(){}}class M extends x{constructor(){super(...arguments),this.step=-1}onAwake(){super.AwakeItem(),this.setRoleContact(!0)}TriggerEnter(t){if(-1==this.step&&(this.step=this.getStepByPos(this.sp.x,this.sp.y)),this.JudgeFlag(this.step))return this.DisableBox(),void GI.gMsgCet.event("FinishLevel");GI.gMsgCet.event("FinishLevel"),GI.gMsgCet.event("Wm.onFinishLvl"),this.DisableBox(),this.times=this.times+1}}class _ extends L{onAwake(){super.onAwake(),GI.gMsgCet.on("FinishLevel",this,this.onFlagUpdate)}onDestroy(){super.onDestroy(),GI.gMsgCet.off("FinishLevel",this,this.onFlagUpdate)}}class v extends x{constructor(){super(...arguments),this.step=-1}onAwake(){super.AwakeItem(),this.setRoleContact(!0)}TriggerEnter(t){if(-1==this.step&&(this.step=this.getStepByPos(this.sp.x,this.sp.y)),this.step=1,this.JudgeFlag(this.step))return this.DisableBox(),void GI.gMsgCet.event("PlayAgain",this.step);this.DisableBox(),GI.gMsgCet.event("ReachLine",this.step),this.times=this.times+1}}class P extends S{constructor(){super(...arguments),this.ti=0}AwakeItem(){super.AwakeItem(),this.sp=this.owner;let t=this.sp.getComponent(Laya.BoxCollider);null!=t&&(t.y=-60)}forwardFunc(){this.isH?GI.Tween.to(this.sp,{x:this.to},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.backFunc),0,!1,!1):GI.Tween.to(this.sp,{y:this.to},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){this.isH?GI.Tween.to(this.sp,{x:this.from},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.startTween),0,!1,!1):GI.Tween.to(this.sp,{y:this.from},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTween(){GI.timerMgr.once(this.delay,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.startTween()}onTriggerEnter(t,i,e){"left"!=t.label&&"right"!=t.label&&"role"!=t.label||(GI.gMsgCet.event("wmCtrl.Role_End"),GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"))}onTriggerExit(t,i,e){}}class B extends x{constructor(){super(...arguments),this.step=-1}onAwake(){super.AwakeItem(),this.setFootContact(!0)}TriggerEnter(t){this.sp.texture=null,GI.gMsgCet.event("PushBridge",this.typeParam),this.DisableBox()}initData(t){super.initData(t),null==this.sp&&this.onAwake()}}class D extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,GI.gMsgCet.on("PushBridge",this,this.onBridgeDown)}onBridgeDown(t){if(t==this.typeParam){let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic")}}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class T extends S{constructor(){super(...arguments),this.ti=0}AwakeItem(){if(super.AwakeItem(),this.sp=this.owner,this.sp.pivot(0,0),this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid){this.rigid.type="kinematic",this.sp.getComponent(Laya.ColliderBase).density=100,this.rigid.allowSleep=!1}let t=this.sp.getComponent(Laya.PolygonCollider);null!=t&&(t.restitution=0),this.onFrame()}onFrame(){"fast"==Laya.stage.frameRate?this.frame=60:"slow"==Laya.stage.frameRate&&(this.frame=30),this.ratio=60/this.frame}GetUpLinearVelocity(){return((this.to-this.from)/(this.duration/1e3*this.frame)).toFixed(1)}GetDownLinearVelocity(){return((this.from-this.to)/(this.duration/1e3*this.frame)).toFixed(1)}forwardFunc(){this.isH?null!=this.rigid&&(this.num=GI.timerMgr.currFrame,this.rigid.body.m_linearVelocity.x=this.GetUpLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.backTween)):null!=this.rigid&&(this.rigid.body.m_linearVelocity.y=this.GetUpLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.backTween))}backTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.backFunc)}backFunc(){this.isH?null!=this.rigid&&(this.num=GI.timerMgr.currFrame,this.rigid.body.m_linearVelocity.x=this.GetDownLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.startTween)):null!=this.rigid&&(this.rigid.body.m_linearVelocity.y=this.GetDownLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.startTween))}startTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.startTween()}setBeginPos(){this.isH?this.sp.x=this.from:this.sp.y=this.from}setEndPos(){this.isH?this.sp.x=this.to:this.sp.y=this.to}setColiType(){this.coliType=1}}class A extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner;let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic");let i=this.sp.getComponent(Laya.BoxCollider);null!=i&&(i.restitution=0,i.density=this.density||3);let e=this.sp.getComponent(Laya.PolygonCollider);null!=e&&(e.restitution=0,e.density=this.density||3)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class k extends S{constructor(){super(...arguments),this.ti=0}onEnable(){}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.startTween()}forwardFunc(){GI.Tween.to(this.sp,{y:this.to},this.duration,null,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){GI.Tween.to(this.sp,{y:this.from},this.duration,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTween(){GI.timerMgr.once(10,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class E extends L{onAwake(){super.onAwake(),GI.gMsgCet.on("ReachMidStep",this,this.onFlagUpdate),GI.gMsgCet.on("MidPlay",this,this.onFlagVertical)}onDestroy(){super.onDestroy(),GI.gMsgCet.off("ReachMidStep",this,this.onFlagUpdate),GI.gMsgCet.off("MidPlay",this,this.onFlagVertical)}}class V extends x{constructor(){super(...arguments),this.step=-1}onAwake(){super.AwakeItem(),this.setRoleContact(!0)}TriggerEnter(t){if(this.step=2,this.JudgeFlag(this.step))return this.DisableBox(),void GI.gMsgCet.event("MidPlay");this.DisableBox(),GI.gMsgCet.event("ReachMidStep",this.step),this.times=this.times+1}}class U extends x{constructor(){super(...arguments),this.step=-1}onAwake(){super.AwakeItem(),this.setFootContact(!0)}TriggerEnter(t){if(this.JudgeFlag(this.step))return GI.gMsgCet.event("FinishLevel"),GI.gMsgCet.event("Wm.onFinishLvl"),this.DisableBox(),void this.addDownMutou();GI.gMsgCet.event("FinishLevel"),GI.gMsgCet.event("Wm.onFinishLvl"),this.DisableBox(),this.addDownMutou(),this.times=this.times+1}addDownMutou(){this.sp.texture=null;let t=new Laya.Sprite;t.pivot(t.width/2,t.height/2),t.x=0,t.y=0,t.loadImage("sceneObj/frontLayer/Ditu_1_Mutou_5.png"),this.sp.addChild(t)}}class O extends x{constructor(){super(...arguments),this.step=-1}onAwake(){super.AwakeItem(),this.setFootContact(!0),GI.gMsgCet.on("ReachLine",this,this.addDownMutou)}TriggerEnter(t){if(this.JudgeFlag(this.step))return this.addDownMutou(),void GI.gMsgCet.event("PlayAgain");GI.gMsgCet.event("ReachLine",1),this.addDownMutou(),this.times=this.times+1}addDownMutou(){this.DisableBox(),this.sp.texture=null;let t=new Laya.Sprite;t.pivot(t.width/2,t.height/2),t.x=0,t.y=0,t.loadImage("sceneObj/frontLayer/Ditu_1_Mutou_4.png"),this.sp.addChild(t)}onDestroy(){GI.gMsgCet.off("ReachLine",this,this.addDownMutou)}}class N extends x{constructor(){super(...arguments),this.step=2}onAwake(){super.AwakeItem(),this.setFootContact(!0),GI.gMsgCet.on("ReachMidStep",this,this.addDownMutou)}TriggerEnter(t){if(this.JudgeFlag(this.step))return this.addDownMutou(),void GI.gMsgCet.event("MidPlay");GI.gMsgCet.event("ReachMidStep",2),this.addDownMutou(),this.times=this.times+1}addDownMutou(){this.DisableBox(),this.sp.texture=null;let t=new Laya.Sprite;t.pivot(t.width/2,t.height/2),t.x=0,t.y=0,t.loadImage("sceneObj/frontLayer/Ditu_1_Mutou_4.png"),this.sp.addChild(t)}onDestroy(){GI.gMsgCet.off("ReachMidStep",this,this.addDownMutou)}}class F extends x{constructor(){super(...arguments),this.step=-1}onAwake(){super.AwakeItem(),this.setFootContact(!0)}TriggerEnter(t){GI.timerMgr.once(2e3,this,this.onPlaneDown)}onPlaneDown(){let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic");let i=this.sp.getComponents(Laya.ColliderBase);for(let t=0;t<i.length;++t){let e=i[t];e.restitution=0,e.isSensor=!0}GI.gMsgCet.event("ReachMidStep",2)}}class H extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner;let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic");let i=this.sp.getComponent(Laya.BoxCollider);null!=i&&(i.isSensor=!1,i.restitution=.2,i.density=this.density||1)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class J extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,GI.gMsgCet.on("PushBridge",this,this.onRiseUp)}onRiseUp(){let t=this.sp.y-this.sp.height/2;GI.Tween.to(this.sp,{y:t},500,null)}onDestroy(){super.onDestroy(),GI.gMsgCet.off("PushBridge",this,this.onRiseUp)}}class X extends S{constructor(){super(...arguments),this.MaxHP=100,this.HP=100,this.propIdx=1,this.restitution=0,this.linearDamping=.5,this.friction=.3,this.density=20,this.propId=0,this.propMaxNum=4,this.rigidId=0,this.grage=0,this.boomerang=1,this.floor=1}AwakeItem(){super.AwakeItem();let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic"),this.rigid=t,this.col=this.sp.getComponent(Laya.ColliderBase),null!=this.col&&(this.col.restitution=this.restitution||0,this.col.friction=this.friction),this.propCfg=Xi.i.data.ModuleCfgs.datas[this.propId],this.feebles=this.propCfg.feebles,this.scales=this.propCfg.scales,this.grage=this.propCfg.grage}initData(t){super.initData(t),this.textureName=this.texName.split(","),null==this.sp&&(this.AwakeItem(),this.col.density=this.density||3),this.propMaxNum=this.textureName.length}getScale(t){if(null!=this.scales)for(let i=0;i<this.scales.length;++i)if(this.scales[i].id==t)return this.scales[i];return{id:1,scaleX:1,scaleY:1}}loadPropImage(t){if(this.textureName.length-1<t-1)return void GI.error(this.textureName.length+"  数据有问题   破碎层 与数据不对   par  "+t);if(""==this.textureName[t-1])return void GI.error(this.textureName.length+"  数据为空   par  "+t+this.sp);let i;i="sceneObj/blocks/".concat(this.textureName[t-1].trim()).concat(".png"),this.propIdx=t,this.sp.loadImage(i)}UpdateShow(){if(this.HP<=0)return void GI.timerMgr.frameOnce(2,this,()=>{this.RemoveItem()});let t=this.HP/this.MaxHP;4==this.propMaxNum?t>=.76?this.propIdx=1:t>=.51?this.propIdx=2:t>=.26?this.propIdx=3:t>.1&&(this.propIdx=4):3==this.propMaxNum&&(t>=.61?this.propIdx=1:t>=.31?this.propIdx=2:t>=.1&&(this.propIdx=3)),this.loadPropImage(this.propIdx)}RemoveItem(){Xi.i.data.AddGrade(this.grage);let t=Laya.Point.create();t.setTo(this.sp.width/2,this.sp.height/2),t=this.sp.localToGlobal(t,!1,GI.sceneMgr.worldRoot),GI.gMsgCet.event("AddGameGrade",{grage:this.grage,isBird:!1,id:this.propCfg.id,point:t,score_type:"destroy"});let i=this.getScale(this.specificId);GI.gMsgCet.event("ab.PlayEffect",[this.propCfg.hit_eff,t.x,t.y,this.sp.rotation,i.scaleX,i.scaleY]),Yi.RemoveNodes(this.sp),this.rigid=null,this.sp.destroy(),this.sp=null}onDestroy(){}}class Y extends X{AwakeItem(){super.AwakeItem(),this.sp=this.owner;let t=this.sp.getComponent(Laya.BoxCollider);null!=t&&(t.isSensor=!1)}}class W extends Laya.Script{constructor(){super(...arguments),this.ti=0}onEnable(){}onAwake(){super.onAwake(),this.tri=!0,this.sp=this.owner,GI.gMsgCet.on("PushBridge",this,this.onPushDown)}onPushDown(){let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic",t.applyForce({x:this.sp.x,y:this.sp.y},{x:0,y:-100}))}onDestroy(){super.onDestroy(),GI.gMsgCet.off("PushBridge",this,this.onPushDown)}}class j extends S{constructor(){super(...arguments),this.ti=0}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.pivot(this.sp.width/2,this.sp.height/2);let t=this.sp.getComponent(Laya.BoxCollider);null!=t&&(t.y=-30)}forwardFunc(){this.isH?GI.Tween.to(this.sp,{x:this.to},this.duration,null,Laya.Handler.create(this,this.backFunc),0,!1,!1):GI.Tween.to(this.sp,{y:this.to},this.duration,null,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){this.isH?GI.Tween.to(this.sp,{x:this.from},this.duration,null,Laya.Handler.create(this,this.startTween),0,!1,!1):GI.Tween.to(this.sp,{y:this.from},this.duration,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTween(){GI.timerMgr.once(this.delay,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.sp.y=this.from,this.startTween()}}class z extends Laya.Script{onAwake(){super.onAwake(),this.sp=this.owner;let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="static")}}class q extends S{constructor(){super(...arguments),this.ti=0}AwakeItem(){if(super.AwakeItem(),this.sp=this.owner,this.sp.pivot(0,0),this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid){this.rigid.type="kinematic",this.sp.getComponent(Laya.ColliderBase).density=100,this.rigid.allowSleep=!1}let t=this.sp.getComponent(Laya.PolygonCollider);null!=t&&(t.restitution=0),this.onFrame()}onFrame(){"fast"==Laya.stage.frameRate?this.frame=60:"slow"==Laya.stage.frameRate&&(this.frame=30),this.ratio=60/this.frame}GetUpLinearVelocity(){return((this.to-this.from)/(this.duration/1e3*this.frame)).toFixed(1)}GetDownLinearVelocity(){return((this.from-this.to)/(this.duration/1e3*this.frame)).toFixed(1)}forwardFunc(){this.isH?null!=this.rigid&&(this.num=GI.timerMgr.currFrame,this.rigid.body.m_linearVelocity.x=this.GetUpLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.backTween)):null!=this.rigid&&(this.rigid.body.m_linearVelocity.y=this.GetUpLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.backTween))}backTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.backFunc)}backFunc(){this.isH?null!=this.rigid&&(this.num=GI.timerMgr.currFrame,this.rigid.body.m_linearVelocity.x=this.GetDownLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.startTween)):null!=this.rigid&&(this.rigid.body.m_linearVelocity.y=this.GetDownLinearVelocity(),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.startTween))}startTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration/1e3*this.frame,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.startTween()}setBeginPos(){this.isH?this.sp.x=this.from:this.sp.y=this.from}setEndPos(){this.isH?this.sp.x=this.to:this.sp.y=this.to}setColiType(){this.coliType=1}}class Q extends S{constructor(){super(...arguments),this.ti=0,this.obj=new Array,this.step=-1,this.times=0}onEnable(){}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.addTxtInFront(),GI.gMsgCet.on("ReachLine",this,this.sendMsgToCoinView),this.JudgeFlag(this.step)?this.onPlayAgain():(this.startTween(),this.startTxtTween())}addTxtInFront(){this.txt=new Laya.Text,this.txt.text="5",this.txt.color="#ffffff",this.txt.fontSize=32,this.txt.bold=!0,this.isChange?(this.txt.pos(this.sp.x-130,this.sp.y-43),this.sp.addChild(this.txt)):(this.txt.pos(this.sp.x-30,this.sp.y+8),Xi.i.mapCtrl.front.addChild(this.txt))}countDownText(){let t=0;for(let i=5;i>=1;i--)t+=150,GI.timerMgr.once(t,this,function(){this.txt.text=i},[i])}sendMsgToCoinView(){this.times<1&&(this.onCreateCoin(),this.countDownText(),GI.timerMgr.once(800,this,function(){this.txt.visible=!1,this.sp.visible=!1}),this.times=this.times+1)}onDestroy(){GI.gMsgCet.off("ReachLine",this,this.sendMsgToCoinView)}onCreateCoin(){GI.resMgr.load("sceneObj/common/coinAni.json",GI.handle(this,t=>{for(let i=5;i>=1;i--)this.showCoinAni(t,i)}))}showCoinAni(t,i){let e=new Laya.Prefab;e.json=t;let s=Laya.Pool.getItemByCreateFun("coinAni",e.create,e);if(s.wrapMode=0,s.play(),Xi.i.mapCtrl.front.addChild(s),this.isChange){let t=this.sp.parent,e=this.sp.x+t.x,r=this.sp.y+t.y;GI.Tween.fromTo(s,{x:e,y:r},{x:e-70+140*Math.random(),y:r-50*Math.random()},800,Laya.Ease.backInOut,GI.handle(this,()=>{GI.uiViewMgr.showView("WmGetCoinView",{index:i,o:s})}),200*(i-1))}else GI.Tween.fromTo(s,{x:this.sp.x,y:this.sp.y},{x:this.sp.x-70+140*Math.random(),y:this.sp.y-30-50*Math.random()},800,Laya.Ease.backInOut,GI.handle(this,()=>{GI.uiViewMgr.showView("WmGetCoinView",{index:i,o:s})}),200*(i-1))}onPlayAgain(){this.txt.visible=!1,this.sp.visible=!1}JudgeFlag(t){return Xi.i.curStep>=t&&0!=Xi.i.curStep}startTween(){GI.timerMgr.once(10,this,this.forwardFunc)}forwardFunc(){GI.Tween.to(this.sp,{y:this.sp.y+10},500,null,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){GI.Tween.to(this.sp,{y:this.sp.y-10},500,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTxtTween(){GI.timerMgr.once(10,this,this.forwardFuncTxt)}forwardFuncTxt(){GI.Tween.to(this.txt,{y:this.txt.y+10},500,null,Laya.Handler.create(this,this.backFuncTxt),0,!1,!1)}backFuncTxt(){GI.Tween.to(this.txt,{y:this.txt.y-10},500,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class K extends Laya.Script{onAwake(){super.onAwake(),this.sp=this.owner,this.addTxtInFront()}addTxtInFront(){this.txt=new Laya.Text,this.txt.pivot(0,0),this.txt.text=Xi.i.curLvl.toString(),this.txt.color="#ff0000",this.txt.fontSize=32,this.txt.bold=!0,this.txt.pos(this.sp.x-100,this.sp.y-420),this.sp.addChild(this.txt)}onDestroy(){this.txt.destroy()}}class Z extends S{constructor(){super(...arguments),this.ti=0,this.obj=new Array,this.step=2}onEnable(){}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.addTxtInFront(),GI.gMsgCet.on("ReachMidStep",this,this.sendMsgToCoinView),this.JudgeFlag(this.step)?this.onPlayAgain():(this.startTween(),this.startTxtTween())}addTxtInFront(){this.txt=new Laya.Text,this.txt.text="5",this.txt.color="#ffffff",this.txt.fontSize=32,this.txt.bold=!0,this.isChange?(this.txt.pos(this.sp.x-130,this.sp.y-65),this.sp.addChild(this.txt)):(this.txt.pos(this.sp.x-30,this.sp.y+8),Xi.i.mapCtrl.front.addChild(this.txt))}countDownText(){let t=0;for(let i=5;i>=1;i--)t+=150,GI.timerMgr.once(t,this,function(){this.txt.text=i},[i])}sendMsgToCoinView(){this.onCreateCoin(),this.countDownText(),GI.timerMgr.once(800,this,function(){this.txt.visible=!1,this.sp.visible=!1})}onDestroy(){GI.gMsgCet.off("ReachMidStep",this,this.sendMsgToCoinView)}onCreateCoin(){GI.resMgr.load("sceneObj/common/coinAni.json",GI.handle(this,t=>{for(let i=5;i>=1;i--)this.showCoinAni(t,i)}))}showCoinAni(t,i){let e=new Laya.Prefab;e.json=t;let s=Laya.Pool.getItemByCreateFun("coinAni",e.create,e);if(s.wrapMode=0,s.play(),Xi.i.mapCtrl.front.addChild(s),this.isChange){let t=this.sp.parent,e=this.sp.x+t.x,r=this.sp.y+t.y;GI.Tween.fromTo(s,{x:e,y:r},{x:e-70+140*Math.random(),y:r-50*Math.random()},800,Laya.Ease.backInOut,GI.handle(this,()=>{GI.uiViewMgr.showView("WmGetCoinView",{index:i,o:s})}),200*(i-1))}else GI.Tween.fromTo(s,{x:this.sp.x,y:this.sp.y},{x:this.sp.x-70+140*Math.random(),y:this.sp.y-30-50*Math.random()},800,Laya.Ease.backInOut,GI.handle(this,()=>{GI.uiViewMgr.showView("WmGetCoinView",{index:i,o:s})}),200*(i-1))}onPlayAgain(){this.txt.visible=!1,this.sp.visible=!1}JudgeFlag(t){return Xi.i.curStep>=t&&0!=Xi.i.curStep}startTween(){GI.timerMgr.once(10,this,this.forwardFunc)}forwardFunc(){GI.Tween.to(this.sp,{y:this.sp.y+10},500,null,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){GI.Tween.to(this.sp,{y:this.sp.y-10},500,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTxtTween(){GI.timerMgr.once(10,this,this.forwardFuncTxt)}forwardFuncTxt(){GI.Tween.to(this.txt,{y:this.txt.y+10},500,null,Laya.Handler.create(this,this.backFuncTxt),0,!1,!1)}backFuncTxt(){GI.Tween.to(this.txt,{y:this.txt.y-10},500,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}initData(t){super.initData(t)}}class $ extends Laya.Script{onAwake(){this.ground=this.owner}onEnable(){let t,i=new Laya.Sprite;i.loadImage("sceneObj/sceneItem/Ditu_1_Mutou_16.png"),this.owner.addChild(i),i.pos(i.width,0);let e=new Laya.RigidBody;i.addComponentIntance(e);let s=new Laya.BoxCollider;s.width=i.width,s.height=116,s.y=5,s.density=20,i.addComponentIntance(s);let r,a=new Laya.RevoluteJoint;a.otherBody=t||this.ground.getComponent(Laya.RigidBody),a.anchor=[0,0],a.collideConnected=!0,a.enableLimit=!0,i.addComponentIntance(a),t=e;for(let e=1;e<15;e++){let s=new Laya.Sprite;s.loadImage("sceneObj/sceneItem/Ditu_1_Mutou_17.png"),this.owner.addChild(s),r=s.width,s.pos(s.width*e+i.width+s.width/2-4*(e-1)-4,-7);let a=new Laya.RigidBody;s.addComponentIntance(a);let o=new Laya.BoxCollider;o.width=18,o.height=26+6*(15-e),o.y=5,o.density=1*(20-e),s.addComponentIntance(o);let h=new Laya.RevoluteJoint;h.otherBody=t||this.ground.getComponent(Laya.RigidBody),h.anchor=[0,10],h.collideConnected=!0,h.enableLimit=!0,s.addComponentIntance(h),t=a}let o=new Laya.Sprite;o.loadImage("sceneObj/sceneItem/Ditu_1_Mutou_18.png"),this.owner.addChild(o),o.pos(15*r+i.width-48,-7);let h=new Laya.RigidBody;o.addComponentIntance(h);let n=new Laya.BoxCollider;n.y=5,n.width=25,n.height=20,n.density=3,o.addComponentIntance(n);let l=new Laya.RevoluteJoint;l.otherBody=t||this.ground.getComponent(Laya.RigidBody),l.anchor=[0,10],l.collideConnected=!0,l.enableLimit=!0,o.addComponentIntance(l)}onDisable(){}}class tt extends Laya.Script{onAwake(){super.onAwake(),this.sp=this.owner,this.addTxtInFront()}addTxtInFront(){this.txt=new Laya.Text,this.txt.pivot(0,0),this.txt.text=Xi.i.curLvl.toString(),this.txt.color="#ff0000",this.txt.fontSize=32,this.txt.bold=!0,this.txt.pos(this.sp.x-20,this.sp.y-40),this.txt.valign="middle",Xi.i.mapCtrl.backGround.addChild(this.txt)}onDestroy(){this.txt.destroy()}}class it extends S{constructor(){super(...arguments),this.ti=0}AwakeItem(){super.AwakeItem(),this.sp=this.owner}forwardFunc(){this.isH?GI.Tween.to(this.sp,{x:this.to},this.duration,null,Laya.Handler.create(this,this.backFunc),0,!1,!1):GI.Tween.to(this.sp,{y:this.to},this.duration,null,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){this.isH?GI.Tween.to(this.sp,{x:this.from},this.duration,null,Laya.Handler.create(this,this.startTween),0,!1,!1):GI.Tween.to(this.sp,{y:this.from},this.duration,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTween(){GI.timerMgr.once(this.delay,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.startTween()}}class et extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.texture=null;this.sp.getComponent(Laya.BoxCollider),this.sp.getComponent(Laya.RigidBody)}}class st extends Laya.Script{onAwake(){super.onAwake(),this.sp=this.owner,this.sp.y=this.sp.y+63;this.sp.getComponent(Laya.RigidBody);let t=this.sp.getComponent(Laya.BoxCollider);null!=t&&(t.y=-20,t.isSensor=!0)}}!function(t){t[t.RedBird=0]="RedBird",t[t.FastBird=1]="FastBird",t[t.AvatarBird=2]="AvatarBird",t[t.BombBird=3]="BombBird",t[t.EggBird=4]="EggBird",t[t.BigRedBird=5]="BigRedBird",t[t.BoomerangBird=6]="BoomerangBird",t[t.ShockWaveBird=7]="ShockWaveBird"}(u||(u={})),function(t){t[t.MuTou=0]="MuTou",t[t.ShiTou=1]="ShiTou",t[t.BoLi=2]="BoLi",t[t.WuPing=3]="WuPing",t[t.Zhu=4]="Zhu",t[t.RedBird=5]="RedBird",t[t.HuangBird=6]="HuangBird",t[t.LanBird=7]="LanBird",t[t.ZaDanBird=8]="ZaDanBird",t[t.TouDanBird=9]="TouDanBird",t[t.DaRedBird=10]="DaRedBird",t[t.HuiLiBird=11]="HuiLiBird",t[t.TNT=12]="TNT",t[t.CJBBird=13]="CJBBird"}(c||(c={}));class rt extends X{constructor(){super(),this.IsTriggerSelf=!1,this.LeaveLists=new Map,this.point=Laya.Point.create(),this.triggerList=[]}AwakeItem(){super.AwakeItem(),this.rigidId=rt.RigidIdx++,null!=this.rigid&&(this.sp.on("Rigid.PostSolve",this,this.OnTriggerEnter),this.sp.on("Rigid.LeaveContact",this,this.OnLeaveContactContact),Xi.i.GameMgr.AddRigidItem(this)),this.rigid.linearDamping=this.linearDamping,this.col.density=this.density,this.col.friction=1,this.rigid.allowSleep=!1,console.log(this.rigidId+"组件   "+this.grage+"   "+Xi.i.data.MaxGameGrade),Xi.i.data.MaxGameGrade=Xi.i.data.MaxGameGrade+this.grage,this.UpdateShow(),rt.startGameTime=!1}UpdateShow(){super.UpdateShow(),this.HP<0&&(this.sp.off("Rigid.PostSolve",this,this.OnTriggerEnter),this.sp.off("Rigid.LeaveContact",this,this.OnLeaveContactContact))}IsSelfTrigger(t,i){return null!=i&&null!=i.m_manifold&&(1==i.m_manifold.type&&null!=i.m_fixtureA&&i.m_fixtureA.collider==t||2==i.m_manifold.type&&null!=i.m_fixtureB&&i.m_fixtureB.collider==t)}OnTriggerEnter(t,i,e,s){if(this.HP<=0)return;let r=t.owner,a=r.getComponent(rt),o=rt.flooe,h=!1,n=null;if(null!=a?o=a.rigidId:r.name.indexOf("bird")>=0&&null!=(n=Xi.i.roleCtrl.GetBirdById(t.label))&&(h=!0,o=-2-n.BirdId),0==this.LeaveLists.has(o)){if(this.IsTriggerSelf=this.IsSelfTrigger(i,e),this.AddLeaveId(o),0==rt.startGameTime)return;this.point.setTo(s.normalImpulses[0],s.normalImpulses[1]);let t=this.point.distance(0,0);null!=n?this.onTriggerEnterBird(n,t,r):null!=a?this.onTriggerEnterRigid(a,t):this.onTriggerEnterFloor(t),this.UpdateShow()}}AddLeaveId(t){0==this.LeaveLists.has(t)&&this.LeaveLists.set(t,t)}OnLeaveContactContact(t,i,e){let s=t.owner.getComponent(rt),r=-1;null!=s&&(r=s.rigidId),null!=this.LeaveLists.get(r)&&this.LeaveLists.delete(r)}GetFeebles(t){if(null!=this.feebles)for(let t=0;t<this.feebles.length;++t)if(this.feebles[t].birdId==t)return this.feebles[t].addition;return 1}onTriggerEnterBird(t,i,e){this.IsTriggerSelf&&(t.IsTriggerFirst?this.OnFirstBirdTriggerSound(t):(t.PlayTriggerSound(),this.OnTriggerSound()));let s=this.GetFeebles(t.BirdId);t.birdType==u.FastBird&&t.isCanMouse&&(s*=2);let r=Math.floor(i*s);this.HP-=r,Xi.i.data.AddGrade(r);let a=Xi.i.data.BirdCfgs.birds[t.birdType],o=Laya.Point.create();o.setTo(this.sp.width/2,this.sp.height/2),o=e.localToGlobal(o,!1,GI.sceneMgr.worldRoot),GI.gMsgCet.event("AddGameGrade",{grage:r,isBird:!1,id:this.propCfg.id,point:{x:o.x,y:o.y},score_type:"hit"}),GI.gMsgCet.event("ab.PlayEffect",[a.hit_eff.url,o.x,o.y,e.rotation,a.hit_eff.scaleX,a.hit_eff.scaleY]),this.HP<0&&(this.HP=0)}onTriggerEnterRigid(t,i){let e=this.GetFeebles(t.propId);this.OnTriggerSound(),this.HP-=i*e,this.HP<0&&(this.HP=0)}onTriggerEnterFloor(t){this.OnTriggerSound();let i=this.propCfg.floor;this.HP-=t*i,this.HP<0&&(this.HP=0)}OnBoomerang(t){if(this.HP<=0)return;let i=this.propCfg.boomerang;this.HP-=t*i,this.HP<0&&(this.HP=0),this.UpdateShow()}MustDie(){this.HP=0,this.UpdateShow()}RemoveItem(){this.sp.off("Rigid.PostSolve",this,this.OnTriggerEnter),super.RemoveItem(),Xi.i.GameMgr.RemoveRigidItem(this),this.OnRemoveSound()}OnFirstBirdTriggerSound(t){GI.gMsgCet.event("AB.RigidItem",[this.propId,2])}OnTriggerSound(){GI.gMsgCet.event("AB.RigidItem",[this.propId,1])}OnRemoveSound(){GI.gMsgCet.event("AB.RigidItem",[this.propId,3])}}rt.flooe=-1,rt.startGameTime=!1,rt.RigidIdx=0;class at extends rt{constructor(){super(...arguments),this.propIdx=1,this.density=10,this.force=40}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.density=9,this.col.density=this.density,console.log("=================================="+this.propMaxNum)}onStart(){Xi.i.GameMgr.AddPig(this)}RemoveItem(){super.RemoveItem(),Xi.i.GameMgr.RemovePigItem(this)}loadPropImage(t){if(null==this.textureName)return;if(null==this.texName)return;let i;i="sceneObj/birds/".concat(this.textureName[t-1]).concat(".png"),this.propIdx=t,this.sp.loadImage(i)}randomNum(){let t=Math.floor(Math.random()*this.textureName.length);this.loadPropImage(t)}}class ot extends S{AwakeItem(){if(super.AwakeItem(),this.sp=this.owner,this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid?(this.rigid.type="kinematic",this.rigid.allowSleep=!1):(this.rigid=this.sp.addComponent(Laya.RigidBody),this.rigid.type="kinematic",this.rigid.allowSleep=!1),this.coll=this.sp.getComponents(Laya.ColliderBase),null!=this.coll)for(let t=0;t<this.coll.length;t++)null!=this.coll[t]&&(this.coll[t].restitution=0)}func(){this.rigid.angularVelocity=.3}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.func()}}class ht extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.pivot(this.sp.width/2,0),this.sp.x=this.sp.x+this.sp.width/4,this.sp.rotation=0,this.func(),this.rigi=this.sp.getComponent(Laya.RigidBody),null!=this.rigi?(this.rigi.type="kinematic",this.rigi.allowSleep=!1,this.rigi.bullet=!0):(this.rigi=this.sp.addComponent(Laya.RigidBody),this.rigi.type="kinematic",this.rigi.allowSleep=!1,this.rigi.bullet=!0)}func(){this.rigi.angularVelocity=.2}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.func()}}class nt extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.itemJson=Xi.i.mapCtrl.itemJson}createStone(){let t=this.onCreateStone(this.itemJson.Ditu_1_Shitou_3);if(null!=t){null!=t.getComponent(Laya.RigidBody)&&GI.timerMgr.once(1500,this,this.DestroyStone,[t],!1)}}onTriggerEnter(t){}onCreateStone(t){let i=new Laya.Sprite;if(i.x=0,i.y=10,i.width=t[0].width,i.height=t[0].height,i.loadImage("sceneObj".concat(t[0].pa.concat(".png"))),1==t[0].rigiBody){i.addComponent(Laya.RigidBody).type="dynamic"}if(t[0].poly.length>0){i.addComponent(Laya.PolygonCollider);let e=i.getComponent(Laya.PolygonCollider);e.label=t[0].collisionType.toString();let s="",r=t[0].poly[0].Element.length;if(r<8){let i=0;for(i=0;i<r;i++)s=s.concat(t[0].poly[0].Element[i].px.toString(),","),s=i==r-1?s.concat(t[0].poly[0].Element[i].py.toString()):s.concat(t[0].poly[0].Element[i].py.toString(),",");e.points=s,e.restitution=1}else{let r=0;for(r=0;r<8;r++)s=s.concat(t[0].poly[0].Element[r].px.toString(),","),s=7==r?s.concat(t[0].poly[0].Element[r].py.toString()):s.concat(t[0].poly[0].Element[r].py.toString(),",");e.x=t[0].width/2,e.points=s,e.restitution=1;let a=i.addComponent(Laya.PolygonCollider),o="",h=-1,n=t[0].poly.Element.length,l=n-1;if(n>8){for(h=8;h<n;h++)o=o.concat(t[0].poly[0].Element[h].px.toString(),","),o=h==l?o.concat(t[0].poly[0].Element[h].py.toString()):o.concat(t[0].poly[0].Element[h].py.toString(),",");a.x=t[0].width/2,a.y=t[0].height/2,a.points=o}a.restitution=1}}return this.sp.addChild(i),i}DestroyStone(t){if(null!=t){let i=t.getComponents(Laya.ColliderBase);if(null!=i)for(let t=0;t<i.length;++t)null!=i[t]&&i[t].destroy();t.destroy()}}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),GI.timerMgr.loop(this.delay,this,this.createStone,null,!1,!1)}}class lt extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner;let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic");let i=this.sp.getComponent(Laya.CircleCollider);null!=i&&(i.density=this.density||.3)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class dt extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.pivot(this.sp.width/2,0),this.sp.rotation=0,this.rigi=this.sp.getComponent(Laya.RigidBody),null!=this.rigi&&(this.rigi.type="static")}f1(){GI.Tween.to(this.sp,{rotation:-15},this.duration,null,Laya.Handler.create(this,this.f2),0,!1,!1)}f2(){GI.Tween.to(this.sp,{rotation:15},this.duration,null,Laya.Handler.create(this,this.f1),0,!1,!1)}initData(t){super.initData(t),this.f1()}}class gt extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.pivot(.38*this.sp.width,.35*this.sp.height)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class ut extends S{constructor(){super(...arguments),this._contact={role:!0}}setFootContact(t){this._contact.left=this._contact.right=t}setRoleContact(t){this._contact.role=t}setAllContact(){this.setFootContact(!0),this.setRoleContact(!0)}AwakeItem(){super.AwakeItem(),this.setAllContact(),this.sp=this.owner;let t=this.sp.getComponent(Laya.PolygonCollider);null!=t&&(t.label="0",t.isSensor=!0)}onTriggerEnter(t){if(this._contact[t.label]){let t=this.forceX||100,i=this.forceY||100;GI.gMsgCet.event("wm.waterForce",{x:t,y:i})}}onTriggerExit(t){}initData(t){super.initData(t)}}class ct extends S{AwakeItem(){if(super.AwakeItem(),this.sp=this.owner,this.sp.pivot(this.sp.width/2,this.sp.height/2),this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid?(this.rigid.type="kinematic",this.rigid.allowSleep=!1):(this.rigid=this.sp.addComponent(Laya.RigidBody),this.rigid.type="kinematic",this.rigid.allowSleep=!1),this.coll=this.sp.getComponents(Laya.ColliderBase),null!=this.coll)for(let t=0;t<this.coll.length;t++)null!=this.coll[t]&&(this.coll[t].restitution=0)}func(){this.rigid.angularVelocity=.2}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.time=this.duration||3e4}}class pt extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.rigi=this.sp.getComponent(Laya.RigidBody),null!=this.rigi&&(this.rigi.type="dynamic"),this.preRigi=this.sp.parent.getComponent(Laya.RigidBody);let t=this.sp.parent.addComponent(Laya.BoxCollider);null!=t&&(t.width=this.sp.parent.width,t.height=this.sp.parent.height),this.isForce=!1,this.func()}func(){this.joint=new Laya.RevoluteJoint,this.joint.otherBody=this.preRigi,this.joint.anchor=[this.sp.width/2,this.sp.height/2],this.joint.enableMotor=!0,this.joint.motorSpeed=5,this.joint.maxMotorTorque=1e3,this.sp.addComponentIntance(this.joint)}ClearForces(t){if(null==t)return;let i=t.body;i.m_force.SetZero(),i.m_angularVelocity=0,i.m_I=0}f2(){this.sp.rotation>=15&&(this.isForce||(this.ClearForces(this.rigi),this.isForce=!0,this.joint.motorSpeed=-5)),this.sp.rotation<=-15&&this.isForce&&(this.ClearForces(this.rigi),this.isForce=!1,this.joint.motorSpeed=5)}onUpdate(){this.f2()}initData(t){super.initData(t),this.time=this.duration||3e4,null==this.sp?this.AwakeItem():this.func()}}class mt extends S{constructor(){super(...arguments),this.buoyancyNum=100,this.buoyancy=20}AwakeItem(){let t;super.AwakeItem(),this.sp=this.owner,this.flY=this.sp.y,this.boxc=this.sp.getComponent(Laya.BoxCollider),null!=this.boxc&&this.boxc.destroy(),this.rigi=this.sp.getComponent(Laya.RigidBody),null!=this.rigi&&this.rigi.destroy(),this.hineHeadList=[];let i=0;for(i=1;i<this.getCount();i++){let e=new Laya.Sprite;this.sp.parent.addChild(e),this.hineHeadList.push(e),e.pos(this.sp.x+20*i,this.sp.y);let s=new Laya.RigidBody;s.linearDamping=3,e.addComponentIntance(s);let r=new Laya.BoxCollider;if(r.width=20,r.height=this.sp.height,r.y=5,r.density=2,e.addComponentIntance(r),null!=t){let i=new Laya.WeldJoint;i.otherBody=t,i.anchor=[20,this.sp.height],i.frequency=10,i.collideConnected=!0,e.addComponentIntance(i);let s=new Laya.RevoluteJoint;s.otherBody=t,s.anchor=[20,0],s.collideConnected=!0,e.addComponentIntance(s)}t=s}this.hineHeadList[Math.floor(this.getCount()/2)].addChild(this.sp),this.sp.x=-this.sp.width/2,this.sp.y=0}OnSetRoleBuoyancy(t){let i=t.getComponent(Laya.RigidBody);if(null!=t&&t.y>=this.flY){let e=t.y-this.flY,s=(e=e>this.buoyancyNum?this.buoyancyNum:e)/this.buoyancyNum*this.buoyancy+10;null!=i&&i.applyForceToCenter({x:0,y:-s*i.body.GetMass()})}else null!=i&&i.applyForceToCenter({x:0,y:-9*i.body.GetMass()})}onUpdate(){for(let t=0;t<this.hineHeadList.length;t++)this.OnSetRoleBuoyancy(this.hineHeadList[t])}getCount(){return this.sp.width/20-1}}class yt extends S{constructor(){super(...arguments),this.ti=0}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.pivot(0,0)}forwardFunc(){this.isH?GI.Tween.to(this.sp,{x:this.to},this.duration,null,Laya.Handler.create(this,this.backFunc),0,!1,!1):GI.Tween.to(this.sp,{y:this.to},this.duration,null,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){this.isH?GI.Tween.to(this.sp,{x:this.from},this.duration,null,Laya.Handler.create(this,this.startTween),0,!1,!1):GI.Tween.to(this.sp,{y:this.from},this.duration,null,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTween(){GI.timerMgr.once(this.delay,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.startTween()}}class ft extends Laya.Script{onAwake(){super.onAwake(),this.sp=this.owner;this.sp.getComponent(Laya.RigidBody);let t=this.sp.getComponent(Laya.BoxCollider);null!=t&&(t.y=70,t.isSensor=!0)}}class It extends S{AwakeItem(){if(super.AwakeItem(),this.sp=this.owner,this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid){this.rigid.type="kinematic",this.sp.getComponent(Laya.ColliderBase).density=100,this.rigid.allowSleep=!1}let t=this.sp.getComponent(Laya.BoxCollider);null!=t&&(t.y=20),GI.gMsgCet.on("PushBridge",this,this.onRiseUp)}onRiseUp(t){if(null!=this.rigid&&this.typeParam==t){let t=this.forceY||4;this.rigid.body.m_linearVelocity.y=-t,GI.timerMgr.once(this.duration,this,this.clearVelocity)}else if(null!=this.rigid&&this.typeParam==t){let t=this.forceY||4;this.rigid.body.m_linearVelocity.y=-t,GI.timerMgr.once(this.duration,this,this.clearVelocity)}else if(null!=this.rigid&&this.typeParam==t){let t=this.forceY||4;this.rigid.body.m_linearVelocity.y=-t,GI.timerMgr.once(this.duration,this,this.clearVelocity)}else if(null!=this.rigid&&this.typeParam==t){let t=this.forceY||4;this.rigid.body.m_linearVelocity.y=-t,GI.timerMgr.once(this.duration,this,this.clearVelocity)}}clearVelocity(){this.rigid.body.m_linearVelocity.y=0}onDestroy(){super.onDestroy(),GI.gMsgCet.off("PushBridge",this,this.onRiseUp)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class Ct extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner;let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic");let i=this.sp.getComponent(Laya.PolygonCollider);null!=i&&(i.restitution=0,i.density=this.density||3),GI.timerMgr.once(1500,this,this.DestroyStone,[this.sp],!1)}DestroyStone(t){if(null!=t){let i=t.getComponents(Laya.ColliderBase);if(null!=i)for(let t=0;t<i.length;++t)null!=i[t]&&i[t].destroy();t.destroy()}}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class wt extends S{constructor(){super(...arguments),this.ti=0}AwakeItem(){super.AwakeItem(),this.sp=this.owner,this.sp.pivot(0,0)}forwardFunc(){this.isH?GI.Tween.to(this.sp,{x:this.to},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.backFunc),0,!1,!1):GI.Tween.to(this.sp,{y:this.to},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.backFunc),0,!1,!1)}backFunc(){this.isH?GI.Tween.to(this.sp,{x:this.from},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.startTween),0,!1,!1):GI.Tween.to(this.sp,{y:this.from},this.duration,Laya.Ease.quartIn,Laya.Handler.create(this,this.startTween),0,!1,!1)}startTween(){GI.timerMgr.once(this.delay,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem(),this.startTween()}}class bt extends Laya.Script{constructor(){super(...arguments),this.ti=0,this.duration=2}onEnable(){}onAwake(){if(super.onAwake(),this.sp=this.owner,this.from=this.sp.y+5,this.to=this.sp.y+this.sp.height/2,this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid){this.rigid.type="kinematic",this.sp.getComponent(Laya.ColliderBase).density=100,this.rigid.allowSleep=!1}let t=this.sp.getComponent(Laya.PolygonCollider);null!=t&&(t.restitution=0),this.onFrame(),this.startTween()}onFrame(){"fast"==Laya.stage.frameRate?this.frame=60:"slow"==Laya.stage.frameRate&&(this.frame=30),this.ratio=60/this.frame}GetUpLinearVelocity(){return((this.to-this.from)/(this.duration*this.frame)).toFixed(1)}GetDownLinearVelocity(){return((this.from-this.to)/(this.duration*this.frame)).toFixed(1)}forwardFunc(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.y=this.GetUpLinearVelocity(),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.backTween))}backTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.backFunc)}backFunc(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.y=this.GetDownLinearVelocity(),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.startTween))}startTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.forwardFunc)}}class Rt extends S{constructor(){super(...arguments),this.ti=0,this.duration=2}onEnable(){}AwakeItem(){if(super.AwakeItem(),this.sp=this.owner,this.rigid=this.sp.getComponent(Laya.RigidBody),null!=this.rigid){this.rigid.type="kinematic",this.sp.getComponent(Laya.ColliderBase).density=100,this.rigid.allowSleep=!1}let t=this.sp.getComponent(Laya.PolygonCollider);null!=t&&(t.restitution=0),this.onFrame(),this.startTween()}onFrame(){"fast"==Laya.stage.frameRate?this.frame=60:"slow"==Laya.stage.frameRate&&(this.frame=30),this.ratio=60/this.frame}GetUpLinearVelocity(){return((this.to-this.from)/(this.duration*this.frame)).toFixed(1)}GetDownLinearVelocity(){return((this.from-this.to)/(this.duration*this.frame)).toFixed(1)}forwardFunc(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=this.GetUpLinearVelocity(),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.backTween))}backTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.backFunc)}backFunc(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=this.GetDownLinearVelocity(),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.startTween))}startTween(){null!=this.rigid&&(this.rigid.body.m_linearVelocity.x=0,this.rigid.body.m_linearVelocity.y=0),GI.timerMgr.frameOnce(this.duration*this.frame,this,this.forwardFunc)}initData(t){super.initData(t),null==this.sp&&this.AwakeItem()}}class Lt extends Laya.Script{constructor(){super(...arguments),this.ti=0}onEnable(){}onAwake(){super.onAwake(),this.sp=this.owner;let t=new Laya.Point(this.sp.x,this.sp.y),i=this.sp.localToGlobal(t,!1,Xi.i.mapCtrl.sceneItem);Xi.i.mapCtrl.topMoreRole.addChild(this.sp),this.sp.x=i.x-this.sp.x,this.sp.y=i.y-this.sp.y}}class Gt extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner,GI.log("------------onawarreraewra"),this.rigiType(),this.boxType()}rigiType(){this.rigi=this.sp.getComponent(Laya.RigidBody),this.rigi}boxType(){this.box=this.sp.getComponent(Laya.BoxCollider),null!=this.box&&(this.box.friction=0)}}class St extends S{AwakeItem(){super.AwakeItem(),this.sp=this.owner;let t=this.sp.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic"),this.col=this.sp.getComponent(Laya.ColliderBase),null!=this.col&&(this.col.restitution=0)}initData(t){super.initData(t),null==this.sp&&(this.AwakeItem(),this.col.density=this.density||3)}}class xt extends S{onAwake(){super.onAwake(),this.sp=this.owner,this.sp.scaleX=-1;let t=this.sp.getComponent(Laya.ColliderBase);null!=t&&(t.restitution=0)}}class Mt extends rt{constructor(){super(...arguments),this.BombForce=12,this.isBomb=!1}AwakeItem(){super.AwakeItem(),this.sp.on("Rigid.PostSolve",this,this.OnTriggerEnter)}OnTriggerEnter(t,i,e,s){if(s.normalImpulses[0]>10||s.normalImpulses[1]>10){let t=Laya.Point.create();t.setTo(s.normalImpulses[0],s.normalImpulses[1]),t.distance(0,0)>30&&(this.DetonatedBomb(),this.sp.alpha=0,GI.timerMgr.frameOnce(2,this,()=>{this.RemoveItem()}))}}BombSkill(){let t=this.sp.localToGlobal(Laya.Point.create(),!1,GI.sceneMgr.worldRoot),i=this.propCfg.hit_eff;console.log("========================================="+i),GI.gMsgCet.event("ab.PlayEffect",[i,t.x,t.y,this.sp.rotation,0,0])}OnBoomerang(t){this.DetonatedBomb()}MustDie(){this.DetonatedBomb()}RemoveItem(){this.BombSkill(),0==this.isBomb&&this.DetonatedBomb(),super.RemoveItem()}DetonatedBomb(){if(this.isBomb)return;this.isBomb=!0;for(var t=this.sp.getComponent(Laya.RigidBody).body.GetWorldCenter(),i=new Laya.Physics.I.box2d.b2Vec2,e=new Laya.Physics.I.box2d.b2Vec2,s=0;s<=100;s++){var r=3.6*s,a=new Laya.Physics.I.box2d.b2RayCastInput;a.p1=t,a.p2.Set(t.x+5*Math.cos(r),t.y+5*Math.sin(r)),a.maxFraction=1;for(var o=new Laya.Physics.I.box2d.b2RayCastOutput,h=Laya.Physics.I.world.GetBodyList();h;h=h.GetNext()){var n=h.GetFixtureList();if(n)if(n.RayCast(o,a)){i.Copy(a.p1),e.Copy(a.p2),e.SelfSub(i),e.SelfMul(o.fraction),i.SelfAdd(e);var l=new Laya.Physics.I.box2d.b2Vec2;l.Copy(i),l.SelfSub(t);let s=new Laya.Physics.I.box2d.b2Vec2(l.x*(1-o.fraction)*this.BombForce,l.y*(1-o.fraction)*this.BombForce);if(null!=n.collider&&null!=n.collider.owner){let t=n.collider.owner.getComponent(rt);null!=t&&t.OnBoomerang(s.x+s.y)}h.ApplyLinearImpulseToCenter(s)}}}}}class _t extends Laya.Script{onAwake(){super.onAwake(),this.sp=this.owner;let t=new Laya.Point(this.sp.x,this.sp.y);Xi.i.data.tagPos=t}}class vt extends S{onAwake(){super.onAwake(),this.sp=this.owner,this.boxType()}boxType(){let t=this.sp.getComponents(Laya.ColliderBase);for(let i=0;i<t.length;i++)t[i].restitution=0}}class Pt{registerComp(){R.regComp("BlockItem",b),R.regComp("StepTriggerItem",v),R.regComp("FinishTriggerItem",M),R.regComp("StepFlagItem",G),R.regComp("FireItem",P),R.regComp("LinkageItem",B),R.regComp("BridgeItem",D),R.regComp("TranslateItem",T),R.regComp("StickItem",A),R.regComp("UpDownItem",k),R.regComp("FinishFlagItem",_),R.regComp("MidStepFlagItem",E),R.regComp("MidStepTriggerItem",V),R.regComp("FootFinishTriggerItem",U),R.regComp("FootStepTriggerItem",O),R.regComp("FootMidStepTriggerItem",N),R.regComp("PlateItem",F),R.regComp("PushItem",H),R.regComp("RiseUpItem",J),R.regComp("RigiItem",Y),R.regComp("PushDownItem",W),R.regComp("BeeAni",j),R.regComp("RigiStaticItem",z),R.regComp("MovementItem",q),R.regComp("CoinAniItem",Q),R.regComp("LevelName",K),R.regComp("MidCoinAniItem",Z),R.regComp("SpringItem",$),R.regComp("LevelNameO",tt),R.regComp("FlowerItem",it),R.regComp("NotVisiableItem",et),R.regComp("RiverItem",st),R.regComp("PigItem",at),R.regComp("WindItem",ot),R.regComp("HammerItem",ht),R.regComp("FallRockItem",nt),R.regComp("BallItem",lt),R.regComp("SwingItem",dt),R.regComp("SprayItem",gt),R.regComp("WaterForceItem",ut),R.regComp("RollItem",ct),R.regComp("WoodrowItem",pt),R.regComp("WaterBuoyancy",mt),R.regComp("MoveItem",yt),R.regComp("FrontRiverItem",ft),R.regComp("TriggerRiseItem",It),R.regComp("FallStoneItem",Ct),R.regComp("FireMoveItem",wt),R.regComp("UpDownItemRigid",bt),R.regComp("TranslateItemRigid",Rt),R.regComp("TopItem",Lt),R.regComp("NotFriction",Gt),R.regComp("DynamicItem",St),R.regComp("PropItem",rt),R.regComp("FIipxItem",xt),R.regComp("TntBombItem",Mt),R.regComp("TagPosItem",_t),R.regComp("NoRestitutionItem",vt)}}class Bt extends Laya.Script{initParam(t,i,e,s,r){}}let Dt={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class Tt extends Bt{initParam(t,i,e,s,r){super.initParam(t,i,e,s,r);let a=t;this.addMapComp(a,i,e)}addMapComp(t,i,e){if(t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height,t.skin="sceneObj".concat(e.pa.concat(".png")),t.sizeGrid=e.sizeGrid,1==e.rigiBody){t.addComponent(Laya.RigidBody).type="static"}if(null!=i.box){let e=t.addComponent(Laya.BoxCollider);null!=e&&(e.width=i.box.width,e.height=i.box.height,e.label=i.collisionType.toString()),i.boxCentereChange&&i.layer==Dt.visionBg&&(e.y=i.height-25),i.colArea&&i.layer==Dt.visionBg&&(e.label="Ground")}}}let At={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class kt extends Bt{initParam(t,i,e,s,r){super.initParam(t,i,e,s,r),this.addMapComp(t,i,e,!1,!0)}addMapComp(t,i,e,s,r){if(r){let t=new Laya.Skeleton;if(Xi.i.mapCtrl.sceneItem.addChild(t),t.pos(i.x,i.y),t.load("sceneObj".concat(e.pa.concat(".sk"))),1==e.rigiBody){t.addComponent(Laya.RigidBody),t.getComponent(Laya.RigidBody).type="static"}if(null!=i.box){t.addComponent(Laya.BoxCollider);let e=t.getComponent(Laya.BoxCollider);e.width=i.box.width,e.height=i.box.height,e.label=i.collisionType.toString(),(i.colArea&&i.layer==At.sceneItem||i.layer==At.frontLayer)&&(e.isSensor=!0,e.restitution=1),i.hurt&&(e.label="Hurt")}if(null!=i&&null!=i.comName){let e=t.addComponent(R.getComp(i.comName));e instanceof S&&(GI.log("------------getComp0000  "),null!=i.data&&e.initData(i.data))}Xi.i.mapCtrl.AddObjectToLayer(t,i.layer,!1,!0)}}}class Et extends Bt{initParam(t,i,e,s,r,a=null){super.initParam(t,i,e,s,r),this.addMapComp(t,i,e,a)}addMapComp(t,i,e,s){if(e.seqAni){let r="sceneObj".concat(e.pa.concat(".json")),a=s;GI.resMgr.load(r,Laya.Handler.create(this,function(e){let s=new Laya.Prefab;s.json=e;let r=Laya.Pool.getItemByCreateFun(this.itemJson[i.idx][a].idx,s.create,s);if(r.pos(this.itemJson[i.idx][a].x,this.itemJson[i.idx][a].y),r.wrapMode=2,r.play(),""!=this.itemJson[i.idx][a].cname){let t=r.addComponent(R.getComp(this.itemJson[i.idx][a].cname));if(t instanceof S){let e=this.getCustomData(i.sItem,this.itemJson[i.idx][a].idx);null!=e&&t.initData(e)}}t.addChild(r)}))}}}class Vt{constructor(t,i){this.x=t,this.y=i}}let Ut={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class Ot extends Bt{initParam(t,i,e,s,r){super.initParam(t,i,e,s,r),this.addMapComp(t,i,e,s,r)}addMapComp(t,i,e,s,r){let a=new Laya.Sprite;if(a.x=e.x,a.y=e.y,a.width=e.width,a.height=e.height,a.pivot(0,0),null!=e.pa&&a.loadImage("sceneObj".concat(e.pa.concat(".png"))),0!=e.vaRotate&&(a.rotation=360-e.vaRotate),e.colArea&&e.born){let i=e.x+t.x,s=Math.abs(e.y)+t.y-20,r=new Vt(i,s);Xi.i.mapCtrl.setCurStepPos(r)}else if(e.born){let t=new Vt(i.x+e.x,i.y+600);Xi.i.mapCtrl.setCurStepPos(t)}if(1==e.rigiBody&&Xi.i.mapCtrl.addRigiBody(a,e,i,!0,!1,!1),null!=e.box){let t=a.addComponent(Laya.BoxCollider);t.width=e.box.width,t.height=e.box.height,e.boxCentereChange&&e.layer==Ut.backGround?t.y=e.height-25:e.boxCentereChange&&e.layer==Ut.frontLayer?t.y=-e.box.height+e.height:e.boxCentereChange&&e.layer==Ut.sceneItem&&(t.y=-e.box.height+e.height),t.label=e.collisionType.toString(),e.colArea&&e.layer==Ut.visionBg?t.label="Ground":(e.colArea&&e.layer==Ut.sceneItem||e.layer==Ut.frontLayer)&&(t.isSensor=!0,t.restitution=1),e.hurt&&(t.label="Hurt")}if(0!=e.radius){let t=a.addComponent(Laya.CircleCollider);if(null!=t&&(t.radius=e.height/2,1==e.rigiBody)){let t=a.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic")}}if(null!=e&&""!=e.cname){let t=a.addComponent(R.getComp(e.cname));if(t instanceof S){let s=Xi.i.mapCtrl.getCustomData(i.sItem,e.idx);null!=s&&t.initData(s)}}for(let t=0;t<e.poly.length;t++){let i=a.addComponent(Laya.PolygonCollider),s="",r=e.poly[t].Element.length;if(r<8){let a=0;for(a=0;a<r;a++)s=s.concat(e.poly[t].Element[a].px.toString(),","),s=a==r-1?s.concat(e.poly[t].Element[a].py.toString()):s.concat(e.poly[t].Element[a].py.toString(),",");i.points=s,i.restitution=1}else{let r=0;for(r=0;r<8;r++)s=s.concat(e.poly[t].Element[r].px.toString(),","),s=7==r?s.concat(e.poly[t].Element[r].py.toString()):s.concat(e.poly[t].Element[r].py.toString(),",");i.x=e.width/2,i.points=s,i.restitution=1;let o=a.addComponent(Laya.PolygonCollider),h="",n=-1,l=e.poly[t].Element.length,d=l-1;if(l>8){for(n=8;n<l;n++)h=h.concat(e.poly[t].Element[n].px.toString(),","),h=n==d?h.concat(e.poly[t].Element[n].py.toString()):h.concat(e.poly[t].Element[n].py.toString(),",");o.x=e.width/2,o.y=e.height/2,o.points=h}o.restitution=1}}t.addChild(a)}}let Nt={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class Ft extends Bt{initParam(t,i,e,s,r){super.initParam(t,i,e,s,r),this.addMapComp(t,i,e,s,r)}addMapComp(t,i,e,s,r){r&&(t=t);let a=t.getComponent(Laya.BoxCollider);null!=a||(a=t.addComponent(Laya.BoxCollider)),null!=i&&null!=i.box&&(a.width=i.box.width,a.height=i.box.height,a.y=i.box.centerY-i.box.height/2),r&&(a.width=e.box.width,a.height=e.box.height,a.y=-e.box.height,a.x=-e.box.width/2),a.label=e.collisionType.toString(),e.colArea&&e.layer==Nt.visionBg?a.label="Ground":(e.colArea&&e.layer==Nt.sceneItem||e.layer==Nt.frontLayer)&&(a.isSensor=!0,a.restitution=1),null!=i&&i.hurt&&(a.label="Hurt")}}class Ht extends Laya.Script{getCls(t){if("itemJson.sudoku"==t){return new Tt}if("itemJson.spine"==t){return new kt}if("itemJson.seqAni"==t){return new Et}if("sprite"==t){return new Ot}if("itemJson.box"==t){return new Ft}}}class Jt{constructor(){this._kParent=null,this._arrURLs=[],this._templetMap=new Map,this._effArray=[]}Init(t){this._kParent=t,GI.gMsgCet.on("ab.PlayEffect",this,this.onPlayEffect),GI.timerMgr.frameLoop(1,this,this.onUpdate)}onUpdate(){for(let t=0;t<this._effArray.length;++t){let i=Laya.Pool.getItem(this._effArray[t].url),e=!1;if(null!=i)e=!0;else if(this._templetMap.has(this._effArray[t].url)){i=this._templetMap.get(this._effArray[t].url).buildArmature(0),e=!0}e&&(this.activeEffect(i,this._effArray[t].posX,this._effArray[t].posY,this._effArray[t].rotation,this._effArray[t].scaleX,this._effArray[t].scaleY),this._effArray.splice(t,1))}}onPlayEffect(t,i,e,s,r=1,a=1){if(null!=t&&(-1==this._arrURLs.indexOf(t)&&this._arrURLs.push(t),this._effArray.push({url:t,posX:i,posY:e,rotation:s,scaleX:r,scaleY:a}),!this._templetMap.has(t))){let i=new Laya.Templet;i.on(Laya.Event.COMPLETE,this,this.parseComplete,[t,i]),i.on(Laya.Event.ERROR,this,this.onError),i.loadAni(t)}}onError(){console.log("EffectControl parse error")}parseComplete(t,i){null!=i&&(this._templetMap.has(t)?(i.destroy(),i=null):this._templetMap.set(t,i))}activeEffect(t,i,e,s,r,a){this._kParent.addChild(t),t.x=i,t.y=e,t.rotation=s,t.scaleX=r,t.scaleY=a,t.play(0,!1),t.on(Laya.Event.STOPPED,this,this.recoverEffect,[t])}recoverEffect(t){t&&(this._kParent.removeChild(t),Laya.Pool.recover(t.url,t),t=null)}clear(){for(let t=0;t<this._arrURLs.length;++t)Laya.Pool.clearBySign(this._arrURLs[t]);this._arrURLs=[],this._templetMap.forEach(t=>{t.destroy()}),this._templetMap.clear(),this._effArray=[],GI.timerMgr.clear(this,this.onUpdate)}}class Xt{constructor(){this._isDebug=!1}Init(){GI.gMsgCet.on("AB.BirdSound",this,this.onPlayBirdSound),GI.gMsgCet.on("AB.RigidItem",this,this.onPlayRigidItemSound),GI.gMsgCet.on("AB.SoundEvent",this,this.onPlaySoundEvent),this._isDebug&&Laya.stage.on(Laya.Event.KEY_DOWN,this,this.onKeyDown)}onKeyDown(t){t.keyCode==Laya.Keyboard.P&&GI.gMsgCet.event("AB.BirdSound",[1,1])}clear(){}onPlayBirdSound(t,i){this._isDebug&&GI.log("播放鸟相关音效type: "+t.toString()+",id: "+i.toString());let e=this.getURL(Xi.i.data.soundsCfg.modules,t,i);this.onPlaySound(e)}onPlaySoundEvent(t,i=1){this._isDebug&&GI.log("播放事件相关音效type: "+t.toString()+",id: "+i.toString());let e=this.getURL(Xi.i.data.soundsCfg.events,t,i);this.onPlaySound(e)}onPlayRigidItemSound(t,i){this._isDebug&&GI.log("播放物理物体相关音效type: "+t.toString()+",id: "+i.toString());let e=this.getURL(Xi.i.data.soundsCfg.modules,t,i);this.onPlaySound(e)}getURL(t,i,e){let s=null;for(let r=0;r<t.length;++r)if(t[r].id==i)for(let i=0;i<t[r].sounds.length;++i)if(t[r].sounds[i].id==e){s=t[r].sounds[i].url;break}return s}onPlaySound(t){null!=t?"null"!=t?GI.soundMgr.playSound(t):GI.log("not provide the sound"):GI.log("Can find the sound url")}}class Yt{constructor(t,i){this.x=t,this.y=i}}var Wt={};let jt={backGround:1,sceneItem:2,frontLayer:3,visionBg:4,topLayer:5};class zt{constructor(){this._effectControl=new Jt,this._soundControl=new Xt,this._mapAddMgr=new Ht,this._initComp=new Pt,this.stepPos=new Array,this.launcherPos=new Yt(230,625),this.bornSpr=new Array,this.visionBgx=0,this._cheerRoles=[]}get mapAddMgr(){return this._mapAddMgr}get initComp(){return this._initComp}initSceneItem(t){this.itemInitEndCall=t,this.initMap()}initMap(){GI.resMgr.load("res/map/mapCfg.json",GI.handle(this,t=>{this.mapConfig=t;for(const t in this.mapConfig.mapCfg){let i,e=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Bg,s=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Si,r=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Fr,a=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Ci,o=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Po,h=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Re,n=this.mapConfig[this.mapConfig.mapCfg[t].Folder].Mp;i=null!=this.mapConfig.mapCfg[t].dataPath?this.mapConfig.mapCfg[t].dataPath:"res/map/level".concat(t.toString()).concat(".json"),Wt[t]={dataPath:i,backGround:e,sceneItem:s,frontLayer:r,circle:a,polygon:o,rectangle:h,map:n,minX:this.mapConfig.mapCfg[t].minX,maxX:this.mapConfig.mapCfg[t].maxX,minY:this.mapConfig.mapCfg[t].minY,maxY:this.mapConfig.mapCfg[t].maxY,initScale:this.mapConfig.mapCfg[t].initScale,minScale:this.mapConfig.mapCfg[t].minScale}}this.onSceneItemLoad()}))}onSceneItemLoad(){null!=this.itemInitEndCall&&(this.itemInitEndCall.run(),this.itemInitEndCall.recover(),this.itemInitEndCall=null)}initlizeComp(){this.initComp.registerComp()}onInitLevelMap(){let t=Xi.i.data.getCurMapLvl();rt.RigidIdx=0,GI.prgMgr.load([{url:Wt[t].dataPath,type:Laya.Loader.JSON},{url:Wt[t].backGround,type:Laya.Loader.ATLAS},{url:Wt[t].sceneItem,type:Laya.Loader.ATLAS},{url:Wt[t].frontLayer,type:Laya.Loader.ATLAS},{url:Wt[t].circle,type:Laya.Loader.ATLAS},{url:Wt[t].polygon,type:Laya.Loader.ATLAS},{url:Wt[t].rectangle,type:Laya.Loader.ATLAS},{url:Wt[t].map,type:Laya.Loader.ATLAS}],Laya.Handler.create(this,this.onSpriteLoaded)),this._effectControl.Init(GI.sceneMgr.worldRoot),this._soundControl.Init()}changeMap(t){this.mapInitEndCall=t,this.clearScene(),this.onInitLevelMap(),GI.gMsgCet.on("wmCtrl.ROLE_DEATH",this,this.onFailMsg)}clearScene(){this.clearCheerRoles(),this.ClearMapObj(),this.clearStepPos(),this.clearBornSpr(),this._effectControl.clear(),this._soundControl.clear(),Xi.i.data.clearBirdPos(),Xi.i.data.clearOffsetPos()}onRoleLoaded(){null!=this.mapInitEndCall&&(this.mapInitEndCall.run(),this.mapInitEndCall.recover(),this.mapInitEndCall=null)}onParseMap(t,i){if(t.isObj){let e=new Laya.Sprite;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e.pivot(0,0),this.AddObjectToLayer(e,t.layer,!1,!1),this.onParseMapItem(t,e,i),this.addCompFunc(e,null,t,!0,!1)}else if(this.itemJson[t.idx][0].sudoku){let i=new Laya.Image;this.mapAddMgr.getCls("itemJson.sudoku").initParam(i,t,this.itemJson[t.idx][0],!1,!1),this.AddObjectToLayer(i,t.layer,!0,!1)}else if(this.itemJson[t.idx][0].spine){this.mapAddMgr.getCls("itemJson.spine").initParam(null,t,this.itemJson[t.idx][0],!1,!0)}else this.itemJson[t.idx][0].seqAni?this.seqAniGenerate(t):this.spriteGenerate(t,null,null)}onParseMapJsonItem(t,i,e,s){if(t.sudoku){let i=new Laya.Image;if(i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,i.pivot(0,0),null!=t.pa&&(i.skin="sceneObj".concat(t.pa.concat(".png"))),i.sizeGrid=t.sizeGrid,this.addRigiBody(i,t,null,!1,!1,!0),null!=t.box){i.addComponent(Laya.BoxCollider);let e=i.getComponent(Laya.BoxCollider);null!=e&&(e.width=t.box.width,e.height=t.box.height,e.label=t.collisionType.toString()),t.boxCentereChange&&t.layer==jt.visionBg&&(e.y=t.height-25),t.colArea&&t.layer==jt.visionBg&&(e.label="Ground")}e.addChild(i)}else if(t.spine)this.addSkeleton(e,i,t);else if(t.seqAni)this.addSeqAni(e,i,t,s);else{this.mapAddMgr.getCls("sprite").initParam(e,i,t,!1,!1)}this.addRigiBody(e,null,i,!0,!1,!1),i.poly.length>0&&null==e.getComponent(Laya.PolygonCollider)&&this.addPolyCollider(e,i),null!=i.box&&this.addBox(e,i,t,!0,!1)}onParseMapItem(t,i,e){let s;for(s=0;s<this.itemJson[t.idx].length;s++)this.onParseMapJsonItem(this.itemJson[t.idx][s],t,i,s)}addSkeleton(t,i,e){if(e.spine){let s=new Laya.Skeleton,r=e.x,a=e.y;s.pos(r,a),s.load("sceneObj".concat(e.pa.concat(".sk"))),this.addRigiBody(s,e,null,!1,!0,!1),null!=e.box&&this.addBox(s,i,e,!1,!0),this.addCompFunc(s,e,i,!1,!0),t.addChild(s)}}addSeqAni(t,i,e,s){if(e.seqAni){let r="sceneObj".concat(e.pa.concat(".json")),a=s;GI.resMgr.load(r,Laya.Handler.create(this,function(e){let s=new Laya.Prefab;s.json=e;let r=Laya.Pool.getItemByCreateFun(this.itemJson[i.idx][a].idx,s.create,s);if(r.pos(this.itemJson[i.idx][a].x,this.itemJson[i.idx][a].y),r.wrapMode=2,r.play(),""!=this.itemJson[i.idx][a].cname){let t=r.addComponent(R.getComp(this.itemJson[i.idx][a].cname));if(t instanceof S){let e=this.getCustomData(i.sItem,this.itemJson[i.idx][a].idx);null!=e&&t.initData(e)}}t.addChild(r)}))}}addBox(t,i,e,s,r){r&&(t=t);let a=t.getComponent(Laya.BoxCollider);null!=a||(a=t.addComponent(Laya.BoxCollider)),null!=i&&null!=i.box&&(a.width=i.box.width,a.height=i.box.height,a.y=i.box.centerY-i.box.height/2),r&&(a.width=e.box.width,a.height=e.box.height,a.y=-e.box.height,a.x=-e.box.width/2),a.label=e.collisionType.toString(),e.colArea&&e.layer==jt.visionBg?a.label="Ground":(e.colArea&&e.layer==jt.sceneItem||e.layer==jt.frontLayer)&&(a.isSensor=!0,a.restitution=1),null!=i&&i.hurt&&(a.label="Hurt"),null!=e&&e.hurt&&(a.label="Hurt")}addCompFunc(t,i,e,s,r){if(r&&(t=t),null!=e&&null!=e.comName){let i=t.addComponent(R.getComp(e.comName));i instanceof S&&null!=e.data&&i.initData(e.data)}if(null!=i&&""!=i.cname){let s=t.addComponent(R.getComp(i.cname));if(s instanceof S){let t=this.getCustomData(e.sItem,i.idx);null!=t&&s.initData(t)}}}onSpriteLoaded(){var t=GI.resMgr.getRes(Wt[Xi.i.data.getCurMapLvl()].dataPath);this.itemJson=GI.resMgr.getRes("res/map/item.json");for(let i in t)this.onParseMap(t[i],null);this.onRoleLoaded()}getCustomData(t,i){let e;for(e=0;e<t.length;e++)if(t[e].idx==i)return t[e].data;return null}addPolyCollider(t,i){if(null!=t){let e=0;for(e=0;e<i.poly.length;e++){let s=t.addComponent(Laya.PolygonCollider),r="",a=i.poly[e].Element.length;if(a<8){let t=0;for(t=0;t<a;t++)r=r.concat(i.poly[e].Element[t].px.toString(),","),r=t==a-1?r.concat(i.poly[e].Element[t].py.toString()):r.concat(i.poly[e].Element[t].py.toString(),",");s.points=r,s.restitution=1}else{let a=0;for(a=0;a<8;a++)r=r.concat(i.poly[e].Element[a].px.toString(),","),r=7==a?r.concat(i.poly[e].Element[a].py.toString()):r.concat(i.poly[e].Element[a].py.toString(),",");s.x=i.width/2,s.points=r,s.restitution=1;let o=t.addComponent(Laya.PolygonCollider),h="",n=-1,l=i.poly[e].Element.length,d=l-1;if(l>8){for(n=8;n<l;n++)h=h.concat(i.poly[e].Element[n].px.toString(),","),h=n==d?h.concat(i.poly[e].Element[n].py.toString()):h.concat(i.poly[e].Element[n].py.toString(),",");o.x=i.width/2,o.y=i.height/2,o.points=h}o.restitution=1}}}}addRigiBody(t,i,e,s,r,a){if(r&&(t=t),a&&(t=t),null!=i&&1==i.rigiBody){t.addComponent(Laya.RigidBody).type="static"}if(null!=e&&1==e.rigiBody&&null==t.getComponent(Laya.RigidBody)){t.addComponent(Laya.RigidBody).type="static"}}seqAniGenerate(t){let i="sceneObj".concat(this.itemJson[t.idx][0].pa.concat(".json"));GI.resMgr.load(i,Laya.Handler.create(this,function(i){let e=new Laya.Prefab;e.json=i;let s=Laya.Pool.getItemByCreateFun(t.idx,e.create,e);if(s.pos(t.x,t.y),s.wrapMode=2,s.play(),this.addAnimationToLayer(s,t.layer),""!=t.cname){s.addComponent(R.getComp(t.cname))}}))}spriteGenerate(t,i,e){if(t.offset&&(GI.log(" idx  "+t.idx+"mapJson X : "+t.x+" mapJson y: "+t.y),Xi.i.data.setOffsetPos(t.x,t.y)),t.backUpBirds)return void Xi.i.data.setCurBirdPos(t.x,t.y,t.birdType);let s=new Laya.Sprite;if(Xi.i.data.maxRightX=t.x,s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height,s.loadImage("sceneObj".concat(this.itemJson[t.idx][0].pa.concat(".png"))),""!=t.rotation&&(s.rotation=t.rotation-360),t.colArea&&t.born){let i=new Yt(t.x,t.y);this.setCurStepPos(i)}if(t.born){let i=new Yt(t.x,t.y-50);this.setCurStepPos(i)}if(t.born&&(Xi.i.data.groundY=t.y),1==this.itemJson[t.idx][0].rigiBody){s.addComponent(Laya.RigidBody).type="static"}if(null!=t.box){s.addComponent(Laya.BoxCollider);let i=s.getComponent(Laya.BoxCollider);i.width=t.box.width,i.height=t.box.height,t.boxCentereChange&&t.layer==jt.backGround?i.y=t.height-25:t.boxCentereChange&&t.layer==jt.frontLayer?i.y=-t.box.height+t.height:t.boxCentereChange&&(t.layer,jt.sceneItem),i.label=t.collisionType.toString(),t.colArea&&t.layer==jt.visionBg?(i.label="Ground",i.isSensor=!0):(t.colArea&&t.layer==jt.sceneItem||t.layer==jt.frontLayer)&&(i.isSensor=!0,i.restitution=1),t.hurt&&(i.label="Hurt")}let r=0;for(r=0;r<t.poly.length;r++){let i=s.addComponent(Laya.PolygonCollider),e="",a=t.poly[r].Element.length;if(a<8){let s=0;for(s=0;s<a;s++)e=e.concat(t.poly[r].Element[s].px.toString(),","),e=s==a-1?e.concat(t.poly[r].Element[s].py.toString()):e.concat(t.poly[r].Element[s].py.toString(),",");i.points=e,i.restitution=1}else{let a=0;for(a=0;a<8;a++)e=e.concat(t.poly[r].Element[a].px.toString(),","),e=7==a?e.concat(t.poly[r].Element[a].py.toString()):e.concat(t.poly[r].Element[a].py.toString(),",");i.x=t.width/2,i.points=e,i.restitution=1;let o=s.addComponent(Laya.PolygonCollider),h="",n=-1,l=t.poly[r].Element.length,d=l-1;if(l>8){for(n=8;n<l;n++)h=h.concat(t.poly[r].Element[n].px.toString(),","),h=n==d?h.concat(t.poly[r].Element[n].py.toString()):h.concat(t.poly[r].Element[n].py.toString(),",");o.x=t.width/2,o.y=t.height/2,o.points=h}o.restitution=1}}if(t.radius){let i=s.addComponent(Laya.CircleCollider);if(null!=i&&(i.radius=t.height/2,1==this.itemJson[t.idx][0].rigiBody)){let t=s.getComponent(Laya.RigidBody);null!=t&&(t.type="dynamic")}}if(""!=t.cname){let i=s.addComponent(R.getComp(t.cname));i instanceof S&&null!=t.data&&i.initData(t.data)}null==i&&null==e?this.AddObjectToLayer(s,t.layer,!1,!1):i.addChild(s)}AddObjectToLayer(t,i,e,s){e&&(t=t),s&&(t=t),i==jt.visionBg?this.visionBg.addChild(t):i==jt.backGround?this.backGround.addChild(t):i==jt.sceneItem?this.sceneItem.addChild(t):i==jt.frontLayer?this.front.addChild(t):i==jt.topLayer&&this.topMoreRole.addChild(t)}onFailMsg(){Xi.i.onFail()}ClearMapObj(){this.recursiveClearLayer(this.backGround),this.recursiveClearLayer(this.sceneItem),this.recursiveClearLayer(this.front),this.recursiveClearLayer(this.visionBg),this.recursiveClearLayer(this.topMoreRole),GI.gMsgCet.off("wmCtrl.ROLE_DEATH",this,this.onFailMsg)}clearLayer(t){if(null!=t){let i=0;for(i=t.numChildren-1;i>=0;i--){let e=t.getChildAt(i);if(null!=e){let t=e.getComponents(Laya.ColliderBase);if(null!=t)for(let i=0;i<t.length;++i)null!=t[i]&&t[i].destroy();e.destroy()}}}}recursiveClearLayer(t){if(null!=t){let i=0;for(i=t.numChildren-1;i>=0;i--){let e=t.getChildAt(i);if(this.recursiveClearLayer(e),null!=e){let t=e.getComponents(Laya.ColliderBase);if(null!=t)for(let i=0;i<t.length;++i)null!=t[i]&&t[i].destroy();let i=e.getComponent(Laya.RevoluteJoint);null!=i&&i.destroy(),e.rotation=0,e.destroy()}}}}setCurBornSpr(t){this.bornSpr.push(t)}clearBornSpr(){for(;this.bornSpr.pop(););}setCurStepPos(t){this.stepPos.push(t)}clearStepPos(){for(;this.stepPos.pop(););}init(t){this.initlizeComp(),this.visionBg=new Laya.Sprite,this.backGround=new Laya.Sprite,this.sceneItem=new Laya.Sprite,null!=this.roleLayer&&(GI.sceneMgr.worldRoot.removeChild(this.roleLayer),this.roleLayer.destroy()),this.roleLayer=new Laya.Sprite,this.roleLayer.pos(0,0),this.front=new Laya.Sprite,this.topMoreRole=new Laya.Sprite,GI.sceneMgr.worldRoot.addChild(this.visionBg),GI.sceneMgr.worldRoot.addChild(this.backGround),GI.sceneMgr.worldRoot.addChild(this.sceneItem),GI.sceneMgr.worldRoot.addChild(this.front),GI.sceneMgr.worldRoot.addChild(this.roleLayer),GI.sceneMgr.worldRoot.addChild(this.topMoreRole),this.topMoreRole.pos(0,0),this.initSceneItem(t)}moveVisionBg(t){this.visionBgx!=t&&(this.visionBgx=t,this.visionBg.x=.3*-t)}getCurBornSpr(){return this.bornSpr[Xi.i.curStep]}getCurStepPos(){return this.stepPos[Xi.i.curStep]}getLaunchePos(){return this.launcherPos}getLastStepPos(){return this.stepPos[this.stepPos.length-1]}getStepByPos(t,i){let e=0;for(e=0;e<this.stepPos.length;e++)if(this.stepPos[e].x==t&&this.stepPos[e].y==i)return e;return-1}addAnimationToLayer(t,i){i==jt.visionBg?this.visionBg.addChild(t):i==jt.backGround?this.backGround.addChild(t):i==jt.sceneItem?this.sceneItem.addChild(t):i==jt.frontLayer&&this.front.addChild(t)}checkCheerRoles(){if(Xi.i.curStep<Xi.i.totalStep-1)this.clearCheerRoles();else if(this._cheerRoles.length>0)return}addCheerRole(t,i){if(!t||i[t.id])return;i[t.id]=!0;let e=new Laya.Skeleton;this.sceneItem.addChild(e);let s=this.getLastStepPos();e.pos(s.x+160+90*this._cheerRoles.length,s.y+75),e.load(t.roleAni),e.scaleX=-1,this._cheerRoles.push(e)}clearCheerRoles(){for(;this._cheerRoles.length>0;)this._cheerRoles.pop().destroy(!0)}}class qt{constructor(){this.rodUrl="rod/2scRod/Soft.png",this.animNum=6,this.SizeNum=2,this.alphaNum=.058,this.rodShowMaxSize=[30,30],this.rodShowMaxAngle=1,this.rodShowMinSize=[18,18],this.rodShowMinAngle=.652}onEnable(t){this.roleCtrl=t;let i=this.roleCtrl.rodSize;this.rodSize=i;i.x;this.leftShow=this.CreateRodShow(i,1),this.rightShow=this.CreateRodShow(i,2)}onDisable(){Yi.RemoveNodes(this.leftShow),Yi.RemoveNodes(this.rightShow),Yi.RemoveNodes(this.leftRodColl),Yi.RemoveNodes(this.rightRodColl),this.leftRodColl=null,this.rightRodColl=null,this.leftShow=null,this.rightShow=null}CreateRodShow(t,i){let e=Yi.CreateSprite(this.rodUrl,this.rodShowMinSize[0],this.rodShowMinSize[1],this.rodShowMinSize[0]/2,this.rodShowMinSize[1]/2,0,0);return 1==i?this.roleCtrl.leftLeg.addChild(e):this.roleCtrl.rightLeg.addChild(e),e.pos(t.x/2,t.y),e.alpha=this.rodShowMaxAngle,e}CloseShowRod(){GI.timerMgr.clear(this,this.UpdateShowAnim),this.rightShow.alpha=0,this.leftShow.alpha=0}get isLeftRodShow(){return this.leftShow.alpha>0}set isLeftRodShow(t){t?(this.leftShow.alpha=this.rodShowMinAngle,this.rightShow.alpha=0,this.leftShow.width=this.rodShowMaxSize[0],this.leftShow.height=this.rodShowMaxSize[1]):(this.leftShow.alpha=0,this.rightShow.alpha=this.rodShowMinAngle,this.rightShow.width=this.rodShowMaxSize[0],this.rightShow.height=this.rodShowMaxSize[1]),this.rightShow.pivotX=this.rightShow.width/2,this.rightShow.pivotY=this.rightShow.height/2,this.rightShow.pos(this.rodSize.x/2,this.rodSize.y),this.leftShow.pivotX=this.leftShow.width/2,this.leftShow.pivotY=this.leftShow.height/2,this.leftShow.pos(this.rodSize.x/2,this.rodSize.y)}get isRightRodShow(){return this.rightShow.alpha>0}set isRightRodShow(t){t?(this.leftShow.alpha=0,this.rightShow.alpha=this.rodShowMinAngle,this.rightShow.width=this.rodShowMaxSize[0],this.rightShow.height=this.rodShowMaxSize[1]):(this.leftShow.alpha=this.rodShowMinAngle,this.rightShow.alpha=0,this.leftShow.width=this.rodShowMaxSize[0],this.leftShow.height=this.rodShowMaxSize[1]),this.rightShow.pivotX=this.rightShow.width/2,this.rightShow.pivotY=this.rightShow.height/2,this.rightShow.pos(this.rodSize.x/2,this.rodSize.y),this.leftShow.pivotX=this.leftShow.width/2,this.leftShow.pivotY=this.leftShow.height/2,this.leftShow.pos(this.rodSize.x/2,this.rodSize.y)}ShowUpdateAnim(t,i){GI.timerMgr.clear(this,this.UpdateShowAnim),this.showAnimIdx=t,1==t?this.isLeftRodShow&&GI.timerMgr.frameLoop(1,this,this.UpdateShowAnim,[i]):2==t&&this.isRightRodShow&&GI.timerMgr.frameLoop(1,this,this.UpdateShowAnim,[i])}SetRodShowSize(t,i=!0){i?(t.width+=this.SizeNum,t.height+=this.SizeNum,t.width>this.rodShowMaxSize[0]&&(t.width=this.rodShowMaxSize[0]),t.height>this.rodShowMaxSize[1]&&(t.height=this.rodShowMaxSize[1]),t.alpha-=this.alphaNum):(t.width-=this.SizeNum,t.height-=this.SizeNum,t.width<this.rodShowMinSize[0]&&(t.width=this.rodShowMinSize[0]),t.height<this.rodShowMinSize[1]&&(t.height=this.rodShowMinSize[1]),t.alpha+=this.alphaNum),t.pivotX=t.width/2,t.pivotY=t.height/2,t.pos(this.rodSize.x/2,this.rodSize.y)}UpdateShowAnim(t){let i;if(null==(i=1==this.showAnimIdx?this.leftShow:this.rightShow))return GI.timerMgr.clear(this,this.UpdateShowAnim),null;this.SetRodShowSize(i,t),(t&&i.alpha<=this.rodShowMinAngle||0==t&&i.alpha>=this.rodShowMaxAngle)&&GI.timerMgr.clear(this,this.UpdateShowAnim)}}class Qt extends Laya.RevoluteJoint{constructor(){super()}}class Kt{constructor(t,i){this._part1H=0,this._part2H=0,this._partLen=20,this._part1Pos=new Laya.Point,this._part2Pos=new Laya.Point,this._part3Pos=new Laya.Point,this.roleCtrl=t,this._index=i}initRole(t,i){this._limb=t,this._part1=this._limb.getChildByName("part1"),this._part1Pt=this._limb.getChildByName("part1Pt"),this._part2=this._part1.getChildByName("part2"),this._part3Con=this._part2.getChildByName("part3Con"),this._part3=this._part3Con.getChildByName("part3"),this._part3Pt=this._part3.getChildByName("part3Pt");let e=i.getChildByName("hand");for(;e.numChildren>0;){let t=e.getChildAt(0);null!=t&&(e.removeChildAt(0),t.destroy())}e.addChild(this._part3),this._part3.rotation=-90,this._part1H=this._part1.height,this._part2H=this._part2.height,this._partLen=Math.floor((this._part1H+this._part2H)/2)}onUpdate(){if(!this._limb||this.roleCtrl.isRoleDeath)return;this.updateScPos(this._part1Pt,this._part1Pos),this.updateScPos(this._part3Pt,this._part3Pos);let t=this._part1Pos.distance(this._part3Pos.x,this._part3Pos.y);if(t>2*this._partLen)this._part1.height=this._part1.pivotY+t/2,this._part1.rotation=this.getRotat(this._part1Pos,this._part3Pos)-this.roleCtrl.roleShow.rotation,this._part2.y=this._part1.height,this._part2.height=this._part2.pivotY+t/2,this._part2.rotation=0;else{let i=this._partLen*Math.cos(Math.PI*t/(4*this._partLen));this._part2Pos.setTo((this._part3Pos.x+this._part1Pos.x)/2-i*(this._part3Pos.y-this._part1Pos.y)/t,(this._part3Pos.y+this._part1Pos.y)/2+i*(this._part3Pos.x-this._part1Pos.x)/t),t=this._part2Pos.distance(this._part1Pos.x,this._part1Pos.y),this._part1.height=this._part1.pivotY+t,this._part1.rotation=this.getRotat(this._part1Pos,this._part2Pos)-this.roleCtrl.roleShow.rotation,this._part2.y=this._part1.height,this._part2.height=this._part2.pivotY+t,this._part2.rotation=this.getRotat(this._part2Pos,this._part3Pos)-this._part1.rotation-this.roleCtrl.roleShow.rotation}}updateScPos(t,i){return t.localToGlobal(i.reset(),null,GI.sceneMgr.worldRoot)}getRotat(t,i){return t&&i?180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI:0}onRoleDie(){this._part1.height=this._part1H,this._part2.height=this._part2H,this._part3Con.addChild(this._part3),this._part3.rotation=0,this._part3.pos(0,0)}}class Zt{constructor(t,i){this._let1H=0,this._offY=0,this._leg1Pos=new Laya.Point,this._rodFeetPos=new Laya.Point,this.roleCtrl=t,this._index=i}initRole(t,i){this._limb=t,this._leg1=this._limb.getChildByName("leg1"),this._leg1Pt=this._limb.getChildByName("leg1Pt"),this._feet=this._leg1.getChildByName("feet"),this._rodFeetPt=i.getChildByName("feet"),this._let1H=this._leg1.height,this._offY=this._feet.y-this._let1H}onUpdate(){this._limb&&!this.roleCtrl.isRoleDeath&&(this.updateScPos(this._leg1Pt,this._leg1Pos),this.updateScPos(this._rodFeetPt,this._rodFeetPos),this._leg1.height=this._leg1Pos.distance(this._rodFeetPos.x,this._rodFeetPos.y),this._leg1.rotation=this.getRotat(this._leg1Pos,this._rodFeetPos)-this.roleCtrl.roleShow.rotation,this._feet.y=this._leg1.height+this._offY)}updateScPos(t,i){return t.localToGlobal(i.reset(),null,GI.sceneMgr.worldRoot)}getRotat(t,i){return t&&i?180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI:0}onRoleDie(){this._leg1.height=this._let1H}}class $t{constructor(){this.imgUrl="rod/2scRod/RoleDeath.png",this.size={x:57,y:49,pivotX:29,pivotY:25}}static StartAnim(t,i=1){let e=new $t;return e.Init(t,i),e}Init(t,i=1){this.sprite=new Laya.Sprite,this.sprite.loadImage(this.imgUrl),this.sprite.width=this.size.x,this.sprite.height=this.size.y,this.sprite.pivot(this.size.pivotX,this.size.pivotY),GI.sceneMgr.worldRoot.addChild(this.sprite),this.sprite.pos(t.x,t.y),this.sprite.scaleX=i,this.sprite.scaleY=i,this.sprite.alpha=1,this.sprite.rotation=0;GI.Tween.to(this.sprite,{rotation:-130},900,null,Laya.Handler.create(this,this.AnimEnd)),GI.Tween.to(this.sprite,{alpha:0},850)}AnimEnd(){this.sprite.destroy()}}var ti,ii,ei,si,ri;!function(t){t[t.None=0]="None",t[t.LeftRod=1]="LeftRod",t[t.RightRod=2]="RightRod"}(ti||(ti={})),function(t){t[t.None=0]="None",t[t.GameNode=1]="GameNode",t[t.AllDeath=2]="AllDeath",t[t.Hurt=3]="Hurt"}(ii||(ii={})),function(t){t[t.normal=0]="normal",t[t.danger=1]="danger",t[t.win=2]="win",t[t.fail=3]="fail"}(ei||(ei={}));class ai{constructor(){this.rolePrefabData=null,this.rodPrefabData=null,this.soundKey={1:"res/sound/Walk.mp3",2:"res/sound/Walk.mp3",3:"res/sound/Walk.mp3",4:"res/sound/Walk.mp3",5:"res/sound/SavePoint.mp3"},this.CollisionKey={1:"",2:"",3:"",4:""},this.GameNode="4",this.AllDeath="Ground",this.Hurt="Hurt",this.isNewbie=!1,this.isDangling=!1,this.isStartUpForce=!1,this.balloonNum=2,this.flY=300,this.buoyancy=500,this.MaxAngle=65,this.buoyancyNum=80,this.leftCollideTime=0,this.leftAway=!1,this.rightCollideTime=0,this.rightAway=!1,this.zoomIn=!1,this.posetionH=593,this.cameraX=230,this.cameraY=740,this.mousex=0,this.minAngleData=-60,this.maxAngleData=60,this.isInit=!1,this.RoleX=0,this.addX=0,this.isSlideFoot=!1,this.isMouseDown=!1,this.userLorR=ti.None,this.leftTween=null,this.RightTween=null,this.rodSize=new Laya.Point(12,198),this.pivotLorR=[6,20],this.runPivotLorR=[6,65],this.boxSize=new Laya.Point(6,198),this.boxPoth=new Laya.Point(3,0),this.roleBoxSize=[0,0,38,38],this.roleTexeSize=[55,37,40,21],this.rolefaceSize=[52,47,22,40],this.RodRunYAddNum=5,this.RoleForce=420,this.rodTweenTime=300,this.StartAngle=28,this.isRoleDeath=!1,this.isInWall=!0,this.isFollowRole=!1,this.followRole=new Laya.Point(0,0),this.leftRodRupture=[],this.rightRodRupture=[],this.leftRodAnimPlay=!0,this.rightRodAnimPlay=!0,this.isRemove=!1,this.onTriggerExitNUm=0,this.isPlayGameNodeSound=!1,this.firstRun=!1,this.isjump=!1,this.MinForce=1850,this.jcRodPoth=null,this.isInRodQuan=!1,this.leftAngle=0,this.rightAngle=0,this.DEGTORAD=50,this.mouseMaxNum=130,this.AngularVelocity=this.DEGTORAD/this.mouseMaxNum,this.IsDetectRod=!1,this.rodUrl="",this.faceUrls={[ei.normal]:"/face.png",[ei.danger]:"/faceDanger.png",[ei.win]:"/faceWin.png",[ei.fail]:"/faceFail.png"}}preInit(){this._leftArm=new Kt(this,1),this._rightArm=new Kt(this,2),this._leftLeg=new Zt(this,1),this._rightLeg=new Zt(this,2),GI.gMsgCet.on("Wm.onFinishLvl",this,this.RoleVictory),GI.gMsgCet.on("ReachMidStep",this,this.OnReachMidStep),GI.gMsgCet.on("ReachLine",this,this.OnReachMidStep),GI.gMsgCet.on("wmCtrl.MOUSE_UP",this,this.onMouseUp11),GI.gMsgCet.on("wmCtrl.MOUSE_DOWN",this,this.onMouseDown11),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_Start",this,()=>{this.setDangerFace(!0)}),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_End",this,()=>{this.setDangerFace(!1)}),GI.gMsgCet.on("wm.waterForce",this,this.OrganForce)}ReachMidStepPhiz(){this.setNormalFace()}ShowWinFacePhiz(){this.setWinFace(),GI.timerMgr.clear(this,this.ReachMidStepPhiz),GI.timerMgr.once(1200,this,this.ReachMidStepPhiz)}OnReachMidStep(){this.ShowWinFacePhiz(),this.isNewbie&&(2==this.balloonNum?(this.buoyancy=400,this.leftRigid.angularDamping=20,this.rightRigid.angularDamping=20,this.SetRoleTutorial(6)):1==this.balloonNum&&(this.leftRigid.angularDamping=0,this.rightRigid.angularDamping=0,this.SetRoleTutorial(7)))}SetInertiaScale(t,i=1,e=1){var s=new Laya.Physics.I.box2d.b2MassData;t.body.GetMassData(s),s.I=i,s.mass=e,t.body.SetMassData(s)}SetMassData(t,i,e){var s=new Laya.Physics.I.box2d.b2MassData;t.body.GetMassData(s),s.center.Set(i,e),t.body.SetMassData(s)}initGuideStepRole(){if(this.isNewbie=Xi.i.data.isGuideScene,this.isDangling=!1,this.isNewbie){let t=Xi.i.data.guideStep;null==t&&(t=1),this.isDangling=t<=4,t>3&&(this.balloonNum=t<=5?2:6==t?1:0),this.flY=540,this.buoyancy=450}}initRole(t=230,i=710){if(this.initGuideStepRole(),null==this.rolePrefabData){let e=[{url:Xi.i.data.bodyData.curUseData.scRes,type:Laya.Loader.JSON},{url:"res/rod/Rod.json",type:Laya.Loader.JSON},{url:Xi.i.data.rodData.curUseData.scResBase,type:Laya.Loader.JSON}];this.AddRoleSkinUrls(e),GI.resMgr.load(e,Laya.Handler.create(this,e=>{this.rolePrefabData=GI.resMgr.getRes(Xi.i.data.bodyData.curUseData.scRes),this.rodPrefabData=GI.resMgr.getRes("res/rod/Rod.json"),this.CreateRoles(t,i)}))}else this.CreateRoles(t,i);ji.physicsDebug&&Laya.PhysicsDebugDraw.enable()}CreateRoles(t,i){Laya.Physics.I.box2d.DEBUG=!1,i-=100,this.isInWall=!0,this.isSlideFoot=!1,this.isInit=!1,this.isMouseDown=!1,this.isRoleDeath=!1,this.MinForce=1100,this.rightAway=!1,this.leftAway=!1,this.isjump=!1,this.SetAllObjectIsNull(),this.CreateRole(t,i),this.CreateRoleShow(t,i),this.ShowRod(),this.isInit=!0,this.isRoleDeath=!1,this.RoleX=this.role.x,GI.gMsgCet.on("Wm.part.curUseID.body",this,this.UpdateRoleSkin),GI.gMsgCet.on("Wm.part.curUseID.rod",this,this.UpdateRodSkin),GI.gMsgCet.on("Wm.part.curUseID.hat",this,this.UpdateRoleHatSkin),GI.gMsgCet.on("Wm.part.curUseID.jewelry",this,this.UpdateRoleJewelrySkin)}set leftAllowRotation(t){this.leftRigid.allowRotation=t}set rightAllowRotation(t){this.rightRigid.allowRotation=t}AddRoleSkinUrls(t){null!=Xi.i.data.hatData.curUseData&&t.push({url:Xi.i.data.hatData.curUseData.scRes,type:Laya.Loader.JSON}),null!=Xi.i.data.jewelryData.curUseData&&t.push({url:Xi.i.data.jewelryData.curUseData.scRes,type:Laya.Loader.JSON})}UpdateRoleHatSkin(){if(null!=Xi.i.data.hatData.curUseData){let t=[{url:Xi.i.data.hatData.curUseData.scRes,type:Laya.Loader.JSON}];GI.resMgr.load(t,Laya.Handler.create(this,t=>{null!=this.role&&this.CreateRoleGarnishHat()}))}else this.CreateRoleGarnishHat()}UpdateRoleJewelrySkin(){if(null!=Xi.i.data.jewelryData.curUseData){let t=[{url:Xi.i.data.jewelryData.curUseData.scRes,type:Laya.Loader.JSON}];GI.resMgr.load(t,Laya.Handler.create(this,t=>{null!=this.role&&this.CreateRoleGarnishJewelry()}))}else this.CreateRoleGarnishJewelry()}UpdateRoleSkin(){let t=[{url:Xi.i.data.bodyData.curUseData.scRes,type:Laya.Loader.JSON}];this.AddRoleSkinUrls(t),GI.resMgr.load(t,Laya.Handler.create(this,t=>{this.rolePrefabData=GI.resMgr.getRes(Xi.i.data.bodyData.curUseData.scRes),null!=this.role&&this.CreateRoleShow(this.role.x,this.role.y)}))}UpdateRodSkin(){GI.resMgr.load([{url:Xi.i.data.rodData.curUseData.scResBase,type:Laya.Loader.JSON}],Laya.Handler.create(this,t=>{this.ShowRod()}))}RemoveRole(){if(null!=this.role){if(this.isRemove=!0,this.roleRodCollCtrl.onDisable(),this.roleRodCollCtrl=null,this.roleShow.off(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision),this.roleFace.off(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision),this.isNewbie){let t=this.balloons.length;for(let i=0;i<t;++i){let t=this.balloons.pop();Yi.RemoveNodes(t)}}this.RemoveRodRuptureObject(this.rightRodRupture),this.RemoveRodRuptureObject(this.leftRodRupture),this.leftRodAnimPlay=!0,this.rightRodAnimPlay=!0,Yi.RemoveNodes(this.jcRodPoth),Yi.RemoveNodes(this.leftLeg),Yi.RemoveNodes(this.rightLeg),Yi.RemoveNodes(this.leftCenter),Yi.RemoveNodes(this.rightCenter),Yi.RemoveNodes(this.role),Yi.RemoveNodes(this.roleShow),Yi.RemoveNodes(this.roleFace),Yi.RemoveNodes(this.spinCenter),Yi.RemoveNodes(this.driveNode),GI.gMsgCet.off("Wm.part.curUseID.body",this,this.UpdateRoleSkin),GI.gMsgCet.off("Wm.part.curUseID.rod",this,this.UpdateRodSkin),GI.gMsgCet.off("Wm.part.curUseID.hat",this,this.UpdateRoleHatSkin),GI.gMsgCet.off("Wm.part.curUseID.jewelry",this,this.UpdateRoleJewelrySkin),this.SetAllObjectIsNull()}}SetAllObjectIsNull(){this.spinCenter=null,this.driveNode=null,this.startFoot=null,this.endFoot=null,this.role=null,this.roleShow=null,this.roleFace=null,this.leftLeg=null,this.rightLeg=null,this.roleRigid=null,this.leftRigid=null,this.rightRigid=null,this.roleBox=null,this.leftBox=null,this.rightBox=null,this.leftWeldJoint=null,this.rightWeldJoint=null,this.leftRvltJoint=null,this.rightRvltJoint=null,this.leftBindJoint=null,this.rigthBindJoint=null,this.leftBindBox=null,this.rightBindBox=null,this.leftMeshData=null,this.rightMeshData=null}OrganForce(t){this.removeWheelJoint(ti.None),this.leftBox.density=.05,this.rightBox.density=.05,this.roleBox.density=5;let i=t.x,e=t.y;this.rightAllowRotation=!1,this.leftAllowRotation=!1,this.roleRigid.applyForceToCenter({x:i,y:-e})}RoleVictory(){this.isMouseDown=!1,this.isRoleDeath=!0,this._leftArm.onRoleDie(),this._rightArm.onRoleDie(),this._leftLeg.onRoleDie(),this._rightLeg.onRoleDie(),this.setWinFace()}RoleDeath(){if(this.isRoleDeath)return;GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"),this.setFailFace(),this.RemoveRodTween(ti.LeftRod),this.RemoveRodTween(ti.RightRod),this.roleRodCollCtrl.CloseShowRod(),this.rightRvltJoint.enabled=!1,this.leftRvltJoint.enabled=!1,this.leftAllowRotation=!0,this.rightAllowRotation=!0,this.leftWeldJoint.destroy(),this.rightWeldJoint.destroy(),this.roleShow.getComponent(Laya.JointBase).destroy();let t=this.roleShow.getComponent(Laya.ColliderBase);t.density=10,t.friction=5e4;this.roleShow.getComponent(Laya.RigidBody);this.leftAway=!1,this.rightAway=!1,this.roleRigid.mask=1,this.leftRigid.gravityScale=1,this.rightRigid.gravityScale=1,this.leftBox.density=10,this.rightBox.density=10,this.roleBox.density=10,this.leftLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_EXIT),this.leftLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_ENTER),this.rightLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_EXIT),this.rightLeg.getChildByName("cfq").offAll(Laya.Event.TRIGGER_ENTER),GI.timerMgr.clear(this,this.ReachMidStepPhiz),GI.timerMgr.clear(this,this.RodInPointTime),this.leftLeg.offAll(Laya.Event.TRIGGER_ENTER),this.rightLeg.offAll(Laya.Event.TRIGGER_ENTER),this.leftLeg.offAll(Laya.Event.TRIGGER_EXIT),this.rightLeg.offAll(Laya.Event.TRIGGER_EXIT),this.removeWheelJoint(ti.None),GI.soundMgr.playSound("res/sound/Hit.mp3"),this.isRoleDeath=!0,this._leftArm.onRoleDie(),this._rightArm.onRoleDie(),this._leftLeg.onRoleDie(),this._rightLeg.onRoleDie(),GI.gMsgCet.event("wmCtrl.ROLE_DEATH")}OnRoleCollision(t){null!=t&&t.label!=this.GameNode&&"0"!=t.label&&(this.AddRoldDeathEffects(t,this.roleShow.getComponent(Laya.ColliderBase)),this.RoleDeath())}get roleX(){return this.isRoleDeath?this.roleShow?this.roleShow.x:-1:this.role?this.role.x:-1}get roleY(){return this.isRoleDeath?this.roleShow?this.roleShow.y:-1:this.role?this.role.y:-1}get roleHeight(){return 76}getAngle(){let t=this.rightLeg.rotation,i=this.leftLeg.rotation;return t<0&&i<0||t>0&&i>0?Math.abs(t-i):Math.abs(t+i)}onTriggerExit(){this.onTriggerExitNUm++,Laya.timer.clear(this,this.onTriggerExit)}removeWheelJoint(t,i=!0){let e=!1;return t!=ti.RightRod&&t!=ti.None||(null!=this.rigthBindJoint&&(0==i&&(this.rightBindBox=this.rigthBindJoint.otherBody.owner.getComponent(Laya.ColliderBase)),this.rigthBindJoint.destroy(),this.rigthBindJoint=null,e=!0),i&&(this.rightBindBox=null)),t!=ti.LeftRod&&t!=ti.None||(null!=this.leftBindJoint&&(0==i&&(this.leftBindBox=this.leftBindJoint.otherBody.owner.getComponent(Laya.ColliderBase)),this.leftBindJoint.destroy(),this.leftBindJoint=null,e=!0),i&&(this.leftBindBox=null)),e}IsRemoveUpForce(){this.isNewbie&&0==this.IsRodSameSide()&&(this.isStartUpForce=!1)}GetRodColliderPoint(t){let i=t==ti.LeftRod?this.leftLeg:this.rightLeg;return this.LocalToGlobal(i,i.rotation>0?6:-6,200)}RodInCollider(t,i){if(null!=t.owner){let e=this.GetRodColliderPoint(i),s=t.owner;if(null!=s.getComponent(Laya.BoxCollider)){e=this.GlobalToLocal(s,e.x,e.y);let i=t,r=6,a=i.x-r,o=i.y-r,h=i.width+r,n=i.height+r;return e.x>=a&&e.x<=h&&e.y<=n&&e.y>=o}if(null!=s.getComponent(Laya.CircleCollider)){let i=t,r=(i.radius+3)*(i.radius+3);return(e=this.GlobalToLocal(s,e.x,e.y)).x*e.y<=r}return!0}return!1}AddLeftJoint(t,i=!1,e=!0,s=!0){if(null!=t&&null!=t.owner&&0==this.leftAway){if(null==this.leftBindJoint){if(0==this.RodInCollider(t,ti.LeftRod)){this.GetContactEdge(this.leftCfqRigid).length}this.leftBox.density=5;let i=new Qt;i.otherBody=t.owner.getComponent(Laya.RigidBody),e&&(i.collideConnected=!0),i.anchor=[this.rodSize.x/2,this.rodSize.y],this.leftLeg.addComponentIntance(i),this.leftBindJoint=i,this.leftWeldJoint.enabled=!1,this.leftAllowRotation=!0}this.leftAllowRotation=!0,this.IsRemoveUpForce()}}AddRightJoint(t,i=!1,e=!0,s=!1){if(null!=t&&null!=t.owner&&0==this.rightAway){if(null==this.rigthBindJoint){if(0==this.RodInCollider(t,ti.RightRod)){this.GetContactEdge(this.rightCfqRigid).length}this.rightBox.density=5;let i=new Qt;i.otherBody=t.owner.getComponent(Laya.RigidBody),e&&(i.collideConnected=!0),i.anchor=[this.rodSize.x/2,this.rodSize.y],this.rightLeg.addComponentIntance(i),this.rigthBindJoint=i,this.rightWeldJoint.enabled=!1,this.rightRigid.allowRotation=!0}this.rightAllowRotation=!0,this.IsRemoveUpForce()}}BindJoint(t=!0,i=!1){this.IsRodSameSide()?this.removeWheelJoint(ti.None):this.userLorR==ti.RightRod?(t&&this.IsInRodUP(ti.RightRod)&&this.AddRightJoint(this.rightBindBox,!0,!0,i),null!=this.leftBindBox&&this.IsInRodUP(ti.LeftRod)&&this.AddLeftJoint(this.leftBindBox,!1,!0,i)):(t&&this.IsInRodUP(ti.LeftRod)&&this.AddLeftJoint(this.leftBindBox,!0,!0,i),null!=this.rightBindBox&&this.IsInRodUP(ti.RightRod)&&this.AddRightJoint(this.rightBindBox,!1,!0,i))}onLeftRigidClick(t){t.isSensor||("2"==t.label?(this.leftBindBox=t,this.AddLeftJoint(t,!0,!0,!0),this.PlayRodAnim(ti.LeftRod)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClick))}onRightRigidClick(t){t.isSensor||("2"==t.label?(this.AddRightJoint(t,!0,!0,!0),this.PlayRodAnim(ti.RightRod),this.rightBindBox=t):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClick))}onRightRigidClickEnd(t){t.isSensor||this.userLorR==ti.LeftRod&&(this.isInWall=!1)}onRightRigidClickEnter(t){t.isSensor||(this.userLorR==ti.RightRod?(this.isjump?this.onRigidJumpBodyClick(t):this.onRigidBodyClick(t),this.rightCollideTime=Laya.timer.currFrame):this.isjump&&this.onRigidJumpFixedClick(t))}onLeftRigidClickEnd(t){t.isSensor||this.userLorR==ti.RightRod&&(this.isInWall=!1)}onLeftRigidClickEnter(t){t.isSensor||(this.userLorR==ti.LeftRod?(this.isjump?this.onRigidJumpBodyClick(t):this.onRigidBodyClick(t),this.leftCollideTime=Laya.timer.currFrame):this.isjump&&this.onRigidJumpFixedClick(t))}LocalToGlobal(t,i,e){let s=Laya.Point.create();return s.setTo(i,e),t.localToGlobal(s,!1,Xi.i.mapCtrl.roleLayer)}GlobalToLocal(t,i,e){let s=Laya.Point.create();return s.setTo(i,e),t.globalToLocal(s,!1,Xi.i.mapCtrl.roleLayer)}IsRodInGroundUp(t,i){if(null!=i&&null!=i.owner){let e=i.owner;if(null!=e){let s=this.LocalToGlobal(t,0,this.rodSize.y),r=i;return(s=null!=r?this.GlobalToLocal(e,s.x,s.y-r.y):this.GlobalToLocal(e,s.x,s.y)).x>=1&&s.y<1&&s.y,!0}}return!1}IsRodSameSide(){return this.leftLeg.rotation<=0&&this.rightLeg.rotation<=0||this.leftLeg.rotation>=0&&this.rightLeg.rotation>=0}IsRodOverspill(t){return t<this.minAngleData||t>this.maxAngleData}GetRodAllAngle(){return Math.abs(this.leftLeg.rotation)+Math.abs(this.rightLeg.rotation)}ClearForces(t){if(null==t)return;let i=t.body;i.m_force.SetZero(),i.m_invI=0,this.ClearTorque(t)}ClearTorque(t){if(null==t)return;let i=t.body;i.m_torque=0,i.m_angularVelocity=0,i.m_I=0}GetRigidPoints(t){let i=new Array;if(null!=t){let e=t.body.GetContactList();for(;null!=e;){let t=new Laya.Point;t.x=-1,t.y=-1;let s=e.contact.m_manifold;s.pointCount>0&&(t.x=50*s.points[0].localPoint.x,t.y=50*s.points[0].localPoint.y),i.push(t),e=e.next}}return i}GetRigidNormals(t){let i=new Array;if(null!=t){let e=t.body.GetContactList();for(;null!=e;){let t=Laya.Point.create();t.x=-1,t.y=-1;let s=e.contact.m_manifold;t.x=s.localNormal.x,t.y=s.localNormal.y,i.push(t),e=e.next}}return i}GetContactEdge(t){let i=new Array;if(null!=t){let e=t.body.GetContactList();for(;null!=e;)i.push(e),e=e.next}return i}IsFixtureAIsRod(t){return"Rod"==t.GetBody().GetUserData()}localNormalToWorld(t,i,e){let s=Laya.Point.create();return s.x=t*e.q.c-i*e.q.s,s.y=t*e.q.s+i*e.q.c,s}GetimpactPointByManifold(t,i){let e={x:-1,y:-1};if(null!=t){let s=this.GetContactEdge(t),r=this.GetContactEdge(i);if(r.length>0)for(let t=0;t<r.length;++t)s.push(r[t]);for(let t=0;t<s.length;++t){let r=s[t].contact;if(r.m_fixtureA.GetBody()==i.body||r.m_fixtureB.GetBody()==i.body){let a=new Laya.Physics.I.box2d.b2WorldManifold;s[t].contact.GetWorldManifold(a);let o=a.points[0].x>a.points[1].x?a.points[0]:a.points[1];if(0==o.x){let e=i.owner,a=s[t].contact.m_manifold.localPoint,o=!1;return o&&2==r.m_manifold.type||!o&&1==r.m_manifold.type?((a=this.localNormalToWorld(a.x,a.y,o?r.m_fixtureA.m_body.m_xf:r.m_fixtureB.m_body.m_xf)).x=(e.x+50*a.x)/50,a.y=(e.y+50*a.y)/50,a):(a=s[t].contact.m_manifold.points[0].localPoint,(a=this.localNormalToWorld(a.x,a.y,o?r.m_fixtureA.m_body.m_xf:r.m_fixtureB.m_body.m_xf)).x=(e.x+50*a.x)/50,a.y=(e.y+50*a.y)/50,a)}e.x<o.x&&(e.x=o.x,e.y=o.y)}}}return e}GetImpactPoint(t,i){let e=this.GetimpactPointByManifold(t,i);return e.x>0?(e.x=50*e.x,e.y=50*e.y,e):{x:-1,y:-1}}IsInRodUP(t){let i=null,e=null;t==ti.LeftRod?(e=this.leftRigid,i=this.leftCfqRigid):(e=this.rightRigid,i=this.rightCfqRigid);let s=this.GetContactEdge(e);if(s.length>0)for(let t=0;t<s.length;++t){let i=s[t].contact,e=this.IsFixtureAIsRod(i.m_fixtureA),r=i.m_manifold;if(1==r.type&&e||2==r.type&&0==e){r.localPoint.x;if(50*r.localPoint.y>=.98*this.rodSize.y){this.localNormalToWorld(r.localNormal.x,r.localNormal.y,e?i.m_fixtureA.m_body.m_xf:i.m_fixtureB.m_body.m_xf);if(-r.localNormal.y<0)return!0}}else if(r.pointCount>0){r.points[0].localPoint.x;if(50*r.points[0].localPoint.y>=.98*this.rodSize.y){if(this.localNormalToWorld(r.localNormal.x,r.localNormal.y,e?i.m_fixtureB.m_body.m_xf:i.m_fixtureA.m_body.m_xf).y<0)return!0}}}return!1}AddRodFriction(t){let i=this.GetContactEdge(t);if(null!=i&&i.length>0)for(let t=0;t<i.length;++t){let e=i[t];null!=e&&null!=e.contact&&e.contact.SetFriction(5e5)}}onRigidJumpBodyClick(t){this.userLorR==ti.LeftRod?(this.leftBindBox=t,this.AddRodFriction(this.leftRigid),this.IsInRodUP(ti.LeftRod)?(this.AddRodFriction(this.leftRigid),this.AddLeftJoint(t,!1,!0,!0),this.PlayRodAnim(ti.LeftRod),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.IsInCollider(ti.RightRod)?(this.BindJoint(!0,!0),this.PlayRodAnim(ti.LeftRod),this.PlayRodAnim(ti.RightRod)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter)):(this.rightBindBox=t,this.AddRodFriction(this.rightRigid),this.IsInRodUP(ti.RightRod)?(this.AddRightJoint(t,!1,!0,!0),this.PlayRodAnim(ti.RightRod),this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter)):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter),this.IsInCollider(ti.LeftRod)?(this.BindJoint(!0,!0),this.PlayRodAnim(ti.LeftRod),this.PlayRodAnim(ti.RightRod)):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))}onRigidJumpFixedClick(t){this.userLorR==ti.LeftRod?(this.rightBindBox=t,this.IsInRodUP(ti.RightRod)?(this.isjump=!1,this.AddRightJoint(t,!1,!0,!0),this.PlayRodAnim(ti.RightRod)):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter)):(this.leftBindBox=t,this.IsInRodUP(ti.LeftRod)?(this.isjump=!1,this.AddLeftJoint(t,!1,!0,!0),this.PlayRodAnim(ti.LeftRod)):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter))}AddRoldDeathEffects(t,i){if(!this.isRoleDeath&&null!=t&&null!=t.rigidBody){let e=t.rigidBody,s=this.GetImpactPoint(e,i.rigidBody);s.x>=0&&$t.StartAnim(s)}}onRigidBodyClick(t){if(null!=t){if(t.label==this.AllDeath||t.label==this.Hurt)return this.AddRoldDeathEffects(t,this.userLorR==ti.LeftRod?this.leftBox:this.rightBox),void this.RoleDeath();if(t.label==this.GameNode&&0==this.isPlayGameNodeSound&&(this.isPlayGameNodeSound=!0),this.IsInRodUP(this.userLorR)){if(this.PlayRodAnim(this.userLorR),(this.userLorR==ti.RightRod&&this.rightBindBox==t||this.userLorR==ti.LeftRod&&this.leftBindBox==t)&&(this.isPlayGameNodeSound=!0),"2"!=t.label&&"3"!=t.label&&"1"!=t.label||(0==this.isPlayGameNodeSound&&GI.soundMgr.playSound("res/sound/Walk.mp3"),this.isPlayGameNodeSound=!1),this.isInWall=!0,this.userLorR==ti.RightRod?this.rightBindBox=t:this.leftBindBox=t,0==this.isMouseDown){this.startFoot=null,this.endFoot=null,this.BindJoint(!0,!0),this.GetUserRodLOrR()==ti.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.isNewbie&&0==this.isDangling&&4==Xi.i.data.guideStep&&this.firstRun&&this.SetRoleTutorial(5)}else this.PlayRodAnim(this.userLorR),this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter);this.leftBox.density=(this.userLorR,ti.LeftRod,5),this.rightBox.density=(this.userLorR,ti.RightRod,5),this.roleBox.density=5,Laya.timer.frameOnce(10,this,this.onTriggerExit,[])}else null!=this.startFoot&&(this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))}else null!=this.startFoot&&(this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))}SetRodData(){this.userLorR==ti.LeftRod?(this.startFoot=this.leftLeg,this.endFoot=this.rightLeg):this.userLorR==ti.RightRod&&(this.startFoot=this.rightLeg,this.endFoot=this.leftLeg)}SetRodRotate(){this.roleRodCollCtrl.ShowUpdateAnim(this.userLorR,!1)}GetUserRodLOrR(){return this.isDangling?ti.LeftRod:this.rightLeg.rotation<this.leftLeg.rotation?ti.LeftRod:ti.RightRod}GetRoleAllMass(){return this.roleRigid.body.GetMass()+this.rightRigid.body.GetMass()+this.leftRigid.body.GetMass()}OnRunJiaoCheng(){this.isNewbie&&0==this.isDangling&&4==Xi.i.data.guideStep&&(this.firstRun=!0)}OnRun(){this.mousex=Laya.stage.mouseX,null!=this.leftBindJoint&&null!=this.rigthBindJoint?this.isInWall=!0:this.IsInRodUP(ti.LeftRod)&&this.IsInRodUP(ti.RightRod)?this.isInWall=!0:this.isInWall=!1,this.roleRigid.linearDamping=0,this.OnRunJiaoCheng(),this.onTriggerExit(),this.userLorR=this.GetUserRodLOrR(),this.leftAngle=this.leftLeg.rotation,this.rightAngle=this.rightLeg.rotation;let t=this.GetRoleAllMass();if(0==this.isInWall){if(this.SetRodData(),(this.userLorR==ti.LeftRod?null!=this.leftBindJoint:null!=this.rigthBindJoint)||this.IsInRodUP(this.userLorR)){this.removeWheelJoint(ti.None),this.ShowWinFacePhiz(),this.leftBox.density=.5,this.rightBox.density=.5,this.roleBox.density=3,t=this.GetRoleAllMass();let i=75,e=370;Math.trunc(this.startFoot.rotation/10);this.startFoot.rotation<0&&(i=-75),this.roleRigid.body.m_linearVelocity.y=0,this.leftRigid.body.m_linearVelocity.y=0,this.rightRigid.body.m_linearVelocity.y=0;let s=this.roleRigid.body.m_linearVelocity;(s.x>6&&i>0||s.x<-5&&i<0)&&(i=0),this.isjump=!0,this.userLorR==ti.LeftRod?this.leftRodAnimPlay=!0:this.rightRodAnimPlay=!0,this.PlayRodAnim(this.userLorR),this.roleRigid.applyForceToCenter({x:i*t,y:-e*t}),this.leftRodAnimPlay=!0,this.rightRodAnimPlay=!0}this.isInWall=!1,this.SetRodRotate(),this.PackUpRodAnim()}else this.SetRodData(),this.SetRodRotate(),this.PackUpRodAnim();if(this.isInWall){let t=0,i=.0174532924*(t=this.endFoot.rotation<this.startFoot.rotation?Math.abs(this.endFoot.rotation):Math.abs(this.startFoot.rotation)),e=t/10*this.RoleForce;e<3*this.RoleForce&&(e=3*this.RoleForce);let s=e*Math.sin(i),r=e*Math.cos(i);this.removeWheelJoint(ti.None,!1),this.BindJoint(!0,!1),this.removeWheelJoint(this.userLorR),this.userLorR==ti.RightRod?null!=this.leftBindJoint&&(this.leftAllowRotation=!0):null!=this.rigthBindJoint&&(this.rightAllowRotation=!0),this.leftBox.density=this.userLorR==ti.LeftRod?.5:5,this.rightBox.density=this.userLorR==ti.RightRod?.5:5,this.roleBox.density=5;let a=this.MinForce;r<s?(s=s<a?a:s,r=r<a?a:r,this.roleRigid.applyForceToCenter({x:s,y:-r})):(r=r<a?a:r,s=s<a?a:s,this.roleRigid.applyForceToCenter({x:r,y:-s})),this.MinForce=1100}this.userLorR==ti.LeftRod?this.leftBindBox=null:this.rightBindBox=null,this.userLorR==ti.LeftRod?this.leftRodAnimPlay=!0:this.rightRodAnimPlay=!0;this.GetUserRodLOrR();this.userLorR==ti.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.isInWall=!1}RemoveQiQiu(t,i){this.balloons[t].getComponent(Laya.RevoluteJoint).destroy(),this.isDangling=!1,this.leftRigid.angularDamping=i,this.rightRigid.angularDamping=i}SetRoleTutorial(t){switch(t){case 1:break;case 2:this.CreateRodPoint(90,90);break;case 3:this.isInRodQuan=!1,this.CreateRodPoint(-15,120);break;case 4:this.isInRodQuan=!1,this.isMouseDown=!1,this.leftLeg.rotation=20,this.GetUserRodLOrR()==ti.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.RodFloorAnim(this.pivotLorR[1]/50),null!=this.jcRodPoth&&(this.jcRodPoth.offAll(Laya.Event.TRIGGER_ENTER),Yi.RemoveNodes(this.jcRodPoth),this.jcRodPoth=null),this.role.getComponent(Laya.RevoluteJoint).destroy(),this.RemoveQiQiu(3,13),this.isDangling=!1,this.balloonNum=2;break;case 6:this.RemoveQiQiu(2,8),this.balloonNum=1;break;case 7:this.RemoveQiQiu(1,0),this.balloonNum=0}Xi.i.data.guideStep=t}RodInPointTime(){this.SetRoleTutorial(Xi.i.data.guideStep+1),GI.timerMgr.clear(this,this.RodInPointTime)}CreateRodPoint(t,i){if(null==this.jcRodPoth){let t=new Laya.Sprite;Xi.i.mapCtrl.roleLayer.addChild(t),t.width=50,t.height=50,t.pivot(25,25);let i=t.addComponent(Laya.CircleCollider);i.radius=25,i.isSensor=!0,i.refresh();let e=t.addComponent(Laya.RigidBody);e.type="static",e.allowSleep=!1,e.category=4,e.mask=4,this.jcRodPoth=t,t.on(Laya.Event.TRIGGER_ENTER,this,()=>{0==this.isInRodQuan&&Xi.i.data.guideStep<4&&(GI.timerMgr.once(600,this,this.RodInPointTime),GI.gMsgCet.event("wmCtrl.RodInPointStart")),this.isInRodQuan=!0}),t.on(Laya.Event.TRIGGER_EXIT,this,()=>{this.GetContactEdge(this.jcRodPoth.getComponent(Laya.RigidBody)).length>1||(this.isInRodQuan=!1,GI.timerMgr.clear(this,this.RodInPointTime),GI.gMsgCet.event("wmCtrl.RodInPointOut"))})}this.LocalToGlobal(this.role,t,i);this.jcRodPoth.x=this.role.x+t,this.jcRodPoth.y=this.role.y+i}RodRunPoint(){let t=Laya.Point.create();return null==this.jcRodPoth?t:(t.x=this.jcRodPoth.x,t.y=this.jcRodPoth.y,t)}onMouseDown11(t){this.isMouseDown=!0,0==this.isRoleDeath&&(this.OnRun(),this.isFollowRole=!1)}onMouseUpJC(){if(this.isNewbie&&(this.isDangling&&Xi.i.data.guideStep<=1&&this.SetRoleTutorial(2),7==Xi.i.data.guideStep)){Xi.i.mapCtrl.getLastStepPos().x-this.role.x<600&&this.SetRoleTutorial(8)}}onMouseUp11(t){if(this.onMouseUpJC(),0==this.isRoleDeath&&null!=this.leftLeg&&this.isMouseDown){if(this.isMouseDown=!1,this.IsInRodUP(ti.LeftRod)&&this.IsInRodUP(ti.RightRod))this.leftBox.density=3.5,this.rightBox.density=3.5,this.isjump=!1,this.BindJoint(!0,!0),this.isFollowRole=!0,this.followRole.x=this.role.x,this.followRole.y=this.role.y,this.leftAllowRotation=!0,this.rightAllowRotation=!0,this.isNewbie&&0==this.isDangling&&4==Xi.i.data.guideStep&&this.firstRun&&this.SetRoleTutorial(5);else if(this.isjump)if(this.roleBox.density=10,this.userLorR==ti.RightRod){this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter);this.GetUserRodLOrR();this.leftBox.density=3.5,this.rightAllowRotation=!0,this.rightBox.density=3.5,this.IsInCollider(ti.RightRod)&&this.IsInRodUP(ti.RightRod)&&null!=this.rightBindBox?(this.AddRightJoint(this.rightBindBox,!1,!0,!1),this.userLorR=ti.LeftRod):this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter)}else this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter),0==this.rightAway&&(this.leftBox.density=3.5,this.rightBox.density=3.5),this.leftBox.density=3.5,this.rightBox.density=3.5,this.leftAllowRotation=!0,this.IsInCollider(ti.LeftRod)&&this.IsInRodUP(ti.LeftRod)&&null!=this.leftBindBox?this.AddLeftJoint(this.leftBindBox,!1,!0,!1):this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter);else this.userLorR==ti.RightRod?(this.leftBox.density=3.5,this.IsInRodUP(ti.RightRod)||0==this.rightAway&&null!=this.rightBindBox?(this.AddRightJoint(this.rightBindBox,!1,!0,!1),this.rightBox.density=3.5,this.rightAllowRotation=!0):(this.rightBox.density=3.5,this.rightAllowRotation=!1)):(this.rightBox.density=3.5,this.IsInRodUP(ti.LeftRod)||0==this.leftAway&&null!=this.leftBindBox?(this.AddRightJoint(this.leftBindBox,!1,!0,!1),this.leftBox.density=3.5,this.leftAllowRotation=!0):(this.leftBox.density=3.5,this.leftAllowRotation=!1)),this.roleBox.density=5;this.GetUserRodLOrR()==ti.LeftRod?this.roleRodCollCtrl.isLeftRodShow=!0:this.roleRodCollCtrl.isRightRodShow=!0,this.RodFloorAnim(this.pivotLorR[1]/50)}}GetRodAngleInRange(t){return t>this.maxAngleData?t=this.maxAngleData:t<this.minAngleData&&(t=this.minAngleData),t}MouseRigodBodySpin(t){t<=-this.mouseMaxNum?t=-this.mouseMaxNum:t>=this.mouseMaxNum&&(t=this.mouseMaxNum);let i=-this.AngularVelocity*t,e=this.userLorR==ti.LeftRod?this.leftRigid:this.rightRigid,s=this.userLorR==ti.LeftRod?this.leftLeg.rotation:this.rightLeg.rotation,r=0,a=this.userLorR==ti.LeftRod?this.leftBox:this.rightBox;if(this.userLorR==ti.LeftRod?(this.leftAngle+=i,this.leftAngle=this.GetRodAngleInRange(this.leftAngle),r=this.leftLeg.rotation-this.leftAngle,this.leftWeldJoint.enabled=!1):(this.rightAngle+=i,this.rightAngle=this.GetRodAngleInRange(this.rightAngle),r=this.rightLeg.rotation-this.leftAngle,this.rightWeldJoint.enabled=!1),(s<=this.minAngleData&&i<0||s>=this.maxAngleData&&i>0)&&(i=0),0==i)0==this.IsDetectRod&&this.ClearForces(e);else{a.density,a.density=.5;let r=i+s;r>this.maxAngleData?i=this.maxAngleData-s:r<this.minAngleData&&(i=this.minAngleData-s),e.body.SetAngularVelocity(i),Math.abs(t)>10&&(this.userLorR==ti.LeftRod?null!=this.leftTween&&(this.RemoveRodTween(this.userLorR),this.leftRvltJoint.joint.m_localAnchorB.y=this.runPivotLorR[1]/50):this.userLorR==ti.RightRod&&null!=this.RightTween&&(this.RemoveRodTween(this.userLorR),this.rightRvltJoint.joint.m_localAnchorB.y=this.runPivotLorR[1]/50))}}OnClearTorque(){if(this.isMouseDown){this.addX,this.role.x,this.RoleX;this.RoleX=this.role.x;let t=Laya.stage.mouseX-this.mousex;this.mousex=Laya.stage.mouseX,this.MouseRigodBodySpin(t)}}Removess(t){let i=t.body;i.m_angularVelocity>0?(i.m_angularVelocity-=.05,i.m_angularVelocity<0&&(i.m_angularVelocity=0)):i.m_angularVelocity<0&&(i.m_angularVelocity+=.05,i.m_angularVelocity>0&&(i.m_angularVelocity=0))}RoleBuoyancy(t){0==t&&(this.isStartUpForce=!0),this.isNewbie&&(this.balloons.length>0&&(this.balloons[0].x=this.role.x,this.balloons[0].y=this.role.y),this.isStartUpForce&&(this.leftLeg.rotation,this.OnSetRoleBuoyancy(),null!=this.leftBindJoint&&null!=this.rigthBindJoint&&(this.isStartUpForce=!1)))}OnSetRoleBuoyancy(){if(null!=this.role&&this.role.y>this.flY&&this.balloonNum>=1&&Xi.i.data.guideStep<8){this.leftBox.density=5,this.rightBox.density=5;let t=this.role.y-this.flY,i=(t=t>this.buoyancyNum?this.buoyancyNum:t)/this.buoyancyNum*this.buoyancy;this.roleRigid.applyForceToCenter({x:0,y:-i})}}RodInAiryAngle(t){t==ti.RightRod?null==this.rightBindBox&&0==this.GetContactEdge(this.rightRigid).length&&this.ClearTorque(this.rightRigid):t==ti.LeftRod&&null==this.leftBindJoint&&0==this.GetContactEdge(this.leftRigid).length&&this.ClearTorque(this.leftRigid)}UpdateRodInAiry(t){this.isMouseDown?this.userLorR==ti.LeftRod?this.RodInAiryAngle(ti.RightRod):this.userLorR==ti.RightRod&&this.RodInAiryAngle(ti.LeftRod):0==t&&0==this.IsRodSameSide()&&(this.RodInAiryAngle(ti.RightRod),this.RodInAiryAngle(ti.LeftRod)),null!=this.leftBindJoint&&null!=this.rigthBindJoint||!this.IsRoleMaxAngle()||0!=t?(this.leftWeldJoint.enabled=!1,this.rightWeldJoint.enabled=!1):(null==this.rigthBindJoint&&(this.rightWeldJoint.enabled=!0),null==this.leftBindJoint&&(this.leftWeldJoint.enabled=!0))}onUpdate(){if(null!=this.role&&(null!=this.roleShow&&(this.roleShow.rotation=(this.leftLeg.rotation+this.rightLeg.rotation)/2),this._leftArm.onUpdate(),this._rightArm.onUpdate(),this._leftLeg.onUpdate(),this._rightLeg.onUpdate()),this.isRoleDeath||null==this.role)return;this.AddRodFriction(this.leftRigid),this.AddRodFriction(this.rightRigid);let t=this.DetectRodUntie();this.RoleBuoyancy(t),this.UpdateRodInAiry(this.IsDetectRod),this.OnClearTorque(),Xi.i.mapCtrl.moveVisionBg(-(this.role.x-this.cameraX)),ji.physicsDebug&&null!=Laya.PhysicsDebugDraw.I&&(Laya.PhysicsDebugDraw.I.x=GI.sceneMgr.worldRoot.x,Laya.PhysicsDebugDraw.I.y=GI.sceneMgr.worldRoot.y),null!=this.rigthBindJoint&&null!=this.leftBindJoint||0!=this.isMouseDown||(this.userLorR==ti.LeftRod?0==this.IsInCollider(ti.LeftRod)&&0==this.IsInCollider(ti.RightRod)&&this.ClearTorque(this.leftRigid):0==this.IsInCollider(ti.RightRod)&&0==this.IsInCollider(ti.LeftRod)&&this.ClearTorque(this.rightRigid)),null!=this.rigthBindJoint&&null!=this.leftBindJoint&&(this.ClearTorque(this.leftRigid),this.ClearTorque(this.rightRigid)),this.IsDetectRod&&(this.leftRigid.allowRotation=!0,this.rightRigid.allowRotation=!0)}IsRoleFallDown(){return this.IsRodSameSide()&&this.IsInCollider(ti.LeftRod)&&this.IsInCollider(ti.RightRod)}IsRoleMaxAngle(){return Math.abs(this.leftLeg.rotation)+Math.abs(this.rightLeg.rotation)>2*this.maxAngleData}IsUntieRod(t){return t>=89||t<=-89}DetectRodUntie(){if(null==this.leftLeg)return!1;if(0==this.isNewbie&&this.IsDetectRod&&this.IsRodSameSide()){let t=this.leftLeg.rotation;if((t=t<0?this.rightLeg.rotation>t?this.rightLeg.rotation:t:this.rightLeg.rotation<t?this.rightLeg.rotation:t)>0&&t>=45||t<0&&t<=-45){let t={x:this.role.x-70,y:this.role.y-40};return this.leftLeg.rotation<0&&(t.x=this.role.x+70),$t.StartAnim(t),this.RoleDeath(),!0}}if(this.IsUntieRod(this.leftLeg.rotation)&&this.removeWheelJoint(ti.LeftRod),this.IsUntieRod(this.rightLeg.rotation)&&this.removeWheelJoint(ti.RightRod),this.IsRoleFallDown())return GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_Start"),this.removeWheelJoint(ti.None),this.rightAllowRotation=!0,this.leftAllowRotation=!0,null!=this.role&&0==this.isNewbie&&(this.roleBox.density=5,this.leftBox.density=5,this.rightBox.density=5),this.IsDetectRod=!0,!1;if(0==this.IsRodSameSide()){let t=this.GetRodAllAngle();if(t>2*this.maxAngleData+15&&this.IsInCollider(ti.LeftRod)&&this.IsInCollider(ti.RightRod)){if(t<2*this.maxAngleData+30)GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_Start"),this.IsDetectRod=!0;else{let t={x:this.role.x-70,y:this.role.y-40};$t.StartAnim(t),this.RoleDeath()}return!1}this.IsDetectRod&&0==this.IsRodSameSide()&&(this.IsDetectRod=!1,GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"))}else this.IsDetectRod&&0==this.IsRodSameSide()&&(this.IsDetectRod=!1,GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End"));return!0}DetectRodSpinUntieJoint(){let t=this.GetSupportRigid();null!=t&&this.IsCollisionManyWall(t)&&this.removeWheelJoint(this.GetSupportRoleRodType())}DetectionRodAngle(){if(0==this.isMouseDown){let t=Math.abs(this.leftLeg.rotation)+Math.abs(this.rightLeg.rotation);if(2*this.MaxAngle+15<t){let t={x:this.role.x-70,y:this.role.y-40};$t.StartAnim(t),this.RoleDeath()}}}IsInCollider(t){let i,e,s=!1;if(t==ti.LeftRod?(i=this.leftRigid,e=this.leftBindJoint,s=0==this.leftAway&&Laya.timer.currFrame-this.leftCollideTime<3):(i=this.rightRigid,e=this.rigthBindJoint,s=0==this.rightAway&&Laya.timer.currFrame-this.rightCollideTime<3),s)return!0;if(null!=e)return!0;let r=this.GetContactEdge(i);if(null!=r)for(let t=0;t<r.length;++t)if(null!=r[t]&&r[t].contact.m_manifold.pointCount>0)return!0;return!1}IsCollisionManyWall(t){let i=t.body.GetContactList();return null!=i&&null!=i.next}IsOperateRodBindWall(){return this.userLorR==ti.LeftRod?null!=this.leftBindJoint&&this.leftBindJoint.enabled:this.userLorR==ti.RightRod&&(null!=this.rigthBindJoint&&this.rigthBindJoint.enabled)}IsSupportRodBindWall(){return this.userLorR==ti.RightRod?null!=this.leftBindJoint&&this.leftBindJoint.enabled:this.userLorR==ti.LeftRod&&(null!=this.rigthBindJoint&&this.rigthBindJoint.enabled)}GetOperateSprite(){return this.userLorR==ti.LeftRod?this.leftLeg:this.userLorR==ti.RightRod?this.rightLeg:null}GetSupportSprite(){return this.userLorR==ti.LeftRod?this.rightLeg:this.userLorR==ti.RightRod?this.leftLeg:null}GetOperateRigid(){return this.userLorR==ti.LeftRod?this.leftRigid:this.userLorR==ti.RightRod?this.rightRigid:null}GetSupportRigid(){return this.userLorR==ti.LeftRod?this.rightRigid:this.userLorR==ti.RightRod?this.leftRigid:null}GetSupportRoleRodType(){return this.userLorR==ti.LeftRod?ti.RightRod:this.userLorR==ti.RightRod?ti.LeftRod:ti.None}LeftPackRodRunAnimEnd(){null!=this.leftTween&&(this.leftTween=null)}RightPackRodRunAnimEnd(){null!=this.RightTween&&(this.RightTween=null)}PackUpRodAnim(){this.RodFloorAnim(this.runPivotLorR[1]/50),this.leftLeg.off(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.off(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter),GI.timerMgr.once(50,this,()=>{null!=this.leftLeg&&(this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClickEnter),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClickEnter))})}RemoveRodTween(t){t==ti.LeftRod?null!=this.leftTween&&(this.leftTween.clear(),this.leftTween.recover(),this.leftTween=null):t==ti.RightRod&&null!=this.RightTween&&(this.RightTween.clear(),this.RightTween.recover(),this.RightTween=null)}RodFloorAnim(t){let i;this.userLorR==ti.LeftRod?(i=this.leftRvltJoint.joint,this.leftWeldJoint.enabled=!1,this.ClearTorque(this.leftRigid),this.RemoveRodTween(this.userLorR),this.leftTween=GI.Tween.to(i.m_localAnchorB,{y:t},this.rodTweenTime,null,Laya.Handler.create(this,this.LeftPackRodRunAnimEnd),0,!1,!1)):this.userLorR==ti.RightRod&&(i=this.rightRvltJoint.joint,this.rightWeldJoint.enabled=!1,this.ClearTorque(this.rightRigid),this.RemoveRodTween(this.userLorR),this.RightTween=GI.Tween.to(i.m_localAnchorB,{y:t},this.rodTweenTime,null,Laya.Handler.create(this,this.RightPackRodRunAnimEnd),0,!1,!1))}onRoleDeathDetect(t,i){if("Hurt"==t.label||"HurtRodRupture"==t.label){{let t=i==ti.LeftRod?this.leftLeg:this.rightLeg,e=t.getChildByName("rod");if(e.numChildren>0){let t=e.removeChildAt(0);t&&t.destroy()}let s=i==ti.LeftRod?this.leftRodRupture:this.rightRodRupture;t.addChild(s[0]),s[0].x=6,s[0].y=20;let r=i==ti.LeftRod?this.leftBox:this.rightBox;r.width=s[0].width,r.height=s[0].height;let a={x:6,y:150},o=$t.StartAnim(a,.7);t.addChild(o.sprite),o.sprite.x=6,o.sprite.y=150,a=this.LocalToGlobal(t,6,150),s[1].addComponent(Laya.RigidBody),Xi.i.mapCtrl.roleLayer.addChild(s[1]),s[1].x=a.x,s[1].y=a.y;let h=s[1].addComponent(Laya.BoxCollider);h.width=s[1].width,h.height=s[1].height,h.density=r.density}this.RoleDeath()}}PlayRodAnim(t){this.isRoleDeath||(t==ti.LeftRod?this.leftRodAnimPlay&&(this.leftRodAnimPlay=!1,this.leftAnim.play(0,!1)):this.rightRodAnimPlay&&(this.rightRodAnimPlay=!1,this.rightAnim.play(0,!1)))}CreateRole(t=230,i=600){this.CreateRoleSprites(t,i),this.followRole.x=t,this.followRole.y=i,this.roleRodCollCtrl=new qt,this.roleRodCollCtrl.onEnable(this),this.roleRodCollCtrl.isLeftRodShow=!0,this.leftLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onLeftRigidClick),this.rightLeg.once(Laya.Event.TRIGGER_ENTER,this,this.onRightRigidClick),this.leftLeg.on(Laya.Event.TRIGGER_ENTER,this,t=>{if(this.onRoleDeathDetect(t,ti.LeftRod),!t.isSensor){if(this.userLorR==ti.LeftRod&&Laya.timer.currFrame-this.leftCollideTime>2&&(this.leftCollideTime=Laya.timer.currFrame),this.leftAway){this.GetContactEdge(this.leftCfqRigid).length>0&&(this.leftAway=!1)}this.IsInRodUP(ti.LeftRod)&&0==this.isjump&&0==this.IsRodSameSide()&&0==this.isMouseDown&&this.AddLeftJoint(t,!1,!0,!0),this.userLorR!=ti.LeftRod&&(this.leftRigid.allowRotation=!0),null!=t.rigidBody&&"HammerItem"==t.rigidBody.label&&this.removeWheelJoint(ti.None)}}),this.rightLeg.on(Laya.Event.TRIGGER_ENTER,this,t=>{if(this.onRoleDeathDetect(t,ti.RightRod),!t.isSensor){if(this.userLorR==ti.RightRod&&Laya.timer.currFrame-this.rightCollideTime>2&&(this.rightCollideTime=Laya.timer.currFrame),this.rightAway){this.GetContactEdge(this.rightCfqRigid).length>0&&(this.rightAway=!1)}this.IsInRodUP(ti.RightRod)&&0==this.isjump&&0==this.IsRodSameSide()&&0==this.isMouseDown&&this.AddRightJoint(t,!1,!0,!0),this.userLorR!=ti.RightRod&&(this.rightRigid.allowRotation=!0),null!=t.rigidBody&&"HammerItem"==t.rigidBody.label&&this.removeWheelJoint(ti.None)}}),this.leftLeg.on(Laya.Event.TRIGGER_EXIT,this,t=>{t.isSensor||(this.userLorR==ti.LeftRod?this.leftCollideTime=Laya.timer.currFrame:this.GetContactEdge(this.leftCfqRigid).length<=0&&null==this.leftBindJoint&&(this.leftRigid.allowRotation=!1))}),this.rightLeg.on(Laya.Event.TRIGGER_EXIT,this,t=>{t.isSensor||(this.userLorR==ti.RightRod?this.rightCollideTime=Laya.timer.currFrame:this.GetContactEdge(this.rightCfqRigid).length<=0&&null==this.rigthBindJoint&&(this.rightRigid.allowRotation=!1))})}RemoveRodRuptureObject(t){if(t.length>0)for(let i=0;i<t.length;++i)Yi.RemoveNodes(t[i])}GetrodRuptureObjs(t,i){let e="",s=[];i==ti.RightRod?(this.RemoveRodRuptureObject(this.rightRodRupture),this.rightRodRupture=[],e="right"):(this.RemoveRodRuptureObject(this.leftRodRupture),this.leftRodRupture=[],e="left");for(let i=1;i<3;++i){let r=t.getChildByName(e+i);Xi.i.mapCtrl.roleLayer.addChild(r),r.x=-1e3,r.y=-1e3,s.push(r)}i==ti.RightRod?this.rightRodRupture=s:this.leftRodRupture=s}GetRodAnim(t){for(;t.numChildren>0;)if("anim"==(t=t.getChildAt(0)).name)return t;return null}StopRodAnim(t){t==ti.LeftRod?null!=this.leftAnim.player?this.leftAnim.player.stop():GI.timerMgr.once(5,this,t=>{this.StopRodAnim(t)},[ti.LeftRod]):null!=this.rightAnim.player?this.rightAnim.player.stop():GI.timerMgr.once(5,this,t=>{this.StopRodAnim(t)},[ti.RightRod])}ShowRod(){if(null==this.leftLeg||this.isRoleDeath)return;let t=new Laya.Prefab;t.json=GI.resMgr.getRes(Xi.i.data.rodData.curUseData.scResBase);let i=t.create(),e=this.leftLeg.getChildByName("rod"),s=e.getChildByName("left");null!=s&&(e.removeChildAt(0),s.destroy());let r=i.getChildByName("left"),a=r.y;e.addChild(r),r.x=r.pivotX,r.y=a;let o=this.rightLeg.getChildByName("rod"),h=i.getChildByName("right"),n=h.y,l=o.getChildByName("right");null!=l&&(o.removeChildAt(0),l.destroy()),o.addChild(h),h.x=h.pivotX,h.y=n,this.leftAnim=this.GetRodAnim(r);let d=Xi.i.data.rodData.curUseData.id;this.rodUrl;this.leftAnim.load("res/rod/rod"+d+"/rod"+d+"_left.sk",Laya.Handler.create(this,this.StopRodAnim,[ti.LeftRod])),this.rightAnim=this.GetRodAnim(h),this.rightAnim.load("res/rod/rod"+d+"/rod"+d+"_right.sk",Laya.Handler.create(this,this.StopRodAnim,[ti.RightRod])),this.GetrodRuptureObjs(i,ti.LeftRod),this.GetrodRuptureObjs(i,ti.RightRod)}createRoleGarnish(t){if(!t)return;let i=this.roleShow.getChildByName(t.data.bindPtName);if(i.numChildren>0){let t=i.removeChildAt(0);t&&t.destroy()}if(null!=t.curUseData){GI.util.bindPros(i,t.data.scPtPros);let e=new Laya.Prefab;e.json=GI.resMgr.getRes(t.curUseData.scRes);let s=i.addChild(e.create());t.curUseData.showPros&&t.curUseData.showPros[Xi.i.data.bodyData.curUseID]&&GI.util.bindPros(s,t.curUseData.showPros[Xi.i.data.bodyData.curUseID].sc)}}CreateRoleGarnishHat(){this.createRoleGarnish(Xi.i.data.hatData)}CreateRoleGarnishJewelry(){this.createRoleGarnish(Xi.i.data.jewelryData)}CreateRoleShow(t=230,i=600){null!=this.roleShow&&Yi.RemoveNodes(this.roleShow);let e=new Laya.Prefab;e.json=this.rolePrefabData,this.roleShow=e.create();let s=this.roleShow.getComponent(Laya.ColliderBase);s.density=.05,s.friction=1;let r=this.roleShow.getComponent(Laya.RigidBody);r.category=16,r.mask=1,r.linearDamping=.5,Xi.i.mapCtrl.roleLayer.addChildAt(this.roleShow,this.LeftRodLayer),this.roleShow.pos(t,i),this.roleFace=this.roleShow.getChildByName("Face"),this.CreateRoleGarnishHat(),this.CreateRoleGarnishJewelry(),this._leftArm.initRole(this.roleShow.getChildByName("leftArm"),this.leftLeg),this._rightArm.initRole(this.roleShow.getChildByName("rightArm"),this.rightLeg),this._leftLeg.initRole(this.roleShow.getChildByName("leftLeg"),this.leftLeg),this._rightLeg.initRole(this.roleShow.getChildByName("rightLeg"),this.rightLeg),this.AddRoleShowJoint()}AddRoleShowJoint(){let t=this.roleShow.getComponent(Laya.RigidBody);t.gravityScale=1,t.allowRotation=!1;let i=this.roleShow.getComponent(Laya.ColliderBase);i.density=.001,i.label="role",this.roleShow.on(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision),this.role.on(Laya.Event.TRIGGER_ENTER,this,this.OnRoleCollision);let e=new Laya.MotorJoint;e.otherBody=this.roleRigid,e.linearOffset=[this.roleBoxSize[2]/2,this.roleBoxSize[2]/2],e.correctionFactor=.5,e.maxTorque=0,e.maxForce=1e5,this.roleShow.addComponentIntance(e)}onTTTa(t,i){i.isSensor||(t==ti.LeftRod?this.leftAway=!1:this.rightAway=!1)}ontttb(t,i){i.isSensor||(t==ti.LeftRod?(0==this.isRemove&&(this.leftAway=!0),this.isRemove=!1):(0==this.isRemove&&(this.rightAway=!0),this.isRemove=!1))}CreateBalloon(t,i,e){this.balloons=new Array;let s=40;if(this.isNewbie){let r=4;0==this.isDangling&&(2==this.balloonNum?(r=3,s=30):1==this.balloonNum?(r=2,s=10):(r=0,s=0));for(let s=0;s<r;++s){let r=t.getChildByName("balloon"+s);r.x=i,r.y=e,this.balloons.push(r),Xi.i.mapCtrl.roleLayer.addChild(r)}return s}return 0}CreateRoleSprites(t=230,i=600){let e=new Laya.Prefab;e.json=this.rodPrefabData;let s=e.create();this.role=s.getChildByName("role"),this.roleBoxSize[2]=this.role.width,this.roleBoxSize[3]=this.role.height,Xi.i.mapCtrl.roleLayer.addChild(this.role),this.roleBox=this.role.getComponent(Laya.BoxCollider),this.roleRigid=this.role.getComponent(Laya.RigidBody);let r=this.CreateBalloon(s,t,i);this.leftLeg=s.getChildByName("left"),Xi.i.mapCtrl.roleLayer.addChild(this.leftLeg),this.LeftRodLayer=Xi.i.mapCtrl.roleLayer.numChildren,this.leftCfqRigid=this.leftLeg.getChildByName("cfq").getComponent(Laya.RigidBody),this.leftBox=this.leftLeg.getComponent(Laya.BoxCollider),this.leftRigid=this.leftLeg.getComponent(Laya.RigidBody),this.leftRigid.body.SetUserData("Rod"),this.leftDistanceJoint=this.leftLeg.getComponent(Laya.DistanceJoint),this.leftDistanceJoint.destroy(),this.role.x=t,this.role.y=i,this.leftLeg.x=t,this.leftLeg.y=i,this.leftRvltJoint=this.leftLeg.addComponentIntance(this.CreateRevoluteJoint(this.roleRigid,this.pivotLorR)),this.leftWeldJoint=this.leftLeg.addComponentIntance(this.CreateWeldJoint(this.roleRigid,this.pivotLorR)),this.leftWeldJoint.enabled=!1,this.rightLeg=s.getChildByName("right"),Xi.i.mapCtrl.roleLayer.addChild(this.rightLeg),this.rightCfqRigid=this.rightLeg.getChildByName("cfq").getComponent(Laya.RigidBody),this.rightBox=this.rightLeg.getComponent(Laya.BoxCollider),this.rightRigid=this.rightLeg.getComponent(Laya.RigidBody),this.rightRigid.body.SetUserData("Rod"),this.rightDistanceJoint=this.rightLeg.getComponent(Laya.DistanceJoint),this.rightDistanceJoint.destroy(),this.rightLeg.x=t,this.rightLeg.y=i,this.rightRvltJoint=this.rightLeg.addComponentIntance(this.CreateRevoluteJoint(this.roleRigid,this.pivotLorR)),this.rightWeldJoint=this.rightLeg.addComponentIntance(this.CreateWeldJoint(this.roleRigid,this.pivotLorR)),this.rightWeldJoint.enabled=!1;this.rightRigid.linearDamping=.1,this.rightRigid.angularDamping=.1,this.leftRigid.linearDamping=.1,this.leftRigid.angularDamping=.1,this.roleRigid.linearDamping=.1,this.roleRigid.angularDamping=.1,this.isNewbie&&(this.leftRigid.angularDamping=r,this.rightRigid.angularDamping=r),this.isDangling&&this.role.addComponent(Laya.RevoluteJoint),this.leftAllowRotation=!1,this.rightAllowRotation=!1;let a=this.leftLeg.getChildByName("cfq");a.on(Laya.Event.TRIGGER_ENTER,this,this.onTTTa,[ti.LeftRod]),a.on(Laya.Event.TRIGGER_EXIT,this,this.ontttb,[ti.LeftRod]);let o=this.rightLeg.getChildByName("cfq");o.on(Laya.Event.TRIGGER_ENTER,this,this.onTTTa,[ti.RightRod]),o.on(Laya.Event.TRIGGER_EXIT,this,this.ontttb,[ti.RightRod])}AddBoxCollider(t,i,e,s,r){let a=new Laya.BoxCollider;return a.x=i,a.y=e,a.width=s,a.height=r,a.restitution=0,a.friction=5e3,t.addComponentIntance(a),a}AddPolygonCollider(t){let i=new Laya.PolygonCollider;return i.friction=5e3,i.points="0,0,8,0,8,190,6,196,4,198,2,196,0,190",t.addComponentIntance(i),i}AddRigidBody(t,i,e=1,s=!1){let r=new Laya.RigidBody;return r.category=i,r.mask=e,r.allowSleep=!1,r.bullet=!0,t.addComponentIntance(r),s&&this.SetMassData(r,this.pivotLorR[0]/50,this.pivotLorR[1]/50),r}CreateRevoluteJoint(t,i=null){let e=new Laya.RevoluteJoint;return e.otherBody=t,e.anchor=null==i?this.pivotLorR:i,e}CreateWeldJoint(t,i=null){let e=new Laya.WeldJoint;return e.otherBody=t,e.frequency=0,e.anchor=null==i?this.pivotLorR:i,e}CreateDistanceJoint(t,i,e=[20,20],s=[3,3]){let r=new Laya.DistanceJoint;return r.enabled=!1,r.otherAnchor=e,r.selfAnchor=s,r.otherBody=i,r.selfBody=t,r.length=.001,r.enabled=!0,r}CreatePrismaticJoint(t,i){let e=new Laya.PrismaticJoint;return e.otherBody=t,e.anchor=i,e.axis=[0,1],e}CreateSprite(t,i,e,s,r,a,o,h){return null==t&&(t=new Laya.Sprite,Xi.i.mapCtrl.roleLayer.addChild(t)),t.loadImage(i),t.width=e,t.height=s,t.pivot(r,a),t.x=o,t.y=h,t}setNormalFace(){this.setFace(ei.normal)}setDangerFace(t){t?this._curRoleFace==ei.normal&&this.setFace(ei.danger):0==this.isRoleDeath&&this.setNormalFace()}setWinFace(){this.setFace(ei.win)}setFailFace(){this.setFace(ei.fail)}setFace(t){this._curRoleFace=t,this.roleFace.loadImage(Xi.i.data.bodyData.curUseData.faceImgBase+this.faceUrls[this._curRoleFace])}}class oi{constructor(t,i){this.adType="nativeAd",this._visible=!1,this._curAdIndex=-1,this._uBtn=t,this._pros=i,this._pros&&this._pros.adType&&(this.adType=this._pros.adType),this._adIconBg=this._uBtn.asCom.getChild("adIconBg"),this._btnAdClose=this._uBtn.asCom.getChild("btnAdClose"),this._icon=new Laya.Sprite,this._icon.mouseEnabled=!0,this._uBtn.displayObject.addChild(this._icon),this._uBtn.displayObject.setChildIndex(this._icon,this._uBtn.asCom.getChildIndex(this._adIconBg)+1),this._uBtn.visible=!1}static create(t,i=null){return new oi(t,i)}get visible(){return this._visible}get iconX(){return this._icon.x}get iconY(){return this._icon.y}get iconWidth(){return this._icon.displayWidth}get iconHeight(){return this._icon.displayHeight}bindNativeAdEvt(t){return t.bindUiClick(this._icon,()=>{this._adData&&GI.pf.reportAdClick({adData:this._adData,adInfo:this._adData.adList[this._curAdIndex]})}),t.bindUiClick(this._btnAdClose,()=>{this._uBtn.visible=!1}),this}doShow(){this._visible=!0,this._adData=GI.pf.showNativeAd({adType:this.adType,pros:this._pros}),this._adData?this.updateData():this._pros&&this._pros.closeOnEmpty?this.doHide():this.onNativeAdError()}doHide(){this._visible=!1,this.clearData(!0),this.closeFunc&&this.closeFunc()}clearData(t=!1){t&&(this._uBtn.visible=!1),GI.timerMgr.clear(this,this.onNativeAdTimer),GI.timerMgr.clear(this,this.onNativeAdErrorTimer);let i=this._adData;this._adData=null,this._curAdIndex=-1,GI.pf.hideNativeAd({adData:i})}get adData(){return this._adData}updateData(){this._curAdIndex=-1,this.onNativeAdTimer(),GI.timerMgr.loop(GI.gCfg.nativeAdTime,this,this.onNativeAdTimer)}onNativeAdTimer(){if(this._curAdIndex++,this._curAdIndex>=this._adData.adList.length)return this.clearData(),void this.doShow();let t=this._adData.adList[this._curAdIndex];GI.pf.reportAdShow({adData:this._adData,adInfo:t}),t&&t.imgUrlList&&this._icon.loadImage(t.imgUrlList[0],GI.handle(this,()=>{this._pros&&this._pros.fill?this._icon.size(this._uBtn.width,this._uBtn.height):(this._icon.scaleX=this._icon.scaleY=this._pros&&this._pros.keepOrigin?Math.min(1,.8*Laya.stage.designWidth/this._icon.texture.width,.8*Laya.stage.designHeight/this._icon.texture.height):Math.min(this._uBtn.width/this._icon.texture.width,this._uBtn.height/this._icon.texture.height),this._icon.size(this._icon.texture.width,this._icon.texture.height)),this._adIconBg.setSize(this._icon.displayWidth-2*this._adIconBg.x,this._icon.displayHeight-2*this._adIconBg.y),this._pros&&this._pros.keepOrigin&&this._uBtn.setSize(this._icon.displayWidth,this._icon.displayHeight),this._uBtn.visible=!0,this.loadImageFunc&&this.loadImageFunc(t)}))}onNativeAdError(){this.clearData(!0),GI.timerMgr.once(GI.gCfg.nativeAdErrorTime,this,this.onNativeAdErrorTimer)}onNativeAdErrorTimer(){this.doShow()}}class hi{constructor(t){this._startIndex=-1,this._uBtn=t}static create(t,i=null){return GI.util.bindPros(t,i),new hi(t)}bindNativeAdEvt(t){t.bindGEvt("pf.onHtBoxGame",t=>{this.onHtBoxGame(t)}),t.bindUiEvt(this._uBtn.asCom.getChild("list"),fgui.Events.CLICK_ITEM,this.onItemClick.bind(this)),this._uBtn.asCom.getChild("list").asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this._uBtn.asCom.getChild("list").asList.setVirtual()}doShow(){this._uBtn.visible=!1,GI.gMsgCet.event("pf.getHtBoxGame")}doHide(){GI.timerMgr.clear(this,this.updateHtBoxGame)}onHtBoxGame(t){this._boxGames=t&&t.dataList||[],this._uBtn.visible=!0,this._startIndex=-1,this.updateHtBoxGame(),GI.timerMgr.loop(GI.gCfg.htBoxGamesFrequency,this,this.updateHtBoxGame)}updateHtBoxGame(){this._startIndex=(this._startIndex+1)%this._boxGames.length,this._uBtn.asCom.getChild("list").asList.numItems=Math.min(GI.gCfg.htBoxGmaeColors.length,this._boxGames.length)}renderListItem(t,i){if(!i)return;t=(this._startIndex+t)%this._boxGames.length,i.data=t;let e=this._boxGames[t];i.asCom.getChild("txtGName").asLabel.text=e.txt,i.asCom.getChild("txtMark").asLabel.text=e.mark,i.asCom.getChild("imgMarkBg").visible=!!e.mark,e.mark&&(i.asCom.getChild("imgMarkBg").asImage.color=GI.gCfg.htAdMarkColors[e.mark]||GI.gCfg.htAdMarkColors.default),i.asCom.getChild("bg").asImage.color=GI.gCfg.htBoxGmaeColors[t%GI.gCfg.htBoxGmaeColors.length];let s=i.asCom.getChild("icoCon").asCom,r=s.displayObject.getChildByName("img");r||((r=new Laya.Sprite).name="img",r.size(s.width,s.height),s.displayObject.addChild(r)),r.loadImage(e.iconUrl)}onItemClick(t,i){if(!t||null==t.data)return;let e=this._boxGames[Number(t.data)];e&&GI.gMsgCet.event("pf.goHtBoxGame",{htData:e})}}class ni extends GI.UIViewBase{constructor(){super(...arguments),this.currentScore=0,this.targetScore=0,this.rankCount=0,this.get_rank=0,this.totalRank=3,this.isNewRecord=!1,this.isSkLoaded=!1}createPanel(){this.needMask=!0,this.createPanelUI("WmSucView"),this.makeFullScreen(),this._gameBox=hi.create(this.u("center")),this.txtScore=this.u("txtScore").asTextField}doBindEvt(){this.bindUiClick("btnLevel",()=>{this.hideSelf(),GI.uiViewMgr.showView("ChallengeView",{chapterId:Xi.i.curChapter})}),this.bindUiClick("btnRestart",()=>{this.hideSelf(),Xi.i.reStart()}),this.bindUiClick("btnNext",()=>{if(Xi.i.data.isGameLastLevel(Xi.i.curChapter,Xi.i.curLvl))return this.hideSelf(),GI.gInfoMgr.showInfoCont(1,"恭喜！游戏已通关！"),void GI.uiViewMgr.showView("ChapterView");let t=Xi.i.data.usingProp[Xi.i.data.commercialCfg.prop_enum.double_point];Xi.i.data.currentRank(t&&t.count>0)>=3||Xi.i.data.isNextLvlUnlock(Xi.i.curChapter,Xi.i.curLvl)?(this.hideSelf(),this.mgr.checkStartLvl()):GI.uiViewMgr.showView("UnlockChapterView")}),this._nativeAd=oi.create(this.u("nativeAd")).bindNativeAdEvt(this),this._gameBox.bindNativeAdEvt(this),this.bindGEvt("pf.InsertAdView.show",()=>{GI.pf.hideBanner({sourceType:127})}),this.bindGEvt("pf.InsertAdView.hide",()=>{GI.pf.showBanner({sourceType:125})})}doShow(t){t&&t.onGameShow||(null!=t&&null!=t.isNewRecord&&(this.isNewRecord=t.isNewRecord),this.isSkLoaded?this.setUIData():this.loadSk(),GI.pf.hideBanner({sourceType:2}),GI.pf.showInsertAd({sourceType:this.viewID})&&GI.pf.showBanner({sourceType:1}),this._nativeAd.doShow(),GI.uiViewMgr.hideView("NativeAdView"),this._gameBox.doShow())}doHide(t){t&&t.onGameHide||(GI.pf.hideBanner({sourceType:1}),GI.pf.showBanner({sourceType:2}),this._nativeAd.doHide(),this._gameBox.doHide(),GI.uiViewMgr.showView("NativeAdView"),this.resetUi())}resetUi(){this.u("imgNewRecord").visible=!1,this.panel.getTransition("showNewRecord").playReverse();for(let t=1;t<=this.totalRank;t++)this["showStarSk"+t].visible=!1}setUIData(){let t=Xi.i.data.chapterData[Xi.i.curChapter].levels[Xi.i.curLvl-1];this.get_rank=t.lastRank,this.u("txtLvl").asTextField.text=Xi.i.curChapter+"-"+Xi.i.curLvl,this.u("txtBestScore").asTextField.text=t.bestScore.toString();for(let i=1;i<=this.totalRank;i++)this.u("maxStar"+i).visible=i<=t.bestRank;this.isNewRecord&&(this.panel.getTransition("showNewRecord").play(),this.u("imgNewRecord").visible=!0),this.currentScore=0,this.targetScore=t.lastScore,this.txtScore.text=this.currentScore.toString(),GI.timerMgr.loop(50,this,this.loopIncreaseScore),this.rankCount=1,this.loopShowStar(),GI.timerMgr.loop(500,this,this.loopShowStar)}loopIncreaseScore(){this.currentScore+4933>=this.targetScore?(this.currentScore=this.targetScore,GI.timerMgr.clear(this,this.loopIncreaseScore)):this.currentScore+=4933,this.txtScore.text=this.currentScore.toString()}loopShowStar(){if(this.rankCount>this.get_rank)return void GI.timerMgr.clear(this,this.loopShowStar);let t=this["showStarSk"+this.rankCount];t.visible=!0,t.play(0,!1),this.panel.getTransition("panel_tremble").play(),this.rankCount++}loadSk(){let t="showStarSk";for(let i=1;i<=this.totalRank;i++)null==this[t+i]&&(this[t+i]=new Laya.Skeleton,this.u("starBg"+i).displayObject.addChild(this[t+i]),this[t+i].pos(this.u("starBg"+i).width/2,this.u("starBg"+i).height/2),this[t+i].load("res/ani/fx_star_show/Balttle_Icon_Xingxing.sk",GI.handle(this,()=>{this[t+i].stop(),i==this.totalRank&&(this.setUIData(),this.isSkLoaded=!0)})))}}class li extends GI.UIViewBase{constructor(){super(...arguments),this.maskPros={alpha:0}}createPanel(){this.needMask=!0,this.createPanelUI("WmFailView"),this.makeFullScreen(),this._gameBox=hi.create(this.u("center"))}doBindEvt(){this.bindUiClick("btnLevel",()=>{this.hideSelf(),GI.uiViewMgr.showView("ChallengeView",{chapterId:Xi.i.curChapter})}),this.bindUiClick("btnRestart",()=>{this.hideSelf(),Xi.i.reStart()}),this.bindUiClick("btnMenu",()=>{this.hideSelf(),GI.uiViewMgr.showView("SysMainUi")}),this._nativeAd=oi.create(this.u("nativeAd")).bindNativeAdEvt(this),this._gameBox.bindNativeAdEvt(this),this.bindGEvt("pf.InsertAdView.show",()=>{GI.pf.hideBanner({sourceType:127})}),this.bindGEvt("pf.InsertAdView.hide",()=>{GI.pf.showBanner({sourceType:125})})}doShow(){this.setUIData(),GI.pf.hideBanner({sourceType:2}),GI.pf.showInsertAd({sourceType:this.viewID})||GI.pf.showBanner({sourceType:1}),this._nativeAd.doShow(),this._gameBox.doShow(),GI.uiViewMgr.hideView("NativeAdView")}doHide(){GI.pf.hideBanner({sourceType:1}),GI.pf.showBanner({sourceType:2}),this._nativeAd.doHide(),this._gameBox.doHide(),GI.uiViewMgr.showView("NativeAdView")}setUIData(){let t=Xi.i.data.chapterData[Xi.i.curChapter].levels[Xi.i.curLvl-1];this.u("txtLvl").asTextField.text=Xi.i.curChapter+"-"+Xi.i.curLvl;for(let i=1;i<=t.bestRank;i++)this.u("maxStar"+i).visible=!0;this.u("txtBestScore").asTextField.text=t.bestScore.toString()}}class di extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("WmGuideView")}doHide(){}}class gi extends GI.UIViewBase{createPanel(){this.createPanelUI("WmGuide2View")}doShow(){GI.timerMgr.once(6e3,this,this.hideSelf)}}class ui extends GI.UIViewBase{createPanel(){this.autoShowOnGShow=!1,this.createPanelUI("WmLvlStartView")}doBindEvt(){this.bindGEvt("Wm.curLvl",()=>{GI.timerMgr.clear(this,this.hideSelf),this.u("imgLvlBg").asLabel.title=this.mgr.curLvl.toString(),this.panel.getTransition("trScale").play(),GI.timerMgr.once(3600,this,this.hideSelf)},!0)}}class ci extends GI.UIViewBase{createPanel(){this.autoShowOnGShow=!1,this.createPanelUI("WmGetCoinView"),this.makeFullScreen()}doShow(t){if(!t)return void this.hideSelf();let i=this.globalToLocal(GI.gMsgCet.fetch("SysMainUI.Coin.Pos"));if(!i)return;let e=t.index;1==e&&(this.u("txtGold").alpha=1,this.u("txtGold").asLabel.text=""),this.u("txtGold").setXY(i.x-60,i.y+40);let s=this.globalToLocal(t.o.localToGlobal(Laya.Point.create()));this.panel.displayObject.addChild(t.o),GI.Tween.fromTo(t.o,{x:s.x,y:s.y},{x:i.x-20,y:i.y-20},700,null,GI.handle(this,this.onCoinMoveEnd,[e,this.mgr.money2+e,t.o]),300)}doHide(){this.mgr.data.updateMoney2()}onCoinMoveEnd(t,i,e){this.u("txtGold").asLabel.text="+"+t.toString(),this.mgr.money2=i,e&&e.destroy(),5==t&&GI.Tween.to(this.u("txtGold"),{alpha:0},800,null,GI.handle(this,this.hideSelf),500)}}class pi{constructor(){this._debug=!1,this._offX=0,this._offY=0,this.delayTime=10,this.outstripRun=1,this._cameraPosX=0,this._cameraPosY=0,this._targetX=0,this._targetY=0,this._minSceneX=-2500,this._maxSceneX=100,this._minSceneY=0,this._maxSceneY=800,this._sceneOffsetStartX=700,this.elasticBackTime=200,this.elasticDistanse=100,this.bBackAction=!1,this.minScale=.6,this.maxScale=.75,this._curScale=1,this._userScale=0,this.lastDistance=0,this.startTween=null,this.bIsPerformance=!1,this.bMoveDown=!1,this.mousePoint={x:0,y:0},this._offPtX=0,this._offPtY=0,this._bIsShark=!1,this._sharkCallBack=null,this.isAcceptCommand=!0,this.scScale=.8,this._showText=null,this._showInfo=""}get cameraPosX(){return this._cameraPosX}set cameraPosX(t){this._cameraPosX!=t&&(this._cameraPosX=t,GI.sceneMgr.mapX=this._cameraPosX)}get cameraPosY(){return this._cameraPosY}set cameraPosY(t){this._cameraPosY!=t&&(this._cameraPosY=t,GI.sceneMgr.mapY=this._cameraPosY)}get curMinXOffset(){return this._minSceneX*this.curScale+GI.gw()}get curMaxXOffset(){return this._maxSceneX*this.curScale}get curMinYOffset(){return this._minSceneY*this._curScale+GI.gh()}get curMaxYOffset(){return this._maxSceneY*this._curScale}get curTopY(){return-(this._minSceneY*this._userScale+GI.gh())}get curslingshotX(){return this._offX-Xi.i.data.birdPos[0].x*this._curScale}get curslingshotY(){return this._offY-Xi.i.data.birdPos[0].y*this._curScale}get curPigX(){return Xi.i.data.tagPos?this._offX-Xi.i.data.tagPos.x*this._curScale:this.curslingshotX-this._sceneOffsetStartX*this._curScale}get curPigY(){return Xi.i.data.tagPos?this._offY-Xi.i.data.tagPos.y*this._curScale:this.curslingshotY}get curScale(){return this._curScale}set curScale(t){this._curScale=t,GI.sceneMgr.mapScale=this._curScale,this.cameraPosY=this._targetY=this.returnLimitY(this.curslingshotY)}get offPtX(){return this._offPtX}set offPtX(t){this._offPtX!=t&&(this._offPtX=t,this.updateOffX())}get offPtY(){return this._offPtY}set offPtY(t){this._offPtY!=t&&(this._offPtY=t,this.updateOffY())}init(t=-770,i=175){this._minSceneX=Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].minX,this._maxSceneX=Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].maxX,this._minSceneY=Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].minY,this._maxSceneY=Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].maxY,this.maxScale=Xi.i.mapCtrl.mapConfig.defCamInitScale?Xi.i.mapCtrl.mapConfig.defCamInitScale:.8,this.minScale=Xi.i.mapCtrl.mapConfig.defMinScale?Xi.i.mapCtrl.mapConfig.defMinScale:.6,Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].minScale&&(this.maxScale=Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].initScale),Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].minScale&&(this.minScale=Xi.i.mapCtrl.mapConfig.mapCfg[Xi.i.curLvl].minScale),this.offPtX=.3,this.offPtY=.3,this.curScale=this.maxScale,this._userScale=this.curScale,this.isAcceptCommand=!0,this.resetStatus(),GI.gMsgCet.on("onGResize",this,this.onGResizeAtcion),GI.gMsgCet.on("abCtrl.MOUSE_DOWN",this,this.onMouseDown),GI.gMsgCet.on("abCtrl.MOUSE_UP",this,this.onMouseUp),GI.gMsgCet.on("abCtrl.MOUSE_OUT",this,this.onMouseUp),GI.gMsgCet.on("Wm.onFinishLvl",this,this.onLvlOver),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_End",this,this.onLvlOver),GI.gMsgCet.on("ab.onLvlShow",this,this.onLvlShow),GI.gMsgCet.on("ab.camLookAtPig",this,this.onLookAtPig),this.bBackAction=!1,this.bMoveDown=!1,this.performanceBegin(this.curPigX,this.returnLimitY(this.curPigY),this.curslingshotX,this.returnLimitY(this.curslingshotY),500,1500),this._debug&&(this.debugShow(),Laya.stage.on(Laya.Event.KEY_DOWN,this,this.onKeyDown))}onLvlShow(){this.isAcceptCommand=!1;let t=Math.abs(this.curslingshotX-this.cameraPosX)/1.5;this.moveTo(this.curslingshotX,this.returnLimitY(this.curslingshotY),t,0,this.onLvlShowFinish)}onLvlShowFinish(){GI.gMsgCet.event("ab.camArriveShotPos"),this.onLvlOver()}onLvlOver(){this.isAcceptCommand=!1,this._targetX=this.cameraPosX,this._targetY=this.cameraPosY,this.resetStatus()}onLookAtPig(){this.isAcceptCommand=!1;let t=Math.abs(this.curPigX-this.cameraPosX)/1.5;this.moveTo(this.curPigX,this.returnLimitY(this.curPigY),t,0,this.onLookAtPigFinish)}onLookAtPigFinish(){GI.gMsgCet.event("ab.camShake",{shadkeDuration:2e3}),this._targetX=this.cameraPosX,this._targetY=this.cameraPosY,this.shake(10,3,2e3,this.onShakeFinish),GI.timerMgr.frameLoop(1,this,this.shakeUpdate)}onShakeFinish(){GI.timerMgr.clear(this,this.shakeUpdate),this.isAcceptCommand=!0}onGResizeAtcion(){this.updateOffX(),this.updateOffY(),this.cameraPosY=this._targetY=this.returnLimitY(this.curslingshotY)}onMouseDown(t){this.bIsPerformance&&this.onPerformanceOver(),this.mousePoint.x=Laya.stage.mouseX,this.mousePoint.y=Laya.stage.mouseY;let i=t.touches;null!=i?i&&i.length<=1?this.bMoveDown=!0:i&&2==i.length&&(this.bMoveDown=!1,this.lastDistance=this.getDistance(i),GI.gMsgCet.on("abCtrl.MOUSE_MOVE",this,this.onChangeScale)):this.bMoveDown=!0}onMouseUp(t){this.bMoveDown=!1,GI.gMsgCet.off("abCtrl.MOUSE_MOVE",this,this.onChangeScale),this.checkArea()}onChangeScale(t){t.touches;let i=this.getDistance(t.touches);let e=this.curScale+.003*(i-this.lastDistance);e>this.minScale&&e<this.maxScale&&(this.curScale=e,this._userScale=e),this.cameraPosX<this.curMinXOffset?this._targetX=this.cameraPosX=this.curMinXOffset:this.cameraPosX>this.curMaxXOffset&&(this._targetX=this.cameraPosX=this.curMaxXOffset),this.lastDistance=i}getDistance(t){let i=0;if(t&&2==t.length){let e=t[0].stageX-t[1].stageX,s=t[0].stageY-t[1].stageY;i=Math.sqrt(e*e+s*s)}return i}shake(t,i,e,s=null){this._bIsShark||(this._bIsShark=!0,this._sharkStrengthX=t,this._sharkStrengthY=i,this._sharkDuration=e,this._elapsedTime=0,this._initPosX=this.cameraPosX,this._initPosY=this.cameraPosY,s&&(this._sharkCallBack=s))}shakeUpdate(){this._elapsedTime+=GI.timerMgr.delta;let t=(this._sharkDuration-this._elapsedTime)/this._sharkDuration;if(t<0)return t=0,this._bIsShark=!1,this.cameraPosX=this._initPosX,this.cameraPosY=this._initPosY,void(null!=this._sharkCallBack&&(this._sharkCallBack(),this._sharkCallBack));let i=this.getRand(-this._sharkStrengthX,this._sharkStrengthX)*t,e=this.getRand(-this._sharkStrengthY,this._sharkStrengthY)*t;this.cameraPosX=this._initPosX+i,this.cameraPosY=this._initPosY+e}getRand(t,i){return Math.random()*(i-t)+t}onUpdate(){this._debug&&this.updateInfo(),this.isAcceptCommand&&(this.bBackAction||this.bIsPerformance||(Xi.i.roleCtrl.isCmeraToBird?this.lookUpBird():Xi.i.roleCtrl.isCmeraToTrigger?this.CameraToTrigger():!Xi.i.roleCtrl.isMouseBird&&this.bMoveDown&&this.onMouseDownMove()))}resetStatus(){Xi.i.roleCtrl.isCmeraToBird=!1,Xi.i.roleCtrl.isCmeraToTrigger=!1,this.bIsPerformance=!1,this.bMoveDown=!1,this.bBackAction=!1}lookUpBird(){this._targetX=this._offX-Xi.i.roleCtrl.roleX*this.curScale;(Xi.i.roleCtrl.roleY-100)*this.curScale<this.curTopY?this.curScale-.003>this.minScale&&(this.curScale-=.003):(Xi.i.roleCtrl.roleY-100)*this.curScale>this.curTopY&&this.curScale+.003<this._userScale&&(this.curScale+=.003),this.moveToTarget(this.curMinXOffset,this.curMaxXOffset)}CameraToTrigger(){this._targetX=this.curslingshotX,this.moveToTarget(this.curMinXOffset,this.curMaxXOffset)}onMouseDownMove(){if(this.bBackAction)return;let t=1.5*(Laya.stage.mouseX-this.mousePoint.x);this._targetX=this._targetX+t,this.moveToTarget(this.curMinXOffset-this.elasticDistanse*this._curScale,this.curMaxXOffset+this.elasticDistanse*this._curScale),this.mousePoint.x=Laya.stage.mouseX,this.mousePoint.y=Laya.stage.mouseY}moveToTarget(t,i){if(this._targetX<t&&(this._targetX=t),this._targetX>i&&(this._targetX=i),this.cameraPosX>this.curPigX&&this.cameraPosX<this.curslingshotX){let t=(this.cameraPosX-this.curslingshotX)/(this.curPigX-this.curslingshotX);this.cameraPosY=this._targetY=this.curslingshotY+t*(this.curPigY-this.curslingshotY)}else this.cameraPosX<this.curPigX?this.cameraPosY=this._targetY=this.curPigY:this.cameraPosX>this.curslingshotX&&(this.cameraPosY=this._targetY=this.curslingshotY);this._targetY=this.cameraPosY=this.returnLimitY(this.cameraPosY),Math.abs(this.cameraPosX-this._targetX)>this.outstripRun&&(this.cameraPosX+=this.GetDelayData(this.cameraPosX,this._targetX,this.delayTime))}GetDelayData(t,i,e){let s=i-t,r=s;return r=s>this.outstripRun||s<-this.outstripRun?(r=s/e)>0?r<this.outstripRun?this.outstripRun:r:r>-this.outstripRun?-this.outstripRun:r:0}returnlimitX(t){return t<this.curMinXOffset?this.curMinXOffset:t>this.curMaxXOffset?this.curMaxXOffset:t}returnLimitY(t){return t<this.curMinYOffset?this.curMinYOffset:t>this.curMaxYOffset?this.curMaxYOffset:t}checkArea(){this.cameraPosX<this.curMinXOffset?this.backToArea(this.curMinXOffset):this.cameraPosX>this.curMaxXOffset&&this.backToArea(this.curMaxXOffset)}backToArea(t){this.bBackAction=!0,GI.Tween.to(this,{cameraPosX:t},this.elasticBackTime,Laya.Ease.sineOut,Laya.Handler.create(this,this.backToAreaFinish))}backToAreaFinish(){this.bBackAction=!1,this._targetX=this.cameraPosX,this._targetY=this.cameraPosY,this.mousePoint.x=Laya.stage.mouseX,this.mousePoint.y=Laya.stage.mouseY}updateOffX(){this._offX=this._offPtX*GI.gw()}updateOffY(){this._offY=this._offPtY*GI.gh()}moveForward(t,i=500){GI.Tween.to(this,{scScale:t},i)}onPlay(){GI.Tween.to(this,{offPtX:Xi.i.isPlay?.25:.5},500)}onLvlOn(){GI.Tween.to(this,{offPtY:Xi.i.isLvlOn?.45:.6},500),this.moveForward(Xi.i.isLvlOn?1:1.5)}moveTo(t,i,e,s,r=null){let a=t,o=i;this.startTween=GI.Tween.to(this,{cameraPosX:a,cameraPosY:o},e,GI.Ease.linearIn,Laya.Handler.create(this,r),s,!0)}performanceBegin(t,i,e,s,r,a){this.bIsPerformance=!0,this.cameraPosX=t,this.cameraPosY=i;let o=e,h=s;this.startTween=GI.Tween.to(this,{cameraPosX:o,cameraPosY:h},r,GI.Ease.linearIn,Laya.Handler.create(this,this.onPerformanceOver),a,!0)}onPerformanceOver(){null!=this.startTween&&(this.startTween.clear(),this.startTween=null),this._targetX=this.cameraPosX,this._targetY=this.cameraPosY,this.bIsPerformance=!1}get roleUiX(){return GI.uiViewMgr.getUIX(this._offX)}get roleUiY(){return GI.uiViewMgr.getUIY(this._offY)}get roleTopUiY(){return this.roleUiY}scToUi(t){return Laya.Point.create().setTo(t.x+this.cameraPosX,t.y+this.cameraPosY)}onKeyDown(t){t.keyCode==Laya.Keyboard.A&&(console.log("width: "+GI.gw()),console.log("height: "+GI.gh()),console.log("cameraPosX: "+this.cameraPosX),console.log("cameraPosY: "+this.cameraPosY),console.log("offPtX: "+this.offPtX),console.log("offPtY: "+this.offPtY),console.log("offX: "+this._offX),console.log("offY: "+this._offY),console.log("curMinXOffset: "+this.curMinXOffset),console.log("curMaxXOffset: "+this.curMaxXOffset),console.log("curMinYOffset: "+this.curMinYOffset),console.log("curMaxYOffset: "+this.curMaxYOffset),console.log("curScale: "+this.curScale),console.log("弹弓位置: "+Xi.i.data.birdPos[0].x),console.log("弹弓位置: "+Xi.i.data.birdPos[0].y),console.log("curPigX: "+this.curPigX),console.log("curPigY: "+this.curPigY),console.log("curslingshotX: "+this.curslingshotX),console.log("curslingshotY: "+this.curslingshotY),console.log("this.bBackAction: "+this.bBackAction),console.log("this.bIsPerformance: "+this.bIsPerformance),console.log("WmMgr.i.roleCtrl.isCmeraToBird: "+Xi.i.roleCtrl.isCmeraToBird),console.log("WmMgr.i.roleCtrl.isCmeraToTrigger: "+Xi.i.roleCtrl.isCmeraToTrigger),console.log("this.bMoveDown: "+this.bMoveDown)),t.keyCode==Laya.Keyboard.B&&(this.curScale==this.maxScale?(this.curScale=this.minScale,this._userScale=this.curScale):this.curScale==this.minScale&&(this.curScale=this.maxScale,this._userScale=this.curScale)),t.keyCode==Laya.Keyboard.C&&this.shake(10,10,2e3),t.keyCode==Laya.Keyboard.D&&GI.gMsgCet.event("ab.camLookAtPig")}debugShow(){null==this._showText&&(this._showText=new Laya.Text,this._showText.x=Laya.stage.width/4,this._showText.y=Laya.stage.height/4,this._showText.fontSize=30,Laya.stage.addChild(this._showText))}updateInfo(){this._showInfo="isAcceptCommand: "+this.isAcceptCommand+"\n",this._showInfo+="bBackAction: "+this.bBackAction+"\n",this._showInfo+="this.bIsPerformance: "+this.bIsPerformance+"\n",this._showInfo+="WmMgr.i.roleCtrl.isCmeraToBird: "+ +Xi.i.roleCtrl.isCmeraToBird+"\n",this._showInfo+="WmMgr.i.roleCtrl.isCmeraToTrigger: "+Xi.i.roleCtrl.isCmeraToTrigger+"\n",this._showInfo+="this.bMoveDown: "+this.bMoveDown+"\n",this._showText.text=this._showInfo}}class mi extends GI.UIViewBase{createPanel(){this.createPanelUI("WmDangerView"),this.makeFullScreen()}doBindEvt(){this.bindGEvt("Wm.onLvlEnd",this.hideSelf)}doShow(){GI.timerMgr.frameLoop(1,this,this.doOnUpdate),this.doOnUpdate()}doHide(){GI.timerMgr.clear(this,this.doOnUpdate)}doOnUpdate(){this.u("img").asImage.setXY(this.mgr.roleUiX-36,this.mgr.roleTopUiY+30)}}class yi extends GI.UIViewBase{createPanel(){this.autoShowOnGShow=!1,this.createPanelUI("WmDangerView"),this.makeFullScreen()}doBindEvt(){this.bindGEvt("Wm.onLvlEnd",this.hideSelf)}doShow(t){this.param=t,GI.timerMgr.frameLoop(1,this,this.doOnUpdate),this.doOnUpdate()}doHide(){GI.timerMgr.clear(this,this.doOnUpdate)}doOnUpdate(){this.u("img").asImage.setXY(this.mgr.roleUiX+340,this.mgr.roleUiY-240)}}class fi extends GI.CfgCtrl{constructor(t){super(),this._curUseID=-1,this._flag=t}get data(){return this._data}get activeCfgs(){return this._activeCfgs}get activeCount(){return this._activeCfgs?this._activeCfgs.length:0}parseCfgData(t){this._data=t,GI.cfgMgr.parseCfgData(this.data.datas,{ctrl:this}),this.every((t,i,e)=>{(t.price<=0||GI.localDataMgr.getBool("Wm.isActiveID."+this._flag+"."+t.id))&&this.active(t.id)})}active(t){let i=this.getCfg(t);i&&!i.active&&(i.active=!0,this._activeCfgs||(this._activeCfgs=[]),this._activeCfgs.push(i),GI.localDataMgr.setBool("Wm.isActiveID."+this._flag+"."+i.id,!0),GI.gMsgCet.event("Wm.part.active",{partData:this,id:t,cfg:i}),GI.gMsgCet.event("Wm.part.active."+this._flag,{partData:this,id:t,cfg:i}))}isActive(t){let i=this.getCfg(t);return i&&i.active}get canActiveCount(){let t=0;return this.every((i,e,s)=>{!i.active&&Xi.i.money>=i.price&&t++}),t}get curUseID(){return this._curUseID<0&&(this._curUseID=GI.localDataMgr.getInt("Wm.curUseID."+this._flag)),this._curUseID}set curUseID(t){this._curUseID!=t&&(this.active(t),this._curUseID=t,GI.localDataMgr.setInt("Wm.curUseID."+this._flag,this._curUseID),GI.gMsgCet.event("Wm.part.curUseID."+this._flag,{id:this._curUseID}),GI.gMsgCet.event("Wm.part.curUseID",{partData:this,id:this._curUseID}))}get curUseData(){return this.getCfg(this.curUseID)}}class Ii{constructor(t,i,e){this.x=t,this.y=i,this.type=e}}class Ci{constructor(t,i){this.x=t,this.y=i}}class wi{constructor(){this.offsetPos=new Array,this.birdPos=new Array,this._groundY=0,this._mapWidht=0,this._mapHeight=0,this._maxRightx=-1,this._minLeftx=-1,this._maxY=-1,this._minY=-1,this.guideSceneLvl=2e4,this._totalLvl=1,this._MaxGameGrade=0,this._gameGrade=0,this._money=-1,this._money2=-1,this._curChapter=-1,this._curLvl=-1,this._finishedLvl=-1,this._curStep=0,this._historyPlayTimes=-1,this._playTimes=0,this._propGuideId=-1,this._viewBeforeGuide={},this._bodyData=new fi("body"),this._rodData=new fi("rod"),this._hatData=new fi("hat"),this._jewelryData=new fi("jewelry"),this._guideStep=0}setOffsetPos(t,i){let e=new Ci(t,i);this.offsetPos.push(e)}clearOffsetPos(){for(;this.offsetPos.pop(););}getOffsetPos(){return this.offsetPos}setCurBirdPos(t,i,e){let s=new Ii(t,i,e);this.birdPos.push(s)}clearBirdPos(){for(;this.birdPos.pop(););}getBirdPos(){return this.birdPos}getBirdPosByIndex(t){return this.birdPos[t]}get groundY(){return this._groundY}set groundY(t){this._groundY=t}get mapWidht(){return this._mapWidht}set mapWidht(t){this._mapWidht=t}get mapHeight(){return this._mapHeight}set mapHeight(t){this._mapHeight=t}get maxRightX(){return this._maxRightx}set maxRightX(t){t>this._maxRightx&&(this._maxRightx=t)}get minLeftX(){return this._minLeftx}set minLeftX(t){t<this._minLeftx&&(this._minLeftx=t)}get maxY(){return this._maxY}set maxY(t){t>this._maxRightx&&(this._maxY=t)}get minY(){return this._minY}set minY(t){t<this._minLeftx&&(this._minY=t)}get tagPos(){return this._tagPos}set tagPos(t){this._tagPos=t}get scoreUiCfg(){return this._scoreUiCfg}set scoreUiCfg(t){this._scoreUiCfg=t}get commercialCfg(){return this._commercialCfg}set commercialCfg(t){this._commercialCfg=t}get soundsCfg(){return this._soundsCfg}set soundsCfg(t){this._soundsCfg=t}get usingProp(){return null==this._usingProp&&this.resetUsingProp(),this._usingProp}set usingProp(t){this._usingProp=t}get courseData(){return this._courseData=GI.localDataMgr.getJSON("course_data"),this._courseData}set courseData(t){this._courseData=t,GI.localDataMgr.setJSON("course_data",this._courseData)}get totalLvl(){return this._totalLvl}get MaxGameGrade(){return this._MaxGameGrade}set MaxGameGrade(t){this._MaxGameGrade=t}set GameGrade(t){this._gameGrade=t}get GameGrade(){return this._gameGrade}AddGrade(t){this._gameGrade+=t,GI.gMsgCet.event("ab.AddGrade")}get money(){return this._money<0&&(this._money=GI.localDataMgr.getInt("Wm.money")),this._money}set money(t){this._money!=t&&(this._money=t,GI.localDataMgr.setInt("Wm.money",this._money),GI.gMsgCet.event("Wm.money"))}get money2(){return this._money2<0&&(this._money2=this.money),this._money2}set money2(t){this._money2!=t&&(this._money2=t,GI.gMsgCet.event("Wm.money2"))}updateMoney2(){this.money2=this.money}get props(){return this._props=GI.localDataMgr.getJSON("commercial_props"),this._props}set props(t){this._props=t,GI.localDataMgr.setJSON("commercial_props",this._props),GI.gMsgCet.event("ab.prop_change")}get curChapter(){return this._curChapter}set curChapter(t){this._curChapter!=t&&(this._curChapter=t)}get chapterData(){return this._chapterData=GI.localDataMgr.getJson("chapter_data"),this._chapterData}set chapterData(t){this._chapterData=t,GI.localDataMgr.setJson("chapter_data",this._chapterData)}getLevelsAmount(t){return this.chapterData[t].levels.length}getCurMapLvl(){return this.isGuideScene&&this.commercialCfg.prop[this.propGuideId]?this.commercialCfg.prop[this.propGuideId].map_id:this.chapterCfgs[this.curChapter].levels[this.curLvl-1].map_id}get curLvl(){return this._curLvl<0&&(this._curLvl=GI.localDataMgr.getInt("Wm.curLvl")),this._curLvl}set curLvl(t){this._curLvl!=t&&(this._curLvl=t,this._playTimes=0,GI.localDataMgr.setInt("Wm.curLvl",this._curLvl),GI.gMsgCet.event("Wm.curLvl"))}get finishedLvl(){return this._finishedLvl<0&&(this._finishedLvl=GI.localDataMgr.getInt("Wm.finishedLvl")),this._finishedLvl}set finishedLvl(t){t>=this.guideSceneLvl||(t>=1e4?GI.localDataMgr.setBool("Wm.challenge."+t,!0):(this._finishedLvl=t,GI.localDataMgr.setInt("Wm.finishedLvl",this._finishedLvl)))}get curStep(){return this._curStep}set curStep(t){this._curStep!=t&&(this._curStep=t,GI.gMsgCet.event("Wm.curStep"))}get historyPlayTimes(){return this._historyPlayTimes<0&&(this._historyPlayTimes=GI.localDataMgr.getInt("Wm.historyPlayTimes")),this._historyPlayTimes}set historyPlayTimes(t){this._historyPlayTimes!=t&&(this._historyPlayTimes=t,GI.localDataMgr.setInt("Wm.historyPlayTimes",this._historyPlayTimes))}get playTimes(){return this._playTimes}addPlayTimes(){this._playTimes++,this.historyPlayTimes++}get chapterCfgs(){return this._chapterCfgs}get BirdCfgs(){return this.birdCfgs}get ModuleCfgs(){return this.birdCfgs.modules}get propGuideId(){return this._propGuideId}set propGuideId(t){this._propGuideId=t}clearPropGuideId(){this.propGuideId=-1}get viewBeforeGuide(){return this._viewBeforeGuide}setViewBeforeGuide(t,i,e){this._viewBeforeGuide.view=t,null!=i&&(this._viewBeforeGuide.chapter=i),null!=e&&(this._viewBeforeGuide.lvl=e)}get bodyData(){return this._bodyData}get curBodyID(){return this.bodyData.curUseID}set curBodyID(t){this.bodyData.curUseID=t}get rodData(){return this._rodData}get curRodID(){return this.rodData.curUseID}set curRodID(t){this.rodData.curUseID=t}get hatData(){return this._hatData}get curHatID(){return this.hatData.curUseID}set curHatID(t){this.hatData.curUseID=t}get jewelryData(){return this._jewelryData}get curJewelryID(){return this.jewelryData.curUseID}set curJewelryID(t){this.jewelryData.curUseID=t}preInit(){this._totalLvl=GI.gCfg.wmMaxLevel}onCfgsLoaded(){this._roleCfgs=GI.resMgr.getRes("res/role/roleCfg.json"),this._roleCfgs&&(this._bodyData.parseCfgData(this._roleCfgs.body),this._rodData.parseCfgData(this._roleCfgs.rod),this._hatData.parseCfgData(this._roleCfgs.hat),this._jewelryData.parseCfgData(this._roleCfgs.jewelry)),this.curBodyID<=0&&(this.curBodyID=1),this.curRodID<=0&&(this.curRodID=1),this._chapterCfgs=GI.resMgr.getRes("res/chapter/chapterCfg.json"),this.scoreUiCfg=GI.resMgr.getRes("res/score/scoreUiCfg.json"),this.birdCfgs=GI.resMgr.getRes("res/role/birdCfg.json"),this.commercialCfg=GI.resMgr.getRes("res/score/commercialCfg.json"),this.soundsCfg=GI.resMgr.getRes("res/sound/soundsCfg.json"),this.initLocalData()}get checkStartLvl(){return this.curLvl>=this.getLevelsAmount(this.curChapter)?(this.curChapter<this.getChapterCount()&&this.curChapter++,1):this.curLvl+1}get canActiveCount(){return this.bodyData.canActiveCount+this.rodData.canActiveCount+this.hatData.canActiveCount+this.jewelryData.canActiveCount}get guideStep(){return this._guideStep}set guideStep(t){this._guideStep!=t&&(this._guideStep=t,GI.gMsgCet.event("Wm.guideStep"))}get isGuideScene(){return this.propGuideId>0}initLocalData(){this.initLvlData(),this.initPropData(),this.initCourseData()}initLvlData(){let t=this.chapterData,i=Xi.i.data.chapterCfgs;if(null!=t)for(let e in i){let s=i[e].levels.length,r=t[e].levels.length;if(s<r){let i=r-s;t[e].levels.splice(s,i)}else if(s>r)for(let a=r+1;a<=s;a++){let s=i[e].levels[a-1];t[e].levels.push({id:s.id,lastScore:0,bestScore:0,lastRank:0,bestRank:0,name:s.name,locked:a==r+1&&t[e].levels[r-1]&&0==t[e].levels[r-1].locked?0:1})}}else{t={};for(let e in i){t[e]={locked:"1"==e?0:1,levels:[]};for(let s of i[e].levels)t[e].levels.push({id:s.id,lastScore:0,bestScore:0,lastRank:0,bestRank:0,name:s.name,locked:1==s.id?0:1})}}this.chapterData=t}updateChapterData(t,i){let e=this.chapterData,s=e[this.curChapter].levels,r=!1;return e[this.curChapter].levels[this.curLvl-1].lastScore=t,e[this.curChapter].levels[this.curLvl-1].lastRank=i,t>s[this.curLvl-1].bestScore&&(r=!0,e[this.curChapter].levels[this.curLvl-1].bestScore=t),i>s[this.curLvl-1].bestRank&&(e[this.curChapter].levels[this.curLvl-1].bestRank=i),this.chapterData=e,r}isNextLvlUnlock(t,i){let e=!1,s=this.chapterData;return i>=s[t].levels.length?t<this.getChapterCount()&&s[t+1].levels.length>0&&(e=0==s[t+1].levels[0].locked):e=0==s[t].levels[i].locked,e}unlockLevel(t,i){if(0==t&&!i)return!1;let e=-1,s=-1,r=this.chapterData;for(let t in r){let i=Number(t);if(1==r[i].locked){let t=0;for(let a of r[i-1].levels){if(1==a.locked){e=i-1,s=t;break}t++}-1==s&&(e=i,s=0);break}if(i==this.getChapterCount()){-1==e&&(e=i);let t=0;for(let a of r[e].levels){if(1==a.locked){e=i,s=t;break}t++}break}}if(-1!=e&&-1!=s){if(i){for(let t=s;t<r[e].levels.length;t++)r[e].levels[t].locked=0;r[e].locked=0}else{let i=s+t-this.getLevelsAmount(e);if(i>=0){for(let t=s;t<this.getLevelsAmount(e);t++)r[e].levels[t].locked=0;if(r[e].locked=0,e<this.getChapterCount())return this.chapterData=r,this.unlockLevel(i,!1)}else{r[e].locked=0;for(let i=s;i<s+t;i++)r[e].levels[i].locked=0}}return this.chapterData=r,GI.gMsgCet.event("ab.chapter_update"),!0}return!1}getChapterCount(){return Object.keys(this.chapterData).length}getUiCfgByEventId(t,i){if(t<this.birdCfgs.modules.datas.length){let e=this.birdCfgs.modules.datas[t].score_ui_id[i];if(null!=e)return this.scoreUiCfg[e]}return null}currentRank(t){let i=0,e=(t?2*this.GameGrade:this.GameGrade)/this.MaxGameGrade;for(let t in GI.gCfg.rankCfg)e>=GI.gCfg.rankCfg[t]&&i++;return i}isGameLastLevel(t,i){let e=!1;return i>=this.chapterData[t].levels.length&&(e=!(t<this.getChapterCount())||this.chapterData[t+1].levels.length<=0),e}initPropData(){let t=this.props;if(null==t){t={};for(let i in this.commercialCfg.prop)t[i]={name:this.commercialCfg.prop[i].name,quantity:0,guide_done:0}}else{for(let i in t)this.commercialCfg.prop.hasOwnProperty(i)||delete t[i];for(let i in this.commercialCfg.prop)t.hasOwnProperty(i)||(t[i]={name:this.commercialCfg.prop[i].name,quantity:0,guide_done:0})}this.props=t}buyPropUpdateData(t){let i=this.props;i[t.type_id].quantity+=t.count,this.props=i,this.money-=t.cost,GI.gMsgCet.event("ab.get_prop",t)}presentUpdateData(t,i){let e=this.props;e[t].quantity+=i,this.props=e,GI.gMsgCet.event("ab.get_prop")}usePropUpdateData(t,i){if(!i){let i=this.props;i[t].quantity>0&&(i[t].quantity--,this.props=i)}this.usingProp[t].count++,GI.gMsgCet.event("ab.use_prop",{prop_id:t})}resetUsingProp(){this.usingProp={};for(let t in this.props)this.usingProp[t]={count:0}}initCourseData(){let t=this.courseData;if(null==t){t={};for(let i in GI.gCfg.coursePageCfg)t[i]={show_count:0}}else{for(let i in t)GI.gCfg.coursePageCfg.hasOwnProperty(i)||delete t[i];for(let i in GI.gCfg.coursePageCfg)t.hasOwnProperty(i)||(t[i]={show_count:0})}this.courseData=t}finishPropGuide(t){let i=this.props;(null==i[t].guide_done||i[t].guide_done<=0)&&(i[t].guide_done=1,this.props=i,this.presentUpdateData(t,5))}}class bi extends GI.UIViewBase{constructor(){super(...arguments),this._lockMouse=!1,this._guideDes={1:"拖动您的手指控制高跷",2:"将高跷移动到目标位置",3:"将高跷移动到目标位置",4:"走一步",5:"走到检查点",6:"走到第二个检查点",7:"跨过障碍",8:"走到终点"},this._guideStep=1}createPanel(){this._layer=GI.UiLayerEnum.base,this.createPanelUI("WmCtrGuideView"),this.makeFullScreen()}doBindEvt(){let t=this.u("ctrlArea");this.bindUiEvt(t,Laya.Event.MOUSE_DOWN,t=>{this.mgr.canPlay&&!this._lockMouse&&(GI.gMsgCet.event("wmCtrl.MOUSE_DOWN",t),this.u("handGuide").visible&&(this.u("handGuide").asCom.getTransition("ani").stop(),this.u("handGuide").visible=!1))}),this.bindUiEvt(t,Laya.Event.MOUSE_UP,t=>{this.mgr.canPlay&&!this._lockMouse&&GI.gMsgCet.event("wmCtrl.MOUSE_UP",t)}),this.bindUiEvt(t,Laya.Event.MOUSE_OUT,t=>{this.mgr.canPlay&&!this._lockMouse&&GI.gMsgCet.event("wmCtrl.MOUSE_OUT",t)}),this.bindGEvt("Wm.money2",()=>{this.u("txtGold").asLabel.text=this.mgr.money2.toString()},!0),this.bindUiClick("btnBack",()=>{this.mgr.returnToLvl()}),this.bindGFetch("SysMainUI.Coin.Pos",()=>this.u("imgCoin").localToGlobal()),this.bindGEvt("Wm.onLvlEnd",this.hideSelf),this.bindGEvt("Wm.guideStep",this.updateGuideDes,!0),this.bindGEvt("wmCtrl.RodInPointStart",this.doPrgTw),this.bindGEvt("wmCtrl.RodInPointOut",this.clearPrgTw)}doShow(){GI.pf.showBanner({sourceType:6})}doPrgTw(){this.clearPrgTw(),this._prgTw=GI.Tween.fromTo(this.u("prg").asCom.getChild("bar"),{alpha:0},{alpha:1},600,null,GI.handle(this,()=>{this._prgTw=null}))}clearPrgTw(){this._prgTw&&(this._prgTw.clear(),this._prgTw=null),this.u("prg").asCom.getChild("bar").alpha=0}updateGuideDes(){switch(this.u("prg").visible=this.mgr.data.guideStep>=2&&this.mgr.data.guideStep<=3,this.u("txtDesBg").visible=this.u("imgOkBg").visible=!0,this.mgr.data.guideStep){case 1:this.u("handGuide").visible=!0,this.u("handGuide").asCom.getTransition("ani").play(null,-1);break;case 2:case 3:this.clearPrgTw();break;case 4:this._lockMouse=!0;default:GI.timerMgr.clear(this,this.onUpdate)}if(this._guideStep==this.mgr.data.guideStep)return GI.timerMgr.clear(this,this.onUpdate),void this.updateGuideDes2();this.u("imgOkBg").asImage.color=this.u("txtDes").asLabel.color="#c5ff63",this.u("imgOk").visible=!0,GI.timerMgr.once(1e3,this,this.updateGuideDes2)}updateGuideDes2(){if(this.visible)switch(this._guideStep=this.mgr.data.guideStep,this._lockMouse=!1,this.u("txtDesBg").visible=this.u("imgOkBg").visible=!!this._guideDes[this.mgr.data.guideStep],this.u("imgOkBg").asImage.color=this.u("txtDes").asLabel.color="#ffffff",this.u("imgOk").visible=!1,this.u("txtDes").asLabel.text=this._guideDes[this.mgr.data.guideStep],this.u("imgOkBg").x=(GI.gw()-(this.u("imgOkBg").width+this.u("txtDes").asLabel.width+10))/2,this.u("txtDes").x=this.u("imgOkBg").x+this.u("imgOkBg").width+10,this.mgr.data.guideStep){case 4:GI.uiViewMgr.showView("WmGuideView")}}onUpdate(){let t=this.globalToLocal(this.mgr.camera.scToUi(this._prgGPt));this.u("prg").setXY(t.x,t.y)}}class Ri extends GI.UIViewBase{createPanel(){this.autoShowOnGShow=!1,this.createPanelUI("WmStepView")}doShow(){this.panel.getTransition("aniUpDown").play(),GI.timerMgr.once(3e3,this,this.hideSelf)}}class Li extends GI.UIViewBase{constructor(){super(...arguments),this.startClick=!1,this.fastClickCount=0,this.maxClickCount=8,this.alreadyShowAd=!1}createPanel(){this.needMask=!0,this.createPanelUI("WmRewardView"),this.makeFullScreen(),this.chestTrembleAni=this.panel.getTransition("chest_tremble"),this.panel.getTransition("ui_enter").play(),this.hideAd()}doBindEvt(){this.bindUiClick("btnOpenChest",this.ClickOpenChestBtn),this.bindUiClick("btnNextStep",this.nextStep)}doShow(){this.u("bottom").visible=!0,this.panel.getTransition("ui_enter").play(),GI.pf.hideBanner({sourceType:6})}doHide(){GI.pf.showBanner({sourceType:6})}ClickOpenChestBtn(){let t=Date.now();if(this.chestTrembleAni.playing||this.chestTrembleAni.play(),this.startClick)if(this.clickInterval=t-this.currentTime,this.currentTime=t,this.clickInterval<500){this.fastClickCount++;let t=Math.random()*this.maxClickCount-1;!this.alreadyShowAd&&this.fastClickCount>=t&&(this.popAd(),setTimeout(()=>{this.hideAd()},2e3)),this.fastClickCount>=this.maxClickCount&&this.OpenChest()}else this.fastClickCount=1;else this.startClick=!0,this.currentTime=t,this.fastClickCount=1}OpenChest(){this.u("bottom").visible=!1,this.panel.getTransition("open_chest").play()}popAd(){this.alreadyShowAd=!0,GI.pf.showBanner({sourceType:127,bannerAdStyle:GI.gCfg.rewardBnAdStyle})}hideAd(){}afterShowAd(){this.hideAd(),this.OpenChest()}nextStep(){this.hideSelf(),GI.uiViewMgr.showView("WmSucView")}}class Gi{preInit(){}initRole(t=230,i=710){}RemoveRole(){}GetMousePos(){let t=Laya.Point.create();return t.x=Laya.stage.mouseX,t.y=Laya.stage.mouseY,t}onUpdate(){}StartPhysicsDebug(){ji.physicsDebug&&Laya.PhysicsDebugDraw.enable(-1)}UpdatePhysicsRun(){ji.physicsDebug&&null!=Laya.PhysicsDebugDraw.I&&(Laya.PhysicsDebugDraw.I.x=GI.sceneMgr.worldRoot.x,Laya.PhysicsDebugDraw.I.y=GI.sceneMgr.worldRoot.y,Laya.PhysicsDebugDraw.I.scaleX=GI.sceneMgr.worldRoot.scaleX,Laya.PhysicsDebugDraw.I.scaleY=GI.sceneMgr.worldRoot.scaleY)}AddInRigidWorld(t,i=-1){null!=t&&(i>=0?GI.sceneMgr.worldRoot.addChildAt(t,i):GI.sceneMgr.worldRoot.addChild(t))}Clamp(t,i,e){return t<i?t=i:t>e&&(t=e),t}}class Si extends Laya.Script{constructor(){super(),this.roleUrl="res/role/Rabit_jump.sk",this.crouchedCollDatas=[],this.standingDatas=["18,98,48,82,38,97,51,126,22,133,17,120,14,108","24,133,52,126,52,157,46,169,26,173,20,163"],this.crouched=!0}SetCrouched(t){this.crouched=t,this.roleJumpSkil.play(0,!1);let i=this.role.getComponents(Laya.PolygonCollider);for(let t=0;t<i.length;++t){let e=i[t];"PolygonCollider"!=e.label&&e.destroy()}if(this.crouched){this.roleJumpSkil.index=11;let t=this.role.addComponent(Laya.PolygonCollider);t.points=this.crouchedCollDatas[0],t.label="1",t.density=8,t.friction=5e3;let i=this.role.addComponent(Laya.PolygonCollider);i.points=this.crouchedCollDatas[1],i.label="2",i.density=8,i.friction=5e3}else{this.roleJumpSkil.index=6;let t=this.role.addComponent(Laya.PolygonCollider);t.points=this.standingDatas[0],t.label="1",t.density=8,t.friction=5e3;let i=this.role.addComponent(Laya.PolygonCollider);i.points=this.standingDatas[1],i.label="2",i.density=8,i.friction=5e3}}InitRole(){let t=this.role.getChildByName("node");this.roleJumpSkil=t.getChildByName("jump"),this.StopRodAnim();let i=this.role.getComponents(Laya.PolygonCollider);for(let t=0;t<i.length;++t){let e=i[t];"1"==e.label?this.crouchedCollDatas[0]=e.points:"2"==e.label?this.crouchedCollDatas[1]=e.points:"3"==e.label?this.standingDatas[0]=e.points:"4"==e.label&&(this.standingDatas[1]=e.points)}}GetContactEdge(t){let i=new Array;if(null!=t){let e=t.body.GetContactList();for(;null!=e;)i.push(e),e=e.next}return i}RemoveRole(){Yi.RemoveNodes(this.role),this.role.destroy(),this.role=null}IsInRod(){return this.GetContactEdge(this.roleJumpJc).length>0}StopRodAnim(){null!=this.roleJumpSkil.player?this.roleJumpSkil.player.stop():GI.timerMgr.once(5,this,t=>{this.StopRodAnim()})}get x(){return this.role.x}get y(){return this.role.y}set x(t){this.role.x=t}set y(t){this.role.y=t}get IsCrouched(){return this.crouched}get IsKinematic(){return"kinematic"==this.roleRigid.type}}!function(t){t[t.UP=87]="UP",t[t.Down=83]="Down",t[t.Left=65]="Left",t[t.Right=68]="Right"}(si||(si={}));class xi extends Gi{constructor(){super(...arguments),this.RollTorqueCrouching=60,this.RollTorqueStanding=75,this.JumpForce=12,this.JumpCooldownTime=12,this.MaxRoleTorqueSpeed=4.5,this.MinRoleTorqueSpeed=1,this.RoleTorqueSpeed=0,this.rolePrefabData=null,this.rolePath="res/role/role.json",this.doJump=!0,this.Alive=!0,this.isMouseDown=!1,this.addX=0,this.RoleX=0,this.mousex=0}get roleX(){return this.role?this.role.x:-1}get roleY(){return this.role?this.role.y:-1}preInit(){GI.gMsgCet.off("Su.SuRoleTorqu",this,this.SuRoleTorqu),GI.gMsgCet.on("Su.SuRoleTorqu",this,this.SuRoleTorqu),GI.gMsgCet.off("Su.StartRoleStartTorqu",this,this.StartRoleStartTorqu),GI.gMsgCet.on("Su.StartRoleStartTorqu",this,this.StartRoleStartTorqu),GI.gMsgCet.off("Su.EndRoleStartTorqu",this,this.EndRoleStartTorqu),GI.gMsgCet.on("Su.EndRoleStartTorqu",this,this.EndRoleStartTorqu)}InitAttribute(){this.Alive=!0,this.doJump=!0,this.isMouseDown=!1}SuRoleTorqu(t){this.RoleTorqueSpeed=t>=53?this.MaxRoleTorqueSpeed/50*t-this.MaxRoleTorqueSpeed:t<=47?this.MaxRoleTorqueSpeed/47*t-this.MaxRoleTorqueSpeed:0}StartRoleStartTorqu(){this.isMouseDown=!0,this.RoleTorqueSpeed=0}EndRoleStartTorqu(){this.isMouseDown=!1,this.onJump()}initRole(t=230,i=710){if(this.InitAttribute(),null==this.rolePrefabData){let e=[{url:this.rolePath,type:Laya.Loader.JSON}];Laya.loader.load(e,Laya.Handler.create(this,e=>{this.rolePrefabData=Laya.loader.getRes(this.rolePath),this.CreateRoles(t,i)}))}else this.CreateRoles(t,i);this.StartPhysicsDebug()}CreateRoles(t=230,i=710){let e=new Laya.Prefab;e.json=this.rolePrefabData;let s=e.create();this.role=s.getComponent(Si),s.x=t,s.y=i,this.role.InitRole(),this.AddInRigidWorld(s)}RemoveRole(){null!=this.role&&this.role.RemoveRole(),this.role=null}onJump(){if(!(0==this.doJump&&GI.timerMgr.currFrame-this.JumpTime<this.JumpCooldownTime)){if(this.role.IsInRod()){let t=.0174532924*this.role.role.rotation,i=this.JumpForce*Math.sin(t),e=this.JumpForce*Math.cos(t);this.role.roleRigid.body.m_linearVelocity.y=-e,this.role.roleRigid.body.m_linearVelocity.x=i}this.doJump=!1,GI.timerMgr.clear(this,this.JumpAnimEnd),this.role.SetCrouched(!1),GI.timerMgr.frameOnce(6,this,this.JumpAnimEnd)}}JumpAnimEnd(){this.role.SetCrouched(!0)}onRoll(t){t=this.Clamp(t,-1,1),this.role.IsCrouched?this.role.roleRigid.applyTorque(this.RollTorqueCrouching*-t*GI.timerMgr.delta):this.role.roleRigid.applyTorque(this.RollTorqueStanding*-t*GI.timerMgr.delta)}OnMouseRun(){this.isMouseDown&&(this.role.roleRigid.body.m_angularVelocity=this.RoleTorqueSpeed)}onUpdate(){this.UpdatePhysicsRun(),this.OnMouseRun()}}class Mi{constructor(t,i,e){this.uiQueues={},this.isPlaying=!1,this.dataQueue=new _i,this.panel=i,this.transitionCallback=e}addData(t){let i=this.getConfigData(t);return i&&this.dataQueue.Enqueue(t),i}getConfigData(t){for(let i in GI.gCfg.hintConfig.infoTypes)if(i==t.infoCfg.infoType)return this.infoType=GI.gCfg.hintConfig.infoTypes[i],this.infoType.id=t.infoType,!0;return GI.log("HintView.ts -> 未找到hint配置"),!1}loopPlay(){this.isPlaying||this.dataQueue.IsEmpty()||(this.isPlaying=!0,this.playAniFunc(),GI.timerMgr.loop(this.infoType.showInterval,this,this.playAniFunc))}playAniFunc(){if(this.dataQueue.IsEmpty())return this.isPlaying=!1,void GI.timerMgr.clear(this,this.playAniFunc);let t=this.dataQueue.Dequeue(),i=this.uiPoolDequeue(t.infoCfg.id);null==i&&((i=GI.uiViewMgr.createUiObj("HintText").asCom).getChild("hintText").text=t.info,this.panel.addChild(i)),i.getTransition(this.infoType.ani).play(GI.handle(this,()=>{this.uiPoolEnqueue(i,t.infoCfg.id),this.transitionCallback&&this.transitionCallback()}))}uiPoolEnqueue(t,i){if(this.uiQueues&&0!=this.uiQueues.length&&this.uiQueues.hasOwnProperty(i))this.uiQueues[i].Enqueue(t);else{let e=new _i;e.Enqueue(t),this.uiQueues[i]=e}}uiPoolDequeue(t){let i=this.uiQueues[t];return i?i.Dequeue():null}}class _i{constructor(){this.item=[]}Enqueue(t){this.item.push(t)}Dequeue(){return this.IsEmpty()?null:this.item.shift()}Count(){return this.item.length}IsEmpty(){return this.Count()<=0}Clear(){this.item=[]}}class vi extends GI.UIViewBase{constructor(){super(...arguments),this.lastClickTime=0,this.allMessages={},this.timers={}}createPanel(){this.autoShowOnGShow=!1,this._layer=GI.UiLayerEnum.info,this.createPanelUI("HintView"),this.initData()}initData(){this.clickCount=0}doShow(t){if(null==t)return void this.hideSelf();let i=this.allMessages[t.infoCfg.infoType];null==i&&(i=new Mi(t,this.panel,()=>{this.clickCount--,this.clickCount<=0&&(this.clickCount=0,this.hideSelf())}),this.allMessages[t.infoCfg.infoType]=i),i.addData(t)&&(this.clickCount++,i.loopPlay())}}class Pi{static CreateBezierPoints(t,i){for(var e=[],s=0;s<i;s++){var r=this.MultiPointBezier(t,s/i);e.push(r)}return e}static MultiPointBezier(t,i){let e=t.length,s=0,r=0;for(let a=0;a<e;a++){let o=t[a];s+=o.x*Math.pow(1-i,e-1-a)*Math.pow(i,a)*this.erxiangshi(e-1,a),r+=o.y*Math.pow(1-i,e-1-a)*Math.pow(i,a)*this.erxiangshi(e-1,a)}return{x:s,y:r}}static erxiangshi(t,i){let e=1,s=1;for(;i>0;)e*=t,s*=i,t--,i--;return e/s}}class Bi{constructor(t){this.IsTriggerFirst=!0,this.BirdId=0,this.density=10,this.friction=.2,this.gravity=1,this.angularDamping=.2,this.BirdNum=1,this.BirdAnimNum=1,this.isInLauncher=!1,this.birdType=u.RedBird,this.MaxSpeed={x:13,y:25},this.MinSpeed={x:7,y:15},this.size={x:50,y:50},this.rubberNum=6,this.trackIdx=0,this.isCanMouse=!1,this.removeTime=150,this.IsRemoveTime=!1,this.IsTrigger=!1,this.grage=0,this.grageId=5,this.isBiggerBird=!1,this.BiggerBirdNum=2,this.zayanIdx=0,this.rotationSeep=0,this.isRotation=!1,this.BirdRunBezierDatas=null,this.jiaoIdx=0,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=0,this.BirdId=t}InitBird(t,i,e,s){this.launcher=s;let r=new Laya.Prefab;r.json=e;let a=r.create();this.birdSprite=a;let o=Xi.i.data.BirdCfgs.birds[this.birdType];this.grageId=o.moduleId,this.MaxSpeed=o.MaxSpeed,this.MinSpeed=o.MinSpeed,this.density=o.density,this.friction=o.friction,this.gravity=o.gravity,this.angularDamping=o.angularDamping,this.friction=o.friction;let h=Xi.i.data.ModuleCfgs.datas[this.grageId];this.grage=h.grage,this.InitGetAllBirds(),this.IsTriggerFirst=!0,this.isCanMouse=!1,this.IsTrigger=!1,this.IsRemoveTime=!1,Xi.i.data.MaxGameGrade=Xi.i.data.MaxGameGrade+this.grage,GI.sceneMgr.worldRoot.addChild(this.birdSprite),this.bird1.pos(t-this.bird1.pivotX,i-this.bird1.pivotY),this.worldPoint=Laya.Point.create(),this.worldPoint.setTo(this.bird1.x,this.bird1.y),this.OnInitBird(),GI.timerMgr.clear(this,this.UpdateBirdRun),GI.timerMgr.frameOnce(150,this,this.UpdateBirdRun)}OnInitBird(){}ToLauncherInit(){this.bird1.x=this.iPosX,this.bird1.y=this.iPosY,GI.timerMgr.clear(this,this.BirdRun),this.bird1.rotation=0,this.isInLauncher=!0}ToLauncher(){this.ToLauncherInit(),this.birdRigid.type="kinematic",this.PlayLauncher()}BirdVictory(){this.Jump();let t=Laya.Point.create();t.setTo(this.bird1.width/2,this.bird1.height/2),Xi.i.data.AddGrade(this.grage),t=this.bird1.localToGlobal(t,!1,GI.sceneMgr.worldRoot),GI.gMsgCet.event("AddGameGrade",{grage:this.grage,isBird:!0,id:this.grageId,point:{x:t.x,y:t.y},score_type:"destroy"})}UpdateBirdRun(){if(null!=this.bird1){if(this.isInLauncher)Math.random()>.35?this.SquintPhiz():this.ShoutPhiz();else{let t=Math.random();t<.3?(this.SquintPhiz(),this.Jump()):t<.6?this.JumpBirdPhiz():this.ShoutPhiz()}GI.timerMgr.frameOnce(150*Math.random()+100,this,this.UpdateBirdRun)}}InitGetAllBirds(){this.birdRigids=[],this.birdObjList=[],this.birdAnimObjes=[];for(let t=0;t<this.BirdNum;++t){let i=this.birdSprite.getChildByName("bird"+(t+1)),e=i.getComponent(Laya.RigidBody),s=i.getComponents(Laya.ColliderBase);for(let t=0;t<s.length;++t)s[t].density=this.density,s[t].friction=this.friction,s[t].label=this.BirdId+"";0==t?(this.bird1=i,this.iPosX=this.bird1.x,this.iPosY=this.bird1.y,this.birdRigid=e):i.alpha=0,this.birdObjList.push(i),this.birdRigids.push(e),this.InitGetBirdAnim(i),e.linearDamping=0,e.category=2,e.mask=1,e.angularDamping=this.angularDamping,e.gravityScale=this.gravity,e.bullet=!0,e.type="kinematic"}}InitGetBirdAnim(t){let i=[];for(let e=0;e<this.BirdAnimNum;++e){let s=t.getChildByName("bird"+e);i.push(s),e>0&&(s.alpha=0)}this.birdAnimObjes.push(i)}GetWorldPoint(){let t=Laya.Point.create();t.setTo(this.bird1.x,this.bird1.y);let i=GI.sceneMgr.worldRoot;return(t=this.bird1.localToGlobal(t,!1,i)).x+=this.bird1.width/2,t.y+=this.bird1.height/2,t}ToWorld(){let t=this.GetWorldPoint();GI.sceneMgr.worldRoot.addChild(this.bird1),this.bird1.pos(t.x,t.y)}GetBirdSpeed(t,i,e){var s=Laya.Point.create();let r=t.distance(0,0),a=t.y/r,o=t.x/r;return s.x=o*this.MaxSpeed.x*i*e,s.y=a*this.MaxSpeed.y*i,s}RunBird(t,i,e){this.IsTriggerFirst=!0,GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.clear(this,this.UpdateBirdRun),this.birdRigid.type="dynamic",Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun),this.bird1.on(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter,[0]),this.ToWorld();let s=this.GetBirdSpeed(t,i,e);this.birdRigid.linearDamping=0,this.birdRigid.body.m_linearVelocity.x=s.x,this.birdRigid.body.m_linearVelocity.y=s.y,GI.timerMgr.clear(this,this.OnRunTrackLink),this.trackIdx=1,GI.timerMgr.frameLoop(3,this,this.OnRunTrackLink),GI.timerMgr.clear(this,this.RemoveJC),GI.timerMgr.frameOnce(400,this,this.RemoveJC),this.OnRunTrackLink(),this.RunPhiz(),Xi.i.GameMgr.AddRunBird(this),rt.startGameTime=!0,GI.gMsgCet.event("bird_eject",[[this.isBiggerBird,this.birdType==u.ShockWaveBird]])}RemoveJC(){this.RemoveBird()}OnRunTrackLink(){for(let t=0;t<this.birdObjList.length;++t)this.birdObjList[t].alpha>0&&this.CreateTrack(t);this.trackIdx++}StartBiggerBird(){if(this.isBiggerBird)return!1;this.isBiggerBird=!0;for(let t=0;t<this.birdObjList.length;++t){this.birdObjList[t].scaleX=this.BiggerBirdNum,this.birdObjList[t].scaleY=this.BiggerBirdNum,this.birdObjList[t].getComponent(Laya.ColliderBase).resetShape(!0)}return!0}CreateTrack(t){let i=this.birdObjList[t];this.CreateTrackByObj(i)}CreateTrackByObj(t){if(1==t.alpha){let i=Laya.Point.create();i.setTo(t.pivotX,t.pivotY),i=t.localToGlobal(i,!1,GI.sceneMgr.worldRoot),this.launcher.trackCtrl.CreateTrack(i.x,i.y,this.trackIdx)}}OnMouseDownRun(){for(let t=0;t<this.birdObjList.length;++t)this.PlayEffect(t,"mou_eff");return Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun),!this.IsTrigger&&(0==this.isCanMouse&&(this.isCanMouse=!0,this.MousePhiz()),this.PlaySkillSound(),!0)}OnTriggerEnter(t,i){this.IsTriggerFirst=!1,this.isCanMouse=!0,GI.timerMgr.clear(this,this.RemoveJC),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun),this.IsTrigger=!0,0==this.IsRemoveTime&&(this.launcher.isCmeraToBird=!1,this.StartRemoveCountdown(),GI.timerMgr.clear(this,this.OnRunTrackLink),this.launcher.trackCtrl.RemoveOldLink(),this.TriggerPhiz())}StartRemoveCountdown(){this.IsRemoveTime||(this.IsRemoveTime=!0,GI.timerMgr.clear(this,this.RemoveBird),GI.timerMgr.frameOnce(this.removeTime,this,this.RemoveBird))}PlayEffect(t,i="die_eff"){1==this.birdObjList[t].alpha&&this.PlayEffectByObj(this.birdObjList[t],i)}PlayEffectByObj(t,i="die_eff"){let e=Xi.i.data.BirdCfgs.birds[this.birdType][i];null!=e?GI.gMsgCet.event("ab.PlayEffect",[e.url,t.x,t.y,t.rotation,e.scaleX,e.scaleY]):console.error("PlayEffect  错误")}RemoveBird(){if(GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.clear(this,this.RemoveJC),GI.timerMgr.clear(this,this.RemoveBird),GI.timerMgr.clear(this,this.ReductionPhiz),GI.timerMgr.clear(this,this.OnRunTrackLink),GI.timerMgr.clear(this,this.UpdateBirdRun),Xi.i.GameMgr.RemoveRunBird(this),null!=this.bird1){if(this.bird1.off(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter),null!=this.bird1.parent)for(let t=0;t<this.birdObjList.length;++t)this.PlayEffect(t),Yi.RemoveNodes(this.birdObjList[t]),this.birdObjList[t].destroy(!0);this.birdRigids=[],this.birdObjList=[],this.birdAnimObjes=[],this.birdSprite.destroy(!0),this.birdSprite=null,this.bird1=null}}ReductionPhiz(t=0){this.CloseAllPhiz(t),this.birdAnimObjes[t][0].alpha=1}CloseAllPhiz(t=0){if(null!=this.bird1)for(let i=0;i<this.birdAnimObjes[t].length;++i)this.birdAnimObjes[t][i].alpha=0}get birdX(){return this.bird1?this.bird1.x:-1}get birdY(){return this.bird1?this.bird1.y:-1}SquintPhiz(t=0){if(null==this.bird1)return;this.CloseAllPhiz(t),GI.timerMgr.clear(this,this.ReductionPhiz),this.birdAnimObjes[t][this.zayanIdx].alpha=1,GI.timerMgr.frameOnce(10,this,this.ReductionPhiz)}JumpBirdPhiz(){var t=[],i={x:this.bird1.x,y:this.bird1.y};t.push({x:this.bird1.x,y:this.bird1.y}),t.push({x:this.bird1.x,y:this.bird1.y-30}),t.push({x:this.bird1.x,y:this.bird1.y}),this.BirdRunBezierDatas=Pi.CreateBezierPoints(t,25),this.BirdRunBezierDatas.push(i),this.bird1.rotation=0,this.rotationSeep=Math.random()>.5?360/26:-360/26,this.isRotation=!0,GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.frameLoop(1,this,this.BirdRun)}Jump(){this.BirdRunAnim()}BirdRunAnim(){var t=[],i={x:this.bird1.x,y:this.bird1.y};t.push({x:this.bird1.x,y:this.bird1.y}),t.push({x:this.bird1.x,y:this.bird1.y-7}),t.push({x:this.bird1.x,y:this.bird1.y}),this.isRotation=!1,this.BirdRunBezierDatas=Pi.CreateBezierPoints(t,10),this.BirdRunBezierDatas.push(i),t.length=0,t.push({x:this.bird1.x,y:this.bird1.y}),t.push({x:this.bird1.x,y:this.bird1.y-30}),t.push({x:this.bird1.x,y:this.bird1.y}),this.BirdRunBezierDatas=this.BirdRunBezierDatas.concat(Pi.CreateBezierPoints(t,25)),this.BirdRunBezierDatas.push(i),GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.frameLoop(1,this,this.BirdRun)}BirdRun(){if(this.isRotation&&(this.bird1.rotation+=this.rotationSeep),null!=this.BirdRunBezierDatas&&this.BirdRunBezierDatas.length>0){let t=this.BirdRunBezierDatas.pop();this.bird1.pos(t.x,t.y)}else this.isRotation=!1,this.bird1.rotation=0,GI.timerMgr.clear(this,this.BirdRun)}ShoutPhiz(t=0){this.PlayStandbySound(),this.CloseAllPhiz(t),GI.timerMgr.clear(this,this.ReductionPhiz),this.birdAnimObjes[t][this.jiaoIdx].alpha=1,GI.timerMgr.frameOnce(20,this,this.ReductionPhiz)}RunPhiz(t=0){this.PlayRun(),this.CloseAllPhiz(t),this.birdAnimObjes[t][this.feiIdx].alpha=1}MousePhiz(t=0){let i=this.birdAnimObjes[t][this.mouseIdx];null!=i&&(this.CloseAllPhiz(t),i.alpha=1)}TriggerPhiz(t=0){this.CloseAllPhiz(t),this.birdAnimObjes[t][this.triggerIdx].alpha=1}PlayTriggerSound(){this.PlayBirdSound(1)}PlayRun(){this.PlayBirdSound(2)}PlayLauncher(){}PlaySkillSound(){this.PlayBirdSound(4)}PlayStandbySound(){this.PlayBirdSound(5)}PlayBirdSound(t){GI.gMsgCet.event("AB.BirdSound",[this.grageId,t])}}class Di extends Bi{constructor(){super(...arguments),this.BirdAnimNum=5,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.density=10}InitBird(t,i,e,s){i+=28,super.InitBird(t,i,e,s)}OnMouseDownRun(){return!0}}class Ti extends Bi{constructor(){super(...arguments),this.birdType=u.AvatarBird,this.BirdAnimNum=4,this.BirdNum=3,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=3}InitBird(t,i,e,s){i+=25,super.InitBird(t,i,e,s)}OnMouseDownRun(){let t=super.OnMouseDownRun();if(t){let t=GI.sceneMgr.worldRoot,i=this.birdRigid.body.m_linearVelocity.x,e=this.birdRigid.body.m_linearVelocity.y+2;for(let s=1;s<this.birdObjList.length;++s)t.addChild(this.birdObjList[s]),this.birdObjList[s].alpha=1,this.birdObjList[s].pos(this.bird1.x,this.bird1.y),this.birdRigids[s].enabled=!0,this.birdRigids[s].type="dynamic",this.birdRigids[s].body.m_linearVelocity.x=i,this.birdRigids[s].body.m_linearVelocity.y=e,this.birdObjList[s].on(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter,[s]),e-=4}return t}}class Ai extends Bi{constructor(){super(...arguments),this.birdType=u.BombBird,this.BirdAnimNum=7,this.BombForce=13,this.range=5,this.dieRange=1,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.removeTime=350,this.density=30,this.isBomb=!1}InitBird(t,i,e,s){i+=60,super.InitBird(t,i,e,s)}OnMouseDownRun(){let t=super.OnMouseDownRun();return this.RemoveBird(),t}OnTriggerEnter(t,i){0==this.IsRemoveTime&&(GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.frameOnce(60,this,this.OnBombDJS)),super.OnTriggerEnter(t,i),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun)}OnBombDJS(){this.CloseAllPhiz(),this.birdAnimObjes[0][5].alpha=1,GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.frameOnce(50,this,this.OnBombDJS2)}OnBombDJS2(){this.isBomb||(this.CloseAllPhiz(),this.birdAnimObjes[0][6].alpha=1,GI.timerMgr.clear(this,this.OnBombDJS3),GI.timerMgr.frameOnce(30,this,this.OnBombDJS3))}OnBombDJS3(){this.isBomb||(this.CloseAllPhiz(),this.RemoveBird())}RemoveBird(){GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.clear(this,this.OnBombDJS3),this.DetonatedBomb(),super.RemoveBird()}DetonatedBomb(){if(this.isBomb)return;Xi.i.roleCtrl.isCmeraToBird=!1,this.isBomb=!0;for(var t=this.birdRigid.body.GetWorldCenter(),i=new Laya.Physics.I.box2d.b2Vec2,e=new Laya.Physics.I.box2d.b2Vec2,s=(this.dieRange,this.dieRange,0);s<=100;s++){var r=3.6*s,a=new Laya.Physics.I.box2d.b2RayCastInput;a.p1=t,a.p2.Set(t.x+this.range*Math.cos(r),t.y+this.range*Math.sin(r)),a.maxFraction=1;for(var o=new Laya.Physics.I.box2d.b2RayCastOutput,h=Laya.Physics.I.world.GetBodyList();h;h=h.GetNext()){var n=h.GetFixtureList();if(n)if(n.RayCast(o,a)){i.Copy(a.p1),e.Copy(a.p2),e.SelfSub(i),e.SelfMul(o.fraction),i.SelfAdd(e);var l=new Laya.Physics.I.box2d.b2Vec2;l.Copy(i),l.SelfSub(t);{let t=new Laya.Physics.I.box2d.b2Vec2(l.x*(1-o.fraction)*this.BombForce,l.y*(1-o.fraction)*this.BombForce);if(null!=n.collider&&null!=n.collider.owner){let i=n.collider.owner.getComponent(rt);null!=i&&i.OnBoomerang(t.x+t.y)}h.ApplyLinearImpulseToCenter(t)}}}}}}class ki extends Bi{constructor(){super(...arguments),this.BirdAnimNum=5,this.BombForce=6,this.range=3,this.dieRange=1.5,this.birdType=u.EggBird,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.density=20,this.eggPoint={x:0,y:0},this.removeTime=180}InitBird(t,i,e,s){i+=55,super.InitBird(t,i,e,s)}OnInitBird(){this.egg=this.birdSprite.getChildByName("egg"),this.egg.alpha=0,this.eggRigid=this.egg.getComponent(Laya.RigidBody),this.eggRigid.linearDamping=.2,this.eggRigid.category=2,this.eggRigid.gravityScale=2,this.eggRigid.mask=1,this.eggRigid.type="kinematic",this.bird4=this.birdSprite.getChildByName("birdbian"),this.bird4.alpha=0,this.brid4Rigid=this.bird4.getComponent(Laya.RigidBody),this.brid4Rigid.linearDamping=.2,this.brid4Rigid.category=2,this.brid4Rigid.gravityScale=2,this.brid4Rigid.mask=1,this.brid4Rigid.type="kinematic"}get birdX(){return this.isCanMouse?this.bird4?this.bird4.x:-1:this.bird1?this.bird1.x:-1}get birdY(){return this.isCanMouse?this.bird4?this.bird4.y:-1:this.bird1?this.bird1.y:-1}RemoveBird(){null!=this.egg&&(Yi.RemoveNodes(this.egg),this.egg.destroy(),this.egg=null),null!=this.bird4&&(Yi.RemoveNodes(this.bird4),this.bird4.destroy(),this.bird4=null),super.RemoveBird()}OnRunTrackLink(){this.isCanMouse&&this.CreateTrackByObj(this.bird4),super.OnRunTrackLink()}OnMouseDownRun(){let t=super.OnMouseDownRun();if(this.launcher.isCmeraToBird=!1,this.isCanMouse=!0,t){this.CloseAllPhiz(),this.birdRigid.type="kinematic",this.birdRigid.body.m_linearVelocity.x=0,this.birdRigid.body.m_linearVelocity.y=0;let t=GI.sceneMgr.worldRoot;t.addChild(this.egg),this.egg.pos(this.bird1.x,this.bird1.y),this.egg.alpha=1,this.eggRigid.enabled=!0,this.eggRigid.type="dynamic",this.eggRigid.body.m_linearVelocity.x=0,this.eggRigid.body.m_linearVelocity.y=40,this.egg.on(Laya.Event.TRIGGER_ENTER,this,this.OnEggTriggerEnter),t.addChild(this.bird4),this.bird4.pos(this.bird1.x,this.bird1.y),this.bird4.alpha=1,this.brid4Rigid.enabled=!0,this.brid4Rigid.type="dynamic",this.brid4Rigid.body.m_linearVelocity.x=20,this.brid4Rigid.body.m_linearVelocity.y=-20,this.brid4Rigid.applyTorque(30),this.StartRemoveCountdown()}return t}OnEggTriggerEnter(){this.DetonatedBomb()}DetonatedBomb(){for(var t=this.eggRigid.body.GetWorldCenter(),i=new Laya.Physics.I.box2d.b2Vec2,e=new Laya.Physics.I.box2d.b2Vec2,s=0;s<=100;s++){var r=3.6*s,a=new Laya.Physics.I.box2d.b2RayCastInput;a.p1=t,a.p2.Set(t.x+1*Math.cos(r),t.y+1*Math.sin(r)),a.maxFraction=1;for(var o=new Laya.Physics.I.box2d.b2RayCastOutput,h=this.dieRange*this.dieRange,n=Laya.Physics.I.world.GetBodyList();n;n=n.GetNext()){var l=n.GetFixtureList();if(l)if(l.RayCast(o,a)){i.Copy(a.p1),e.Copy(a.p2),e.SelfSub(i),e.SelfMul(o.fraction),i.SelfAdd(e);var d=new Laya.Physics.I.box2d.b2Vec2;d.Copy(i),d.SelfSub(t);new Laya.Physics.I.box2d.b2Vec2(d.x*(1-o.fraction)*this.BombForce,d.y*(1-o.fraction)*this.BombForce);if(d.LengthSquared()<=h){if(null!=l.collider&&null!=l.collider.owner){let t=l.collider.owner.getComponent(rt);null!=t&&t.MustDie()}}else{let t=new Laya.Physics.I.box2d.b2Vec2(d.x*(1-o.fraction)*this.BombForce,d.y*(1-o.fraction)*this.BombForce);null!=l.collider&&l.collider.owner,n.ApplyLinearImpulseToCenter(t)}}}}this.eggPoint.x=this.egg.x,this.eggPoint.y=this.egg.y,this.PlayEffectByObj(this.egg),Yi.RemoveNodes(this.egg),this.egg.destroy(),this.egg=null}StartBiggerBird(){if(0==this.isBiggerBird){this.egg.scaleX=this.BiggerBirdNum,this.egg.scaleY=this.BiggerBirdNum;let t=this.egg.getComponent(Laya.ColliderBase);t.resetShape(!0),this.bird4.scaleX=this.BiggerBirdNum,this.bird4.scaleY=this.BiggerBirdNum,(t=this.bird4.getComponent(Laya.ColliderBase)).resetShape(!0)}return super.StartBiggerBird()}}class Ei extends Bi{constructor(){super(...arguments),this.birdType=u.FastBird,this.BirdAnimNum=6,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=4,this.triggerIdx=5,this.grageId=6}InitBird(t,i,e,s){i+=45,super.InitBird(t,i,e,s)}OnMouseDownRun(){let t=super.OnMouseDownRun();return t&&(this.birdRigid.body.m_linearVelocity.x+=15),t}}class Vi{constructor(){this.trackPath={0:"role/angerbird/Track1.PNG",1:"role/angerbird/Track2.PNG",2:"role/angerbird/Track3.PNG",3:"role/angerbird/mzx.png"},this.trackSzie={0:{x:9,y:9},1:{x:16,y:11},2:{x:14,y:13},3:{x:16,y:16}},this.birdRun=null,this.poolParent=null,this.trackListPool=[],this.trackList1=[],this.trackList2=[],this.aimList=[]}InitTrack(){null==this.poolParent&&(this.poolParent=new Laya.Sprite,GI.sceneMgr.worldRoot.addChild(this.poolParent),this.poolParent.pos(-1e3,-1e4)),null==this.birdRun&&(this.birdRun=new Laya.Sprite,GI.sceneMgr.worldRoot.addChild(this.birdRun),this.birdRun.pos(0,0)),this.RemoveAllTracks()}CreateTrack(t,i,e){let s=this.GetTrack();this.birdRun.addChild(s);let r=e%3;s.loadImage(this.trackPath[r]),s.width=this.trackSzie[r].x,s.height=this.trackSzie[r].y,s.pivot(this.trackSzie[r].x/2,this.trackSzie[r].y/2),s.pos(t,i),this.trackList1.push(s)}RemoveOldLink(){this.trackList1.length>0&&(this.RecycleList(this.trackList2),this.trackList2=this.trackList1,this.trackList1=[])}CreateAim(t,i){let e=this.GetTrack();this.birdRun.addChild(e);e.loadImage(this.trackPath[3]),e.width=this.trackSzie[3].x,e.height=this.trackSzie[3].y,e.pivot(this.trackSzie[3].x/2,this.trackSzie[3].y/2),e.pos(t,i),this.aimList.push(e)}RemoveAim(){this.RecycleList(this.aimList),this.aimList=[]}RemoveAllTracks(){for(this.RecycleList(this.trackList2),this.RecycleList(this.trackList1),this.RemoveAim();this.trackListPool.length>0;){this.trackListPool.pop().destroy(!0)}}GetTrack(){return this.trackListPool.length>0?this.trackListPool.pop():new Laya.Sprite}RecycleList(t){for(;t.length>0;){let i=t.pop();this.poolParent.addChild(i),i.pos(0,0),this.trackListPool.push(i)}}}class Ui extends Bi{constructor(){super(...arguments),this.BirdAnimNum=3,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=0,this.density=20,this.grageId=5,this.birdType=u.BigRedBird}InitBird(t,i,e,s){i+=28,super.InitBird(t,i,e,s)}}class Oi extends Bi{constructor(){super(...arguments),this.birdType=u.BoomerangBird,this.BirdAnimNum=4,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=0,this.mouseIdx=0,this.triggerIdx=3,this.density=10,this.endxSpeed=0,this.speed=0}InitBird(t,i,e,s){i+=28,super.InitBird(t,i,e,s)}get birdX(){return this.isCanMouse?this.hlbBird?this.hlbBird.x:-1:this.bird1?this.bird1.x:-1}get birdY(){return this.isCanMouse?this.hlbBird?this.hlbBird.y:-1:this.bird1?this.bird1.y:-1}OnInitBird(){this.hlbBird=this.birdSprite.getChildByName("hlbBird"),this.hlbBird.alpha=0,this.hlbBirdRigid=this.hlbBird.getComponent(Laya.RigidBody),this.hlbBirdRigid.linearDamping=this.birdRigid.linearDamping,this.hlbBirdRigid.category=this.birdRigid.category,this.hlbBirdRigid.gravityScale=this.gravity,this.hlbBirdRigid.mask=this.birdRigid.mask,this.bird1.addChild,this.hlbBirdRigid.type="kinematic"}OnRunTrackLink(){this.hlbBird.alpha>0&&this.CreateTrackByHLB(),super.OnRunTrackLink()}CreateTrackByHLB(){let t=this.hlbBird,i=Laya.Point.create();i.setTo(t.pivotX,t.pivotY),i=t.localToGlobal(i,!1,GI.sceneMgr.worldRoot),this.launcher.trackCtrl.CreateTrack(i.x,i.y,this.trackIdx)}OnMouseDownRun(){if(super.OnMouseDownRun()){GI.timerMgr.clear(this,this.BoomerangUpdate),this.endxSpeed=1.2*-this.birdRigid.body.m_linearVelocity.x,this.speed=2*this.endxSpeed/60,this.bird1.off(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter),this.hlbBird.on(Laya.Event.TRIGGER_ENTER,this,this.OnTriggerEnter,[0]),GI.sceneMgr.worldRoot.addChild(this.hlbBird),this.hlbBird.pos(this.bird1.x,this.bird1.y),this.hlbBird.alpha=1,this.hlbBirdRigid.enabled=!0,this.hlbBirdRigid.type="dynamic",this.hlbBirdRigid.body.m_linearVelocity.x=this.birdRigid.body.m_linearVelocity.x,this.hlbBirdRigid.body.m_linearVelocity.y=this.birdRigid.body.m_linearVelocity.y,this.hlbBirdRigid.angularVelocity=15,this.bird1.alpha=0,this.birdRigid.body.m_linearVelocity.x=0,this.birdRigid.body.m_linearVelocity.y=0,this.birdRigid.type="kinematic",GI.timerMgr.frameLoop(1,this,this.BoomerangUpdate)}return!0}BoomerangUpdate(){this.hlbBirdRigid.body.m_linearVelocity.x+=this.speed,this.endxSpeed>this.hlbBirdRigid.body.m_linearVelocity.x&&GI.timerMgr.clear(this,this.BoomerangUpdate)}OnTriggerEnter(t,i){super.OnTriggerEnter(t,i),GI.timerMgr.clear(this,this.BoomerangUpdate)}RemoveBird(){null!=this.hlbBird&&(Yi.RemoveNodes(this.hlbBird),this.hlbBird.destroy(),this.hlbBird=null),super.RemoveBird(),GI.timerMgr.clear(this,this.BoomerangUpdate)}RunBird(t,i,e){super.RunBird(t,i,e),this.birdRigid.angularVelocity=10}}class Ni extends Bi{constructor(){super(...arguments),this.birdType=u.ShockWaveBird,this.BirdAnimNum=7,this.BombForce=13,this.Range=7,this.DieRange=1,this.zayanIdx=2,this.jiaoIdx=1,this.feiIdx=3,this.mouseIdx=3,this.triggerIdx=4,this.removeTime=350,this.density=30,this.ShockIdx=0,this.isBomb=!1}InitBird(t,i,e,s){i+=28,super.InitBird(t,i,e,s)}OnMouseDownRun(){super.OnMouseDownRun();return this.birdRigid.type="kinematic",this.OnBombDJS2(),!0}OnTriggerEnter(t,i){0==this.IsRemoveTime&&(GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.frameOnce(60,this,this.OnBombDJS)),super.OnTriggerEnter(t,i),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRun)}OnBombDJS(){this.CloseAllPhiz(),this.birdAnimObjes[0][5].alpha=1,GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.frameOnce(50,this,this.OnBombDJS2)}OnBombDJS2(){this.isBomb||(this.CloseAllPhiz(),this.birdAnimObjes[0][6].alpha=1,this.birdRigid.type="kinematic",this.birdRigid.body.m_linearVelocity.x=0,this.birdRigid.body.m_linearVelocity.y=0,this.birdRigid.angularVelocity=0,GI.timerMgr.clear(this,this.OnShock),this.ShockIdx=0,GI.timerMgr.frameLoop(6,this,this.OnShock),GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.clear(this,this.OnBombDJS3),this.OnShock())}OnShock(){this.ShockIdx++,this.ShockIdx>this.Range?(this.ShockWave(this.Range+4,this.Range),GI.timerMgr.clear(this,this.OnShock),this.RemoveBird()):this.ShockWave(this.ShockIdx+2,this.ShockIdx)}OnBombDJS3(){this.isBomb||(this.CloseAllPhiz(),this.birdRigid.type="kinematic",this.RemoveBird())}RemoveBird(){GI.timerMgr.clear(this,this.OnBombDJS),GI.timerMgr.clear(this,this.OnBombDJS2),GI.timerMgr.clear(this,this.OnBombDJS3),super.RemoveBird()}ShockWave(t,i){Xi.i.roleCtrl.isCmeraToBird=!1,this.isBomb=!0;for(var e=this.birdRigid.body.GetWorldCenter(),s=new Laya.Physics.I.box2d.b2Vec2,r=new Laya.Physics.I.box2d.b2Vec2,a=i*i,o=0;o<=100;o++){var h=3.6*o,n=new Laya.Physics.I.box2d.b2RayCastInput;n.p1=e,n.p2.Set(e.x+t*Math.cos(h),e.y+t*Math.sin(h)),n.maxFraction=1;for(var l=new Laya.Physics.I.box2d.b2RayCastOutput,d=Laya.Physics.I.world.GetBodyList();d;d=d.GetNext()){var g=d.GetFixtureList();if(g)if(g.RayCast(l,n)){s.Copy(n.p1),r.Copy(n.p2),r.SelfSub(s),r.SelfMul(l.fraction),s.SelfAdd(r);var u=new Laya.Physics.I.box2d.b2Vec2;if(u.Copy(s),u.SelfSub(e),u.LengthSquared()<=a){if(null!=g.collider&&null!=g.collider.owner){let t=g.collider.owner.getComponent(rt);null!=t&&t.MustDie()}}else{let t=new Laya.Physics.I.box2d.b2Vec2(u.x*(1-l.fraction)*this.BombForce,u.y*(1-l.fraction)*this.BombForce);d.ApplyLinearImpulseToCenter(t)}}}}}}class Fi extends Gi{constructor(){super(...arguments),this.birdId=0,this.birdPrefabs=[],this.trackCtrl=new Vi,this.rolePrefabData=null,this.rolePath="res/role/Launcher.json",this.isUser=!1,this.isMouseDown=!1,this.isMouseBird=!1,this.isCmeraToBird=!1,this.isCmeraToTrigger=!1,this.IsMouseRun=!0,this.minCamera={x:-2500,y:1024},this.MaxCamera={x:0,y:0},this.mousePoint={x:0,y:0},this.MinLauncherNum=30,this.MaxLauncherNum=100,this.birdDatas=[],this.launcherPoint={x:0,y:0},this.birdList=[],this.birdListDatas=[],this.isUseBow=!1,this.addXFore=1,this.isUseBiggerBird=!1,this.isUseAim=!1,this.isVictory=!1,this.BirdRunBezierDatas=null,this.birdRunIdx=0,this.birdRun=null,this.isBirdAnimAdd=!1,this.rotationSeep=0,this.startAimIdx=0,this.aimSize=5,this.aimMaxNum=0}preInit(){this.MaxCamera={x:GI.sceneMgr.worldRoot.x,y:GI.sceneMgr.worldRoot.y}}InitAttribute(){this.birdId=0,this.birdDatas=[],this.birdList=[],this.birdListDatas=[],this.trackCtrl.InitTrack(),this.birdDatas=[];let t=Xi.i.data.getBirdPos();this.launcherPoint=t[0],GI.log("鸟数据添加"+t.length);for(let i=t.length-1;i>0;--i)GI.log(t[i]),this.birdDatas.push(t[i]);GI.log("====",this.birdDatas),this.minCamera={x:600-Xi.i.data.maxRightX,y:1024},this.isUser=!1,this.isMouseDown=!1,this.isMouseBird=!1,this.isCmeraToBird=!1,this.IsMouseRun=!0,this.isCmeraToTrigger=!1,this.isUseBow=!1,this.isUseBiggerBird=!1,this.bird=null,this.runBird=null,this.isVictory=!1,this.isUseAim=!1,this.addXFore=1}initRole(t=230,i=400){this.InitAttribute();let e=Xi.i.data.BirdCfgs.birds;if(null==this.rolePrefabData){let s=[{url:this.rolePath,type:Laya.Loader.JSON}],r=8;if(0==this.birdPrefabs.length)for(let t=0;t<r;++t)s.push({url:e[t].url,type:Laya.Loader.JSON});Laya.loader.load(s,Laya.Handler.create(this,s=>{if(this.rolePrefabData=Laya.loader.getRes(this.rolePath),0==this.birdPrefabs.length)for(let t=0;t<r;++t)this.birdPrefabs[t]=Laya.loader.getRes(e[t].url);this.CreateRoles(t,i)}))}else this.CreateRoles(t,i);this.StartPhysicsDebug()}OnMouseDownRole(t){null!=this.bird&&(this.isMouseDown=!0,this.isCmeraToTrigger=!1,this.launcher.IsMouseDown()&&0==Xi.i.GameMgr.IsVictory&&Xi.i.canOperate?(this.isMouseBird=!0,this.SetTriggerPoss()):this.isMouseDown=!1,this.mousePoint.x=Laya.stage.mouseX,this.mousePoint.y=Laya.stage.mouseY)}OnMouseUpRole(t){if(this.trackCtrl.RemoveAim(),this.isMouseBird){if(this.launcher.InitAimJin(),this.launcher.GetPullLenght()<=this.MinLauncherNum)return this.launcher.ReductionTrigger(),this.isMouseDown=!1,void(this.isMouseBird=!1);this.BirdLaunching()}this.isMouseDown=!1,this.isMouseBird=!1}GetLauncherAddMousePoint(){let t=this.GetTriggerPoint(),i=this.launcher.triggerPoint;return t.x=i.x-t.x,t.y=i.y-t.y,t}BirdLaunching(){if(null==this.bird)return;let t=this.GetLauncherAddMousePoint(),i=t.distance(0,0);i=i<this.MinLauncherNum?this.MinLauncherNum:i,i/=this.MaxLauncherNum,this.bird.RunBird(t,i,this.addXFore),this.isCmeraToBird=!0,this.launcher.InitRubber(),GI.timerMgr.clear(this,this.TriggerLoadingBird),GI.timerMgr.frameOnce(150,this,this.TriggerLoadingBird),this.runBird=this.bird,this.bird=null,this.isMouseBird=!1,this.trackCtrl.RemoveAim()}TriggerLoadingBird(){this.LoadNextBird()}SetTriggerPoss(){let t=this.GetTriggerPoint();this.launcher.UpdateRubberSpingAngle(this.GetSpringAngle()),this.bird.birdSprite.x=0,this.bird.birdSprite.y=0,this.bird.ToLauncher(),this.launcher.SetTriggerPoss(t.x,t.y),t.recover()}RoleVictory(){this.isVictory=!0;let t=0;this.birdList.length>0||null!=this.bird?GI.gMsgCet.event("ab.onLvlShow"):(t++,this.SeedVictory(t))}DengDaiVictory(){let t=0;null!=this.bird&&(this.bird.BirdVictory(),t=1),this.birdList.length>0&&(GI.timerMgr.frameOnce(100,this,this.DenBird,[this.birdList.length-1]),t+=this.birdList.length),this.SeedVictory(t)}DenBird(t){t>=0&&this.birdList.length>t&&(this.birdList[t].BirdVictory(),--t>=0&&GI.timerMgr.frameOnce(100,this,this.DenBird,[t]))}SeedVictory(t){GI.timerMgr.frameOnce(100*t,this,this.victory)}victory(){GI.gMsgCet.event("FinishLevel"),GI.gMsgCet.event("Wm.onFinishLvl")}GetTriggerPoint(){let t=this.GetMousePos(),i=this.launcher.GetPullLenght(),e=this.launcher.GetTriggerPoint(),s=t.x-e.x,r=t.y-e.y,a=this.MaxLauncherNum;if(i>45&&r>0&&(s<=0&&s>-30||s>=0&&s<60)&&(a=35),a<this.MaxLauncherNum||i>=this.MaxLauncherNum){let o=a/i;e.x=s*o+e.x,e.y=r*o+e.y,t=this.launcher.launcherObj.globalToLocal(e)}else t=this.launcher.launcherObj.globalToLocal(t);return t}GetSpringAngle(){let t=this.GetMousePos(),i=this.launcher.GetTriggerPoint();return this.getAngle(t,i)}getAngle(t,i){return t&&i?180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI:0}RemoveRole(){this.trackCtrl.RemoveAllTracks(),GI.gMsgCet.off("ab.camShake",this,this.UpdateEarthquake),GI.gMsgCet.off("ab.camArriveShotPos",this,this.DengDaiVictory),GI.gMsgCet.off("ab.use_prop",this,this.UserProps),GI.timerMgr.clear(this,this.DengDaiVictory),GI.timerMgr.clear(this,this.DenBird),GI.timerMgr.clear(this,this.victory),GI.timerMgr.clear(this,this.TriggerLoadingBird),GI.timerMgr.clear(this,this.BirdRun),null!=this.bird&&this.bird.RemoveBird(),null!=this.runBird&&this.runBird.RemoveBird();for(let t=0;t<this.birdList.length;++t)this.birdList[t].RemoveBird();null!=this.launcher&&this.launcher.Remove(),this.birdListDatas=[],this.birdList=[],this.bird=null,this.launcher=null,this.runBird=null,Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRole),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.OnMouseUpRole)}LoadNextBird(){if(this.bird=null,this.birdList.length>0){this.bird=this.birdList.pop();let t=this.launcher.GetWorldBird();t.x-=.5*this.bird.bird1.pivotX,t.y-=.5*this.bird.bird1.pivotY,this.bird.ToLauncherInit(),this.BirdRunAnim(t,this.bird.worldPoint,this.bird,!1),GI.gMsgCet.event("ab.UpdateRole"),this.isUseBiggerBird&&this.StartBiggerBird()}}CreateBirds(){this.birdList=[];for(let t=0;t<this.birdDatas.length;++t){let i=this.birdDatas[t],e=this.CreateBird(i.type);e.InitBird(i.x,i.y,this.birdPrefabs[i.type],this),this.birdList.push(e),this.birdListDatas.push(e)}}GetBirdById(t){for(let i=0;i<this.birdListDatas.length;++i)if(this.birdListDatas[i].BirdId+""==t)return this.birdListDatas[i];return null}GetBirdNum(){var t=0;return null!=this.bird&&t++,t+=this.birdList.length}CreateBird(t){switch(t){case u.RedBird:return new Di(this.birdId++);case u.AvatarBird:return new Ti(this.birdId++);case u.BombBird:return new Ai(this.birdId++);case u.EggBird:return new ki(this.birdId++);case u.FastBird:return new Ei(this.birdId++);case u.BigRedBird:return new Ui(this.birdId++);case u.BoomerangBird:return new Oi(this.birdId++);case u.ShockWaveBird:return new Ni(this.birdId++)}return console.error("错误 创建的鸟没有这个类型    "+t),null}CreateRoles(t,i){GI.gMsgCet.off("ab.camShake",this,this.UpdateEarthquake),GI.gMsgCet.on("ab.camShake",this,this.UpdateEarthquake),GI.gMsgCet.off("ab.camArriveShotPos",this,this.DengDaiVictory),GI.gMsgCet.on("ab.camArriveShotPos",this,this.DengDaiVictory);let e=new Laya.Prefab;e.json=this.rolePrefabData;let s=e.create();this.launcher=s.getComponent(Wi),this.AddInRigidWorld(s),s.x=this.launcherPoint.x,s.y=this.launcherPoint.y+100,this.launcher.MinLauncherNum=this.MinLauncherNum,this.launcher.MaxLauncherNum=this.MaxLauncherNum,this.launcher.InitData(),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRole),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.OnMouseUpRole),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.OnMouseDownRole),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.OnMouseUpRole),GI.gMsgCet.off("ab.use_prop",this,this.UserProps),GI.gMsgCet.on("ab.use_prop",this,this.UserProps),this.CreateBirds(),this.LoadNextBird()}UserProps(t){let i=t.prop_id;rt.startGameTime=!0,GI.gMsgCet.event("AB.UserProp",[i]),1==i?this.StartBiggerBird():2==i?this.StartEnergyBow():3==i?this.StartAim():4==i?this.StartEarthquake():6==i&&this.AddChongJiBo()}StartEnergyBow(){this.isUseBow=!0,this.addXFore=1.5,this.launcher.SetShowLauncher(2)}StartBiggerBird(){if(null!=this.bird){this.bird.StartBiggerBird()&&(this.isUseBiggerBird=!1)}else this.isUseBiggerBird=!0}StartAim(){this.isUseAim=!0,this.launcher.ShowAim()}StartEarthquake(){this.isMouseBird=!1,GI.gMsgCet.event("ab.camLookAtPig")}UpdateEarthquake(t){GI.gMsgCet.event("AB.EarthquakeSound");var i=t.shadkeDuration;GI.timerMgr.clear(this,this.Earthquake1),GI.timerMgr.clear(this,this.Earthquake2),GI.timerMgr.clear(this,this.Earthquake3);let e=.5*(Math.random()+1)*7;e=Math.random()>.5?e:-e,GI.timerMgr.once(.4*i,this,this.Earthquake1,[.4*e]),GI.timerMgr.once(.6*i,this,this.Earthquake2,[.7*e]),GI.timerMgr.once(.8*i,this,this.Earthquake3,[e])}Earthquake1(t){Xi.i.GameMgr.StartEarthquake(!1,t)}Earthquake2(t){Xi.i.GameMgr.StartEarthquake(!0,t)}Earthquake3(t){Xi.i.GameMgr.StartEarthquake(!0,t)}AddChongJiBo(){null!=this.bird&&(this.BirdRunAnim(this.bird.GetWorldPoint(),this.bird.worldPoint,this.bird,!0),this.bird=this.CreateBird(u.ShockWaveBird),this.bird.InitBird(0,0,this.birdPrefabs[u.ShockWaveBird],this),this.launcher.LoadBird(this.bird))}BirdRunAnim(t,i,e,s=!1){var r=[];r.push(t),r.push({x:.5*(i.x+t.x),y:.5*(t.y-i.y)+t.y}),r.push(i),this.birdRun=e,this.isBirdAnimAdd=s,this.BirdRunBezierDatas=Pi.CreateBezierPoints(r,30),this.BirdRunBezierDatas.push(i),this.rotationSeep=s?360/31:-360/31,this.birdRunIdx=s?0:this.BirdRunBezierDatas.length-1,GI.sceneMgr.worldRoot.addChild(e.birdSprite),e.birdSprite.pos(0,0),s?e.bird1.pos(t.x,t.y):e.bird1.pos(i.x,i.y),GI.timerMgr.clear(this,this.BirdRun),GI.timerMgr.frameLoop(1,this,this.BirdRun)}BirdRun(){let t=this.BirdRunBezierDatas[this.birdRunIdx];this.birdRun.bird1.pos(t.x,t.y),this.isBirdAnimAdd?this.birdRunIdx++:this.birdRunIdx--,(this.isBirdAnimAdd&&this.birdRunIdx>=this.BirdRunBezierDatas.length||0==this.isBirdAnimAdd&&this.birdRunIdx<0)&&(this.isBirdAnimAdd?this.birdList.push(this.birdRun):this.launcher.LoadBird(this.birdRun),this.birdRun=null,this.BirdRunBezierDatas=[],GI.timerMgr.clear(this,this.BirdRun))}LockTrigger(t=!1){null!=this.bird||this.birdList.length>0?t&&(this.isCmeraToTrigger=!0,this.isCmeraToBird=!1):0==this.isVictory&&null==this.bird&&0==this.birdList.length&&GI.gMsgCet.event("wmCtrl.Role_Death_Prompt_End")}GetPositionWhen(t,i,e){var s,r,a=new Laya.Point,o=Laya.Physics.I.world.GetGravity().y;return r=i.y*(1/60)*e+1/60*(1/60)*o*(e+1)*e/2,s=i.x*(1/60)*e,a.y=t.y+50*r,a.x=t.x+50*s,a}UpdateAim(){if(null!=this.bird){let t=this.GetLauncherAddMousePoint(),i=t.distance(0,0);i=i<this.MinLauncherNum?this.MinLauncherNum:i,i/=this.MaxLauncherNum;let e=this.bird.GetBirdSpeed(t,i,this.addXFore),s=this.bird.GetWorldPoint(),r=Xi.i.data.groundY;this.bird.birdRigid.linearDamping,this.trackCtrl.RemoveAim(),this.trackCtrl.CreateAim(s.x,s.y),this.startAimIdx=0,this.startAimIdx=this.aimSize;Laya.Point.create(),Math.tanh(e.x/e.y),Math.PI;for(let t=0;t<2e3;++t){let t=this.GetPositionWhen(s,e,this.startAimIdx);if(this.startAimIdx+=this.aimSize,t.y>r)return;this.trackCtrl.CreateAim(t.x,t.y)}}}OnMouseRun(){this.isMouseDown&&this.isMouseBird&&0==this.isVictory&&(this.SetTriggerPoss(),this.isUseAim&&this.UpdateAim())}onUpdate(){this.UpdatePhysicsRun(),this.OnMouseRun()}get roleX(){return null!=this.runBird?this.runBird.birdX-50:null!=this.bird?this.bird.birdX-50:-1}get roleY(){return null!=this.runBird?this.runBird.birdY:null!=this.bird?this.bird.birdY:-1}}class Hi{constructor(){this.pigLists=new Map,this.rigidList=[],this.runBird=new Map,this.isRoleVictory=!1,this.UpTime=0,GI.gMsgCet.on("ab.AddGrade",this,this.AddGrade)}AddGrade(){this.UpTime=Laya.timer.currTimer}RemoveDatas(){this.pigLists.clear(),this.rigidList=[],this.runBird.clear(),this.isRoleVictory=!1,GI.timerMgr.clear(this,this.DetectRun)}StartDetect(){this.UpTime=Laya.timer.currTimer,GI.timerMgr.clear(this,this.DetectRun),0==this.isRoleVictory&&GI.timerMgr.frameLoop(30,this,this.DetectRun)}StartEarthquake(t,i=5){let e=i;if(this.pigLists.forEach((t,i)=>{null!=t&&null!=t.sp&&(t.rigid.body.m_angularVelocity+=.4*e)}),t)for(var s=0;s<this.rigidList.length;++s){var r=this.rigidList[s];null!=r&&null!=r.rigid&&Math.abs(r.rigid.body.m_angularVelocity)<.1&&4!=r.propId&&null!=r.sp&&null!=r.rigid&&r.HP>0&&Math.random()>.6&&(r.rigid.body.m_angularVelocity+=e)}}DetectRun(){if(0==this.IsRun()||(0==this.pigLists.size||0==Xi.i.roleCtrl.GetBirdNum())&&Laya.timer.currTimer-this.UpTime>=90){if(this.isRoleVictory)return void GI.timerMgr.clear(this,this.DetectRun);0==this.pigLists.size&&this.RoleVictory(),GI.timerMgr.clear(this,this.DetectRun),GI.timerMgr.clear(this,this.LockTrigger),0==this.runBird.size&&GI.timerMgr.frameOnce(50,this,this.LockTrigger)}else GI.timerMgr.clear(this,this.LockTrigger)}LockTrigger(){Xi.i.roleCtrl.LockTrigger(0==this.runBird.size)}RoleVictory(){Xi.i.roleCtrl.RoleVictory(),this.isRoleVictory=!0,GI.timerMgr.clear(this,this.DetectRun)}IsRun(){for(let t=0;t<this.rigidList.length;++t){let i=this.rigidList[t];if(null!=i&&null!=i.sp&&(Math.abs(50*i.rigid.body.m_linearVelocity.x)>.5||Math.abs(50*i.rigid.body.m_linearVelocity.y)>.5))return!0}return!1}get IsVictory(){return 0==this.pigLists.size}AddPig(t){this.pigLists.set(t.rigidId,t)}AddRigidItem(t){this.rigidList.push(t)}AddRunBird(t){this.runBird.set(t.BirdId,t)}RemovePigItem(t){this.pigLists.delete(t.rigidId),0==this.pigLists.size&&(this.StartDetect(),GI.gMsgCet.event("ab.RigEnd"))}RemoveRigidItem(t){}RemoveRunBird(t){this.runBird.delete(t.BirdId),0==this.runBird.size&&this.StartDetect()}}class Ji extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("AbRewardView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnVideo",()=>{this.hideSelf(),this.onFinishVideo(!0,null)})}onFinishVideo(t,i){if(GI.log("奖励界面播放完视频广告：",t,i),t)if(this.rewardData.isCurrency){let t=this.rewardData.quantity;Xi.i.money+=t,GI.uiViewMgr.showView("ObtainView",{name:this.rewardData.name,quantity:this.rewardData.quantity,iconName:this.rewardData.iconName}),GI.timerMgr.once(1e3,this,()=>{GI.uiViewMgr.hideView("ObtainView")})}else Xi.i.data.usePropUpdateData(this.rewardData.prop_id,!0)}doShow(t){Xi.i.canOperate=!1,this.handleSk(),null!=t&&null!=t.reward_id&&(this.rewardData=Xi.i.data.commercialCfg.reward[t.reward_id],null!=this.rewardData&&(this.u("txtTitle").asTextField.text=this.rewardData.name,this.u("txtRewardHint").asTextField.text=this.rewardData.desc,this.u("imgObj").asLoader.url=GI.uiViewMgr.getItemURL(this.rewardData.iconName)))}handleSk(){if(null==this.sk){this.sk=new Laya.Skeleton,this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,1);let t=this.u("imgObj");this.sk.pos(t.x,t.y)}else this.sk.play(0,!0)}doHide(){Xi.i.canOperate=!0,this.sk.stop()}}class Xi extends GI.Module{constructor(){super(...arguments),this._data=new wi,this._mapCtrl=new zt,this._gameControl=new Hi,this._roleCtrl=new ai,this._roleSuCtrl=new xi,this._LauncherCtrl=new Fi,this._camera=new pi,this._curChapter=-1,this._curLvl=-1,this._canPlayTime=-1,this.isWaitWin=!1}get data(){return this._data}get mapCtrl(){return this._mapCtrl}get GameMgr(){return this._gameControl}get roleCtrl(){return this._LauncherCtrl}get camera(){return this._camera}get money(){return this.data.money}set money(t){this.data.money=t}get money2(){return this.data.money2}set money2(t){this.data.money2=t}get curChapter(){return this.data.curChapter}set curChapter(t){this.data.curChapter=t}get curLvl(){return this.data.curLvl}set curLvl(t){this.data.curLvl=t}get curStep(){return this.data.curStep}set curStep(t){this.data.curStep=t}get isLvlOn(){return this._isLvlOn}set isLvlOn(t){this._isLvlOn!=t&&(this._isLvlOn=t,GI.gMsgCet.event("Wm.isLvlOn"))}get canPlay(){return this._isLvlOn&&GI.timerMgr.currTimer>=this._canPlayTime}get isPlay(){return this._isPlay}set isPlay(t){this._isPlay!=t&&(this._isPlay=t)}get canOperate(){return this._canOperate}set canOperate(t){this._canOperate!=t&&(this._canOperate=t,GI.gMsgCet.event("Ab.canOperate",this._canOperate))}preInit(){this.data.preInit(),this.roleCtrl.preInit(),this.registerView("WmLvlStartView",ui),this.registerView("WmStepView",Ri),this.registerView("WmSucView",ni),this.registerView("WmFailView",li),this.registerView("WmDangerView",mi),this.registerView("WmMonDangerView",yi),this.registerView("WmGetCoinView",ci),this.registerView("WmGuideView",di),this.registerView("WmGuide2View",gi),this.registerView("WmCtrGuideView",bi),this.registerView("WmRewardView",Li),this.registerView("AbRewardView",Ji),this.registerView("HintView",vi),GI.gMsgCet.on("ReachLine",this,this.onFinishStep),GI.gMsgCet.on("ReachMidStep",this,this.onFinishStep),GI.gMsgCet.on("Wm.onFinishLvl",this,this.onFinishLvl),GI.gMsgCet.on("Wm.onFail",this,this.onFail),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_Start",this,()=>{GI.uiViewMgr.showView("WmDangerView")}),GI.gMsgCet.on("wmCtrl.Role_Death_Prompt_End",this,()=>{GI.uiViewMgr.hideView("WmDangerView"),this.onFail()}),GI.gMsgCet.on("wmCtrl.Monster_Prompt_Start",this,t=>{GI.uiViewMgr.showView("WmMonDangerView",t)}),GI.gMsgCet.on("wmCtrl.Monster_Prompt_End",this,()=>{GI.uiViewMgr.hideView("WmMonDangerView")}),GI.gMsgCet.on("ab.RigEnd",this,()=>{this.isWaitWin=!0})}enterWm(){this.loadCfgs(),GI.soundMgr.playMusic("res/sound/BGM.mp3")}loadCfgs(){GI.prgMgr.load([{url:"res/role/roleCfg.json",type:Laya.Loader.JSON},{url:"res/role/birdCfg.json",type:Laya.Loader.JSON},{url:"res/map/item.json",type:Laya.Loader.JSON},{url:"res/chapter/chapterCfg.json",type:Laya.Loader.JSON},{url:"res/score/scoreUiCfg.json",type:Laya.Loader.JSON},{url:"res/score/commercialCfg.json",type:Laya.Loader.JSON},{url:"res/sound/soundsCfg.json",type:Laya.Loader.JSON}],GI.handle(this,this.onCfgsLoaded))}onCfgsLoaded(){this.data.onCfgsLoaded(),GI.prgMgr.openScene("res/scene/Main.scene",this.onOpenSc.bind(this))}onOpenSc(){let t=new Laya.Sprite;GI.sceneMgr.scene.addChild(t),GI.sceneMgr.worldRoot=t,this.mapCtrl.init(GI.handle(this,this.afterInitMap))}afterInitMap(){GI.uiViewMgr.showView("SysMainUi")}checkStartLvl(){this.startLvl(this.data.checkStartLvl)}startLvl(t){this.curStep=0,this.curLvl=t,this.doStart()}startPropGuideLvl(){this.doStart()}doStart(){this.isPlay=!0,this.isWaitWin=!1,this.data.MaxGameGrade=0,this.data.GameGrade=0,GI.gMsgCet.event("Wm.beforeChangeMap"),this.data.addPlayTimes(),GI.timerMgr.clear(this,this.onUpdate),this.roleCtrl.RemoveRole(),this.GameMgr.RemoveDatas(),this.mapCtrl.changeMap(GI.handle(this,this.onMapChanged)),this.data.resetUsingProp(),this.canOperate=!0,GI.uiViewMgr.showView("GamePlayView",{from:"WmMgr"})}quitPlay(){GI.timerMgr.clear(this,this.onUpdate),this.roleCtrl.RemoveRole(),this.GameMgr.RemoveDatas(),this.onLvlEnd()}onMapChanged(){let t=this.mapCtrl.getLaunchePos();t?(this.roleCtrl.initRole(t.x-20,t.y-120),this.camera.init(t.x-1e3,t.y-250)):(this.roleCtrl.initRole(),this.camera.init()),GI.timerMgr.frameLoop(1,this,this.onUpdate),this._canPlayTime=GI.timerMgr.currTimer+800,this.isLvlOn=!0,this.checkCheerRoles(),this.showViewBeforePlay()}get totalStep(){return this.curLvl>=6?3:2}onFinishStep(t){t>this.curStep&&(this.curStep=t,this.money+=GI.gCfg.stepMoney,GI.uiViewMgr.showView("WmStepView"),this.checkCheerRoles())}onFinishLvl(){if(this.isPlay)if(this.onLvlEnd(),this.curStep++,this.data.finishedLvl=this.curLvl,GI.uiViewMgr.hideView("WmFailView"),this.data.isGuideScene)this.data.finishPropGuide(this.data.propGuideId),GI.uiViewMgr.showView("PropGuideEndView",{isWin:!0,propId:this.data.propGuideId});else{let t=this.data.GameGrade,i=this.data.usingProp[this.data.commercialCfg.prop_enum.double_point];i&&i.count>0&&(t*=2);let e=this.data.currentRank(i&&i.count>0),s=this.data.updateChapterData(t,e);this.data.isGameLastLevel(this.curChapter,this.curLvl)||e>=3&&!this.data.isNextLvlUnlock(this.curChapter,this.curLvl)&&this.data.unlockLevel(1,!1),GI.uiViewMgr.showView("WmSucView",{isNewRecord:s})}}onFail(){this.isPlay&&(this.onLvlEnd(),this.data.isGuideScene?GI.uiViewMgr.showView("PropGuideEndView",{isWin:!1,propId:this.data.propGuideId}):GI.uiViewMgr.showView("WmFailView"))}onLvlEnd(){this.isPlay=!1,this.isLvlOn=!1,GI.uiViewMgr.hideView("GamePlayView"),GI.gMsgCet.event("Wm.onLvlEnd")}reStart(){this.onLvlEnd(),this.doStart()}returnToLvl(){this.onLvlEnd(),this.checkStartLvl()}onUpdate(){this.roleCtrl.onUpdate(),this.camera.onUpdate()}get roleUiX(){return this.camera.roleUiX}get roleUiY(){return this.camera.roleUiY}get roleTopUiY(){return this.camera.roleTopUiY}checkCheerRoles(){this.mapCtrl.checkCheerRoles()}checkShowRewardView(t){return GI.gCfg.reward_display_judge[(t-1)%GI.gCfg.reward_display_judge.length]}showViewBeforePlay(){if(this.data.isGuideScene)return;let t=GI.gCfg.coursePageCfg;for(let i in t)if(t[i].chapter==this.curChapter&&t[i].lvl==this.curLvl){let t=this.data.courseData;return t[i]&&t[i].show_count>0?void GI.uiViewMgr.showView("AbRewardView",{reward_id:3}):(GI.uiViewMgr.showView("AbGuideView",{isSingle:!0,guidePage:i,callback:()=>{GI.uiViewMgr.showView("AbRewardView",{reward_id:3})}}),t[i].show_count++,void(this.data.courseData=t))}GI.uiViewMgr.showView("AbRewardView",{reward_id:3})}}class Yi{constructor(){}static AddRigidBody(t,i,e=1){let s=new Laya.RigidBody;return s.category=i,s.mask=e,s.allowSleep=!1,s.bullet=!0,t.addComponentIntance(s),s}static AddBoxCollider(t){let i=t.addComponent(Laya.BoxCollider);return i.x=0,i.y=0,i.width=t.width,i.height=t.height,i.restitution=0,i}static CreateSprite(t,i,e,s,r,a,o){let h=new Laya.Sprite;return GI.sceneMgr.worldRoot.addChild(h),h.loadImage(t),h.width=i,h.height=e,h.pivot(s,r),h.x=a,h.y=o,h}static CreateWeldJoint(t,i=[0,0],e=10){let s=new Laya.WeldJoint;return s.otherBody=t,s.frequency=e,s.anchor=i,s}static CreateWheelJoint(t,i=null){let e=new Laya.WheelJoint;return e.otherBody=t,e.anchor=i,e}static CreateRevoluteJoint(t,i=null){let e=new Laya.RevoluteJoint;return e.otherBody=t,e.anchor=i,e.collideConnected=!1,e}static RemoveComponent(t,i,e=!1){let s=t.getComponents(i);if(null!=s)for(let t=0;t<s.length;++t){let i=s[t];e&&(i.enabled=!1),i.destroy()}}static RemoveNode(t){null!=t&&(this.RemoveComponent(t,Laya.JointBase,!0),this.RemoveComponent(t,Laya.ColliderBase),this.RemoveComponent(t,Laya.RigidBody))}static RemoveNodes(t){if(null!=t){this.RemoveNode(t);for(let i=0;i<t.numChildren;i++)this.RemoveNode(t.getChildAt(i));this.RemoveComponent(t,Laya.Sprite),Xi.i.mapCtrl.roleLayer.removeChild(t)}}}class Wi extends Laya.Script{constructor(){super(),this.MaxRubberSize=24,this.MinRubberSize=10,this.MinLauncherNum=40,this.rubberData={},this.rubberA=0,this.rubberB=0,this.MaxLauncherNum=100,this.launcherUps=[],this.launcherDowns=[],this.UpdateRubberTime=0,this.aimIdx=0}onAwake(){this.triggerPoint=Laya.Point.create(),this.triggerPoint.setTo(this.trigger.x,this.trigger.y),this.rubberData={x:this.leftRubber.x,y:this.leftRubber.y,rotation:this.leftRubber.rotation,width:this.leftRubber.width,height:this.leftRubber.height,pivotX:this.leftRubber.pivotX,pivotY:this.leftRubber.pivotY},this.launcherDowns=[],this.launcherUps=[];var t=this.launcherObj.getChildByName("up");for(let i=1;i<3;i++)this.launcherUps.push(t.getChildByName("up"+i));var i=this.launcherObj.getChildByName("down");for(let t=1;t<3;t++)this.launcherDowns.push(i.getChildByName("down"+t));this.aimTou=this.launcherObj.getChildByName("aimTou"),this.aimJin=this.launcherObj.getChildByName("aimJin")}ShowAim(){this.aimJin.alpha=1,this.aimTou.alpha=1}SetShowLauncher(t=1){t--;for(let i=0;i<2;++i)i!=t?(this.launcherUps[i].alpha=0,this.launcherDowns[i].alpha=0):(this.launcherUps[i].alpha=1,this.launcherDowns[i].alpha=1);let i="role/angerbird/rubber"+ ++t+".png";this.rightRubber.skin=i,this.leftRubber.skin=i,this.rubber.loadImage(i)}Remove(){Yi.RemoveNodes(this.launcherObj),this.launcherObj.destroy()}InitData(){this.rubberA=(this.MinRubberSize-this.MaxRubberSize)/(this.MaxLauncherNum-this.MinLauncherNum),this.rubberB=this.MaxRubberSize-this.MinLauncherNum*this.rubberA}LoadBird(t){this.bird.addChild(t.birdSprite),t.birdSprite.x=0,t.birdSprite.y=0,t.ToLauncher()}GetWorldBird(){if(null==this.birdWorld){let t=Laya.Point.create();t.setTo(this.bird.x,this.bird.y);let i=GI.sceneMgr.worldRoot;t=this.bird.localToGlobal(t,!1,i),this.birdWorld=t}return this.birdWorld}IsMouseDown(){let t=Laya.stage.mouseX,i=Laya.stage.mouseY,e=this.detect.localToGlobal(new Laya.Point(0,0));return t>=e.x&&t<=e.x+this.detect.width&&i>=e.y&&i<=e.y+this.detect.height}getAngle(t,i){return t&&i?180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI:0}SetTriggerPoss(t,i){this.trigger.pos(t,i),this.rubber.pos(t,i),this.UpdateRubberWidths()}UpdateRubberWidths(){GI.timerMgr.clear(this,this.AimAnim);let t=this.UpdateRubberLenght(this.leftRubber);this.aimJin.rotation=this.leftRubber.rotation-90;let i=this.UpdateRubberLenght(this.rightRubber),e=t<i?t:i;GI.timerMgr.currTimer-this.UpdateRubberTime>150&&(this.UpdateRubberTime=GI.timerMgr.currTimer,GI.gMsgCet.event("AB.RubberSound")),this.UpdateRubberWidth(e,this.leftRubber),this.UpdateRubberWidth(e,this.rightRubber)}InitAimJin(){this.aimIdx=60,Math.abs(this.aimJin.rotation)<5?this.aimJin.rotation=0:(this.aimSpeed=-this.aimJin.rotation/this.aimIdx,GI.timerMgr.clear(this,this.AimAnim),GI.timerMgr.frameLoop(1,this,this.AimAnim))}AimAnim(){this.aimJin.rotation+=this.aimSpeed,this.aimIdx--,this.aimIdx<=0&&(this.aimJin.rotation=0,GI.timerMgr.clear(this,this.AimAnim))}InitRubber(){this.leftRubber.width=this.rubberData.width,this.leftRubber.height=this.rubberData.height,this.leftRubber.rotation=this.rubberData.rotation,this.leftRubber.pivotX=this.rubberData.pivotX,this.leftRubber.pivotY=this.rubberData.pivotY,this.leftRubber.x=this.rubberData.x,this.leftRubber.y=this.rubberData.y,this.rightRubber.height=1,this.trigger.pos(this.triggerPoint.x,this.triggerPoint.y),this.rubber.pos(this.triggerPoint.x,this.triggerPoint.y),this.rubber.rotation=0}GetPullLenght(){let t=Laya.stage.mouseX,i=Laya.stage.mouseY;return this.GetTriggerPoint().distance(t,i)}ReductionTrigger(){this.trigger.pos(this.triggerPoint.x,this.triggerPoint.y),this.rubber.pos(this.triggerPoint.x,this.triggerPoint.y),this.UpdateRubberWidths(),this.UpdateRubberSpingAngle(0)}UpdateRubberWidth(t,i){i.width=this.rubberA*t+this.rubberB,i.width<this.MinRubberSize&&(i.width=this.MinRubberSize),i.pivotX=i.width/2}UpdateRubberLenght(t){let i=Laya.Point.create();i.setTo(t.x,t.y);let e=Laya.Point.create();e.setTo(11,20),e=this.rubber.localToGlobal(e,!1,this.launcherObj),t.height=i.distance(e.x,e.y);let s=i.distance(this.rubber.x,this.rubber.y);return t.rotation=this.getAngle(t,this.rubber)-90,s>this.MaxLauncherNum&&(s=this.MaxLauncherNum),s}UpdateRubberSpingAngle(t){this.rubber.rotation=t}GetTriggerPoint(){return this.launcherObj.localToGlobal(this.triggerPoint,!0)}}class ji{constructor(){}static init(){(0,Laya.ClassUtils.regClass)("script/as/LauncherObj.ts",Wi)}}ji.width=1280,ji.height=720,ji.scaleMode="fixedauto",ji.screenMode="horizontal",ji.alignV="middle",ji.alignH="center",ji.startScene="res/scene/Main.scene",ji.sceneRoot="",ji.debug=!1,ji.stat=!1,ji.physicsDebug=!1,ji.exportSceneToJson=!0,ji.init();class zi extends GI.UIViewBase{constructor(){super(...arguments),this.canGroundMove=!0,this.isSetOpen=!1,this.isMoreOpen=!1,this.treeTweens=[],this.groundTweens=[],this.treeOriginX=0,this.groundOriginX=0}createPanel(){this._layer=GI.UiLayerEnum.base,this.createPanelUI("SysMainUi"),this.makeFullScreen(),this.initOriginData()}initOriginData(){this.treeOriginX=this.u("trees1").x,this.treeOriginX=this.u("ground1").x}doBindEvt(){this.bindUiClick("btnStart",()=>{GI.uiViewMgr.showView("ChapterView"),this.hideSelf()}),this.bindUiClick("btnVoice",()=>{GI.soundMgr.triggerMuted()}),this.bindGEvt("sound.muted",()=>{this.u("imgMute").visible=GI.soundMgr.muted},!0),this.bindUiClick("btnShop",()=>{this.stopBgScroll(),GI.uiViewMgr.showView("ShopView",{from:"SysMainUi"})}),this.bindGEvt("hide_shop_view",t=>{t&&t.from&&"SysMainUi"==t.from&&(this.displayIcons(!0),this.startBgScroll())}),this.bindGEvt("show_shop_view",()=>{this.displayIcons(!1),this.stopBgScroll()}),this.bindUiClick("btnClear",()=>{GI.localDataMgr.clear(),Xi.i.data.initLocalData(),GI.gInfoMgr.showInfo(3,null)})}doShow(){this.displayIcons(!0),this.initData(),this.initUI(),this.startBgScroll()}doHide(){this.stopBgScroll()}initData(){this.isMoreOpen=!1,this.isSetOpen=!1}initUI(){this.u("btnClear").visible=this.u("txtClear").visible=GI.isDebug}startBgScroll(){this.canGroundMove=!0,this.u("trees1").x=this.treeOriginX,this.u("trees2").x=this.treeOriginX+this.u("trees1").width-1,this.u("ground1").x=this.groundOriginX,this.u("ground2").x=this.groundOriginX+this.u("ground1").width-1,this.groundTweens=this.loopScroll("ground1","ground2",3e4),this.treeTweens=this.loopScroll("trees1","trees2",35e3)}loopScroll(t,i,e,s){null==s&&(s=!0);let r=s?this.u(t):this.u(i),a=s?this.u(i):this.u(t);return[GI.Tween.to(r,{x:r.x-r.width},e,Laya.Ease.linearNone,GI.handle(this,()=>{r.x=a.x+a.width-1,this.canGroundMove&&this.loopScroll(t,i,e,!s)}),0,!0),GI.Tween.to(a,{x:r.x},e,Laya.Ease.linearNone,null,0,!0)]}stopBgScroll(){this.canGroundMove=!1;for(let t of this.treeTweens)t.clear();for(let t of this.groundTweens)t.clear()}displayIcons(t){this.u("imgTitle").visible=t,this.u("bgStart").visible=t,this.u("btnShop").visible=t,this.u("btnVoice").visible=t,GI.soundMgr.muted&&(this.u("imgMute").visible=t),GI.isDebug&&(this.u("btnClear").visible=this.u("txtClear").visible=t)}}!function(t){t[t.main=0]="main",t[t.prop=1]="prop",t[t.blast=2]="blast"}(ri||(ri={}));class qi extends GI.UIViewBase{constructor(){super(...arguments),this.propArr=[],this.blastArr=[],this.isDraggingList=!1,this._currentPropType=1,this.isDirectClose=!1}get currentPropType(){return this._currentPropType}set currentPropType(t){this.currentPropType!=t&&(this._currentPropType=t)}createPanel(){this.needMask=!0,this.createPanelUI("ShopView"),this.makeFullScreen(),this.initUIData()}initUIData(){let t=Xi.i.data.commercialCfg.prop_enum,i=Xi.i.data.commercialCfg.prop;this.currentStage=ri.main,this.propList=this.u("propList"),this.propList.itemRenderer=GI.handle(this,this.renderPropListItem,null,!1),this.propArr=[],this.blastList=this.u("blastList"),this.blastList.itemRenderer=GI.handle(this,this.renderBlastListItem,null,!1),this.blastArr=[];for(let e in i)for(let s of i[e].commodity)s.type_id==t.blast?this.blastArr.push(s):this.propArr.push(s);this.propList.numItems=this.propArr.length,this.blastList.numItems=this.blastArr.length}doBindEvt(){this.bindUiClick("btnBack",()=>{if(this.currentStage==ri.main){let t=Xi.i.data.viewBeforeGuide;"SysMainUi"==t.view||"GamePlayView"==t.view?this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.hideSelf(),GI.gMsgCet.event("hide_shop_view",{from:this.fromView}),"SysMainUi"==t.view?GI.uiViewMgr.showView(t.view):"GamePlayView"==t.view&&(Xi.i.curChapter=t.chapter,Xi.i.startLvl(t.lvl)),Xi.i.data.setViewBeforeGuide("")})):this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.hideSelf(),GI.gMsgCet.event("hide_shop_view",{from:this.fromView})}))}else this.isDirectClose?(this.currentStage=ri.main,this.panel.getTransition("drop_detail").playReverse(GI.handle(this,()=>{this.hideSelf(),GI.gMsgCet.event("hide_shop_view",{from:this.fromView})}))):(this.currentStage=ri.main,this.panel.getTransition("drop_detail").playReverse(GI.handle(this,()=>{this.panel.getTransition("drop_panel").play()})))}),this.bindUiClick("btnIntensify",()=>{this.currentStage=ri.prop,this.updateDesc(this.currentPropType),this.panel.getController("displayCtrl").selectedPage="prop_page",this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.panel.getTransition("drop_detail").play()}))}),this.bindUiClick("btnBlast",()=>{this.currentStage=ri.blast,this.panel.getController("displayCtrl").selectedPage="blast_page",this.updateDesc(Xi.i.data.commercialCfg.prop_enum.blast),this.panel.getTransition("drop_panel").playReverse(GI.handle(this,()=>{this.panel.getTransition("drop_detail").play()}))}),this.bindUiClick("btnFeather",()=>{GI.uiViewMgr.showView("AbRewardView",{reward_id:1})}),this.bindUiClick("btnPropCollege",()=>{let t=this.currentStage==ri.blast?Xi.i.data.commercialCfg.prop_enum.blast:this.currentPropType;GI.uiViewMgr.showView("PropCollegeView",{prop_id:t,from:this.fromView})});let t=Xi.i.data.commercialCfg.prop;for(let i in t)i!=Xi.i.data.commercialCfg.prop_enum.blast&&(this.bindUiClick("btnPropType"+i,()=>{this.switchPropType(Number(i))}),this.bindUiEvt("btnPropType"+i,Laya.Event.MOUSE_DOWN,t=>{this.u("btnPropType"+i).setScale(.8,.8)}),this.bindUiEvt("btnPropType"+i,Laya.Event.MOUSE_UP,t=>{this.u("btnPropType"+i).setScale(1,1)}));this.bindUiEvt("propList",fgui.Events.CLICK_ITEM,this.onItemClick),this.bindUiEvt("blastList",fgui.Events.CLICK_ITEM,this.onItemClick),this.bindUiEvt(this.panel,Laya.Event.MOUSE_UP,()=>{this.isDraggingList&&(this.isDraggingList=!1,GI.timerMgr.once(250,this,this.onListScroll))}),this.bindUiEvt("propList",Laya.Event.MOUSE_DOWN,()=>{this.isDraggingList=!0}),this.bindGEvt("Wm.money",()=>{this.u("coinCorner").asCom.getChild("txtCoin").asTextField.text=this.abbreviateNumber(Xi.i.money)},!0),this.bindGEvt("ab.prop_change",this.updatePropCount),this.bindGEvt("ab.get_prop",this.afterBuyProp),this.bindGEvt("ab.RigEnd",()=>{this.hideSelf()})}doShow(t){if(null!=t){let i=Xi.i.data.commercialCfg.prop_enum.blast;if(t.hasOwnProperty("prop_id"))switch(t.prop_id==i?this.currentStage=ri.blast:(this.currentStage=ri.prop,this.currentPropType=t.prop_id),this.isDirectClose=!0,this.currentStage){case ri.prop:this.panel.getController("displayCtrl").selectedPage="prop_page",this.panel.getTransition("drop_detail").play(),this.switchPropType(this.currentPropType);break;case ri.blast:this.panel.getController("displayCtrl").selectedPage="blast_page",this.panel.getTransition("drop_detail").play()}if(t.hasOwnProperty("from"))if(t.hasOwnProperty("prop_id")||(this.isDirectClose=!1),this.fromView=t.from,this.currentStage==ri.main)this.panel.getTransition("drop_panel").play();else{let t=this.currentStage==ri.prop?this.currentPropType:i;this.updateDesc(t)}}GI.gMsgCet.event("show_shop_view"),this.isDraggingList=!1,this.updatePropCount()}doHide(){}renderPropListItem(t,i){if(!i)return;let e=this.propArr[t];i.data=e,i.data.index=t,this.u("imgLoader",i.asCom).asLoader.url=GI.uiViewMgr.getItemURL(Xi.i.data.commercialCfg.prop[e.type_id].iconName),this.u("txtCount",i.asCom).asTextField.text="x"+e.count,this.u("txtCost",i.asCom).asTextField.text=e.cost}renderBlastListItem(t,i){if(!i)return;let e=this.blastArr[t];i.data=e,i.data.index=t,this.u("imgLoader",i.asCom).asLoader.url=GI.uiViewMgr.getItemURL(Xi.i.data.commercialCfg.prop[e.type_id].iconName),this.u("txtCount",i.asCom).asTextField.text="x"+e.count,this.u("txtCost",i.asCom).asTextField.text=e.cost}switchPropType(t){this.currentPropType=t,this.propList.scrollToView(4*(t-1),!0),this.movePointer(this.u("btnPropType"+t).x),this.updateDesc(t)}onItemClick(t,i){t&&null!=t.data&&(Xi.i.data.money>=t.data.cost?Xi.i.data.buyPropUpdateData(t.data):GI.gInfoMgr.showInfo(2,null))}onListScroll(t){let i=this.panel.getController("listCtrl").selectedIndex+1;this.currentPropType=i,this.movePointer(this.u("btnPropType"+i).x),this.updateDesc(i)}movePointer(t){GI.Tween.to(this.u("imgPointer"),{x:t},300)}updatePropCount(){let t=Xi.i.data.props;for(let i in t){let e=this.u("txtPropCount"+i);null!=e&&(e.asTextField.text=t[i].quantity)}}updateDesc(t){this.u("txtDesc").asTextField.text=Xi.i.data.commercialCfg.prop[t].desc,this.panel.getController("descCtrl").selectedPage="prop"+t;let i=Xi.i.data.props[t];this.u("imgStar").visible=null!=i.guide_done&&i.guide_done>0}afterBuyProp(t){let i=Xi.i.data.commercialCfg.prop[t.type_id];GI.uiViewMgr.showView("ObtainView",{name:i.name,quantity:t.count,iconName:i.iconName})}abbreviateNumber(t){let i=t;if(t>=1e3){var e=["","k","m","g","t"],s=Math.floor((t.toFixed(0).length-1)/3);s>=e.length&&(s=e.length-1);var r=0!=s?t/Math.pow(1e3,s):t;r%1!=0&&(r=Math.floor(r)),i=r+e[s]}return i.toString()}}class Qi extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("RoleView"),this.makeFullScreen(),this._cfgs=[Xi.i.data.bodyData,Xi.i.data.hatData,Xi.i.data.jewelryData,Xi.i.data.rodData],this._txtUsingPosX=this.u("txtUsing").x}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnUse",this.onUse),this.bindUiEvt("typeList",fgui.Events.CLICK_ITEM,this.onTypeSelect),this.bindUiEvt("list",fgui.Events.CLICK_ITEM,this.onItemSelect),this.bindGEvt("Wm.money",()=>{this.u("txtGold").asLabel.text=Xi.i.money.toString()},!0),this.bindGEvt(["Wm.money","Wm.part.active","Wm.part.curUseID"],this.onItemSelect),this.bindGEvt(["Wm.part.active"],this.updateTypePrg),this.u("list").asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.u("list").asList.setVirtual()}doShow(){this.u("list").asList.numItems=0,this.u("typeList").asList.selectedIndex=0,this.onTypeSelect(),GI.pf.hideBanner({sourceType:127}),GI.pf.showInsertAd({sourceType:this.viewID})}doHide(){this.u("list").asList.numItems=0,this.clearRolePreview(),GI.pf.showBanner({sourceType:6})}onTypeSelect(){this._curTypeCtrl=this._cfgs[this.u("typeList").asList.selectedIndex],this.u("txtTitle").asLabel.text=this._curTypeCtrl?this._curTypeCtrl.data.name:"",this.updateTypePrg(),this.u("list").asList.numItems=this._curTypeCtrl.cfgCount,this.u("list").asList.selectedIndex=Math.max(0,this._curTypeCtrl.getIndexByID(this.curTypeUseID)),this.u("list").asList.scrollToView(this.u("list").asList.selectedIndex),this.onItemSelect()}updateTypePrg(){this.u("txtProgress").asLabel.text=this._curTypeCtrl?this._curTypeCtrl.activeCount+"/"+this._curTypeCtrl.cfgCount:"",this.u("prg").asProgress.value=this._curTypeCtrl?100*this._curTypeCtrl.activeCount/this._curTypeCtrl.cfgCount:0,this._cfgs.forEach((t,i)=>{let e=this.u("typeList").asList.getChildAt(this.u("typeList").asList.itemIndexToChildIndex(i));if(!e)return;let s=t.canActiveCount;e.getChild("txtRoleNotice").asLabel.text=(s||"").toString(),e.getChild("imgRoleNotice").visible=s>0})}renderListItem(t,i){if(!i)return;i.data=t,i.icon=GI.uiViewMgr.getItemURL(this._curTypeCtrl.getCfgByIndex(t).icoUrl);let e=i.displayObject.getChildByName("img");e||((e=new Laya.Sprite).name="img",e.pos(10,36),i.displayObject.addChild(e)),e.loadImage(this._curTypeCtrl.getCfgByIndex(t).icoUrl)}onItemSelect(){if(this.clearRolePreview(),this._curItemData=this._curTypeCtrl.getCfgByIndex(this.u("list").asList.selectedIndex),this._curItemData)if(this._curItemData.id==this.curTypeUseID)this.u("btnUse").asButton.grayed=!0,this.u("imgPrice").visible=!1,this.u("txtUsing").asLabel.text="当前选择",this.u("txtUsing").x=this.u("btnUse").x;else if(this._curItemData.active)this.u("btnUse").asButton.grayed=!1,this.u("imgPrice").visible=!1,this.u("txtUsing").asLabel.text="选择",this.u("txtUsing").x=this.u("btnUse").x;else{let t=Xi.i.money>=this._curItemData.price;this.u("btnUse").asButton.grayed=!t,this.u("imgPrice").visible=!0,this.u("imgPrice").asImage.grayed=!t,this.u("txtUsing").asLabel.text=this._curItemData.price.toString(),this.u("txtUsing").x=this._txtUsingPosX}else;switch(this._curTypeCtrl){case Xi.i.data.bodyData:case Xi.i.data.rodData:this._rolePreviewData=this._curItemData,this._parPreviewData=null;break;case Xi.i.data.hatData:case Xi.i.data.jewelryData:this._rolePreviewData=Xi.i.data.bodyData.curUseData,this._parPreviewData=this._curItemData;break;default:this._rolePreviewData=null,this._parPreviewData=null}let t=[this._rolePreviewData.uiRes];this._parPreviewData&&this._parPreviewData.uiRes&&t.push(this._parPreviewData.uiRes),GI.resMgr.load(t,GI.handle(this,t=>{this.clearRolePreview(!1),this._rolePreview=this.createPreview(this._rolePreviewData),this._rolePreview&&(this._partPreview=this.createPreview(this._parPreviewData,this._rolePreview.getChildByName(this._curTypeCtrl.data.bindPtName)))}),null,Laya.Loader.JSON)}createPreview(t,i=null){if(!t)return null;let e=new Laya.Prefab;if(e.json=GI.resMgr.getRes(t.uiRes),!e.json)return null;let s=Laya.Pool.getItemByCreateFun(t.uiRes,e.create,e);return i?(GI.util.bindPros(i,t.ctrl.data.uiPtPros),i.addChild(s),s.pos(0,0),t.showPros&&t.showPros[Xi.i.data.bodyData.curUseID]&&GI.util.bindPros(s,t.showPros[Xi.i.data.bodyData.curUseID].ui)):(this.u("rolePt").displayObject.parent.addChild(s),s.pos(this.u("rolePt").x,this.u("rolePt").y-(i?200:0))),s}clearRolePreview(t=!0){this.recoverPreview(this._partPreview,this._parPreviewData),this._partPreview=null,t&&(this._parPreviewData=null),this.recoverPreview(this._rolePreview,this._rolePreviewData),this._rolePreview=null,t&&(this._rolePreviewData=null)}recoverPreview(t,i){t&&(t.parent.removeChild(t),GI.util.bindPros(t,i.ctrl.data.resetPros),Laya.Pool.recover(i.uiRes,t))}get curTypeUseID(){switch(this.u("typeList").asList.selectedIndex){case 0:return Xi.i.data.curBodyID;case 1:return Xi.i.data.curHatID;case 2:return Xi.i.data.curJewelryID;case 3:return Xi.i.data.curRodID}return-1}onUse(){this._curItemData&&this._curItemData.id!=this.curTypeUseID&&(this._curItemData.active?this._curTypeCtrl.curUseID=this._curItemData.id:Xi.i.money>=this._curItemData.price&&(Xi.i.money-=this._curItemData.price,Xi.i.money2-=this._curItemData.price,this._curTypeCtrl.active(this._curItemData.id),this._curTypeCtrl.curUseID=this._curItemData.id))}}class Ki extends GI.UIViewBase{constructor(){super(...arguments),this.chapterId=-1,this._curPage=0}set curPage(t){this._curPage=t,this.pageIndexRecord[this.chapterId]=t,this.u("btnPre").visible=t>0,this.u("btnNext").visible=this.u("list").asList.numItems>21*(t+1)}get curPage(){return this._curPage}scrollPageView(t,i){this.list.scrollToView(21*t,i)}createPanel(){this.createPanelUI("ChallengeView"),this.makeFullScreen(),this.list=this.u("list").asList,this.pageIndexRecord={};for(let t in Xi.i.data.chapterData)this.pageIndexRecord[t]=0}doBindEvt(){this.bindUiClick("btnBack",()=>{this.hideSelf(),GI.uiViewMgr.showView("ChapterView")}),this.bindUiClick("btnNext",()=>{this.curPage++,this.scrollPageView(this.curPage,!0)}),this.bindUiClick("btnPre",()=>{this.curPage--,this.scrollPageView(this.curPage,!0)}),this.bindUiEvt("list",fgui.Events.CLICK_ITEM,this.onItemClick),this.list.asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.list.asList.setVirtual(),this.bindGEvt("ab.chapter_update",this.doShow)}doShow(t){null!=t&&null!=t.chapterId&&(this.chapterId=Number(t.chapterId)),this.chapterData=Xi.i.data.chapterData[this.chapterId],this.list.numItems=Xi.i.data.getLevelsAmount(this.chapterId);let i=this.pageIndexRecord[this.chapterId];this.curPage=i,this.scrollPageView(i,!1),GI.pf.hideBanner({sourceType:6}),GI.pf.showInsertAd({sourceType:this.viewID})}doHide(){this.list.numItems=0,GI.pf.showBanner({sourceType:6})}renderListItem(t,i){if(!i)return;i.data=t;let e=Xi.i.data.chapterCfgs[this.chapterId].levels;e[t]&&null!=e[t].name?this.u("txtLvl",i.asCom).asLabel.text=e[t].name:this.u("txtLvl",i.asCom).asLabel.text=(t+1).toString();for(let t=1;t<=3;t++)this.u("star"+t,i.asCom).visible=!1;if(1==this.chapterData.levels[t].locked&&0==GI.gCfg.unlock_all_chapter)i.asCom.getController("displayCtrl").selectedPage="lock";else{i.asCom.getController("displayCtrl").selectedPage="enable";for(let e=1;e<=this.chapterData.levels[t].bestRank;e++)this.u("star"+e,i.asCom).visible=!0}}onItemClick(t,i){if(!t||null==t.data)return;let e=Number(t.data);1!=this.chapterData.levels[e].locked||0!=GI.gCfg.unlock_all_chapter?(this.hideSelf(),Xi.i.startLvl(e+1)):GI.uiViewMgr.showView("UnlockChapterView")}}class Zi extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("ChapterView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnBack",()=>{this.hideSelf(),GI.uiViewMgr.showView("SysMainUi")}),this.bindUiClick("btnVideo",()=>{this.onFinishVideo(!0,null)}),this.bindGEvt("ab.get_prop",()=>{this.showObtainView()});let t=Xi.i.data.chapterCfgs;for(let i in t)this.bindUiClick("btnChapter"+i,()=>{1!=Xi.i.data.chapterData[i].locked||0!=GI.gCfg.unlock_all_chapter?(Xi.i.curChapter=Number(i),GI.uiViewMgr.showView("ChallengeView",{chapterId:i}),this.hideSelf()):GI.uiViewMgr.showView("UnlockChapterView")});this.bindGEvt("ab.chapter_update",this.doShow)}doShow(){this.initUI()}doHide(){}onFinishVideo(t,i){if(GI.log("章节界面播放完视频广告：",t,i),!t)return;let e=Xi.i.data.commercialCfg.reward;this.rewardId=Math.round(Math.random()*(Object.keys(e).length-1))+1;let s=e[this.rewardId];if(1==s.isCurrency)Xi.i.data.money+=s.quantity,this.showObtainView();else{let t=s.prop_id;Xi.i.data.presentUpdateData(t,s.quantity)}}showObtainView(){let t=Xi.i.data.commercialCfg.reward[this.rewardId];GI.uiViewMgr.showView("ObtainView",{name:t.name,quantity:t.quantity,iconName:t.iconName})}initUI(){let t=Xi.i.data.chapterData;for(let i in t){let e=t[i];this.u("lock"+i).visible=1==e.locked&&0==GI.gCfg.unlock_all_chapter;let s=0,r=0,a=0;for(let t of e.levels)s+=t.bestScore,r+=t.bestRank,a+=3;this.u("txtScore"+i).asTextField.text=s.toString(),this.u("txtRank"+i).asTextField.text=r+"/"+a}}}class $i extends GI.UIViewBase{constructor(){super(...arguments),this.isPropBarOpen=!1,this.isPauseOpen=!1,this.isGuiding=!1,this.guideIdMap={1:6,2:7,3:8,4:9,5:10,6:11}}createPanel(){this.createPanelUI("GamePlayView"),this.makeFullScreen(),this.initData()}initData(){}doBindEvt(){this.bindUiEvt(this.panel,Laya.Event.MOUSE_DOWN,t=>{GI.gMsgCet.event("abCtrl.MOUSE_DOWN",t)}),this.bindUiEvt(this.panel,Laya.Event.MOUSE_UP,t=>{GI.gMsgCet.event("abCtrl.MOUSE_UP",t)}),this.bindUiEvt(this.panel,Laya.Event.MOUSE_OUT,t=>{GI.gMsgCet.event("abCtrl.MOUSE_OUT",t)}),this.bindUiEvt(this.panel,Laya.Event.MOUSE_MOVE,t=>{GI.gMsgCet.event("abCtrl.MOUSE_MOVE",t)}),this.bindUiClick("btnPause",()=>{this.displayPausePanel(!0)}),this.bindUiClick(["btnRestart","btnPauseRestart","btnGuideRestart"],()=>{this.hideSelf(),Xi.i.reStart()}),this.bindUiClick("btnBack",()=>{this.quitGuide()}),this.bindUiClick("btnExpand",()=>{this.displayPausePanel(!1)}),this.bindUiEvt(this.u("coverBg"),Laya.Event.MOUSE_DOWN,t=>{this.displayPausePanel(!1)}),this.bindUiClick("btnVoice",()=>{GI.soundMgr.triggerMuted()}),this.bindGEvt("sound.muted",()=>{this.u("imgMute").visible=GI.soundMgr.muted},!0),this.bindUiClick("btnLvl",()=>{this.hideSelf(),Xi.i.quitPlay(),GI.uiViewMgr.showView("ChallengeView",{chapterId:Xi.i.curChapter})}),this.bindUiClick("btnMenu",()=>{this.hideSelf(),Xi.i.quitPlay(),GI.uiViewMgr.showView("SysMainUi")}),this.bindUiClick("btnGuide",()=>{this.displayPausePanel(!1),GI.uiViewMgr.showView("AbGuideView",{isSingle:!1,guidePage:1})}),this.bindUiClick("pausePanel",()=>{}),this.bindGEvt("AddGameGrade",t=>{this.updateCurrentScore()}),this.bindUiClick("btnOpenProp",()=>{this.displayProBar(!this.isPropBarOpen)}),this.bindUiClick("btnShop",()=>{GI.uiViewMgr.showView("ShopView",{from:"GamePlayView"})}),this.bindGEvt("ab.RigEnd",()=>{this.displayProBar(!1,()=>{this.displayIcons(!1)})}),this.bindGEvt("ab.prop_change",this.updatePropCount);for(let t in Xi.i.data.props)null!=this.u("btnProp"+t)&&this.bindUiClick("btnProp"+t,()=>{let i=0!=Xi.i.data.props[t].quantity;Xi.i.data.isGuideScene&&(i=Number(t)==Xi.i.data.propGuideId),i?Xi.i.data.usePropUpdateData(t,Xi.i.data.isGuideScene):GI.uiViewMgr.showView("ShopView",{from:"GamePlayView",prop_id:t})});this.bindGEvt("ab.use_prop",this.onUseProp),this.bindGEvt("bird_eject",this.onBirdEject),this.bindGEvt("ab.camShake",this.onQuakeFinish)}doShow(t){t&&t.from&&this.applyUI(),GI.pf.showBanner({sourceType:6}),GI.uiViewMgr.showView("ScoreView")}doHide(t){t&&t.onGameHide||(this.displayPausePanel(!1),this.displayProBar(!1),GI.uiViewMgr.hideView("ScoreView"))}applyUI(){let t=Xi.i.data.isGuideScene;if(this.panel.getController("displayCtrl").selectedPage=t?"guide":"game",!t){let t=Xi.i.data.chapterData[Xi.i.curChapter].levels[Xi.i.curLvl-1];this.u("txtBestScore").asTextField.text=t.bestScore}this.u("txtLvl").asTextField.text=Xi.i.curChapter+"-"+Xi.i.curLvl;let i=Xi.i.data.commercialCfg.prop_enum.double_point;null!=Xi.i.data.usingProp[i]&&(this.u("txtDoublePoint").visible=Xi.i.data.usingProp[i].count>0),this.displayIcons(!Xi.i.isWaitWin),this.updatePropCount(),this.updateCurrentScore(),this.displayProBar(!0,()=>{Xi.i.data.isGuideScene&&(GI.guideMgr.start(this.guideIdMap[Xi.i.data.propGuideId]),this.isGuiding=!0)})}showGuide(t){Xi.i.canOperate=!1;let i=GI.gCfg.guideCfgs[t],e=[],s=GI.uiViewMgr.createUiObj("viewMask");this.u("bg",s).alpha=.7,this.panel.addChild(s);let r=GI.uiViewMgr.createUiObj(i.guideArrow);this.panel.addChild(r);let a=this.u(i.pointUiName);r.setXY(a.x+a.width,a.y),r.getTransition("ani").play();let o=this.panel.getChildIndex(s);if(Array.isArray(i.uiName))for(let t of i.uiName)e.push(this.panel.getChildIndex(this.u(t))),this.panel.setChildIndex(this.u(t),o),o++;else String.is(i.uiName)&&(e.push(this.panel.getChildIndex(this.u(i.uiName))),this.panel.setChildIndex(this.u(name),o));a.onClick(this,()=>{if(Xi.i.canOperate=!0,r.getTransition("ani").stop(),this.panel.removeChild(s),this.panel.removeChild(r),Array.isArray(i.uiName))for(let t=0;t<i.uiName.length;t++)this.panel.setChildIndex(this.u(i.uiName[t]),e[t]);else String.is(i.uiName)&&this.panel.setChildIndex(this.u(i.uiName),e[0])})}displayIcons(t){this.panel.getController("waitEndCtrl").selectedPage=t?"show":"hide"}updateCurrentScore(){this.u("txtScore").asTextField.text=Xi.i.data.GameGrade.toString()}displayProBar(t,i){if(this.isPropBarOpen==t)return void(i&&i());let e=this.panel.getTransition("openProp");t?e.play(GI.handle(this,i)):e.playReverse(GI.handle(this,i)),this.isPropBarOpen=t}displayPausePanel(t){if(this.isPauseOpen==t)return;let i=this.panel.getTransition("pause");t?i.play():i.playReverse(),this.isPauseOpen=t}updatePropCount(){let t=Xi.i.data.props,i=Xi.i.data.isGuideScene,e=Xi.i.data.propGuideId;if(i)for(let i in t)Number(i)==e?t[i].quantity=-1:t[i].quantity=0;for(let s in t){let r=this.u("btnProp"+s),a=this.u("txtPropCount"+s),o=this.u("imgAddProp"+s);if(null!=r){let t=Xi.i.data.usingProp[s].count,a=!i||Number(s)==e;r.enabled=t<=0&&a}if(null!=a){let i=t[s].quantity;a.asTextField.text=-1==i?"∞":i}if(null!=o&&(o.visible=0==t[s].quantity&&!i),s==Xi.i.data.commercialCfg.prop_enum.blast){let e=this.u("bgPropCount"+s);null!=e&&(e.visible=0!=t[s].quantity||i)}}}onUseProp(t){this.isGuiding&&Xi.i.data.isGuideScene&&(GI.guideMgr.stopCurGuide(),this.isGuiding=!1);let i=Number(t.prop_id),e=this.panel.getTransition("useProp"+i);e&&e.play(),this.updatePropCount();let s=Xi.i.data.commercialCfg.prop_enum;switch(i){case s.double_point:this.u("txtDoublePoint").visible=!0;break;case s.blast:Xi.i.data.props[s.bird_intensify].quantity>0&&(this.u("btnProp"+s.bird_intensify).enabled=!0)}}onBirdEject(t){if(t&&Array.isArray(t)){let i=Xi.i.data.commercialCfg.prop_enum,e={0:i.bird_intensify,1:i.blast};for(let i=0;i<t.length;i++)1==t[i]&&this.doneUseProp(e[i])}this.updatePropCount()}onQuakeFinish(t){t&&t.shadkeDuration&&GI.timerMgr.once(t.shadkeDuration,this,()=>{this.doneUseProp(Xi.i.data.commercialCfg.prop_enum.quake),this.updatePropCount()})}doneUseProp(t){let i=Xi.i.data.usingProp[t];i&&i.count>0&&i.count--}quitGuide(){this.hideSelf(),Xi.i.quitPlay(),Xi.i.data.clearPropGuideId(),GI.uiViewMgr.showView("ShopView")}}class te extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("PrgView"),this._bar=this.u("bar").asProgress}doBindEvt(){this.bindGEvt("PrgMgr.progress",()=>{this._bar.value=GI.prgMgr.prg},!0)}}class ie extends GI.UIViewBase{createPanel(){this._layer=GI.uiViewMgr.getMaskViewLayer(this.viewID),this.createPanelUI("MaskView"),this.makeFullScreen(),this.defaultAlpha=this.u("bg").asCom.alpha}get curMaskview(){return GI.uiViewMgr.curMaskview}autoUpdatePanelDepth(){this.bringToBottom(),this.curMaskview&&this.curMaskview.panel.parent==this.panel.parent&&this.panel.parent.setChildIndex(this.panel,this.panel.parent.getChildIndex(this.curMaskview.panel)-1)}doBindEvt(){this.bindUiClick(this.panel,()=>{GI.uiViewMgr.onMaskClick()})}doShow(){let t=this.curMaskview.maskPros;this.u("bg").alpha=t?t.alpha:this.defaultAlpha}}class ee extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("NativeAdView"),this.makeFullScreen(),this._imgHtNativeGame=new Laya.Sprite,this._imgHtNativeGame.mouseEnabled=!0,this._imgHtNativeGame.size(this.u("htNativeGames").width,this.u("htNativeGames").height),this.u("htNativeGames").displayObject.addChild(this._imgHtNativeGame),this.u("btnMoreGame").visible=this.u("lblMoreGame").visible=GI.gCfg.htMoreGame,this._htMoreGameShowNum=this.u("list").asList.numItems}doBindEvt(){this._nativeAd=oi.create(this.u("nativeAd")).bindNativeAdEvt(this),this.bindUiClick(this._imgHtNativeGame,()=>{this._curHtNativeGame&&GI.gMsgCet.event("pf.goHtNativeGame",{htData:this._curHtNativeGame})}),this.u("btnMoreGame").visible&&this.bindUiClick("btnMoreGame",this.showMoreGame),this.bindUiClick("btnHideMoreGame",this.hideMoreGame),this.bindUiEvt("list",fgui.Events.CLICK_ITEM,this.onItemClick),this.bindGEvt("pf.onHtNativeGames",this.onHtNativeGames),this.bindGEvt("pf.onHtMoreGame",this.onHtMoreGame),this.u("list").asList.itemRenderer=GI.handle(this,this.renderListItem,null,!1),this.u("list").asList.setVirtual()}doShow(){this._nativeAd.doShow(),GI.gMsgCet.event("pf.getHtNativeGames"),this.u("htNativeGamesCon").visible=!1,this.hideMoreGame()}doHide(){this._nativeAd.doHide(),GI.timerMgr.clear(this,this.updateHtNativeGame),this.hideMoreGame()}onHtNativeGames(t){this._htNativeGames=t?t.dataList:[],this._curHtNativeGameIndex=-1,this.updateHtNativeGame(),GI.timerMgr.loop(GI.gCfg.htNativeGamesFrequency,this,this.updateHtNativeGame)}updateHtNativeGame(){this._curHtNativeGameIndex=(this._curHtNativeGameIndex+1)%this._htNativeGames.length,this._curHtNativeGame=this._htNativeGames[this._curHtNativeGameIndex],this._curHtNativeGame&&this._imgHtNativeGame.loadImage(this._curHtNativeGame.iconUrl,GI.handle(this,()=>{this.visible&&(this.u("htNativeGamesCon").visible=!0,this.u("htNativeGamesTxtGName").asLabel.text=this._curHtNativeGame.txt,this.u("htNativeGamesBg").asImage.color=GI.gCfg.htBoxGmaeColors[this._curHtNativeGameIndex%GI.gCfg.htBoxGmaeColors.length],this.u("htNativeGamesTxtMark").asLabel.text=this._curHtNativeGame.mark,this.u("htNativeGamesMarkBg").visible=!!this._curHtNativeGame.mark,this._curHtNativeGame.mark&&(this.u("htNativeGamesMarkBg").asImage.color=GI.gCfg.htAdMarkColors[this._curHtNativeGame.mark]||GI.gCfg.htAdMarkColors.default))}))}showMoreGame(){this.u("list").visible=!1,this.u("conMoreGames").visible=!0,GI.gMsgCet.event("pf.getHtMoreGame")}hideMoreGame(){this.u("conMoreGames").visible=!1,GI.timerMgr.clear(this,this.updateHtMoreGame)}onHtMoreGame(t){this._htMoreGames=t?t.dataList:[],this._curHtMoreGameIndex=-1,this.updateHtMoreGame(),GI.timerMgr.loop(GI.gCfg.htMoreGamesFrequency,this,this.updateHtMoreGame)}updateHtMoreGame(){this._curHtMoreGameIndex=(this._curHtMoreGameIndex+1)%this._htMoreGames.length,this.u("list").asList.numItems=Math.min(this._htMoreGameShowNum,this._htMoreGames.length),this.u("list").visible=!0}renderListItem(t,i){if(!i)return;t=(this._curHtMoreGameIndex+t)%this._htMoreGames.length,i.data=t;let e=this._htMoreGames[t];this.u("txtGName",i.asCom).asLabel.text=e.txt,this.u("txtMark",i.asCom).asLabel.text=e.mark,this.u("imgMarkBg",i.asCom).visible=!!e.mark,e.mark&&(this.u("imgMarkBg",i.asCom).asImage.color=GI.gCfg.htAdMarkColors[e.mark]||GI.gCfg.htAdMarkColors.default);let s=i.asCom.getChild("imgCon"),r=s.displayObject.getChildByName("img");r||((r=new Laya.Sprite).name="img",r.size(s.width,s.height),s.displayObject.addChild(r)),r.loadImage(e.iconUrl)}onItemClick(t,i){if(!t||null==t.data)return;let e=this._htMoreGames[Number(t.data)];e&&GI.gMsgCet.event("pf.goHtMoreGame",{htData:e}),this.hideMoreGame()}}class se extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.needMask=!0,this.autoShowOnGShow=!1,this.createPanelUI("InsertAdView"),this.makeFullScreen(),this.u("nativeAd").asCom.getChild("btnAdClose").visible=!1}doBindEvt(){this._nativeAd=oi.create(this.u("nativeAd"),{keepOrigin:!0,adType:"insertAd",closeOnEmpty:!0}).bindNativeAdEvt(this),this.bindClickHide("btnClose"),this._nativeAd.loadImageFunc=this.onNativeAdLoad.bind(this)}doShow(){this._nativeAd.closeFunc=this.hideSelf.bind(this),this._nativeAd.doShow(),this._nativeAd.visible&&GI.gMsgCet.event("pf.InsertAdView.show")}doHide(){this._nativeAd.closeFunc=null,this._nativeAd.doHide(),GI.gMsgCet.event("pf.InsertAdView.hide")}onNativeAdLoad(t){this.u("nativeAdText").text=t.title}}class re extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.pop,this.createPanelUI("BannerAdView"),this.makeFullScreen(),this.u("nativeAd").asCom.getChild("btnAdClose").visible=!1}doBindEvt(){this._nativeAd=oi.create(this.u("nativeAd"),{adType:"bannerAd",fill:!0}).bindNativeAdEvt(this),this.bindClickHide("btnClose"),this._nativeAd.loadImageFunc=this.onNativeAdLoad.bind(this)}doShow(t){let i=t&&t.style&&t.style;this.u("nativeAd").setSize(i.width,i.height),this.u("nativeAd").setXY(i.left,i.top-GI.uiViewMgr.uiOffY),this._nativeAd.closeFunc=this.hideSelf.bind(this),this._nativeAd.doShow()}doHide(){this._nativeAd.closeFunc=null,this._nativeAd.doHide()}onNativeAdLoad(t){this.u("btnClose").setXY(this.u("nativeAd").x+this._nativeAd.iconX+this._nativeAd.iconWidth-this.u("btnClose").width*this.u("btnClose").scaleX/2,this.u("nativeAd").y+this._nativeAd.iconY+this.u("btnClose").height*this.u("btnClose").scaleY/2)}}class ae extends GI.UIViewBase{constructor(){super(...arguments),this._currentPage=0,this.totalPage=7}set currentPage(t){if(this._currentPage==t)return;let i=this._currentPage;this._currentPage=t,this.changePage(i)}get currentPage(){return this._currentPage}createPanel(){this.createPanelUI("AbGuideView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("guidePanel",()=>{}),this.bindUiClick("mask",()=>{!this.isSinglePage&&this.closeGuide()}),this.bindUiClick("btnNext",()=>{this.isSinglePage||this.currentPage>=this.totalPage?this.closeGuide():this.currentPage++})}doShow(t){null!=t&&null!=t.isSingle&&null!=t.guidePage&&(this.currentPage=t.guidePage,this.isSinglePage=t.isSingle,this.callback=t.callback)}doHide(){}changePage(t){null!=this.u("guide"+t)&&(this.u("guide"+t).visible=!1),null!=this.u("guide"+this.currentPage)&&(this.u("guide"+this.currentPage).visible=!0)}closeGuide(){this.hideSelf(),this.u("guide"+this.currentPage).visible=!1,this.currentPage=0,this.callback&&this.callback()}}class oe extends GI.UIViewBase{constructor(){super(...arguments),this.scorePool={}}get isShowingScore(){return this._isShowingScore}set isShowingScore(t){this._isShowingScore=t}doOnUpdate(){for(let t in this.scorePool){let i=Xi.i.camera.scToUi(new Laya.Point(this.scorePool[t].x,this.scorePool[t].y));this.scorePool[t].component.asCom.setXY(i.x,i.y)}}createPanel(){this._layer=GI.UiLayerEnum.sceneui,this.createPanelUI("ScoreView"),this.makeFullScreen()}doBindEvt(){this.bindGEvt("AddGameGrade",t=>{this.isShowingScore||(this.isShowingScore=!0);let i=Xi.i.data.getUiCfgByEventId(t.id,t.score_type);i&&this.popScore(t,i)})}doShow(){this.isShowingScore=!1,this.scorePool={}}doHide(){}popScore(t,i){let e=GI.uiViewMgr.createUiObj("ScoreText").asCom;e.x=t.point.x,e.y=t.point.y;let s=this.getNoUseId(0);this.scorePool[s]={x:t.point.x,y:t.point.y,component:e};let r=e.getChild("txtScore").asTextField;r.text=t.grage.toString(),r.font=i.font_url,this.panel.addChild(e),e.getTransition(i.ani_code).play(GI.handle(this,()=>{this.panel.removeChild(e),delete this.scorePool[s],Object.keys(this.scorePool).length<=0&&(this.isShowingScore=!1)}))}getNoUseId(t){for(let i in this.scorePool)if(Number(i)==t)return this.getNoUseId(t+1);return t}}class he extends GI.UIViewBase{createPanel(){this._layer=GI.UiLayerEnum.tip,this.autoShowOnGShow=!1,this.createPanelUI("GuideView"),this._panelOff=Laya.Point.create().setTo((GI.gw()-this.panel.width)/2,(GI.gh()+GI.uiViewMgr.uiOffY-this.panel.height)/2)}doBindEvt(){}doShow(){this.updateGuide()}updateGuide(){let t=GI.guideMgr.curGuideCfg,i=GI.guideMgr.guideRect;this.panel.getController("aniCtrl").selectedPage=t.guideAni;let e=this.u(t.guideAni).asCom;e.getTransition("ani").play(null,-1);let s=t.bgMaskAlpha>=0;for(let i=0;i<4;i++)this.u("bg"+i).visible=s,s&&(this.u("bg"+i).alpha=t.bgMaskAlpha);this.u("center").setXY(i.x-this._panelOff.x+(t.rectOffX||0),i.y-this._panelOff.y+(t.rectOffY||0)),this.u("center").setSize(i.width+(t.rectExtraWidth||0),i.height+(t.rectExtraHeight||0));let r=this.u(t.guideAni+"Pt");e.setXY(r.x+(t.aniOffX||0),r.y+(t.aniOffY||0));let a=this.u("txtDes").asLabel;a.text=t.des||"",t.des&&(this.u("desPt",e).localToGlobal(0,0,Laya.Point.TEMP.reset()),a.setXY(Laya.Point.TEMP.x-this._panelOff.x,Laya.Point.TEMP.y-this._panelOff.y))}}class ne extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("ObtainView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick(this.panel,()=>{GI.uiViewMgr.onMaskClick()})}doShow(t){this.handleSk(),null!=t&&null!=t.name&&(this.uiData=t);let i=this.u("imgLoader");i.asLoader.url=GI.uiViewMgr.getItemURL(this.uiData.iconName),this.panel.getTransition("show").play(),this.u("txtDesc").asTextField.text="恭喜获得"+this.uiData.name,this.u("txtCount").asTextField.text="x"+this.uiData.quantity,this.u("txtCount").x=i.x+i.width}handleSk(){if(null==this.sk){this.sk=new Laya.Skeleton;let t=this.u("imgLoader");t&&this.sk.pos(t.x,t.y),this.sk.load("res/ani/fx_prop_shine/bu_glwo_01.sk",GI.handle(this,()=>{this.sk.play(0,!0)})),this.panel.displayObject.addChild(this.sk),this.panel.displayObject.setChildIndex(this.sk,0)}else this.panel.displayObject.setChildIndex(this.sk,0),this.sk.play(0,!0)}doHide(){this.panel.getTransition("show").playReverse(),this.sk.stop()}}class le extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("UnlockChapterView"),this.makeFullScreen(),this.unlockCfg=Xi.i.data.commercialCfg.unlock_chapter}doBindEvt(){this.bindClickHide("btnClose");for(let t in this.unlockCfg.unlock_items)null!=this.u("btnUnlock"+t)&&this.bindUiClick("btnUnlock"+t,()=>{this.unlockLvl(this.unlockCfg.unlock_items[t])})}doShow(){this.setUI()}doHide(){}setUI(){this.u("txtTitle").asTextField.text=this.unlockCfg.name,this.u("txtDesc").asTextField.text=this.unlockCfg.desc;for(let t in this.unlockCfg.unlock_items)null!=this.u("txtUnlock"+t)&&(this.u("txtUnlock"+t).asTextField.text=this.unlockCfg.unlock_items[t].desc)}unlockLvl(t){if(Xi.i.data.money<t.cost)GI.gInfoMgr.showInfo(2,null);else{Xi.i.data.unlockLevel(t.unlock_count,t.whole_chapter)&&(Xi.i.money-=t.cost,GI.gInfoMgr.showInfo(4,null)),this.hideSelf()}}}class de extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("PropCollegeView"),this.makeFullScreen()}doBindEvt(){this.bindClickHide("btnClose"),this.bindUiClick("btnPlay",()=>{Xi.i.isPlay?this.panel.getController("displayCtrl").selectedPage="pop":this.toGuide()}),this.bindUiClick("btnPopNo",()=>{this.panel.getController("displayCtrl").selectedPage="normal"}),this.bindUiClick("btnPopYes",()=>{this.toGuide()})}doShow(t){t&&t.prop_id&&t.from&&(this.currentPropId=t.prop_id,this.fromView=t.from,this.panel.getController("displayCtrl").selectedPage="normal",this.updateUI())}doHide(){}updateUI(){let t=Xi.i.data.props;for(let i in t){let t=this.u("imgProp"+i);if(null!=t){let e=Number(i)==this.currentPropId;t.alpha=e?1:.5}}}toGuide(){this.hideSelf(),GI.uiViewMgr.hideView("ShopView"),GI.uiViewMgr.hideView("SysMainUi"),GI.uiViewMgr.hideView("GamePlayView"),Xi.i.data.propGuideId=this.currentPropId,Xi.i.data.setViewBeforeGuide(this.fromView,Xi.i.curChapter,Xi.i.curLvl),Xi.i.startPropGuideLvl()}}class ge extends GI.UIViewBase{createPanel(){this.needMask=!0,this.createPanelUI("PropGuideEndView"),this.makeFullScreen()}doBindEvt(){this.bindUiClick("btnBack",()=>{this.quitGuide()}),this.bindUiClick("btnRestart",()=>{this.hideSelf(),Xi.i.reStart()}),this.bindUiClick("btnNext",()=>{null!=Xi.i.data.commercialCfg.prop[this.propId+1]?(this.hideSelf(),Xi.i.data.propGuideId=this.propId+1,Xi.i.startPropGuideLvl()):this.quitGuide()})}doShow(t){t&&null!=t.isWin&&null!=t.propId&&(this.isWin=t.isWin,this.propId=t.propId),this.applyUI()}doHide(){}applyUI(){this.panel.getController("stageCtrl").selectedPage=this.isWin?"win":"fail";let t=Xi.i.data.commercialCfg.prop[this.propId];t&&(this.u("propLoader").asLoader.url=GI.uiViewMgr.getItemURL(t.iconName))}quitGuide(){this.hideSelf(),Xi.i.data.clearPropGuideId(),GI.uiViewMgr.showView("ShopView")}}class ue{static init(){GI.gInfoMgr.registerView("HintView",vi),GI.guideMgr.initData(GI.uiViewMgr.registerView("GuideView",he),GI.cfgMgr.parseCfgData(GI.gCfg.guideCfgs)),GI.moduleMgr.preInit(),GI.uiViewMgr.registerView("PrgView",te),GI.moduleMgr.addModule(Xi),GI.moduleMgr.doModulesPreInit();for(let t=0;t<GI.UiLayerEnum.num;t++)GI.uiViewMgr.registerView(GI.uiViewMgr.maskViewIDs[t],ie);GI.uiViewMgr.registerView("SysMainUi",zi),GI.uiViewMgr.registerView("ShopView",qi),GI.uiViewMgr.registerView("RoleView",Qi),GI.uiViewMgr.registerView("ChallengeView",Ki),GI.uiViewMgr.registerView("ChapterView",Zi),GI.uiViewMgr.registerView("GamePlayView",$i),GI.uiViewMgr.registerView("ScoreView",oe),GI.uiViewMgr.registerView("NativeAdView",ee),GI.uiViewMgr.registerView("InsertAdView",se),GI.uiViewMgr.registerView("BannerAdView",re),GI.uiViewMgr.registerView("AbGuideView",ae),GI.uiViewMgr.registerView("ObtainView",ne),GI.uiViewMgr.registerView("UnlockChapterView",le),GI.uiViewMgr.registerView("PropCollegeView",de),GI.uiViewMgr.registerView("PropGuideEndView",ge),GI.moduleMgr.doModulesInit(),GI.moduleMgr.doModulesLateInit(),Xi.i.enterWm()}}var ce,pe=Laya.ClassUtils.regClass;!function(t){!function(t){!function(t){class i extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.createView(i.uiView)}}i.uiView={type:"Scene",props:{y:360,x:640,width:1280,pivotY:360,pivotX:640,height:720},compId:2,child:[{type:"Sprite",props:{y:360,x:640,texture:"1stAsset/Login_Beijing_1.png",pivotY:450,pivotX:800,name:"bg"},compId:6},{type:"Sprite",props:{y:153,x:640,var:"imgLogo",texture:"1stAsset/Land_Logo_1.png",pivotY:87,pivotX:333,name:"imgLogo"},compId:3},{type:"Label",props:{y:666,x:640,width:600,var:"lblMsg",valign:"middle",strokeColor:"#000000",stroke:1,pivotY:60,pivotX:300,name:"lblMsg",height:120,fontSize:32,color:"#ffffff",bold:!0,align:"center"},compId:5}],loadList:["1stAsset/Login_Beijing_1.png","1stAsset/Land_Logo_1.png"],loadList3D:[]},t.LogoScUI=i,pe("ui.res.scene.LogoScUI",i);class e extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/scene/Main")}}t.MainUI=e,pe("ui.res.scene.MainUI",e)}(t.scene||(t.scene={}))}(t.res||(t.res={}))}(ce||(ce={}));class me{static initPf(t){t&&!GI.pf&&(GI.pf=GI.moduleMgr.addModule(t))}constructor(){this._isGameShow=!0,this.sysInfo=null,this.pfVer=0,this._nativeAdNum=0,this._nativeAdDay=0,this.flag=""}onGameStart(){GI.log("=======>>>pf-onGameStart:"+this.flag+",gVerName:"+GI.gCfg.gVerName+",gVerCode:"+GI.gCfg.gVerCode),this._nativeAdNum=GI.localDataMgr.getInt("pf.nativeAdNum"),this._nativeAdDay=this.getDay(GI.localDataMgr.getInt("pf.nativeAdDay")),this.webBasePath=GI.gCfg.webBasePath||GI.gCfg.webRoot&&GI.gCfg.webRoot+this.flag+"/release/",this.verPath=GI.gCfg.verPath||this.webBasePath&&this.webBasePath+this.flag+"Ver_"+GI.gCfg.gVerName.replace(/\./g,"_")+".json",this.verPath&&(this.verPath+="?v="+Math.floor(Date.now()/1e3))}preInit(){this.parseGCfg(this.flag),this.initBanner(),this.initInsertAd(),this.initVideoAd(),this.initNativeAd()}get isGameShow(){return this._isGameShow}onShow(t){GI.log("game.sys.onShow",t),this._isGameShow=!0,GI.gMsgCet.event("CMEVT_ON_SHOW",{res:t})}onHide(t){GI.log("game.sys.onHide",t),this._isGameShow=!1,GI.gMsgCet.event("CMEVT_ON_HIDE",{res:t})}parseGCfg(t){t&&(GI.gCfg.bindPros(GI.gCfg[t]),this.bindPosCfg(GI.gCfg.posCfg),this.bindPosCfg(GI.gCfg.pfPosCfg))}bindPosCfg(t){if(t&&GI.gCfg.posStr)for(const i of t)if(i&&i.pos)for(const t of i.pos)if(GI.gCfg.posStr.indexOf(t)>=0){GI.gCfg.bindPros(i.cfg);break}}login(){}initBanner(){this.bannerAdID&&(this.bannerAdType=Math.pow(2,GI.gCfg.bannerAdType-1),this.doInitBanner&&this.doInitBanner())}get bannerAdID(){return GI.gCfg.bannerAdID}getBannerStyle(t,i){i||(i=GI.gScale());let e=t&&t.bannerAdStyle||GI.gCfg.bannerAdStyle;return{top:i*(GI.gh()-e.height-e.bottomOff),left:i*(GI.gw()-e.width)/2,width:i*e.width,height:i*e.height}}showBanner(t){t&&t.sourceType&&(this.bannerAdType&t.sourceType)>0&&(this.isBannerShow=!0,this.doShowBanner(t))}doShowBanner(t){this.bannerAd&&this.isBannerShow&&this.exeShowBanner(t)}exeShowBanner(t){return this.bannerAd.show()}onBannerSuc(){GI.log("bannerAd显示成功"),GI.timerMgr.clear(this,this.doShowBanner)}onBannerError(t){GI.log("bannerAd 显示Error",t),this.isBannerShow&&GI.timerMgr.once(GI.gCfg.bannerAdErrorTime,this,this.doShowBanner)}hideBanner(t){t&&t.sourceType&&(this.bannerAdType&t.sourceType)>0&&(this.isBannerShow=!1,this.doHideBanner(t))}doHideBanner(t){GI.timerMgr.clear(this,this.doShowBanner),this.bannerAd&&!this.isBannerShow&&this.exeHideBanner(t)}exeHideBanner(t){return this.bannerAd.hide()}initInsertAd(){}showInsertAd(t){return GI.gCfg.insertAdID&&(!GI.gCfg.insertAdForbid||!t||!GI.gCfg.insertAdForbid[t.sourceType])&&!GI.guideMgr.isGuiding&&Math.random()<GI.gCfg.insertAdRatio&&this.doShowInsertAd(t)}doShowInsertAd(t){return GI.uiViewMgr.showView("InsertAdView")}initVideoAd(){GI.gCfg.videoAdID&&this.doInitVideoAd&&this.doInitVideoAd()}showVideoAd(t){this.videoAd&&this.exeLoadVideoAd(t)}exeLoadVideoAd(t){return this._videoAdCloseFunc=t&&t.closeFunc,this.videoAd.load()}onVideoAdLoadSuc(){return GI.log("激励视频加载成功"),this.exeShowVideoAd()}onVideoAdError(t){this._videoAdCloseFunc=null,GI.log("激励视频加载失败",t)}exeShowVideoAd(){return GI.soundMgr.setSoundMuted(this,!0),this.videoAd.show()}onVideoAdClose(t,i){GI.soundMgr.setSoundMuted(this,!1);let e=this._videoAdCloseFunc;this._videoAdCloseFunc=null,e&&e(t,i),t?(GI.log("激励视频广告完成，发放奖励"),GI.gMsgCet.event("CMEVT_ON_VIDEO_SUC")):GI.log("激励视频广告取消关闭，不发放奖励")}get nativeAdNum(){return this.getToday!=this._nativeAdDay&&(this.nativeAdNum=0),this._nativeAdNum}set nativeAdNum(t){this._nativeAdNum=t,this._nativeAdDay=this.getToday}get getToday(){return this.getDay(GI.timerMgr.currTimer)}getDay(t){return Math.floor(t/864e5)}initNativeAd(){GI.gCfg.nativeAds&&(this.nativeAds=GI.gCfg.nativeAds,this.nativeAdDatas={},this.tryCreateNativeAd())}tryCreateNativeAd(){if(this.nativeAds)for(const t in this.nativeAds){if(!this.nativeAds.hasOwnProperty(t))continue;const i=this.nativeAds[t];if(i.ids)for(const t of i.ids){let i=this.nativeAdDatas[t.id];if(!i)return i={id:t.id},this.nativeAdDatas[t.id]=i,this.createNativeAd(i),i.ad.load(),void GI.timerMgr.once(GI.gCfg.nativeAdCreateDelay,this,this.tryCreateNativeAd)}}}createNativeAd(t){!t.ad&&this.doCreateNativeAd&&this.doCreateNativeAd(t)}onNativeAdLoaded(t,i){GI.log("原生广告加载完成:"+t.id,i,i.adList,i.adList.length),t.adList=i.adList;let e=[];for(const i of t.adList)for(const t of i.imgUrlList)e.push(t);GI.resMgr.load(e,GI.handle(this,()=>{t.allLoaded=!0}))}onNativeAdError(t,i){GI.log("原生广告加载失败:"+t.id,t,i),GI.timerMgr.once(GI.gCfg.nativeAdErrorTime,this,()=>{t.ad.load()})}showNativeAd(t){if(!this.nativeAds||!t||!t.adType)return null;let i=this.nativeAds[t.adType]||this.nativeAds.default;if(!i||!i.ids||i.numLimit&&this.nativeAdNum>=GI.gCfg.nativeAdMaxNum)return null;let e=0;for(const t of i.ids){let i=this.nativeAdDatas[t.id];i&&i.allLoaded&&(e+=t.wv,t.tv=e)}let s=Math.random()*e;for(const e of i.ids){let r=this.nativeAdDatas[e.id];if(r&&r.allLoaded&&!(s>r.tv))return r.args=t,i.numLimit&&this.nativeAdNum++,r}return null}hideNativeAd(t){t&&t.adData&&(t.adData.args=null)}reportAdShow(t){t&&t.adData&&t.adData.ad&&t.adInfo&&t.adData.ad.reportAdShow({adId:t.adInfo.adId.toString()})}reportAdClick(t){t&&t.adData&&t.adData.ad&&t.adInfo&&t.adData.ad.reportAdClick({adId:t.adInfo.adId.toString()})}}me.initPf(class extends me{constructor(){super(),this.flag="web"}onGameStart(){super.onGameStart()}preInit(){super.preInit(),GI.stage.on(Laya.Event.FOCUS,this,this.onShow.bind(this)),GI.stage.on(Laya.Event.BLUR,this,this.onHide.bind(this))}});class ye{BeginContact(t){var i=t.GetFixtureA().collider,e=t.GetFixtureB().collider,s=i.owner,r=e.owner;if(0==t.IsTouching()&&console.log("==================BeginContactBeginContactBeginContact=============================="),s){var a=[e,i,t];s.event("Rigid.BeginContact",a)}if(r){a=[i,e,t];r.event("Rigid.BeginContact",a)}Laya.Physics.I._eventList.push(0,t)}EndContact(t){var i=t.GetFixtureA().collider,e=t.GetFixtureB().collider,s=i.owner,r=e.owner;if(t.IsTouching()){if(s){var a=[e,i,t];s.event("Rigid.EndContact",a)}if(r){a=[i,e,t];r.event("Rigid.EndContact",a)}}else{if(s){a=[e,i,t];s.event("Rigid.LeaveContact",a)}if(r){a=[i,e,t];r.event("Rigid.LeaveContact",a)}}Laya.Physics.I._eventList.push(1,t)}BeginContactFixtureParticle(t,i){}EndContactFixtureParticle(t,i){}BeginContactParticleParticle(t,i){}EndContactParticleParticle(t,i){}PreSolve(t,i){}PostSolve(t,i){var e=t.GetFixtureA().collider,s=t.GetFixtureB().collider,r=e.owner,a=s.owner;if(i.normalImpulses[0]>1||i.normalImpulses[1]>1){if(r){var o=[s,e,t,i];r.event("Rigid.PostSolve",o)}if(a){o=[e,s,t,i];a.event("Rigid.PostSolve",o)}}}}window.Laya3D?Laya3D.init(ji.width,ji.height):Laya.init(ji.width,ji.height,Laya.WebGL),null!=Laya.Physics&&(Laya.Physics.enable({gravity:9}),Laya.Physics.I.world.SetContactListener(new ye)),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=ji.scaleMode,Laya.stage.screenMode=ji.screenMode,Laya.stage.alignV=ji.alignV,Laya.stage.alignH=ji.alignH,Laya.stage.bgColor="#333333",Laya.URL.exportSceneToJson=ji.exportSceneToJson,(ji.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),Laya.alertGlobalError=!0,GI.instMgrs(),GI.isDebug&&Laya.Stat.show();let fe=Laya.stage.addChild(new class extends ce.res.scene.LogoScUI{onEnable(){super.onEnable(),this.onResize(),Laya.stage.on(Laya.Event.RESIZE,this,this.onResize)}setMsg(t){this.lblMsg.text=t}onResize(){this.pos(GI.gw()/2,GI.gh()/2)}});GI.resMgr.load("1stAsset/localCfg_1_0_9.json",GI.handle(null,t=>{GI.gCfg=t||{},GI.moduleMgr.onGameStart(),GI.pf.webBasePath&&(Laya.URL.basePath=GI.pf.webBasePath),Laya.ResourceVersion.enable(GI.pf.verPath||"version.json",GI.handle(null,()=>{let t=!1;function checkGameReady(){function initFGUI(){GI.log("posStr==="+GI.gCfg.posStr),GI.uiViewMgr.initFGUI(["sceneui","base","normal","pop","tip","info"],"normal","sceneui",GI.handle(null,()=>{ue.init(),fe&&(fe.destroy(!0),fe=null)}))}t&&GI.gCfg&&GI.gCfg.bindPros&&(GI.moduleMgr.onGameReady(),GI.gCfg.reqIp?GI.netMgr.getTxt(GI.gCfg.reqIp,GI.handle(null,t=>{GI.gCfg.posStr=t.resText,initFGUI()})):initFGUI())}Laya.AtlasInfoManager.enable("fileconfig.json",GI.handle(null,()=>{t=!0,checkGameReady()})),GI.resMgr.load("res/gCfg.json",GI.handle(null,t=>{if(!t)return GI.log("net error!!!"),void fe.setMsg("网络错误，请重新加载！");GI.gCfg.bindPros=function(t){return GI.util.bindPros(GI.gCfg,t)},GI.gCfg.bindPros(t),GI.gCfg.bindPros(GI.gCfg[GI.isDebug?"debug":"release"]),checkGameReady()}))}),Laya.ResourceVersion.FILENAME_VERSION)}))}();